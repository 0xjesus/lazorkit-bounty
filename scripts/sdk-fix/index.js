"use strict";var e=require("react/jsx-runtime"),t=require("react"),a=require("@solana/web3.js"),r=require("zustand"),n=require("@coral-xyz/anchor"),i=require("buffer"),s=require("js-sha256"),o=require("bs58"),l=require("eventemitter3"),c=require("@solana/wallet-adapter-base"),d=require("@solana/kora"),u=require("@wallet-standard/wallet");function A(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(a){if("default"!==a){var r=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,r.get?r:{enumerable:!0,get:function(){return e[a]}})}}),t.default=e,Object.freeze(t)}var p=A(n);function g(e,t){let a;try{a=e()}catch(e){return}return{getItem:e=>{var t;const r=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=a.getItem(e))?t:null;return n instanceof Promise?n.then(r):r(n)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}const m=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>m(e)(a),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>m(t)(e)}}},h=(e,t)=>(a,r,n)=>{let i={storage:g(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1;const o=new Set,l=new Set;let c=i.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),a(...e)},r,n);const d=()=>{const e=i.partialize({...r()});return c.setItem(i.name,{state:e,version:i.version})},u=n.setState;n.setState=(e,t)=>(u(e,t),d());const A=e((...e)=>(a(...e),d()),r,n);let p;n.getInitialState=()=>A;const h=()=>{var e,t;if(!c)return;s=!1,o.forEach(e=>{var t;return e(null!=(t=r())?t:A)});const n=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=r())?e:A))||void 0;return m(c.getItem.bind(c))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const t=i.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[n,s]=e;if(p=i.merge(s,null!=(t=r())?t:A),a(p,!0),n)return d()}).then(()=>{null==n||n(p,void 0),p=r(),s=!0,l.forEach(e=>e(p))}).catch(e=>{null==n||n(void 0,e)})};return n.persist={setOptions:e=>{i={...i,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>h(),hasHydrated:()=>s,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},i.skipHydration||h(),p||A},y={PORTAL_URL:"https://portal.lazor.sh",PAYMASTER_URL:"https://lazorkit-paymaster.onrender.com",RPC_ENDPOINT:"https://api.devnet.solana.com"},f={CONNECT:"connect",SIGN:"sign"},w="confirmed",b={WALLET:"lazorkit-wallet",CREDENTIALS:"lazorkit-credentials",PUBLIC_KEY:"PUBLIC_KEY",CREDENTIAL_ID:"CREDENTIAL_ID",SMART_WALLET_ADDRESS:"SMART_WALLET_ADDRESS"},S={getItem:async e=>{try{if("undefined"==typeof window)return null;return localStorage.getItem(e)}catch(t){return console.error("Error reading from localStorage:",t,{key:e}),null}},setItem:async(e,t)=>{try{if("undefined"==typeof window)return;localStorage.setItem(e,t)}catch(a){console.error("Error writing to localStorage:",a,{key:e,valueLength:t.length})}},removeItem:async e=>{try{if("undefined"==typeof window)return;localStorage.removeItem(e)}catch(t){console.error("Error removing from localStorage:",t,{key:e})}}};class k{static async saveWallet(e){try{await S.setItem(b.WALLET,JSON.stringify(e)),await S.setItem(b.CREDENTIAL_ID,e.credentialId),await S.setItem(b.SMART_WALLET_ADDRESS,e.smartWallet),await S.setItem(b.PUBLIC_KEY,i.Buffer.from(e.passkeyPubkey).toString("base64"))}catch(e){throw console.error("Failed to save wallet to storage:",e),e}}static async getWallet(){try{const e=await S.getItem(b.WALLET);return e?JSON.parse(e):null}catch(e){return console.error("Failed to get wallet from storage:",e),null}}static async saveConfig(e){try{await S.setItem("lazorkit-config",JSON.stringify(e))}catch(e){throw console.error("Failed to save config to storage:",e),e}}static async getConfig(){try{const e=await S.getItem("lazorkit-config");return e?JSON.parse(e):null}catch(e){return console.error("Failed to get config from storage:",e),null}}static async clearWallet(){try{await S.removeItem(b.WALLET),await S.removeItem(b.CREDENTIAL_ID),await S.removeItem(b.SMART_WALLET_ADDRESS),await S.removeItem(b.PUBLIC_KEY),await S.removeItem("CREDENTIALS_TIMESTAMP")}catch(e){throw console.error("Failed to clear wallet from storage:",e),e}}static async getItem(e){return await S.getItem(e)}static async setItem(e,t){await S.setItem(e,t)}static async removeItem(e){await S.removeItem(e)}}class I{constructor(e){this.context=e,this.enabled="production"!==process.env.NODE_ENV}debug(e,t){this.enabled&&console.debug(`[${this.context}] ${e}`,t)}info(e,t){console.info(`[${this.context}] ${e}`,t)}warn(e,t){console.warn(`[${this.context}] ${e}`,t)}error(e,t){console.error(`[${this.context}] ${e}`,t)}}class v{constructor(e){this.logger=new I("Paymaster"),this.endpoint=e.paymasterUrl,this.apiKey=e.apiKey}getHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["x-api-key"]=this.apiKey),e}async getPayer(){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getPayerSigner",params:[]})});if(!e.ok)throw new Error(`Failed to get payer: ${e.statusText}`);const t=await e.json();return new a.PublicKey(t.result.signer_address)}catch(e){throw this.logger.error("Failed to get payer",e),e}}async getBlockhash(){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"getBlockhash",id:1,params:[]})});if(!e.ok)throw new Error(`Failed to get blockhash: ${e.statusText}`);return(await e.json()).result.blockhash}catch(e){throw this.logger.error("Failed to get blockhash",e),e}}async attemptSign(e,t=1){try{const t=e.serialize({verifySignatures:!1,requireAllSignatures:!1}),r=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signTransaction",id:1,params:[t.toString("base64")]})});if(!r.ok)throw new Error(`Failed to sign transaction: ${r.statusText}`);const n=await r.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return a.Transaction.from(i.Buffer.from(n.result.signed_transaction,"base64"))}catch(e){throw this.logger.error(`Sign attempt ${t} failed:`,e),e}}async sign(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSign(e,r)}catch(e){if(r===t)throw this.logger.error("All sign retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying sign in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign transaction after all retries")}async attemptSignAndSend(e,t=1){try{const t=e.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[t.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign and send transaction: ${a.statusText}`);const r=await a.json();if(r.error)throw new Error(r.error.message||"Unknown paymaster error");return r.result.signature}catch(e){throw this.logger.error(`Attempt ${t} failed:`,e),e}}async signAndSend(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSignAndSend(e,r)}catch(e){if(r===t)throw this.logger.error("All retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign and send transaction after all retries")}async attemptSignAndSendVersionedTransaction(e,t=1){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[i.Buffer.from(e.serialize()).toString("base64")]})});if(!t.ok)throw new Error(`Failed to sign and send transaction: ${t.statusText}`);const a=await t.json();if(a.error)throw new Error(a.error.message||"Unknown paymaster error");return a.result.signature}catch(e){throw this.logger.error(`Attempt ${t} failed:`,e),e}}async signAndSendVersionedTransaction(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSignAndSendVersionedTransaction(e,r)}catch(e){if(r===t)throw this.logger.error("All retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign and send transaction after all retries")}}var P,C={address:"Gsuz7YcA5sbMGVRXT3xSYhJBessW4xFC4xYsihNCqMFh",metadata:{name:"lazorkit",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},docs:["LazorKit: Smart Wallet with WebAuthn Passkey Authentication"],instructions:[{name:"close_chunk",discriminator:[150,183,213,198,0,74,14,170],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0}],args:[]},{name:"create_chunk",discriminator:[83,226,15,219,9,19,186,90],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"wallet_state.last_nonce",account:"WalletState"}]}},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateChunkArgs"}}}]},{name:"create_smart_wallet",discriminator:[129,39,235,18,132,68,203,19],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"arg",path:"args.wallet_id"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"policy_program"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateSmartWalletArgs"}}}]},{name:"delete_smart_wallet",discriminator:[126,239,172,118,134,32,52,102],accounts:[{name:"payer",writable:!0,signer:!0,address:"BE8duRBDmh4cF4Ecz4TBCNgNAMCaonrpQiEiQ1xfQmab"},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[]},{name:"execute",discriminator:[130,221,242,154,13,193,189,29],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"cpi_program"},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"ExecuteArgs"}}}]},{name:"execute_chunk",discriminator:[106,83,113,47,89,243,39,220],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"instruction_data_list",type:{vec:"bytes"}},{name:"split_index",type:"bytes"}]}],accounts:[{name:"Chunk",discriminator:[134,67,80,65,135,143,156,196]},{name:"WalletDevice",discriminator:[35,85,31,31,179,48,136,123]},{name:"WalletState",discriminator:[126,186,0,158,92,223,167,68]}],errors:[{code:6e3,name:"PasskeyMismatch",msg:"Passkey public key mismatch with stored authenticator"},{code:6001,name:"InvalidPolicyDataSize",msg:"Invalid policy data size"},{code:6002,name:"Secp256r1InvalidLength",msg:"Secp256r1 instruction has invalid data length"},{code:6003,name:"Secp256r1HeaderMismatch",msg:"Secp256r1 instruction header validation failed"},{code:6004,name:"Secp256r1DataMismatch",msg:"Secp256r1 signature data validation failed"},{code:6005,name:"InvalidSignature",msg:"Invalid signature provided for passkey verification"},{code:6006,name:"ClientDataInvalidUtf8",msg:"Client data JSON is not valid UTF-8"},{code:6007,name:"ClientDataJsonParseError",msg:"Client data JSON parsing failed"},{code:6008,name:"ChallengeMissing",msg:"Challenge field missing from client data JSON"},{code:6009,name:"ChallengeBase64DecodeError",msg:"Challenge base64 decoding failed"},{code:6010,name:"ChallengeDeserializationError",msg:"Challenge message deserialization failed"},{code:6011,name:"HashMismatch",msg:"Message hash mismatch: expected different value"},{code:6012,name:"InvalidInstructionDiscriminator",msg:"Invalid instruction discriminator"},{code:6013,name:"InsufficientCpiAccounts",msg:"Insufficient remaining accounts for CPI instruction"},{code:6014,name:"AccountSliceOutOfBounds",msg:"Account slice index out of bounds"},{code:6015,name:"InvalidAccountOwner",msg:"Account owner verification failed"},{code:6016,name:"ProgramNotExecutable",msg:"Program not executable"},{code:6017,name:"CredentialIdEmpty",msg:"Credential ID cannot be empty"},{code:6018,name:"PolicyDataTooLarge",msg:"Policy data exceeds maximum allowed size"},{code:6019,name:"TransactionTooOld",msg:"Transaction is too old"},{code:6020,name:"InvalidInstructionData",msg:"Invalid instruction data"},{code:6021,name:"InvalidInstruction",msg:"Invalid instruction"},{code:6022,name:"InsufficientBalanceForFee",msg:"Insufficient balance for fee"},{code:6023,name:"InvalidSequenceNumber",msg:"Invalid sequence number"},{code:6024,name:"InvalidPasskeyFormat",msg:"Invalid passkey format"},{code:6025,name:"ReentrancyDetected",msg:"Reentrancy detected"},{code:6026,name:"UnauthorizedAdmin",msg:"Unauthorized admin"}],types:[{name:"Chunk",docs:["Transaction chunk for deferred execution","","Created after full passkey and policy verification. Contains all bindings","necessary to execute the transaction later without re-verification.","Used for large transactions that need to be split into manageable chunks."],type:{kind:"struct",fields:[{name:"owner_wallet_address",docs:["Smart wallet address that authorized this chunk session"],type:"pubkey"},{name:"cpi_hash",docs:["Combined SHA256 hash of all cpi transaction instruction data"],type:{array:["u8",32]}},{name:"authorized_nonce",docs:["The nonce that was authorized at chunk creation (bound into data hash)"],type:"u64"},{name:"authorized_timestamp",docs:["Timestamp from the original message hash for expiration validation"],type:"i64"},{name:"rent_refund_address",docs:["Address to receive rent refund when closing the chunk session"],type:"pubkey"}]}},{name:"CreateChunkArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"policy_data",type:"bytes"},{name:"timestamp",type:"i64"},{name:"cpi_hash",type:{array:["u8",32]}}]}},{name:"CreateSmartWalletArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"init_policy_data",type:"bytes"},{name:"wallet_id",type:"u64"},{name:"amount",type:"u64"},{name:"policy_data_size",type:"u16"}]}},{name:"ExecuteArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"split_index",type:"u16"},{name:"policy_data",type:"bytes"},{name:"cpi_data",type:"bytes"},{name:"timestamp",type:"i64"}]}},{name:"WalletDevice",docs:["Wallet device account linking a passkey to a smart wallet"],type:{kind:"struct",fields:[{name:"passkey_pubkey",docs:["Secp256r1 compressed public key (33 bytes)"],type:{array:["u8",33]}},{name:"credential_hash",docs:["SHA256 hash of the credential ID"],type:{array:["u8",32]}},{name:"smart_wallet",docs:["Associated smart wallet address"],type:"pubkey"},{name:"bump",docs:["PDA bump seed"],type:"u8"}]}},{name:"WalletState",docs:["Wallet state account storing wallet configuration and execution state"],type:{kind:"struct",fields:[{name:"bump",docs:["PDA bump seed for smart wallet"],type:"u8"},{name:"wallet_id",docs:["Unique wallet identifier"],type:"u64"},{name:"last_nonce",docs:["Last used nonce for anti-replay protection"],type:"u64"},{name:"policy_program",docs:["Policy program that validates transactions"],type:"pubkey"},{name:"policy_data",docs:["Serialized policy data returned from policy initialization"],type:"bytes"}]}}]};function W(e,t){return e.keys.map(e=>({pubkey:e.pubkey,isWritable:e.isWritable,isSigner:!!t&&t.some(t=>t.toString()===e.pubkey.toString())}))}function D(e){if("function"==typeof globalThis.crypto?.getRandomValues){const t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),t}try{const{randomBytes:t}=require("crypto");return t(e)}catch{throw new Error("No CSPRNG available")}}function E(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}function B(e){const t=i.Buffer.from(e,"base64");return Array.from(new Uint8Array(s.sha256.arrayBuffer(t)))}async function x(e){const t=await e.getSlot(),a=await e.getBlockTime(t);return new p.BN(a||Math.floor(Date.now()/1e3))}function T(e){return e}function U(e){return e}exports.SmartWalletAction=void 0,(P=exports.SmartWalletAction||(exports.SmartWalletAction={})).Execute="execute",P.CreateChunk="create_chunk",P.ExecuteChunk="execute_chunk";var R={address:"BiE9vSdz9MidUiyjVYsu3PG4C1fbPZ8CVPADA9jRfXw7",metadata:{name:"default_policy",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},instructions:[{name:"check_policy",discriminator:[28,88,170,179,239,136,25,35],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet"}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"policy_data",type:"bytes"}]},{name:"init_policy",discriminator:[45,234,110,100,209,146,191,86],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}],returns:{defined:{name:"PolicyStruct"}}}],errors:[{code:6e3,name:"InvalidPasskey",msg:"Invalid passkey format"},{code:6001,name:"Unauthorized",msg:"Unauthorized to access smart wallet"}],types:[{name:"DeviceSlot",type:{kind:"struct",fields:[{name:"passkey_pubkey",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}]}},{name:"PolicyStruct",type:{kind:"struct",fields:[{name:"bump",type:"u8"},{name:"smart_wallet",type:"pubkey"},{name:"device_slots",type:{vec:{defined:{name:"DeviceSlot"}}}}]}}]};const M=i.Buffer.from("policy");const H=890880;class Q extends Error{constructor(e,t){super(e),this.field=t,this.name="ValidationError"}}function N(e,t){if(null==e||void 0===e){throw new Q(`${t} is required but was ${null===e?"null":"undefined"}`,t)}}function K(e,t){N(e,t);try{if("string"==typeof e){if(0===e.trim().length)throw new Q(`${t} cannot be an empty string`,t);new p.web3.PublicKey(e)}else{if(!(e instanceof p.web3.PublicKey||e&&"object"==typeof e&&"toBase58"in e&&"function"==typeof e.toBase58&&"toBytes"in e&&"function"==typeof e.toBytes))throw new Q(`${t} must be a PublicKey instance or valid base58 string`,t)}}catch(e){if(e instanceof Q)throw e;throw new Q(`${t} is not a valid PublicKey: ${e instanceof Error?e.message:"Invalid format"}`,t)}}function O(e,t,a){let r;if(N(e,a),Array.isArray(e))r=e;else if(e instanceof Uint8Array)r=Array.from(e);else{if(!e||"object"!=typeof e||"number"!=typeof e.length)throw new Q(`${a} must be an array or Uint8Array`,a);r=Array.from(e)}if(r.length!==t)throw new Q(`${a} must be exactly ${t} bytes, got ${r.length}`,a);for(let e=0;e<r.length;e++){const t=r[e];if("number"!=typeof t||!Number.isFinite(t)||!Number.isInteger(t)||t<0||t>255)throw new Q(`${a}[${e}] must be a valid byte (0-255), got ${"number"==typeof t?t:typeof t}`,a)}}function z(e,t="passkeyPublicKey"){O(e,33,t)}function L(e,t="credentialHash"){O(e,32,t)}function V(e,t="signature"){O(e,64,t)}function F(e,t){N(e,t);if(!(e instanceof p.BN||e&&"object"==typeof e&&"lt"in e&&"function"==typeof e.lt&&"toString"in e&&"function"==typeof e.toString))throw new Q(`${t} must be a BN instance`,t);if(e.lt(new p.BN(0)))throw new Q(`${t} must be non-negative, got ${e.toString()}`,t)}function _(e,t){if(N(e,t),"string"!=typeof e)throw new Q(`${t} must be a string (got ${typeof e})`,t);if(0===String(e).trim().length)throw new Q(`${t} cannot be empty`,t)}function j(e,t){if(N(e,t),!Array.isArray(e))throw new Q(`${t} must be an array (got ${typeof e}${e&&"object"==typeof e?` with constructor ${e.constructor?.name||"unknown"}`:""})`,t);if(0===e.length)throw new Q(`${t} cannot be empty`,t)}function G(e,t){N(e,t);if(!(e instanceof p.web3.TransactionInstruction||e&&"object"==typeof e&&"programId"in e&&"keys"in e&&Array.isArray(e.keys)&&"data"in e))throw new Q(`${t} must be a TransactionInstruction instance`,t);if(K(e.programId,`${t}.programId`),!e.keys||!Array.isArray(e.keys)||0===e.keys.length)throw new Q(`${t} must have at least one account key`,t)}function J(e){return Array.isArray(e)?e:Array.from(e)}function Z(e,t){_(e,t);if(!/^[A-Za-z0-9+/]*={0,2}$/.test(e))throw new Q(`${t} is not a valid base64 string (invalid characters)`,t);try{"undefined"!=typeof Buffer&&Buffer.from?Buffer.from(e,"base64"):"undefined"!=typeof atob&&atob(e)}catch(e){throw new Q(`${t} is not a valid base64 string: ${e instanceof Error?e.message:"Invalid format"}`,t)}}function Y(e,t){if(N(e,t),"number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))throw new Q(`${t} must be a finite number (got ${Number.isNaN(e)?"NaN":Number.isFinite(e)?typeof e:e===1/0?"Infinity":"-Infinity"})`,t);if(!Number.isInteger(e))throw new Q(`${t} must be an integer, got ${e}`,t);if(e<=0)throw new Q(`${t} must be a positive integer, got ${e}`,t)}function X(e,t){j(e,t),e.forEach((e,a)=>{K(e,`${t}[${a}]`)})}function q(e,t){j(e,t),e.forEach((e,a)=>{G(e,`${t}[${a}]`)})}function $(e){return Array.isArray(e)?[...e]:Array.from(e)}class ee{constructor(e){N(e,"connection"),this.connection=e,this.program=new p.Program(R,{connection:e}),this.programId=this.program.programId}policyPda(e){return K(e,"smartWallet"),function(e,t){return p.web3.PublicKey.findProgramAddressSync([M,t.toBuffer()],e)[0]}(this.programId,e)}getPolicyDataSize(){return 102}validateInitPolicyParams(e){N(e,"params"),F(e.walletId,"params.walletId"),z(e.passkeyPublicKey,"params.passkeyPublicKey"),L(e.credentialHash,"params.credentialHash"),K(e.policySigner,"params.policySigner"),K(e.smartWallet,"params.smartWallet"),K(e.walletState,"params.walletState")}async buildInitPolicyIx(e){return this.validateInitPolicyParams(e),await this.program.methods.initPolicy(e.walletId,$(e.passkeyPublicKey),$(e.credentialHash)).accountsPartial({smartWallet:e.smartWallet,walletState:e.walletState,policySigner:e.policySigner}).instruction()}validateCheckPolicyParams(e){if(N(e,"params"),F(e.walletId,"params.walletId"),z(e.passkeyPublicKey,"params.passkeyPublicKey"),K(e.policySigner,"params.policySigner"),K(e.smartWallet,"params.smartWallet"),L(e.credentialHash,"params.credentialHash"),N(e.policyData,"params.policyData"),!Buffer.isBuffer(e.policyData))throw new Q("params.policyData must be a Buffer instance","params.policyData")}async buildCheckPolicyIx(e){return this.validateCheckPolicyParams(e),await this.program.methods.checkPolicy(e.walletId,$(e.passkeyPublicKey),$(e.credentialHash),e.policyData).accountsPartial({smartWallet:e.smartWallet,policySigner:e.policySigner}).instruction()}}function te(e,t){const a=i.Buffer.concat([e.toBuffer(),i.Buffer.from(t)]),r=s.sha256.arrayBuffer(a);return i.Buffer.from(r).subarray(0,32)}const ae=32,re=new p.web3.PublicKey("Secp256r1SigVerify1111111111111111111111111"),ne=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),ie=new Uint8Array([127,255,255,255,128,0,0,0,127,255,255,255,255,255,255,255,222,115,125,86,211,139,207,66,121,220,229,97,126,49,146,168]);function se(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);{const t=new ArrayBuffer(2*Object.values(e).length),a=new DataView(t);return Object.values(e).forEach((e,t)=>{a.setUint16(2*t,e,!0)}),new Uint8Array(t)}}function oe(e,t,a){try{const r=a.slice(0,ae),n=a.slice(ae,64),s=i.Buffer.alloc(ae,0),o=i.Buffer.alloc(ae,0);if(r.copy(s,ae-r.length),n.copy(o,ae-n.length),function(e,t){if(e.length!==t.length)return e.length>t.length;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return e[a]>t[a];return!1}(o,ie)){const e=function(e,t){const a=new Uint8Array(e.length);let r=0;for(let n=e.length-1;n>=0;n--){let i=e[n]-t[n]-r;i<0?(i+=256,r=1):r=0,a[n]=i}return a}(ne,o);a=i.Buffer.concat([s,i.Buffer.from(e)])}else a=i.Buffer.concat([s,o]);if(33!==t.length||64!==a.length)throw new Error("Invalid key or signature length");const l=113+e.length,c=new Uint8Array(l),d=1,u=16,A=u+33,g=A+64;c.set(se([d,0]),0);const m={signature_offset:A,signature_instruction_index:65535,public_key_offset:u,public_key_instruction_index:65535,message_data_offset:g,message_data_size:e.length,message_instruction_index:65535};return c.set(se(m),2),c.set(t,u),c.set(a,A),c.set(e,g),new p.web3.TransactionInstruction({keys:[],programId:re,data:i.Buffer.from(c)})}catch(e){throw new Error(`Failed to create secp256r1 instruction: ${e}`)}}const le=i.Buffer.from("smart_wallet"),ce=i.Buffer.from("wallet_state"),de=i.Buffer.from("wallet_device"),ue=i.Buffer.from("chunk");function Ae(e,t){return p.web3.PublicKey.findProgramAddressSync([le,t.toArrayLike(i.Buffer,"le",8)],e)[0]}function pe(e,t){return p.web3.PublicKey.findProgramAddressSync([ce,t.toBuffer()],e)[0]}function ge(e,t,a){return p.web3.PublicKey.findProgramAddressSync([de,te(t,a)],e)}function me(e,t,a){return p.web3.PublicKey.findProgramAddressSync([ue,t.toBuffer(),a.toArrayLike(i.Buffer,"le",8)],e)[0]}class he{constructor(e){this.programId=e}smartWallet(e){return F(e,"walletId"),Ae(this.programId,e)}walletState(e){return K(e,"smartWallet"),pe(this.programId,e)}walletDevice(e,t){return K(e,"smartWallet"),L(t,"credentialHash"),ge(this.programId,e,t)[0]}chunk(e,t){return K(e,"smartWallet"),me(this.programId,e,t)}}class ye{constructor(e,t){this.policyClient=e,this.walletPdas=t}async resolveForExecute({provided:e,smartWallet:t,credentialHash:a,passkeyPublicKey:r,walletStateData:n}){if(null!==e)return e;const i=this.walletPdas.walletDevice(t,a);return this.policyClient.buildCheckPolicyIx({walletId:n.walletId,passkeyPublicKey:r,policySigner:i,smartWallet:t,credentialHash:a,policyData:n.policyData})}async resolveForCreate({provided:e,smartWalletId:t,smartWallet:a,walletState:r,passkeyPublicKey:n,credentialHash:i}){if(null!=e)return e;const s=this.walletPdas.walletDevice(a,i);return this.policyClient.buildInitPolicyIx({walletId:t,passkeyPublicKey:n,credentialHash:i,policySigner:s,smartWallet:a,walletState:r})}}let fe=null;const we=e=>new Uint8Array(s.sha256.arrayBuffer(e)),be=(e,t,a)=>{const r=s.sha256.create();r.update(e.toBytes());for(const e of t)r.update(e.pubkey.toBytes()),r.update(Uint8Array.from([e.isSigner?1:0])),r.update(Uint8Array.from([e.pubkey.toString()===a.toString()||e.isWritable?1:0]));return new Uint8Array(r.arrayBuffer())},Se=(e,t)=>{const a=W(e),r=be(e.programId,a,t);return{policyDataHash:we(e.data),policyAccountsHash:r}},ke=(e,t,a)=>{const r=i.Buffer.alloc(4);r.writeUInt32LE(e.length,0);const n=i.Buffer.concat([r,...e.map(e=>{const t=i.Buffer.from(e.data),a=i.Buffer.alloc(4);return a.writeUInt32LE(t.length,0),i.Buffer.concat([a,t])})]),o=we(n),l=((e,t)=>{const a=new Map;for(const t of e){const e=t.pubkey.toString(),r=a.get(e);r?(r.isSigner=r.isSigner||t.isSigner,r.isWritable=r.isWritable||t.isWritable):a.set(e,{isSigner:t.isSigner,isWritable:t.isWritable})}const r=e.map(e=>{const t=e.pubkey.toString(),r=a.get(t);return{pubkey:e.pubkey,isSigner:r.isSigner,isWritable:r.isWritable}}),n=s.sha256.create();for(const e of r)n.update(e.pubkey.toBytes()),n.update(Uint8Array.from([e.isSigner?1:0])),n.update(Uint8Array.from([e.pubkey.toString()===t.toString()||e.isWritable?1:0]));return new Uint8Array(n.arrayBuffer())})(e.flatMap(e=>[{pubkey:e.programId,isSigner:!1,isWritable:!1},...W(e,a)]),t);return{cpiDataHash:o,cpiAccountsHash:l}},Ie=(e,t)=>{try{const a=(fe||(fe=new p.BorshCoder({version:"0.1.0",name:"lazorkit_msgs",instructions:[],accounts:[],types:[{name:"SimpleMessage",type:{kind:"struct",fields:[{name:"dataHash",type:{array:["u8",32]}}]}}]})),fe).types.encode(e,t);return i.Buffer.from(a)}catch(t){throw new Error(`Failed to encode ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}};function ve(e,t,a,r,n,s){const o=Se(r,e),l=((e,t,a)=>{const r=W(e,a),n=be(e.programId,r,t);return{cpiDataHash:we(e.data),cpiAccountsHash:n}})(n,e,s??[]),c=new Uint8Array(64);c.set(o.policyDataHash,0),c.set(o.policyAccountsHash,32);const d=we(c),u=new Uint8Array(64);u.set(l.cpiDataHash,0),u.set(l.cpiAccountsHash,32);const A=we(u),p=i.Buffer.alloc(8);p.writeBigUInt64LE(BigInt(t.toString()),0);const g=i.Buffer.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=i.Buffer.concat([p,g,i.Buffer.from(d),i.Buffer.from(A)]),h=we(m);return Ie("SimpleMessage",{dataHash:Array.from(h)})}function Pe(e,t,a,r,n,s){const o=Se(r,e),l=ke(n,e,s),c=new Uint8Array(64);c.set(o.policyDataHash,0),c.set(o.policyAccountsHash,32);const d=we(c),u=new Uint8Array(64);u.set(l.cpiDataHash,0),u.set(l.cpiAccountsHash,32);const A=we(u),p=i.Buffer.alloc(8);p.writeBigUInt64LE(BigInt(t.toString()),0);const g=i.Buffer.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=i.Buffer.concat([p,g,i.Buffer.from(d),i.Buffer.from(A)]),h=we(m);return Ie("SimpleMessage",{dataHash:Array.from(h)})}function Ce(e){z(e.passkeyPublicKey,"passkeySignature.passkeyPublicKey"),Z(e.signature64,"passkeySignature.signature64"),Z(e.clientDataJsonRaw64,"passkeySignature.clientDataJsonRaw64"),Z(e.authenticatorDataRaw64,"passkeySignature.authenticatorDataRaw64");const t=Buffer.from(e.authenticatorDataRaw64,"base64"),a=Buffer.from(e.clientDataJsonRaw64,"base64"),r=Buffer.from(e.signature64,"base64");V(J(r),"passkeySignature.signature64 (decoded)");return oe(Buffer.concat([t,Buffer.from(s.sha256.arrayBuffer(a))]),e.passkeyPublicKey,r)}function We(e){const t=Buffer.from(e.signature64,"base64");return V(J(t),"passkeySignature.signature64 (decoded)"),{passkeyPublicKey:e.passkeyPublicKey,signature:J(t),clientDataJsonRaw:Buffer.from(e.clientDataJsonRaw64,"base64"),authenticatorDataRaw:Buffer.from(e.authenticatorDataRaw64,"base64")}}function De(e){return p.web3.ComputeBudgetProgram.setComputeUnitLimit({units:e})}function Ee(e,t){return void 0===t?e:[De(t),...e]}function Be(e,t){return[e,...t]}function xe(e){return void 0!==e?1:0}async function Te(e,t,a,r={}){const{addressLookupTables:n,recentBlockhash:i,computeUnitLimit:s}=r,o=Ee(a,s),l=n||[],c=i||(await e.getLatestBlockhash()).blockhash;if(l.length>0){console.log("lookupTables in buildTransaction",l);const e=new p.web3.TransactionMessage({payerKey:t,recentBlockhash:c,instructions:o}).compileToV0Message(l);return{transaction:new p.web3.VersionedTransaction(e),isVersioned:!0,recentBlockhash:c}}{const e=(new p.web3.Transaction).add(...o);return e.feePayer=t,e.recentBlockhash=c,{transaction:e,isVersioned:!1,recentBlockhash:c}}}"undefined"!=typeof globalThis&&(globalThis.Buffer=i.Buffer),i.Buffer.prototype.subarray=function(e,t){const a=Uint8Array.prototype.subarray.apply(this,[e,t]);return Object.setPrototypeOf(a,i.Buffer.prototype),a};class Ue{constructor(e){this.connection=e,this.program=new p.Program(C,{connection:e}),this.programId=this.program.programId,this.defaultPolicyProgram=new ee(e),this.walletPdas=new he(this.programId),this.policyResolver=new ye(this.defaultPolicyProgram,this.walletPdas)}getSmartWalletPubkey(e){return this.walletPdas.smartWallet(e)}getWalletStatePubkey(e){return this.walletPdas.walletState(e)}getWalletDevicePubkey(e,t){return this.walletPdas.walletDevice(e,t)}getChunkPubkey(e,t){return this.walletPdas.chunk(e,t)}generateWalletId(){return new p.BN(D(8),"le")}async fetchWalletStateContext(e){const t=this.getWalletStatePubkey(e);return{walletState:t,data:await this.program.account.walletState.fetch(t)}}async fetchChunkContext(e,t){const a=this.getChunkPubkey(e,t);return{chunk:a,data:await this.program.account.chunk.fetch(a)}}validateCreateSmartWalletParams(e){N(e,"params"),K(e.payer,"params.payer"),z(e.passkeyPublicKey,"params.passkeyPublicKey"),Z(e.credentialIdBase64,"params.credentialIdBase64"),void 0!==e.amount&&F(e.amount,"params.amount"),void 0!==e.smartWalletId&&F(e.smartWalletId,"params.smartWalletId"),void 0!==e.policyDataSize&&Y(e.policyDataSize,"params.policyDataSize"),null!==e.policyInstruction&&void 0!==e.policyInstruction&&G(e.policyInstruction,"params.policyInstruction")}validateExecuteParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),L(e.credentialHash,"params.credentialHash"),G(e.cpiInstruction,"params.cpiInstruction"),F(e.timestamp,"params.timestamp"),null!==e.policyInstruction&&G(e.policyInstruction,"params.policyInstruction")}validateCreateChunkParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),L(e.credentialHash,"params.credentialHash"),q(e.cpiInstructions,"params.cpiInstructions"),F(e.timestamp,"params.timestamp"),null!==e.policyInstruction&&G(e.policyInstruction,"params.policyInstruction"),void 0!==e.cpiSigners&&X(e.cpiSigners,"params.cpiSigners")}validateExecuteChunkParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),q(e.cpiInstructions,"params.cpiInstructions"),void 0!==e.cpiSigners&&X(e.cpiSigners,"params.cpiSigners")}validateCloseChunkParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),F(e.nonce,"params.nonce")}async getWalletStateData(e){const{data:t}=await this.fetchWalletStateContext(e);return t}async getChunkData(e){return await this.program.account.chunk.fetch(e)}async getSmartWalletByPasskey(e){z(e,"passkeyPublicKey");const t=C.accounts?.find(e=>"WalletState"===e.name)?.discriminator;if(!t)throw new Q("WalletState discriminator not found in IDL","passkeyPublicKey");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:o.encode(t)}}]});for(const t of a)try{const a=this.program.coder.accounts.decode("WalletState",t.account.data);for(const r of a.devices)if(E(r.passkeyPubkey,e)){return{smartWallet:this.getSmartWalletPubkey(a.walletId),walletState:t.pubkey,deviceSlot:{passkeyPubkey:r.passkeyPubkey,credentialHash:r.credentialHash}}}}catch(e){continue}return{smartWallet:null,walletState:null,deviceSlot:null}}async getSmartWalletByCredentialHash(e){L(e,"credentialHash");const t=C.accounts?.find(e=>"WalletDevice"===e.name)?.discriminator;if(!t)throw new Q("WalletDevice discriminator not found in IDL","credentialHash");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:o.encode(t)}},{memcmp:{offset:41,bytes:o.encode(e)}}]});if(0===a.length)return null;for(const e of a){const t=await this.program.account.walletDevice.fetch(e.pubkey);return{smartWallet:t.smartWallet,walletState:this.getWalletStatePubkey(t.smartWallet),walletDevice:e.pubkey,passkeyPubkey:t.passkeyPubkey}}return null}async buildCreateSmartWalletIns(e,t,a,r){return K(e,"payer"),K(t,"smartWallet"),G(a,"policyInstruction"),N(r,"args"),z(r.passkeyPublicKey,"args.passkeyPublicKey"),L(r.credentialHash,"args.credentialHash"),F(r.walletId,"args.walletId"),F(r.amount,"args.amount"),await this.program.methods.createSmartWallet(r).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),walletDevice:this.getWalletDevicePubkey(t,r.credentialHash),policyProgram:a.programId,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(a)]).instruction()}async buildExecuteIns(e,t,a,r,n,i,s){return K(e,"payer"),K(t,"smartWallet"),K(a,"walletDevice"),N(r,"args"),G(n,"policyInstruction"),G(i,"cpiInstruction"),void 0!==s&&X(s,"cpiSigners"),await this.program.methods.execute(r).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),walletDevice:a,policyProgram:n.programId,cpiProgram:i.programId,ixSysvar:p.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(n),...W(i,s)]).instruction()}async buildCreateChunkIns(e,t,a,r,n){K(e,"payer"),K(t,"smartWallet"),K(a,"walletDevice"),N(r,"args"),G(n,"policyInstruction");const{walletState:i,data:s}=await this.fetchWalletStateContext(t),o=this.getChunkPubkey(t,s.lastNonce);return await this.program.methods.createChunk(r).accountsPartial({payer:e,smartWallet:t,walletState:i,walletDevice:a,policyProgram:n.programId,chunk:o,ixSysvar:p.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(n)]).instruction()}async buildExecuteChunkIns(e,t,a,r){K(e,"payer"),K(t,"smartWallet"),q(a,"cpiInstructions"),void 0!==r&&X(r,"cpiSigners");const{data:n}=await this.fetchWalletStateContext(t),s=n.lastNonce.sub(new p.BN(1)),{chunk:o,data:l}=await this.fetchChunkContext(t,s),c=a.map(e=>i.Buffer.from(e.data)),d=function(e){const t=[];let a=0;for(let r=0;r<e.length-1;r++)a+=e[r].keys.length+1,t.push(a);return t}(a),u=function(e,t){return e.flatMap(e=>[{pubkey:e.programId,isSigner:!1,isWritable:!1},...W(e,t)])}(a,r);return await this.program.methods.executeChunk(c,i.Buffer.from(d)).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),chunk:o,sessionRefund:l.rentRefundAddress,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts(u).instruction()}async buildCloseChunkIns(e,t,a){K(e,"payer"),K(t,"smartWallet"),F(a,"nonce");const{chunk:r,data:n}=await this.fetchChunkContext(t,a);return await this.program.methods.closeChunk().accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),chunk:r,sessionRefund:n.rentRefundAddress}).instruction()}async createSmartWalletTxn(e,t={}){this.validateCreateSmartWalletParams(e);const a=e.smartWalletId??this.generateWalletId(),r=this.getSmartWalletPubkey(a),n=this.getWalletStatePubkey(r),i=e.amount??new p.BN(H),s=e.policyDataSize??this.defaultPolicyProgram.getPolicyDataSize(),o=B(e.credentialIdBase64),l=await this.policyResolver.resolveForCreate({provided:e.policyInstruction,smartWalletId:a,smartWallet:r,walletState:n,passkeyPublicKey:e.passkeyPublicKey,credentialHash:o}),c={passkeyPublicKey:e.passkeyPublicKey,credentialHash:o,initPolicyData:l.data,walletId:a,amount:i,policyDataSize:s},d=await this.buildCreateSmartWalletIns(e.payer,r,l,c);return{transaction:(await Te(this.connection,e.payer,[d],t)).transaction,smartWalletId:a,smartWallet:r}}async executeTxn(e,t={}){this.validateExecuteParams(e);const a=Ce(e.passkeySignature),r=await this.getWalletStateData(e.smartWallet),n=this.getWalletDevicePubkey(e.smartWallet,e.credentialHash),i=await this.policyResolver.resolveForExecute({provided:e.policyInstruction,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:e.passkeySignature.passkeyPublicKey,walletStateData:r}),s=We(e.passkeySignature),o=Be(a,[await this.buildExecuteIns(e.payer,e.smartWallet,n,{...s,verifyInstructionIndex:xe(t.computeUnitLimit),splitIndex:i.keys.length,policyData:i.data,cpiData:e.cpiInstruction.data,timestamp:e.timestamp},i,e.cpiInstruction,[...e.cpiSigners??[],e.payer])]);return(await Te(this.connection,e.payer,o,t)).transaction}async createChunkTxn(e,t={}){this.validateCreateChunkParams(e);const a=Ce(e.passkeySignature),r=await this.getWalletStateData(e.smartWallet),n=this.getWalletDevicePubkey(e.smartWallet,e.credentialHash),i=await this.policyResolver.resolveForExecute({provided:e.policyInstruction,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:e.passkeySignature.passkeyPublicKey,walletStateData:r}),o=We(e.passkeySignature),l=function(e,t,a){const r=ke(e,t,a),n=new Uint8Array(64);return n.set(r.cpiDataHash,0),n.set(r.cpiAccountsHash,32),Array.from(new Uint8Array(s.sha256.arrayBuffer(n)))}(e.cpiInstructions,e.smartWallet,[...e.cpiSigners??[],e.payer]),c=Be(a,[await this.buildCreateChunkIns(e.payer,e.smartWallet,n,{...o,policyData:i.data,verifyInstructionIndex:xe(t.computeUnitLimit),timestamp:e.timestamp,cpiHash:Array.from(l)},i)]);return(await Te(this.connection,e.payer,c,t)).transaction}async executeChunkTxn(e,t={}){this.validateExecuteChunkParams(e);const a=await this.buildExecuteChunkIns(e.payer,e.smartWallet,e.cpiInstructions,e.cpiSigners);return(await Te(this.connection,e.payer,[a],t)).transaction}async closeChunkTxn(e,t={}){this.validateCloseChunkParams(e);const a=await this.buildCloseChunkIns(e.payer,e.smartWallet,e.nonce);return(await Te(this.connection,e.payer,[a],t)).transaction}async buildAuthorizationMessage(e){let t;const{action:a,smartWallet:r,passkeyPublicKey:n,credentialHash:i,timestamp:s}=e;switch(a.type){case exports.SmartWalletAction.Execute:{const{policyInstruction:i,cpiInstruction:o,cpiSigners:l}=a.args,c=await this.getWalletStateData(e.smartWallet),d=await this.policyResolver.resolveForExecute({provided:i,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:n,walletStateData:c});t=ve(r,(await this.getWalletStateData(r)).lastNonce,s,d,o,[...l??[],e.payer]);break}case exports.SmartWalletAction.CreateChunk:{const{policyInstruction:o,cpiInstructions:l,cpiSigners:c}=a.args,d=await this.getWalletStateData(r);if(o)t=Pe(r,d.lastNonce,s,o,l,[...c??[],e.payer]);else{const a=this.getWalletDevicePubkey(r,i),o=await this.defaultPolicyProgram.buildCheckPolicyIx({walletId:d.walletId,passkeyPublicKey:n,policySigner:a,smartWallet:r,credentialHash:i,policyData:d.policyData});t=Pe(r,d.lastNonce,s,o,l,[...c??[],e.payer])}break}default:throw new Q(`Unsupported SmartWalletAction: ${a.type}`,"action.type")}return t}}"function"!=typeof globalThis.structuredClone&&(globalThis.structuredClone=e=>JSON.parse(JSON.stringify(e)));class Re extends l.EventEmitter{constructor(){super(),this.iframeRef=null,this.retryDelays=[200,400,800,1500,3e3]}setIframeRef(e){this.iframeRef=e}notifyCredentialsUpdated(e){this.emit("credentials-updated",e);const t=new CustomEvent("lazorkit:credentials-updated",{detail:e,bubbles:!0,cancelable:!0});window.dispatchEvent(t)}syncCredentials(e=!1){this.iframeRef&&this.iframeRef.contentWindow?this.performCredentialSync(e):setTimeout(()=>this.syncCredentials(e),500)}performCredentialSync(e){if(!this.iframeRef?.contentWindow)throw new Error("Cannot sync credentials: iframe reference not available");const t=localStorage.getItem("CREDENTIAL_ID")||"",a=localStorage.getItem("PUBLIC_KEY")||"",r=localStorage.getItem("SMART_WALLET_ADDRESS")||"";if(!(e||t&&a))return;const n={type:"SYNC_CREDENTIALS",data:{credentialId:t,publickey:a,smartWalletAddress:r,timestamp:Date.now()}};try{this.iframeRef.contentWindow.postMessage(n,"*"),this.retryDelays.forEach(e=>{setTimeout(()=>{try{this.iframeRef?.contentWindow&&this.iframeRef.contentWindow.postMessage(n,"*")}catch(e){}},e)})}catch(e){}}storeCredential(e){e.credentialId&&localStorage.setItem("CREDENTIAL_ID",e.credentialId),e.publickey&&localStorage.setItem("PUBLIC_KEY",e.publickey),e.smartWalletAddress&&localStorage.setItem("SMART_WALLET_ADDRESS",e.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",(new Date).toISOString())}destroy(){this.removeAllListeners(),this.iframeRef=null}}class Me extends l.EventEmitter{constructor(e){super(),this.dialogRef=null,this.iframeRef=null,this.popupWindow=null,this.popupCloseInterval=null,this.isClosing=!1,this.isDestroyed=!1,this.logger=new I("DialogManager"),this._currentAction=null,this.config=e,this.credentialManager=new Re,this.logger.debug("Created dialog manager"),this.setupMessageListener()}async openConnect(){return new Promise((e,t)=>{const a=()=>{this.off("connect-result",r),this.off("error",n)},r=t=>{a(),e(t)},n=e=>{a(),t(e)};this.on("connect-result",r),this.on("error",n);const i=setTimeout(()=>{a(),t(new Error("Connection timed out after 60 seconds"))},6e4),s=e,o=t;e=e=>{clearTimeout(i),s(e)},t=e=>{clearTimeout(i),o(e)},this._currentAction=f.CONNECT;if(this.shouldUsePopup("connect")){const e=`${this.config.portalUrl}?action=${f.CONNECT}`;this.openPopup(e).catch(t)}else this.openConnectDialog().catch(t)})}async openSign(e,t,a,r){return new Promise((n,i)=>{const s=()=>{this.off("sign-result",o),this.off("error",l)},o=e=>{s(),n(e)},l=e=>{s(),i(e)};this.on("sign-result",o),this.on("error",l);const c=setTimeout(()=>{s(),i(new Error("Signing timed out after 60 seconds"))},6e4),d=n,u=i;n=e=>{clearTimeout(c),d(e)},i=e=>{clearTimeout(c),u(e)},this._currentAction=f.SIGN;const A=this.shouldUsePopup("sign"),p=encodeURIComponent(e);let g=`${this.config.portalUrl}?action=${f.SIGN}&message=${p}&transaction=${encodeURIComponent(t)}&credentialId=${encodeURIComponent(a)}`;r&&(g+=`&clusterSimulation=${r}`),A?this.openPopup(g).catch(i):this.openSignDialog(g).catch(i)})}async openSignMessage(e,t){return new Promise((a,r)=>{const n=()=>{this.off("sign-result",i),this.off("error",s)},i=e=>{n(),a(e)},s=e=>{n(),r(e)};this.on("sign-result",i),this.on("error",s);const o=setTimeout(()=>{n(),r(new Error("Signing timed out after 60 seconds"))},6e4),l=a,c=r;a=e=>{clearTimeout(o),l(e)},r=e=>{clearTimeout(o),c(e)},this._currentAction=f.SIGN;const d=encodeURIComponent(e),u=`${this.config.portalUrl}?action=${f.SIGN}&message=${d}&credentialId=${encodeURIComponent(t)}`;this.shouldUsePopup("sign")?this.openPopup(u).catch(r):this.openSignDialog(u).catch(r)})}async openConnectDialog(){const e=`${this.config.portalUrl}?action=${f.CONNECT}`;await this.openModal(e)}ensureFonts(){const e="lazorkit-font-roboto-flex";if(document.getElementById(e))return;const t=document.createElement("link");t.id=e,t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap",document.head.appendChild(t)}ensureDialogBackdropCSS(){const e="lazorkit-dialog-backdrop-style";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent='\n    /* ===== Backdrop (overlay nhẹ) ===== */\n    dialog#lazorkit-dialog::backdrop {\n      background: rgba(0,0,0,0);\n      animation: lazor-backdrop-in 160ms ease-out forwards;\n    }\n\n    dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n      animation: lazor-backdrop-out 140ms ease-in forwards;\n    }\n\n    @keyframes lazor-backdrop-in {\n      from { background: rgba(0,0,0,0); }\n      to   { background: rgba(0,0,0,0.12); } /* ✅ overlay nhẹ */\n    }\n\n    @keyframes lazor-backdrop-out {\n      from { background: rgba(0,0,0,0.12); }\n      to   { background: rgba(0,0,0,0); }\n    }\n\n    /* ===== Panel animations ===== */\n    @keyframes lazor-drawer-in {\n      from { transform: translateY(16px); opacity: 0.98; }\n      to   { transform: translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-drawer-out {\n      from { transform: translateY(0); opacity: 1; }\n      to   { transform: translateY(16px); opacity: 0.98; }\n    }\n\n    @keyframes lazor-float-in {\n      from { transform: scale(0.985) translateY(4px); opacity: 0; }\n      to   { transform: scale(1) translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-float-out {\n      from { transform: scale(1) translateY(0); opacity: 1; }\n      to   { transform: scale(0.985) translateY(4px); opacity: 0; }\n    }\n\n    #lazorkit-panel {\n      will-change: transform, opacity;\n      transform-origin: center;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-drawer-in 180ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-drawer-out 150ms ease-in forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-float-in 170ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-float-out 140ms ease-in forwards;\n    }\n\n    /* ===== Reduced motion ===== */\n    @media (prefers-reduced-motion: reduce) {\n      dialog#lazorkit-dialog::backdrop {\n        animation: none !important;\n        background: rgba(0,0,0,0.12) !important;\n      }\n      dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n        background: rgba(0,0,0,0) !important;\n      }\n      dialog#lazorkit-dialog #lazorkit-panel {\n        animation: none !important;\n      }\n    }\n  ',document.head.appendChild(t)}createCloseButton(e){const t=document.createElement("button");return t.type="button",t.title="Close Dialog",t.setAttribute("aria-label","Close Dialog"),Object.assign(t.style,{width:"36px",height:"36px",borderRadius:"10px",border:"none",background:"transparent",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"0",color:"rgba(255, 255, 255, 0.6)",outline:"none",webkitTapHighlightColor:"transparent"}),t.addEventListener("mouseenter",()=>{t.style.background="rgba(255,255,255,0.1)",t.style.color="#ffffff"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent",t.style.color="rgba(255, 255, 255, 0.6)"}),t.onclick=e,t.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg"\n      width="20" height="20" viewBox="0 0 24 24"\n      fill="none" stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18" />\n      <line x1="6" y1="6" x2="18" y2="18" />\n    </svg>\n  ',t}async openSignDialog(e){await this.openModal(e),this.iframeRef&&(this.credentialManager.setIframeRef(this.iframeRef),setTimeout(()=>{this.credentialManager.syncCredentials(!0)},500))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}shouldUsePopup(e){const t=this.isMobileDevice();return!(!this.isSafari()||"connect"!==e)||(!(!t||"connect"!==e)||!(!t&&"sign"===e)&&(!t||"sign"!==e))}getPopupDimensions(){if(!window.top)return{width:450,height:600,top:0,left:0};const e=window.top.outerWidth/2+window.top.screenX-225;return{width:450,height:600,top:window.top.outerHeight/2+window.top.screenY-300,left:e}}async openPopup(e){if(this.popupWindow&&!this.popupWindow.closed)try{this.popupWindow.close()}catch(e){}const t=this.getPopupDimensions();if(this.popupWindow=window.open(e,"lazorkit-popup",`width=${t.width},height=${t.height},top=${t.top},left=${t.left},resizable,scrollbars,status`),this.startPopupMonitor(),!this.popupWindow)throw this.logger.error("Popup was blocked by browser"),new Error("Popup was blocked by browser")}startPopupMonitor(){this.popupCloseInterval&&clearInterval(this.popupCloseInterval),this.popupCloseInterval=setInterval(()=>{this.popupWindow?.closed&&(this.popupWindow=null,this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null))},500)}async openModal(e){this.dialogRef||this.createModal(),this.iframeRef&&(this.iframeRef.src=e),this.dialogRef&&!this.dialogRef.open&&(this.dialogRef.setAttribute("data-state","opening"),this.dialogRef.showModal(),window.setTimeout(()=>{this.dialogRef?.open&&this.dialogRef.setAttribute("data-state","idle")},220))}createModal(){this.ensureFonts(),this.ensureDialogBackdropCSS();const e=document.createElement("dialog");e.id="lazorkit-dialog",e.style.colorScheme="dark",e.setAttribute("data-theme","dark");const t=this.isMobileDevice(),a=(e=>({overlay:{position:"fixed",inset:0,padding:0,border:"none",background:"transparent",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",overflow:"visible",zIndex:2147483647,display:"grid",placeItems:e?"end center":"center"},panel:{width:e?"100%":"360px",maxWidth:e?"100%":"90vw",height:e?"55vh":"650px",maxHeight:e?"55vh":"90vh",background:"white",borderRadius:e?"20px 20px 0 0":"20px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden",position:"relative"},closeButton:{zIndex:10},iframeContainer:{position:"relative",width:"100%",height:"100%",border:"none",margin:0,padding:0,overflow:"hidden",borderRadius:"inherit",background:"white"},iframe:{width:"100%",height:"100%",border:0,borderRadius:"inherit",display:"block"}}))(t);Object.assign(e.style,a.overlay),Object.assign(e.style,{"--background-color-th_base":"#191919","--background-color-th_frame":"#191919","--text-color-th_base":"#eeeeee","--border-color-th_frame":"rgba(255,255,255,0.10)"});const r=document.createElement("div"),n=t?"drawer":"floating";e.setAttribute("data-variant",n),e.setAttribute("data-state","idle"),r.id="lazorkit-panel",Object.assign(r.style,a.panel),Object.assign(r.style,{display:"flex",flexDirection:"column"}),Object.assign(r.style,{background:"var(--background-color-th_base, #fcfcfc)",color:"var(--text-color-th_base, #202020)",fontFamily:'"Roboto Flex", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'});const i=document.createElement("div");Object.assign(i.style,{height:"32px",flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 12px",boxSizing:"border-box",borderBottom:"1px solid rgba(0,0,0,0.08)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, var(--background-color-th_base, #fcfcfc))",color:"var(--text-color-th_base, #202020)",borderBottom:"1px solid var(--border-color-th_frame, rgba(0,0,0,0.08))"});const s=document.createElement("div");Object.assign(s.style,a.iframeContainer),Object.assign(s.style,{flex:"1 1 auto"}),Object.assign(s.style,{background:"var(--background-color-th_base, #fcfcfc)"}),Object.assign(r.style,{background:"var(--background-color-th_base, #191919)",color:"var(--text-color-th_base, #eeeeee)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, #191919)",color:"var(--text-color-th_base, #eeeeee)",borderBottom:"1px solid var(--border-color-th_frame, rgba(255,255,255,0.10))"}),Object.assign(s.style,{background:"var(--background-color-th_base, #191919)"});const o=this.createCloseButton(()=>{this.closeDialog(),this.emit("close")});Object.assign(o.style,{position:"static",top:"",right:""}),o.id="lazorkit-dialog-close",o.ariaLabel="Close",Object.assign(o.style,a.closeButton);const l=document.createElement("iframe");l.id="lazorkit-iframe",Object.assign(l.style,a.iframe),l.allow=`publickey-credentials-get ${this.config.portalUrl}; publickey-credentials-create ${this.config.portalUrl}; clipboard-write; camera; microphone`;const c=l.sandbox;c.add("allow-forms"),c.add("allow-scripts"),c.add("allow-same-origin"),c.add("allow-popups"),c.add("allow-popups-to-escape-sandbox"),c.add("allow-modals"),l.setAttribute("aria-label","Lazor Wallet"),l.tabIndex=0,l.title="Lazor",e.addEventListener("cancel",()=>this.closeDialog()),e.addEventListener("click",t=>{t.target===e&&this.closeDialog()}),i.appendChild(o),r.appendChild(i),s.appendChild(l),r.appendChild(s),e.appendChild(r),document.body.appendChild(e),this.dialogRef=e,this.iframeRef=l}setupMessageListener(){window.addEventListener("message",e=>{if(!e.origin.includes(new URL(this.config.portalUrl).hostname))return;const{type:t,data:a,error:r}=e.data;if(r)this.emit("error",new Error(r.message||"Portal error"));else switch(t){case"connect-result":case"WALLET_CONNECTED":const e={publicKey:a.publickey||a.publicKey||"",credentialId:a.credentialId,isCreated:"create"===a.connectionType||!!a.publickey,connectionType:a.connectionType||(a.publickey?"create":"get"),timestamp:a.timestamp||Date.now(),accountName:a.accountName};this.emit("connect-result",e),this.closeDialog();break;case"sign-result":case"SIGNATURE_CREATED":const t={signature:a.normalized,clientDataJsonBase64:a.clientDataJSONReturn,authenticatorDataBase64:a.authenticatorDataReturn,signedPayload:a.msg};this.emit("sign-result",t),this.closeDialog();break;case"error":this.emit("error",new Error(a?.message||"Unknown portal error"));break;case"close":this.closeDialog()}})}closeDialog(){if(this.isClosing)return;this.isClosing=!0;const e=this.dialogRef,t=this.iframeRef;try{e&&e.setAttribute("data-state","closing"),window.setTimeout(()=>{try{if(t&&(t.parentNode&&t.parentNode.removeChild(t),this.iframeRef=null),e){try{e.open&&e.close()}catch{}e.parentNode&&e.parentNode.removeChild(e),this.dialogRef=null}if(this.popupWindow){try{this.popupWindow.close()}catch{}this.popupWindow=null}this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null),this.logger.debug("Closed dialog (animated)")}catch(e){this.logger.error("Error during animated close:",e)}finally{this.isClosing=!1}},170)}catch(e){this.logger.error("Error closing dialog:",e),this.isClosing=!1}}getIframeRef(){return this.iframeRef}getDialogRef(){return this.dialogRef}getPopupWindow(){return this.popupWindow}getCurrentAction(){return this._currentAction}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.closeDialog(),this.credentialManager.destroy(),this.removeAllListeners(),this.logger.debug("Destroyed dialog manager"))}}const He=e=>new Me({portalUrl:e.portalUrl,rpcUrl:e.rpcUrl,paymasterUrl:e.paymasterConfig.paymasterUrl}),Qe=e=>Array.from(new Uint8Array(s.sha256.arrayBuffer(Buffer.from(e,"base64")))),Ne=(e,t,a)=>{const r=e instanceof Error?e:new Error(String(e));throw t({error:r}),a?.(r),r},Ke=e=>e?Array.from(Buffer.from(e,"base64")):[],Oe=async(e,t,a)=>{const{isConnecting:r,config:n}=e();if(r)throw new Error("Already connecting");t({isConnecting:!0,error:null});try{const r=await k.getWallet();if((()=>{if("undefined"==typeof window)return;const e=localStorage.getItem("lazorkit-wallet");if(e)try{const t=JSON.parse(e);t.state&&void 0!==t.version&&localStorage.removeItem("lazorkit-wallet")}catch(e){}})(),r)return t({wallet:r}),a?.onSuccess?.(r),r;const i=He(n);try{const r=await i.openConnect(),s=new v(n.paymasterConfig),o=new Ue(e().connection),l=Qe(r.credentialId),c=await o.getSmartWalletByCredentialHash(l);let d,u;if(!r.publicKey&&c?(u=Buffer.from(c.passkeyPubkey).toString("base64"),localStorage.setItem("PUBLIC_KEY",u)):u=r.publicKey,c)d=c.smartWallet.toBase58();else{const e=await s.getPayer(),t=await o.createSmartWalletTxn({passkeyPublicKey:Ke(u),payer:e,credentialIdBase64:r.credentialId});await s.signAndSend(t.transaction),d=t.smartWallet.toBase58()}const A={credentialId:r.credentialId,passkeyPubkey:Ke(u),expo:"web",platform:navigator.platform,smartWallet:d,walletDevice:"",accountName:r.accountName};return await k.saveWallet(A),t({wallet:A}),a?.onSuccess?.(A),A}finally{i.destroy()}}catch(e){return Ne(e,t,a?.onFail)}finally{t({isConnecting:!1})}},ze=r.create()(h((e,t)=>({wallet:null,config:{portalUrl:y.PORTAL_URL,paymasterConfig:{paymasterUrl:y.PAYMASTER_URL},rpcUrl:y.RPC_ENDPOINT},connection:new a.Connection(y.RPC_ENDPOINT,w),isLoading:!1,isConnecting:!1,isSigning:!1,error:null,setConfig:t=>{try{const r=new a.Connection(t.rpcUrl||y.RPC_ENDPOINT,w);e({config:t,connection:r})}catch(e){throw console.error("Failed to update wallet configuration:",e,{config:t}),new Error(`Failed to update configuration: ${e}`)}},setWallet:t=>{try{e({wallet:t})}catch(e){throw console.error("Failed to set wallet:",e,{wallet:t}),e}},setLoading:t=>e({isLoading:t}),setConnecting:t=>e({isConnecting:t}),setSigning:t=>e({isSigning:t}),setConnection:t=>{try{e({connection:t})}catch(e){throw console.error("Failed to set connection:",e,{endpoint:t?.rpcEndpoint}),e}},setError:t=>{e({error:t}),t&&console.error("Error state set:",t)},clearError:()=>{e({error:null})},connect:a=>Oe(t,e,a),disconnect:()=>(async(e,t)=>{try{await k.clearWallet(),e({wallet:null,error:null,isConnecting:!1,isSigning:!1,isLoading:!1}),t?.onSuccess?.()}catch(a){return Ne(a,e,t?.onFail)}})(e),signAndSendTransaction:a=>(async(e,t,a)=>{const{isSigning:r,connection:n,wallet:i,config:s}=e();if(r)throw new Error("Already signing");if(!i)throw new Error("No wallet connected");if(!n)throw new Error("No connection available");t({isSigning:!0,error:null});try{const e=new v(s.paymasterConfig),t=new Ue(n),r=await e.getPayer(),o=await x(n),l=Qe(i.credentialId),c=new p.web3.PublicKey(i.smartWallet),d=1===a.instructions.length,u=await t.buildAuthorizationMessage({action:d?{type:exports.SmartWalletAction.Execute,args:{policyInstruction:null,cpiInstruction:a.instructions[0]}}:{type:exports.SmartWalletAction.CreateChunk,args:{policyInstruction:null,cpiInstructions:a.instructions}},payer:r,smartWallet:c,passkeyPublicKey:i.passkeyPubkey,timestamp:new p.BN(o),credentialHash:l}),A=Buffer.from(u).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),g=await n.getLatestBlockhash(),m=new p.web3.TransactionMessage({payerKey:r,recentBlockhash:g.blockhash,instructions:a.instructions}).compileToV0Message(),h=new p.web3.VersionedTransaction(m),y=Buffer.from(h.serialize()).toString("base64"),f=He(s),w=i.credentialId,b=a.transactionOptions?.clusterSimulation;try{const s=await f.openSign(A,y,w,b),u={msg:A,normalized:s.signature,clientDataJSONReturn:s.clientDataJsonBase64,authenticatorDataReturn:s.authenticatorDataBase64},p={passkeyPublicKey:i.passkeyPubkey,signature64:u.normalized,clientDataJsonRaw64:u.clientDataJSONReturn,authenticatorDataRaw64:u.authenticatorDataReturn};let g;if(d){const n=await t.executeTxn({payer:r,smartWallet:c,passkeySignature:p,policyInstruction:null,cpiInstruction:a.instructions[0],timestamp:o,credentialHash:l});g=(a.transactionOptions?.addressLookupTableAccounts||[]).length>0?await e.signAndSendVersionedTransaction(n):await e.signAndSend(n)}else{const i=await t.createChunkTxn({payer:r,smartWallet:c,passkeySignature:p,policyInstruction:null,cpiInstructions:a.instructions,timestamp:o,credentialHash:l}),s=await e.signAndSend(i);await n.confirmTransaction(s);const d=a.transactionOptions?.addressLookupTableAccounts||[],u=await t.executeChunkTxn({payer:r,smartWallet:c,cpiInstructions:a.instructions},{addressLookupTables:d,computeUnitLimit:a.transactionOptions?.computeUnitLimit});g=d.length>0?await e.signAndSendVersionedTransaction(u):await e.signAndSend(u)}return a.onSuccess?.(g),g}finally{f.destroy()}}catch(e){return Ne(e,t,a.onFail)}finally{t({isSigning:!1})}})(t,e,a),signMessage:a=>(async(e,t,a)=>{const{isSigning:r,wallet:n,config:i}=e();if(r)throw new Error("Already signing");if(!n)throw new Error("No wallet connected");t({isSigning:!0,error:null});try{const e=He(i);try{const t=await e.openSignMessage(a,n.credentialId);return{signature:t.signature,signedPayload:t.signedPayload}}finally{e.destroy()}}catch(e){throw t({error:e}),e}finally{t({isSigning:!1})}})(t,e,a)}),{name:"lazorkit-wallet-store",storage:g(()=>S),partialize:e=>({wallet:e.wallet,config:e.config})}));function Le(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}async function Ve(e){let t=e;if(64===t.length){const e=new Uint8Array(65);e[0]=4,e.set(t,1),t=e}return crypto.subtle.importKey("raw",t,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])}async function Fe({signedPayload:e,signature:t,publicKey:a}){const r=Le(e),n=Le(t),i=Le(a),s=await Ve(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},s,n,r)}const _e="CREDENTIAL_ID",je="PUBLIC_KEY",Ge="SMART_WALLET_ADDRESS";const Je="Lazorkit Wallet",Ze={rpcUrl:"https://api.devnet.solana.com",portalUrl:"https://portal.lazor.sh",paymasterConfig:{paymasterUrl:"https://kora.devnet.lazorkit.com"}};class Ye extends c.BaseWalletAdapter{constructor(e){super(),this.name=Je,this.url="https://lazorkit.com",this.icon="data:image/png;base64,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",this.supportedTransactionVersions=new Set(["legacy",0]),this._publicKey=null,this._readyState="undefined"==typeof window||"undefined"==typeof document?c.WalletReadyState.Unsupported:c.WalletReadyState.Installed,this._connecting=!1,this._wallet=null,this._config=Ze,e&&(this._config={...this._config,...e})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==c.WalletReadyState.Installed)throw new c.WalletWindowClosedError;this._connecting=!0,this.emit("readyStateChange",this._readyState);const e=await k.getWallet();if(e)return void this._updateWalletState(e);const t=this._createDialogManager();try{const e=await t.openConnect(),a=await this._ensureWalletOnChain(e);await k.saveWallet(a),this._updateWalletState(a)}finally{t.destroy()}}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}_updateWalletState(e){this._wallet=e,this._publicKey=new a.PublicKey(e.smartWallet),this.emit("connect",this._publicKey)}_createDialogManager(){return new Me({portalUrl:this._config.portalUrl,rpcUrl:this._config.rpcUrl,paymasterUrl:this._config.paymasterConfig.paymasterUrl})}async _ensureWalletOnChain(e){const t=new a.Connection(this._config.rpcUrl),r=new d.KoraClient({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),n=new Ue(t),s=Qe(e.credentialId),o=await n.getSmartWalletByCredentialHash(s);let l,c;if(!e.publicKey&&o?(c=i.Buffer.from(o.passkeyPubkey).toString("base64"),localStorage.setItem("PUBLIC_KEY",c)):c=e.publicKey,o)l=o.smartWallet.toBase58();else{const t=await r.getPayerSigner(),a=await n.createSmartWalletTxn({passkeyPublicKey:Ke(e.publicKey),payer:new p.web3.PublicKey(t.signer_address),credentialIdBase64:e.credentialId});await r.signAndSendTransaction({transaction:i.Buffer.from(a.transaction.serialize({requireAllSignatures:!1})).toString("base64"),signer_key:t.signer_address}),l=a.smartWallet.toBase58()}return{credentialId:e.credentialId,passkeyPubkey:Ke(c),expo:"web",platform:navigator.platform,smartWallet:l,walletDevice:""}}async disconnect(){await k.clearWallet(),this._wallet=null,this._publicKey=null,this.emit("disconnect")}async sendTransaction(e){try{if(!this._wallet||!this._publicKey)throw new c.WalletDisconnectedError;const t=this._prepareInstructions(e);if(0===t.length)throw new c.WalletSignTransactionError("No instructions to sign");const r=this._initializeClients();let n=[];if("version"in e){const t=e.message.addressTableLookups;n=await Promise.all(t.map(async e=>{const t=await r.connection.getAccountInfo(e.accountKey);if(!t)throw new Error("Lookup table not found");return new a.AddressLookupTableAccount({key:e.accountKey,state:a.AddressLookupTableAccount.deserialize(t.data)})}))}const i=await r.paymaster.getPayerSigner(),s=await x(r.connection),o=Qe(this._wallet.credentialId),l=await this._buildAuthorizationMessage(r.smartWallet,t,i.signer_address,s,o),d=await r.connection.getLatestBlockhash(),u=await this._signWithDialog(l,t,d.blockhash,i.signer_address);return await this._executeSmartWalletTransaction(r,t,u,i.signer_address,s,o,n)}catch(e){throw this.emit("error",e),e}}async signTransaction(e){throw new c.WalletSignTransactionError("Lazorkit Wallet does not support signTransaction. Please use sendTransaction or signAndSendTransaction.")}async signAllTransactions(e){throw new c.WalletSignTransactionError("Lazorkit Wallet does not support signAllTransactions. Please use sendTransaction or signAndSendTransaction.")}async signMessage(e){const t=this._createDialogManager();try{if(!this._wallet||!this._publicKey)throw new c.WalletDisconnectedError;const a=i.Buffer.from(e).toString("base64"),r=await t.openSign(a,"",this._wallet.credentialId,this._config.clusterSimulation),n=JSON.stringify({signature:r.signature,signedPayload:r.signedPayload});return new Uint8Array(i.Buffer.from(n))}catch(e){throw this.emit("error",e),e}finally{t.destroy()}}_initializeClients(){const e=new a.Connection(this._config.rpcUrl);return{connection:e,paymaster:new d.KoraClient({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),smartWallet:new Ue(e)}}_prepareInstructions(e){return"version"in e?e.message.compiledInstructions.map(t=>new a.TransactionInstruction({keys:t.accountKeyIndexes.map(t=>({pubkey:e.message.staticAccountKeys[t],isSigner:e.message.isAccountSigner(t),isWritable:e.message.isAccountWritable(t)})),programId:new a.PublicKey(e.message.staticAccountKeys[t.programIdIndex]),data:i.Buffer.from(t.data)})):[...e.instructions]}async _buildAuthorizationMessage(e,t,a,r,n){return await e.buildAuthorizationMessage({action:{type:exports.SmartWalletAction.CreateChunk,args:{policyInstruction:null,cpiInstructions:t}},payer:new p.web3.PublicKey(a),smartWallet:this._publicKey,passkeyPublicKey:this._wallet.passkeyPubkey,timestamp:new p.BN(r),credentialHash:n})}async _signWithDialog(e,t,a,r){const n=i.Buffer.from(e).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),s=this._createDialogManager();try{const e=new p.web3.TransactionMessage({payerKey:new p.web3.PublicKey(r),recentBlockhash:a,instructions:t}).compileToV0Message(),o=new p.web3.VersionedTransaction(e),l=i.Buffer.from(o.serialize()).toString("base64");return await s.openSign(n,l,this._wallet.credentialId,this._config.clusterSimulation)}finally{s.destroy()}}async _executeSmartWalletTransaction(e,t,a,r,n,i,s){const o=await e.smartWallet.createChunkTxn({payer:new p.web3.PublicKey(r),smartWallet:this._publicKey,passkeySignature:{passkeyPublicKey:this._wallet.passkeyPubkey,signature64:a.signature,clientDataJsonRaw64:a.clientDataJsonBase64,authenticatorDataRaw64:a.authenticatorDataBase64},policyInstruction:null,cpiInstructions:t,timestamp:n,credentialHash:i}),l=await this._sendToPaymaster(e.paymaster,o,r);await e.connection.confirmTransaction(l,"confirmed");const c=await e.smartWallet.executeChunkTxn({payer:new p.web3.PublicKey(r),smartWallet:this._publicKey,cpiInstructions:t},{addressLookupTables:s});return await this._sendToPaymaster(e.paymaster,c,r)}async _sendToPaymaster(e,t,a){let r;r="version"in t?i.Buffer.from(t.serialize()):i.Buffer.from(t.serialize({requireAllSignatures:!1,verifySignatures:!1}));return(await e.signAndSendTransaction({transaction:r.toString("base64"),signer_key:a})).signature}}class Xe{constructor(e){this.version="1.0.0",this.name=Je,this.icon="data:image/png;base64,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",this._account=null,this._listeners={},this._adapter=new Ye(e),this._adapter.on("connect",e=>{this._account={address:e.toBase58(),publicKey:e.toBytes(),chains:["solana:mainnet","solana:devnet","solana:testnet"],features:["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"]},this._emit("change",{accounts:[this._account]})}),this._adapter.on("disconnect",()=>{this._account=null,this._emit("change",{accounts:[]})})}get accounts(){return this._account?[this._account]:[]}get chains(){return["solana:mainnet","solana:devnet","solana:testnet"]}get features(){return{"standard:connect":{version:"1.0.0",connect:async()=>(await this._adapter.connect(),{accounts:this.accounts})},"standard:disconnect":{version:"1.0.0",disconnect:async()=>{await this._adapter.disconnect()}},"standard:events":{version:"1.0.0",on:(e,t)=>(this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),()=>{this._listeners[e]=this._listeners[e]?.filter(e=>e!==t)||[]})},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:async(...e)=>{const t=[];for(const r of e){const e=a.VersionedTransaction.deserialize(r.transaction),n=await this._adapter.sendTransaction(e);t.push({signature:o.decode(n)})}return t}},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:async(...e)=>{throw new Error("signTransaction not supported")}},"solana:signMessage":{version:"1.0.0",signMessage:async(...e)=>{const t=[];for(const a of e){const e=await this._adapter.signMessage(a.message);t.push({message:a.message,signature:e,signedMessage:a.message})}return t}}}}_emit(e,...t){this._listeners[e]?.forEach(e=>e(...t))}}Object.defineProperty(exports,"Connection",{enumerable:!0,get:function(){return a.Connection}}),Object.defineProperty(exports,"Keypair",{enumerable:!0,get:function(){return a.Keypair}}),Object.defineProperty(exports,"PublicKey",{enumerable:!0,get:function(){return a.PublicKey}}),Object.defineProperty(exports,"Transaction",{enumerable:!0,get:function(){return a.Transaction}}),Object.defineProperty(exports,"TransactionInstruction",{enumerable:!0,get:function(){return a.TransactionInstruction}}),exports.API_ENDPOINTS=f,exports.CHUNK_SEED=ue,exports.CREDENTIAL_HASH_SIZE=32,exports.DEFAULTS=y,exports.DEFAULT_COMMITMENT=w,exports.DEFAULT_CONFIG=Ze,exports.DefaultPolicyClient=ee,exports.DialogManager=Me,exports.EMPTY_PDA_RENT_EXEMPT_BALANCE=H,exports.LazorkitClient=Ue,exports.LazorkitProvider=a=>{const{children:r,rpcUrl:n=y.RPC_ENDPOINT,portalUrl:i=y.PORTAL_URL,paymasterConfig:s={paymasterUrl:y.PAYMASTER_URL}}=a,{setConfig:o}=ze();return t.useEffect(()=>{o({portalUrl:i,paymasterConfig:s,rpcUrl:n})},[n,i,s,o]),e.jsx(e.Fragment,{children:r})},exports.LazorkitWalletAdapter=Ye,exports.LazorkitWalletName=Je,exports.Logger=I,exports.PASSKEY_PUBLIC_KEY_SIZE=33,exports.Paymaster=v,exports.SIGNATURE_SIZE=64,exports.SMART_WALLET_CONFIG_SEED=ce,exports.SMART_WALLET_SEED=le,exports.STORAGE_KEYS=b,exports.StorageManager=k,exports.StorageUtil=class{static saveCredentials(e){try{e.credentialId&&localStorage.setItem(_e,e.credentialId),localStorage.setItem(je,e.publickey),localStorage.setItem(Ge,e.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",e.timestamp.toString())}catch(e){console.error("Failed to save credentials to local storage:",e)}}static getCredentials(){try{const e=localStorage.getItem(_e),t=localStorage.getItem(je),a=localStorage.getItem(Ge),r=localStorage.getItem("CREDENTIALS_TIMESTAMP");return t&&a?{credentialId:e||void 0,publickey:t,smartWalletAddress:a,timestamp:r?parseInt(r):Date.now()}:null}catch(e){return console.error("Failed to get credentials from local storage:",e),null}}static updateSmartWalletAddress(e){try{localStorage.setItem(Ge,e)}catch(e){console.error("Failed to update smart wallet address in local storage:",e)}}static clearCredentials(){try{localStorage.removeItem(_e),localStorage.removeItem(je),localStorage.removeItem(Ge),localStorage.removeItem("CREDENTIALS_TIMESTAMP"),console.log("Credentials cleared from local storage")}catch(e){console.error("Failed to clear credentials from local storage:",e)}}static getItem(e){return localStorage.getItem(e)}static setItem(e,t){localStorage.setItem(e,t)}},exports.ValidationError=Q,exports.WALLET_DEVICE_SEED=de,exports.asCredentialHash=U,exports.asPasskeyPublicKey=T,exports.asSignature=function(e){return e},exports.assertByteArrayLength=O,exports.assertDefined=N,exports.assertNonEmptyArray=j,exports.assertNonEmptyByteArray=function(e,t){if(N(e,t),0===(Array.isArray(e)?e:Array.from(e)).length)throw new Q(`${t} cannot be empty`,t)},exports.assertNonEmptyString=_,exports.assertPositiveBN=F,exports.assertPositiveInteger=Y,exports.assertPositiveNumber=function(e,t){if(N(e,t),"number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))throw new Q(`${t} must be a finite number (got ${Number.isNaN(e)?"NaN":Number.isFinite(e)?typeof e:e===1/0?"Infinity":"-Infinity"})`,t);if(e<0)throw new Q(`${t} must be non-negative, got ${e}`,t)},exports.assertValidBase64=Z,exports.assertValidCredentialHash=L,exports.assertValidPasskeyPublicKey=z,exports.assertValidPublicKey=K,exports.assertValidPublicKeyArray=X,exports.assertValidSignature=V,exports.assertValidTransactionInstruction=G,exports.assertValidTransactionInstructionArray=q,exports.base64ToBytes=Le,exports.buildCreateChunkMessage=Pe,exports.buildExecuteMessage=ve,exports.buildPasskeyVerificationInstruction=Ce,exports.buildTransaction=Te,exports.byteArrayEquals=E,exports.calculateVerifyInstructionIndex=xe,exports.combineInstructionsWithAuth=Be,exports.combineInstructionsWithAuthAndCU=function(e,t,a){return Ee([e,...t],a)},exports.computeMultipleCpiHashes=ke,exports.convertPasskeySignatureToInstructionArgs=We,exports.createComputeUnitLimitInstruction=De,exports.credentialHashFromBase64=B,exports.deriveChunkPda=me,exports.deriveSmartWalletConfigPda=pe,exports.deriveSmartWalletPda=Ae,exports.deriveWalletDevicePda=ge,exports.detectPlatform=function(){if("undefined"!=typeof window&&window.ReactNativeWebView)return"mobile";const e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":"web"},exports.getBlockchainTimestamp=x,exports.getRandomBytes=D,exports.importP256PublicKey=Ve,exports.instructionToAccountMetas=W,exports.isAndroid=function(){return/Android/i.test(navigator.userAgent)},exports.isIOS=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},exports.isSafari=function(){const e=navigator.userAgent.toLowerCase();return/^((?!chrome|android).)*safari/i.test(e)},exports.normalizePublicKey=function(e,t="publicKey"){return K(e,t),"string"==typeof e?new p.web3.PublicKey(e):e},exports.prependComputeUnitLimit=Ee,exports.registerLazorkitWallet=function(e){u.registerWallet(new Xe(e))},exports.toNumberArray=J,exports.toNumberArraySafe=$,exports.useWallet=()=>{const{wallet:e,isLoading:r,isConnecting:n,isSigning:i,error:s,connect:o,disconnect:l,signAndSendTransaction:c,signMessage:d}=ze(),u=t.useCallback(async e=>{try{return await o(e)}catch(e){throw console.error("Failed to connect wallet:",e),e}},[o]),A=t.useCallback(async()=>{try{await l()}catch(e){throw console.error("Failed to disconnect wallet:",e),e}},[l]),p=t.useCallback(async e=>{try{return await c({instructions:e.instructions,transactionOptions:e.transactionOptions})}catch(e){throw console.error("Failed to sign and send transaction:",e),e}},[c]),g=t.useCallback(async e=>{try{return await d(e)}catch(e){throw console.error("Failed to sign message:",e),e}},[d]),m=t.useCallback(async({signedPayload:e,signature:t,publicKey:a})=>{const r=Buffer.from(e).toString("base64"),n=Buffer.from(t).toString("base64"),i=Buffer.from(a).toString("base64");return await Fe({signedPayload:r,signature:n,publicKey:i})},[]);return{smartWalletPubkey:e?.smartWallet?new a.PublicKey(e.smartWallet):null,isConnected:!!e,isLoading:r||n||i,isConnecting:n,isSigning:i,error:s,wallet:e,connect:u,disconnect:A,signAndSendTransaction:p,signMessage:g,verifyMessage:m}},exports.useWalletStore=ze,exports.validateCredentialHash=function(e,t="credentialHash"){return L(e,t),Array.isArray(e)?e:Array.from(e)},exports.validatePasskeyPublicKey=function(e,t="passkeyPublicKey"){return z(e,t),Array.isArray(e)?e:Array.from(e)},exports.validateSignature=function(e,t="signature"){return V(e,t),Array.isArray(e)?e:Array.from(e)},exports.verifySignatureBrowser=Fe;
//# sourceMappingURL=index.js.map
