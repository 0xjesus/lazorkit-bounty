diff --git a/node_modules/@lazorkit/wallet/dist/index.js b/node_modules/@lazorkit/wallet/dist/index.js
index 44c171d..276f44c 100644
--- a/node_modules/@lazorkit/wallet/dist/index.js
+++ b/node_modules/@lazorkit/wallet/dist/index.js
@@ -1,2 +1,2 @@
-"use strict";var e=require("react/jsx-runtime"),t=require("react"),a=require("@solana/web3.js"),r=require("zustand"),n=require("@coral-xyz/anchor"),i=require("buffer"),s=require("js-sha256"),o=require("bs58"),l=require("eventemitter3"),c=require("@solana/wallet-adapter-base"),d=require("@solana/kora"),u=require("@wallet-standard/wallet");function A(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(a){if("default"!==a){var r=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,r.get?r:{enumerable:!0,get:function(){return e[a]}})}}),t.default=e,Object.freeze(t)}var p=A(n),g=A(o);function m(e,t){let a;try{a=e()}catch(e){return}return{getItem:e=>{var t;const r=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=a.getItem(e))?t:null;return n instanceof Promise?n.then(r):r(n)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}const h=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>h(e)(a),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>h(t)(e)}}},y=(e,t)=>(a,r,n)=>{let i={storage:m(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1;const o=new Set,l=new Set;let c=i.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),a(...e)},r,n);const d=()=>{const e=i.partialize({...r()});return c.setItem(i.name,{state:e,version:i.version})},u=n.setState;n.setState=(e,t)=>(u(e,t),d());const A=e((...e)=>(a(...e),d()),r,n);let p;n.getInitialState=()=>A;const g=()=>{var e,t;if(!c)return;s=!1,o.forEach(e=>{var t;return e(null!=(t=r())?t:A)});const n=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=r())?e:A))||void 0;return h(c.getItem.bind(c))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const t=i.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[n,s]=e;if(p=i.merge(s,null!=(t=r())?t:A),a(p,!0),n)return d()}).then(()=>{null==n||n(p,void 0),p=r(),s=!0,l.forEach(e=>e(p))}).catch(e=>{null==n||n(void 0,e)})};return n.persist={setOptions:e=>{i={...i,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>s,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},i.skipHydration||g(),p||A},f={PORTAL_URL:"https://portal.lazor.sh",PAYMASTER_URL:"https://lazorkit-paymaster.onrender.com",RPC_ENDPOINT:"https://api.devnet.solana.com"},w={CONNECT:"connect",SIGN:"sign"},b="confirmed",S={WALLET:"lazorkit-wallet",CREDENTIALS:"lazorkit-credentials",PUBLIC_KEY:"PUBLIC_KEY",CREDENTIAL_ID:"CREDENTIAL_ID",SMART_WALLET_ADDRESS:"SMART_WALLET_ADDRESS"},k={getItem:async e=>{try{if("undefined"==typeof window)return null;return localStorage.getItem(e)}catch(t){return console.error("Error reading from localStorage:",t,{key:e}),null}},setItem:async(e,t)=>{try{if("undefined"==typeof window)return;localStorage.setItem(e,t)}catch(a){console.error("Error writing to localStorage:",a,{key:e,valueLength:t.length})}},removeItem:async e=>{try{if("undefined"==typeof window)return;localStorage.removeItem(e)}catch(t){console.error("Error removing from localStorage:",t,{key:e})}}};class I{static async saveWallet(e){try{await k.setItem(S.WALLET,JSON.stringify(e)),await k.setItem(S.CREDENTIAL_ID,e.credentialId),await k.setItem(S.SMART_WALLET_ADDRESS,e.smartWallet),await k.setItem(S.PUBLIC_KEY,i.Buffer.from(e.passkeyPubkey).toString("base64"))}catch(e){throw console.error("Failed to save wallet to storage:",e),e}}static async getWallet(){try{const e=await k.getItem(S.WALLET);return e?JSON.parse(e):null}catch(e){return console.error("Failed to get wallet from storage:",e),null}}static async saveConfig(e){try{await k.setItem("lazorkit-config",JSON.stringify(e))}catch(e){throw console.error("Failed to save config to storage:",e),e}}static async getConfig(){try{const e=await k.getItem("lazorkit-config");return e?JSON.parse(e):null}catch(e){return console.error("Failed to get config from storage:",e),null}}static async clearWallet(){try{await k.removeItem(S.WALLET),await k.removeItem(S.CREDENTIAL_ID),await k.removeItem(S.SMART_WALLET_ADDRESS),await k.removeItem(S.PUBLIC_KEY),await k.removeItem("CREDENTIALS_TIMESTAMP")}catch(e){throw console.error("Failed to clear wallet from storage:",e),e}}static async getItem(e){return await k.getItem(e)}static async setItem(e,t){await k.setItem(e,t)}static async removeItem(e){await k.removeItem(e)}}class v{constructor(e){this.context=e,this.enabled="production"!==process.env.NODE_ENV}debug(e,t){this.enabled&&console.debug(`[${this.context}] ${e}`,t)}info(e,t){console.info(`[${this.context}] ${e}`,t)}warn(e,t){console.warn(`[${this.context}] ${e}`,t)}error(e,t){console.error(`[${this.context}] ${e}`,t)}}class P{constructor(e){this.logger=new v("Paymaster"),this.endpoint=e.paymasterUrl,this.apiKey=e.apiKey}getHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["x-api-key"]=this.apiKey),e}async getPayer(){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getPayerSigner",params:[]})});if(!e.ok)throw new Error(`Failed to get payer: ${e.statusText}`);const t=await e.json();return new a.PublicKey(t.result.signer_address)}catch(e){throw this.logger.error("Failed to get payer",e),e}}async getBlockhash(){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"getBlockhash",id:1,params:[]})});if(!e.ok)throw new Error(`Failed to get blockhash: ${e.statusText}`);return(await e.json()).result.blockhash}catch(e){throw this.logger.error("Failed to get blockhash",e),e}}async attemptSign(e,t=1){try{const t=e.serialize({verifySignatures:!1,requireAllSignatures:!1}),r=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signTransaction",id:1,params:[t.toString("base64")]})});if(!r.ok)throw new Error(`Failed to sign transaction: ${r.statusText}`);const n=await r.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return a.Transaction.from(i.Buffer.from(n.result.signed_transaction,"base64"))}catch(e){throw this.logger.error(`Sign attempt ${t} failed:`,e),e}}async sign(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSign(e,r)}catch(e){if(r===t)throw this.logger.error("All sign retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying sign in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign transaction after all retries")}async attemptSignAndSend(e,t=1){try{const t=e.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[t.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign and send transaction: ${a.statusText}`);const r=await a.json();if(r.error)throw new Error(r.error.message||"Unknown paymaster error");return r.result.signature}catch(e){throw this.logger.error(`Attempt ${t} failed:`,e),e}}async signAndSend(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSignAndSend(e,r)}catch(e){if(r===t)throw this.logger.error("All retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign and send transaction after all retries")}async attemptSignAndSendVersionedTransaction(e,t=1){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[i.Buffer.from(e.serialize()).toString("base64")]})});if(!t.ok)throw new Error(`Failed to sign and send transaction: ${t.statusText}`);const a=await t.json();if(a.error)throw new Error(a.error.message||"Unknown paymaster error");return a.result.signature}catch(e){throw this.logger.error(`Attempt ${t} failed:`,e),e}}async signAndSendVersionedTransaction(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSignAndSendVersionedTransaction(e,r)}catch(e){if(r===t)throw this.logger.error("All retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign and send transaction after all retries")}}var C,D={address:"Gsuz7YcA5sbMGVRXT3xSYhJBessW4xFC4xYsihNCqMFh",metadata:{name:"lazorkit",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},docs:["LazorKit: Smart Wallet with WebAuthn Passkey Authentication"],instructions:[{name:"create_chunk",discriminator:[83,226,15,219,9,19,186,90],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"wallet_state.last_nonce",account:"WalletState"}]}},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateChunkArgs"}}}]},{name:"create_smart_wallet",discriminator:[129,39,235,18,132,68,203,19],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"arg",path:"args.wallet_id"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"policy_program"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateSmartWalletArgs"}}}]},{name:"execute",discriminator:[130,221,242,154,13,193,189,29],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"cpi_program"},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"ExecuteArgs"}}}]},{name:"execute_chunk",discriminator:[106,83,113,47,89,243,39,220],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"instruction_data_list",type:{vec:"bytes"}},{name:"split_index",type:"bytes"}]}],accounts:[{name:"Chunk",discriminator:[134,67,80,65,135,143,156,196]},{name:"WalletDevice",discriminator:[35,85,31,31,179,48,136,123]},{name:"WalletState",discriminator:[126,186,0,158,92,223,167,68]}],errors:[{code:6e3,name:"PasskeyMismatch",msg:"Passkey public key mismatch with stored authenticator"},{code:6001,name:"InvalidPolicyDataSize",msg:"Invalid policy data size"},{code:6002,name:"Secp256r1InvalidLength",msg:"Secp256r1 instruction has invalid data length"},{code:6003,name:"Secp256r1HeaderMismatch",msg:"Secp256r1 instruction header validation failed"},{code:6004,name:"Secp256r1DataMismatch",msg:"Secp256r1 signature data validation failed"},{code:6005,name:"InvalidSignature",msg:"Invalid signature provided for passkey verification"},{code:6006,name:"ClientDataInvalidUtf8",msg:"Client data JSON is not valid UTF-8"},{code:6007,name:"ClientDataJsonParseError",msg:"Client data JSON parsing failed"},{code:6008,name:"ChallengeMissing",msg:"Challenge field missing from client data JSON"},{code:6009,name:"ChallengeBase64DecodeError",msg:"Challenge base64 decoding failed"},{code:6010,name:"ChallengeDeserializationError",msg:"Challenge message deserialization failed"},{code:6011,name:"HashMismatch",msg:"Message hash mismatch: expected different value"},{code:6012,name:"InvalidInstructionDiscriminator",msg:"Invalid instruction discriminator"},{code:6013,name:"InsufficientCpiAccounts",msg:"Insufficient remaining accounts for CPI instruction"},{code:6014,name:"AccountSliceOutOfBounds",msg:"Account slice index out of bounds"},{code:6015,name:"InvalidAccountOwner",msg:"Account owner verification failed"},{code:6016,name:"ProgramNotExecutable",msg:"Program not executable"},{code:6017,name:"CredentialIdEmpty",msg:"Credential ID cannot be empty"},{code:6018,name:"PolicyDataTooLarge",msg:"Policy data exceeds maximum allowed size"},{code:6019,name:"TransactionTooOld",msg:"Transaction is too old"},{code:6020,name:"InvalidInstructionData",msg:"Invalid instruction data"},{code:6021,name:"InvalidInstruction",msg:"Invalid instruction"},{code:6022,name:"InsufficientBalanceForFee",msg:"Insufficient balance for fee"},{code:6023,name:"InvalidSequenceNumber",msg:"Invalid sequence number"},{code:6024,name:"InvalidPasskeyFormat",msg:"Invalid passkey format"},{code:6025,name:"ReentrancyDetected",msg:"Reentrancy detected"},{code:6026,name:"UnauthorizedAdmin",msg:"Unauthorized admin"}],types:[{name:"Chunk",docs:["Transaction chunk for deferred execution","","Created after full passkey and policy verification. Contains all bindings","necessary to execute the transaction later without re-verification.","Used for large transactions that need to be split into manageable chunks."],type:{kind:"struct",fields:[{name:"owner_wallet_address",docs:["Smart wallet address that authorized this chunk session"],type:"pubkey"},{name:"cpi_hash",docs:["Combined SHA256 hash of all cpi transaction instruction data"],type:{array:["u8",32]}},{name:"authorized_nonce",docs:["The nonce that was authorized at chunk creation (bound into data hash)"],type:"u64"},{name:"authorized_timestamp",docs:["Timestamp from the original message hash for expiration validation"],type:"i64"},{name:"rent_refund_address",docs:["Address to receive rent refund when closing the chunk session"],type:"pubkey"}]}},{name:"CreateChunkArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"policy_data",type:"bytes"},{name:"timestamp",type:"i64"},{name:"cpi_hash",type:{array:["u8",32]}}]}},{name:"CreateSmartWalletArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"init_policy_data",type:"bytes"},{name:"wallet_id",type:"u64"},{name:"amount",type:"u64"},{name:"policy_data_size",type:"u16"}]}},{name:"ExecuteArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"split_index",type:"u16"},{name:"policy_data",type:"bytes"},{name:"cpi_data",type:"bytes"},{name:"timestamp",type:"i64"}]}},{name:"WalletDevice",docs:["Wallet device account linking a passkey to a smart wallet"],type:{kind:"struct",fields:[{name:"passkey_pubkey",docs:["Secp256r1 compressed public key (33 bytes)"],type:{array:["u8",33]}},{name:"credential_hash",docs:["SHA256 hash of the credential ID"],type:{array:["u8",32]}},{name:"smart_wallet",docs:["Associated smart wallet address"],type:"pubkey"},{name:"bump",docs:["PDA bump seed"],type:"u8"}]}},{name:"WalletState",docs:["Wallet state account storing wallet configuration and execution state"],type:{kind:"struct",fields:[{name:"bump",docs:["PDA bump seed for smart wallet"],type:"u8"},{name:"wallet_id",docs:["Unique wallet identifier"],type:"u64"},{name:"last_nonce",docs:["Last used nonce for anti-replay protection"],type:"u64"},{name:"policy_program",docs:["Policy program that validates transactions"],type:"pubkey"},{name:"policy_data",docs:["Serialized policy data returned from policy initialization"],type:"bytes"}]}}]};function W(e,t){return e.keys.map(e=>({pubkey:e.pubkey,isWritable:e.isWritable,isSigner:!!t&&t.some(t=>t.toString()===e.pubkey.toString())}))}function E(e){if("function"==typeof globalThis.crypto?.getRandomValues){const t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),t}try{const{randomBytes:t}=require("crypto");return t(e)}catch{throw new Error("No CSPRNG available")}}function B(e){const t=i.Buffer.from(e,"base64");return Array.from(new Uint8Array(s.sha256.arrayBuffer(t)))}async function x(e){const t=await e.getSlot(),a=await e.getBlockTime(t);if(null===a)throw new Error("Failed to get blockchain timestamp");return new p.BN(a)}async function T(e,t,a){let r=0;for(;r<3;){try{const r=await t.getWalletStateData(a),n=t.getChunkPubkey(a,r.lastNonce);if(await e.getAccountInfo(n))return}catch(e){console.warn(`Attempt ${r+1} failed to find chunk:`,e)}r++,r<3&&await new Promise(e=>setTimeout(e,3e3))}throw new Error("Chunk not found")}function U(e){return e}function R(e){return e}exports.SmartWalletAction=void 0,(C=exports.SmartWalletAction||(exports.SmartWalletAction={})).CreateChunk="create_chunk",C.ExecuteChunk="execute_chunk";var M={address:"BiE9vSdz9MidUiyjVYsu3PG4C1fbPZ8CVPADA9jRfXw7",metadata:{name:"default_policy",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},instructions:[{name:"check_policy",discriminator:[28,88,170,179,239,136,25,35],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet"}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"policy_data",type:"bytes"}]},{name:"init_policy",discriminator:[45,234,110,100,209,146,191,86],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}],returns:{defined:{name:"PolicyStruct"}}}],errors:[{code:6e3,name:"InvalidPasskey",msg:"Invalid passkey format"},{code:6001,name:"Unauthorized",msg:"Unauthorized to access smart wallet"}],types:[{name:"DeviceSlot",type:{kind:"struct",fields:[{name:"passkey_pubkey",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}]}},{name:"PolicyStruct",type:{kind:"struct",fields:[{name:"bump",type:"u8"},{name:"smart_wallet",type:"pubkey"},{name:"device_slots",type:{vec:{defined:{name:"DeviceSlot"}}}}]}}]};const H=i.Buffer.from("policy");const Q=890880;class K extends Error{constructor(e,t){super(e),this.field=t,this.name="ValidationError"}}function N(e,t){if(null==e||void 0===e){throw new K(`${t} is required but was ${null===e?"null":"undefined"}`,t)}}function O(e,t){N(e,t);try{if("string"==typeof e){if(0===e.trim().length)throw new K(`${t} cannot be an empty string`,t);new p.web3.PublicKey(e)}else{if(!(e instanceof p.web3.PublicKey||e&&"object"==typeof e&&"toBase58"in e&&"function"==typeof e.toBase58&&"toBytes"in e&&"function"==typeof e.toBytes))throw new K(`${t} must be a PublicKey instance or valid base58 string`,t)}}catch(e){if(e instanceof K)throw e;throw new K(`${t} is not a valid PublicKey: ${e instanceof Error?e.message:"Invalid format"}`,t)}}function z(e,t,a){let r;if(N(e,a),Array.isArray(e))r=e;else if(e instanceof Uint8Array)r=Array.from(e);else{if(!e||"object"!=typeof e||"number"!=typeof e.length)throw new K(`${a} must be an array or Uint8Array`,a);r=Array.from(e)}if(r.length!==t)throw new K(`${a} must be exactly ${t} bytes, got ${r.length}`,a);for(let e=0;e<r.length;e++){const t=r[e];if("number"!=typeof t||!Number.isFinite(t)||!Number.isInteger(t)||t<0||t>255)throw new K(`${a}[${e}] must be a valid byte (0-255), got ${"number"==typeof t?t:typeof t}`,a)}}function L(e,t="passkeyPublicKey"){z(e,33,t)}function V(e,t="credentialHash"){z(e,32,t)}function F(e,t="signature"){z(e,64,t)}function j(e,t){N(e,t);if(!(e instanceof p.BN||e&&"object"==typeof e&&"lt"in e&&"function"==typeof e.lt&&"toString"in e&&"function"==typeof e.toString))throw new K(`${t} must be a BN instance`,t);if(e.lt(new p.BN(0)))throw new K(`${t} must be non-negative, got ${e.toString()}`,t)}function _(e,t){if(N(e,t),"string"!=typeof e)throw new K(`${t} must be a string (got ${typeof e})`,t);if(0===String(e).trim().length)throw new K(`${t} cannot be empty`,t)}function G(e,t){if(N(e,t),!Array.isArray(e))throw new K(`${t} must be an array (got ${typeof e}${e&&"object"==typeof e?` with constructor ${e.constructor?.name||"unknown"}`:""})`,t);if(0===e.length)throw new K(`${t} cannot be empty`,t)}function J(e,t){N(e,t);if(!(e instanceof p.web3.TransactionInstruction||e&&"object"==typeof e&&"programId"in e&&"keys"in e&&Array.isArray(e.keys)&&"data"in e))throw new K(`${t} must be a TransactionInstruction instance`,t);if(O(e.programId,`${t}.programId`),!e.keys||!Array.isArray(e.keys)||0===e.keys.length)throw new K(`${t} must have at least one account key`,t)}function Z(e){return Array.isArray(e)?e:Array.from(e)}function Y(e,t){_(e,t);if(!/^[A-Za-z0-9+/]*={0,2}$/.test(e))throw new K(`${t} is not a valid base64 string (invalid characters)`,t);try{"undefined"!=typeof Buffer&&Buffer.from?Buffer.from(e,"base64"):"undefined"!=typeof atob&&atob(e)}catch(e){throw new K(`${t} is not a valid base64 string: ${e instanceof Error?e.message:"Invalid format"}`,t)}}function X(e,t){if(N(e,t),"number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))throw new K(`${t} must be a finite number (got ${Number.isNaN(e)?"NaN":Number.isFinite(e)?typeof e:e===1/0?"Infinity":"-Infinity"})`,t);if(!Number.isInteger(e))throw new K(`${t} must be an integer, got ${e}`,t);if(e<=0)throw new K(`${t} must be a positive integer, got ${e}`,t)}function q(e,t){if(N(e,t),!Array.isArray(e))throw new K(`${t} must be an array (got ${typeof e})`,t);e.forEach((e,a)=>{O(e,`${t}[${a}]`)})}function $(e,t){G(e,t),e.forEach((e,a)=>{J(e,`${t}[${a}]`)})}function ee(e){return Array.isArray(e)?[...e]:Array.from(e)}function te(e,t="passkeySignature"){if(N(e,t),"object"!=typeof e||null===e)throw new K(`${t} must be an object`,t);L(e.passkeyPublicKey,`${t}.passkeyPublicKey`),Y(e.signature64,`${t}.signature64`),Y(e.clientDataJsonRaw64,`${t}.clientDataJsonRaw64`),Y(e.authenticatorDataRaw64,`${t}.authenticatorDataRaw64`)}class ae{constructor(e){N(e,"connection"),this.connection=e,this.program=new p.Program(M,{connection:e}),this.programId=this.program.programId}policyPda(e){return O(e,"smartWallet"),function(e,t){return p.web3.PublicKey.findProgramAddressSync([H,t.toBuffer()],e)[0]}(this.programId,e)}getPolicyDataSize(){return 102}validateInitPolicyParams(e){N(e,"params"),j(e.walletId,"params.walletId"),L(e.passkeyPublicKey,"params.passkeyPublicKey"),V(e.credentialHash,"params.credentialHash"),O(e.policySigner,"params.policySigner"),O(e.smartWallet,"params.smartWallet"),O(e.walletState,"params.walletState")}async buildInitPolicyIx(e){return this.validateInitPolicyParams(e),await this.program.methods.initPolicy(e.walletId,ee(e.passkeyPublicKey),ee(e.credentialHash)).accountsPartial({smartWallet:e.smartWallet,walletState:e.walletState,policySigner:e.policySigner}).instruction()}validateCheckPolicyParams(e){if(N(e,"params"),j(e.walletId,"params.walletId"),L(e.passkeyPublicKey,"params.passkeyPublicKey"),O(e.policySigner,"params.policySigner"),O(e.smartWallet,"params.smartWallet"),V(e.credentialHash,"params.credentialHash"),N(e.policyData,"params.policyData"),!Buffer.isBuffer(e.policyData))throw new K("params.policyData must be a Buffer instance","params.policyData")}async buildCheckPolicyIx(e){return this.validateCheckPolicyParams(e),await this.program.methods.checkPolicy(e.walletId,ee(e.passkeyPublicKey),ee(e.credentialHash),e.policyData).accountsPartial({smartWallet:e.smartWallet,policySigner:e.policySigner}).instruction()}}const re=i.Buffer.from("smart_wallet"),ne=i.Buffer.from("wallet_state"),ie=i.Buffer.from("wallet_device"),se=i.Buffer.from("chunk");function oe(e,t){return p.web3.PublicKey.findProgramAddressSync([re,t.toArrayLike(i.Buffer,"le",8)],e)[0]}function le(e,t){return p.web3.PublicKey.findProgramAddressSync([ne,t.toBuffer()],e)[0]}function ce(e,t){const a=i.Buffer.concat([e.toBuffer(),i.Buffer.from(t)]),r=s.sha256.arrayBuffer(a);return i.Buffer.from(r).subarray(0,32)}function de(e,t,a){return p.web3.PublicKey.findProgramAddressSync([ie,ce(t,a)],e)}function ue(e,t,a){return p.web3.PublicKey.findProgramAddressSync([se,t.toBuffer(),a.toArrayLike(i.Buffer,"le",8)],e)[0]}class Ae{constructor(e){this.programId=e}smartWallet(e){return j(e,"walletId"),oe(this.programId,e)}walletState(e){return O(e,"smartWallet"),le(this.programId,e)}walletDevice(e,t){return O(e,"smartWallet"),V(t,"credentialHash"),de(this.programId,e,t)[0]}chunk(e,t){return O(e,"smartWallet"),ue(this.programId,e,t)}}class pe{constructor(e,t){this.policyClient=e,this.walletPdas=t}async resolveForExecute({provided:e,smartWallet:t,credentialHash:a,passkeyPublicKey:r,walletStateData:n}){if(void 0!==e)return e;const i=this.walletPdas.walletDevice(t,a);return this.policyClient.buildCheckPolicyIx({walletId:n.walletId,passkeyPublicKey:r,policySigner:i,smartWallet:t,credentialHash:a,policyData:n.policyData})}async resolveForCreate({provided:e,smartWalletId:t,smartWallet:a,walletState:r,passkeyPublicKey:n,credentialHash:i}){if(void 0!==e)return e;const s=this.walletPdas.walletDevice(a,i);return this.policyClient.buildInitPolicyIx({walletId:t,passkeyPublicKey:n,credentialHash:i,policySigner:s,smartWallet:a,walletState:r})}}let ge=null;const me=e=>new Uint8Array(s.sha256.arrayBuffer(e)),he=(e,t,a)=>{const r=s.sha256.create();r.update(e.toBytes());for(const e of t)r.update(e.pubkey.toBytes()),r.update(Uint8Array.from([e.isSigner?1:0])),r.update(Uint8Array.from([e.pubkey.toString()===a.toString()||e.isWritable?1:0]));return new Uint8Array(r.arrayBuffer())},ye=(e,t)=>{const a=W(e),r=he(e.programId,a,t);return{policyDataHash:me(e.data),policyAccountsHash:r}},fe=(e,t,a)=>{const r=i.Buffer.alloc(4);r.writeUInt32LE(e.length,0);const n=i.Buffer.concat([r,...e.map(e=>{const t=i.Buffer.from(e.data),a=i.Buffer.alloc(4);return a.writeUInt32LE(t.length,0),i.Buffer.concat([a,t])})]),o=me(n),l=((e,t)=>{const a=new Map;for(const t of e){const e=t.pubkey.toString(),r=a.get(e);r?(r.isSigner=r.isSigner||t.isSigner,r.isWritable=r.isWritable||t.isWritable):a.set(e,{isSigner:t.isSigner,isWritable:t.isWritable})}const r=e.map(e=>{const t=e.pubkey.toString(),r=a.get(t);return{pubkey:e.pubkey,isSigner:r.isSigner,isWritable:r.isWritable}}),n=s.sha256.create();for(const e of r)n.update(e.pubkey.toBytes()),n.update(Uint8Array.from([e.isSigner?1:0])),n.update(Uint8Array.from([e.pubkey.toString()===t.toString()||e.isWritable?1:0]));return new Uint8Array(n.arrayBuffer())})(e.flatMap(e=>[{pubkey:e.programId,isSigner:!1,isWritable:!1},...W(e,a)]),t);return{cpiDataHash:o,cpiAccountsHash:l}},we=(e,t)=>{try{const a=(ge||(ge=new p.BorshCoder({version:"0.1.0",name:"lazorkit_msgs",instructions:[],accounts:[],types:[{name:"SimpleMessage",type:{kind:"struct",fields:[{name:"dataHash",type:{array:["u8",32]}}]}}]})),ge).types.encode(e,t);return i.Buffer.from(a)}catch(t){throw new Error(`Failed to encode ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}};function be(e,t,a,r,n,s){const o=ye(r,e),l=fe(n,e,s),c=new Uint8Array(64);c.set(o.policyDataHash,0),c.set(o.policyAccountsHash,32);const d=me(c),u=new Uint8Array(64);u.set(l.cpiDataHash,0),u.set(l.cpiAccountsHash,32);const A=me(u),p=i.Buffer.alloc(8);p.writeBigUInt64LE(BigInt(t.toString()),0);const g=i.Buffer.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=i.Buffer.concat([p,g,i.Buffer.from(d),i.Buffer.from(A)]),h=me(m);return we("SimpleMessage",{dataHash:Array.from(h)})}const Se=new p.web3.PublicKey("Secp256r1SigVerify1111111111111111111111111");function ke(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);{const t=new ArrayBuffer(2*Object.values(e).length),a=new DataView(t);return Object.values(e).forEach((e,t)=>{a.setUint16(2*t,e,!0)}),new Uint8Array(t)}}function Ie(e){L(e.passkeyPublicKey,"passkeySignature.passkeyPublicKey"),Y(e.signature64,"passkeySignature.signature64"),Y(e.clientDataJsonRaw64,"passkeySignature.clientDataJsonRaw64"),Y(e.authenticatorDataRaw64,"passkeySignature.authenticatorDataRaw64");const t=Buffer.from(e.authenticatorDataRaw64,"base64"),a=Buffer.from(e.clientDataJsonRaw64,"base64"),r=Buffer.from(e.signature64,"base64");F(Z(r),"passkeySignature.signature64 (decoded)");return function(e,t,a){if(33!==t.length||64!==a.length)throw new Error("Invalid key or signature length");const r=113+e.length,n=new Uint8Array(r);n.set(ke([1,0]),0);const s={signature_offset:49,signature_instruction_index:65535,public_key_offset:16,public_key_instruction_index:65535,message_data_offset:113,message_data_size:e.length,message_instruction_index:65535};return n.set(ke(s),2),n.set(t,16),n.set(a,49),n.set(e,113),new p.web3.TransactionInstruction({keys:[],programId:Se,data:i.Buffer.from(n)})}(Buffer.concat([t,Buffer.from(s.sha256.arrayBuffer(a))]),e.passkeyPublicKey,r)}function ve(e){const t=Buffer.from(e.signature64,"base64");return F(Z(t),"passkeySignature.signature64 (decoded)"),{passkeyPublicKey:e.passkeyPublicKey,signature:Z(t),clientDataJsonRaw:Buffer.from(e.clientDataJsonRaw64,"base64"),authenticatorDataRaw:Buffer.from(e.authenticatorDataRaw64,"base64")}}function Pe(e){return p.web3.ComputeBudgetProgram.setComputeUnitLimit({units:e})}function Ce(e,t){return void 0===t?e:[Pe(t),...e]}function De(e,t){return[e,...t]}function We(e){return void 0!==e?1:0}async function Ee(e,t,a,r={}){const{addressLookupTables:n,recentBlockhash:i,computeUnitLimit:s}=r,o=Ce(a,s),l=void 0!==n&&n.length>0,c=i||(await e.getLatestBlockhash()).blockhash;if(l){const e=new p.web3.TransactionMessage({payerKey:t,recentBlockhash:c,instructions:o}).compileToV0Message([...n]);return{transaction:new p.web3.VersionedTransaction(e),isVersioned:!0,recentBlockhash:c}}{const e=(new p.web3.Transaction).add(...o);return e.feePayer=t,e.recentBlockhash=c,{transaction:e,isVersioned:!1,recentBlockhash:c}}}global.Buffer=i.Buffer,i.Buffer.prototype.subarray=function(e,t){const a=Uint8Array.prototype.subarray.apply(this,[e,t]);return Object.setPrototypeOf(a,i.Buffer.prototype),a};class Be{constructor(e){this.connection=e,this.program=new p.Program(D,{connection:e}),this.programId=this.program.programId,this.defaultPolicyProgram=new ae(e),this.walletPdas=new Ae(this.programId),this.policyResolver=new pe(this.defaultPolicyProgram,this.walletPdas)}getSmartWalletPubkey(e){return this.walletPdas.smartWallet(e)}getWalletStatePubkey(e){return this.walletPdas.walletState(e)}getWalletDevicePubkey(e,t){return this.walletPdas.walletDevice(e,t)}getChunkPubkey(e,t){return this.walletPdas.chunk(e,t)}generateWalletId(){return new p.BN(E(8),"le")}async fetchWalletStateContext(e){const t=this.getWalletStatePubkey(e);return{walletState:t,data:await this.program.account.walletState.fetch(t)}}async fetchChunkContext(e,t){const a=this.getChunkPubkey(e,t);return{chunk:a,data:await this.program.account.chunk.fetch(a)}}validateCreateSmartWalletParams(e){N(e,"params"),O(e.payer,"params.payer"),L(e.passkeyPublicKey,"params.passkeyPublicKey"),Y(e.credentialIdBase64,"params.credentialIdBase64"),void 0!==e.amount&&j(e.amount,"params.amount"),void 0!==e.smartWalletId&&j(e.smartWalletId,"params.smartWalletId"),void 0!==e.policyDataSize&&X(e.policyDataSize,"params.policyDataSize"),void 0!==e.policyInstruction&&J(e.policyInstruction,"params.policyInstruction")}validateExecuteParams(e){N(e,"params"),O(e.payer,"params.payer"),O(e.smartWallet,"params.smartWallet"),te(e.passkeySignature,"params.passkeySignature"),V(e.credentialHash,"params.credentialHash"),J(e.cpiInstruction,"params.cpiInstruction"),j(e.timestamp,"params.timestamp"),void 0!==e.policyInstruction&&J(e.policyInstruction,"params.policyInstruction"),void 0!==e.cpiSigners&&q(e.cpiSigners,"params.cpiSigners")}validateCreateChunkParams(e){N(e,"params"),O(e.payer,"params.payer"),O(e.smartWallet,"params.smartWallet"),te(e.passkeySignature,"params.passkeySignature"),V(e.credentialHash,"params.credentialHash"),$(e.cpiInstructions,"params.cpiInstructions"),j(e.timestamp,"params.timestamp"),void 0!==e.policyInstruction&&J(e.policyInstruction,"params.policyInstruction"),void 0!==e.cpiSigners&&q(e.cpiSigners,"params.cpiSigners")}validateExecuteChunkParams(e){N(e,"params"),O(e.payer,"params.payer"),O(e.smartWallet,"params.smartWallet"),$(e.cpiInstructions,"params.cpiInstructions"),void 0!==e.cpiSigners&&q(e.cpiSigners,"params.cpiSigners")}async getWalletStateData(e){const{data:t}=await this.fetchWalletStateContext(e);return t}async getChunkData(e){return await this.program.account.chunk.fetch(e)}async getSmartWalletByCredentialHash(e){V(e,"credentialHash");const t=D.accounts?.find(e=>"WalletDevice"===e.name)?.discriminator;if(!t)throw new K("WalletDevice discriminator not found in IDL","credentialHash");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:g.default.encode(t)}},{memcmp:{offset:41,bytes:g.default.encode(e)}}]});if(0===a.length)return null;for(const e of a){const t=await this.program.account.walletDevice.fetch(e.pubkey);return{smartWallet:t.smartWallet,walletState:this.getWalletStatePubkey(t.smartWallet),walletDevice:e.pubkey,passkeyPublicKey:t.passkeyPubkey}}return null}async buildCreateSmartWalletIns(e,t,a,r){return O(e,"payer"),O(t,"smartWallet"),J(a,"policyInstruction"),N(r,"args"),L(r.passkeyPublicKey,"args.passkeyPublicKey"),V(r.credentialHash,"args.credentialHash"),j(r.walletId,"args.walletId"),j(r.amount,"args.amount"),await this.program.methods.createSmartWallet(r).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),walletDevice:this.getWalletDevicePubkey(t,r.credentialHash),policyProgram:a.programId,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(a)]).instruction()}async buildExecuteIns(e,t,a,r,n,i,s){return O(e,"payer"),O(t,"smartWallet"),O(a,"walletDevice"),N(r,"args"),J(n,"policyInstruction"),J(i,"cpiInstruction"),void 0!==s&&q(s,"cpiSigners"),await this.program.methods.execute(r).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),walletDevice:a,policyProgram:n.programId,cpiProgram:i.programId,ixSysvar:p.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(n),...W(i,s)]).instruction()}async buildCreateChunkIns(e,t,a,r,n){O(e,"payer"),O(t,"smartWallet"),O(a,"walletDevice"),N(r,"args"),J(n,"policyInstruction");const{walletState:i,data:s}=await this.fetchWalletStateContext(t),o=this.getChunkPubkey(t,s.lastNonce);return await this.program.methods.createChunk(r).accountsPartial({payer:e,smartWallet:t,walletState:i,walletDevice:a,policyProgram:n.programId,chunk:o,ixSysvar:p.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(n)]).instruction()}async buildExecuteChunkIns(e,t,a,r){O(e,"payer"),O(t,"smartWallet"),$(a,"cpiInstructions"),void 0!==r&&q(r,"cpiSigners");const{data:n,walletState:s}=await this.fetchWalletStateContext(t),{chunk:o,data:l}=await this.fetchChunkContext(t,n.lastNonce),c=a.map(e=>i.Buffer.from(e.data)),d=function(e){const t=[];let a=0;for(let r=0;r<e.length-1;r++)a+=e[r].keys.length+1,t.push(a);return t}(a),u=function(e,t){return e.flatMap(e=>[{pubkey:e.programId,isSigner:!1,isWritable:!1},...W(e,t)])}(a,r);return await this.program.methods.executeChunk(c,i.Buffer.from(d)).accountsStrict({payer:e,smartWallet:t,walletState:s,chunk:o,sessionRefund:l.rentRefundAddress,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts(u).instruction()}async createSmartWalletTxn(e,t={}){this.validateCreateSmartWalletParams(e);const a=e.smartWalletId??this.generateWalletId(),r=this.getSmartWalletPubkey(a),n=this.getWalletStatePubkey(r),i=e.amount??new p.BN(Q),s=e.policyDataSize??this.defaultPolicyProgram.getPolicyDataSize(),o=B(e.credentialIdBase64),l=await this.policyResolver.resolveForCreate({provided:e.policyInstruction,smartWalletId:a,smartWallet:r,walletState:n,passkeyPublicKey:e.passkeyPublicKey,credentialHash:o}),c={passkeyPublicKey:e.passkeyPublicKey,credentialHash:o,initPolicyData:l.data,walletId:a,amount:i,policyDataSize:s},d=await this.buildCreateSmartWalletIns(e.payer,r,l,c);return{transaction:(await Ee(this.connection,e.payer,[d],t)).transaction,smartWalletId:a,smartWallet:r}}async executeTxn(e,t={}){this.validateExecuteParams(e);const a=Ie(e.passkeySignature),r=await this.getWalletStateData(e.smartWallet),n=this.getWalletDevicePubkey(e.smartWallet,e.credentialHash),i=await this.policyResolver.resolveForExecute({provided:e.policyInstruction,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:e.passkeySignature.passkeyPublicKey,walletStateData:r}),s=ve(e.passkeySignature),o=De(a,[await this.buildExecuteIns(e.payer,e.smartWallet,n,{...s,verifyInstructionIndex:We(t.computeUnitLimit),splitIndex:i.keys.length,policyData:i.data,cpiData:e.cpiInstruction.data,timestamp:e.timestamp},i,e.cpiInstruction,[...e.cpiSigners??[],e.payer])]);return(await Ee(this.connection,e.payer,o,t)).transaction}async createChunkTxn(e,t={}){this.validateCreateChunkParams(e);const a=Ie(e.passkeySignature),r=await this.getWalletStateData(e.smartWallet),n=this.getWalletDevicePubkey(e.smartWallet,e.credentialHash),i=await this.policyResolver.resolveForExecute({provided:e.policyInstruction,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:e.passkeySignature.passkeyPublicKey,walletStateData:r}),o=ve(e.passkeySignature),l=function(e,t,a){const r=fe(e,t,a),n=new Uint8Array(64);return n.set(r.cpiDataHash,0),n.set(r.cpiAccountsHash,32),Array.from(new Uint8Array(s.sha256.arrayBuffer(n)))}(e.cpiInstructions,e.smartWallet,[...e.cpiSigners??[],e.payer]),c=De(a,[await this.buildCreateChunkIns(e.payer,e.smartWallet,n,{...o,policyData:i.data,verifyInstructionIndex:We(t.computeUnitLimit),timestamp:e.timestamp,cpiHash:Array.from(l)},i)]);return(await Ee(this.connection,e.payer,c,t)).transaction}async executeChunkTxn(e,t={}){this.validateExecuteChunkParams(e);const a=await this.buildExecuteChunkIns(e.payer,e.smartWallet,e.cpiInstructions,e.cpiSigners);return(await Ee(this.connection,e.payer,[a],t)).transaction}async buildAuthorizationMessage(e){let t;const{action:a,smartWallet:r,passkeyPublicKey:n,timestamp:i}=e;switch(a.type){case exports.SmartWalletAction.CreateChunk:{const{policyInstruction:s,cpiInstructions:o,cpiSigners:l}=a.args,c=await this.getWalletStateData(e.smartWallet),d=await this.policyResolver.resolveForExecute({provided:s,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:n,walletStateData:c});t=be(r,(await this.getWalletStateData(r)).lastNonce,i,d,o,[...l??[],e.payer]);break}default:throw new K(`Unsupported SmartWalletAction: ${a.type}`,"action.type")}return t}}"function"!=typeof globalThis.structuredClone&&(globalThis.structuredClone=e=>JSON.parse(JSON.stringify(e)));class xe extends l.EventEmitter{constructor(){super(),this.iframeRef=null,this.retryDelays=[200,400,800,1500,3e3]}setIframeRef(e){this.iframeRef=e}notifyCredentialsUpdated(e){this.emit("credentials-updated",e);const t=new CustomEvent("lazorkit:credentials-updated",{detail:e,bubbles:!0,cancelable:!0});window.dispatchEvent(t)}syncCredentials(e=!1){this.iframeRef&&this.iframeRef.contentWindow?this.performCredentialSync(e):setTimeout(()=>this.syncCredentials(e),500)}performCredentialSync(e){if(!this.iframeRef?.contentWindow)throw new Error("Cannot sync credentials: iframe reference not available");const t=localStorage.getItem("CREDENTIAL_ID")||"",a=localStorage.getItem("PUBLIC_KEY")||"",r=localStorage.getItem("SMART_WALLET_ADDRESS")||"";if(!(e||t&&a))return;const n={type:"SYNC_CREDENTIALS",data:{credentialId:t,publickey:a,smartWalletAddress:r,timestamp:Date.now()}};try{this.iframeRef.contentWindow.postMessage(n,"*"),this.retryDelays.forEach(e=>{setTimeout(()=>{try{this.iframeRef?.contentWindow&&this.iframeRef.contentWindow.postMessage(n,"*")}catch(e){}},e)})}catch(e){}}storeCredential(e){e.credentialId&&localStorage.setItem("CREDENTIAL_ID",e.credentialId),e.publickey&&localStorage.setItem("PUBLIC_KEY",e.publickey),e.smartWalletAddress&&localStorage.setItem("SMART_WALLET_ADDRESS",e.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",(new Date).toISOString())}destroy(){this.removeAllListeners(),this.iframeRef=null}}class Te extends l.EventEmitter{constructor(e){super(),this.dialogRef=null,this.iframeRef=null,this.popupWindow=null,this.popupCloseInterval=null,this.isClosing=!1,this.isDestroyed=!1,this.logger=new v("DialogManager"),this._currentAction=null,this.config=e,this.credentialManager=new xe,this.logger.debug("Created dialog manager"),this.setupMessageListener()}async openConnect(){return new Promise((e,t)=>{const a=()=>{this.off("connect-result",r),this.off("error",n)},r=t=>{a(),e(t)},n=e=>{a(),t(e)};this.on("connect-result",r),this.on("error",n);const i=setTimeout(()=>{a(),t(new Error("Connection timed out after 60 seconds"))},6e4),s=e,o=t;e=e=>{clearTimeout(i),s(e)},t=e=>{clearTimeout(i),o(e)},this._currentAction=w.CONNECT;if(this.shouldUsePopup("connect")){const e=`${this.config.portalUrl}?action=${w.CONNECT}`;this.openPopup(e).catch(t)}else this.openConnectDialog().catch(t)})}async openSign(e,t,a,r){return new Promise((n,i)=>{const s=()=>{this.off("sign-result",o),this.off("error",l)},o=e=>{s(),n(e)},l=e=>{s(),i(e)};this.on("sign-result",o),this.on("error",l);const c=setTimeout(()=>{s(),i(new Error("Signing timed out after 60 seconds"))},6e4),d=n,u=i;n=e=>{clearTimeout(c),d(e)},i=e=>{clearTimeout(c),u(e)},this._currentAction=w.SIGN;const A=this.shouldUsePopup("sign"),p=encodeURIComponent(e);let g=`${this.config.portalUrl}?action=${w.SIGN}&message=${p}&transaction=${encodeURIComponent(t)}&credentialId=${encodeURIComponent(a)}`;r&&(g+=`&clusterSimulation=${r}`),A?this.openPopup(g).catch(i):this.openSignDialog(g).catch(i)})}async openSignMessage(e,t){return new Promise((a,r)=>{const n=()=>{this.off("sign-result",i),this.off("error",s)},i=e=>{n(),a(e)},s=e=>{n(),r(e)};this.on("sign-result",i),this.on("error",s);const o=setTimeout(()=>{n(),r(new Error("Signing timed out after 60 seconds"))},6e4),l=a,c=r;a=e=>{clearTimeout(o),l(e)},r=e=>{clearTimeout(o),c(e)},this._currentAction=w.SIGN;const d=encodeURIComponent(e),u=`${this.config.portalUrl}?action=${w.SIGN}&message=${d}&credentialId=${encodeURIComponent(t)}`;this.shouldUsePopup("sign")?this.openPopup(u).catch(r):this.openSignDialog(u).catch(r)})}async openConnectDialog(){const e=`${this.config.portalUrl}?action=${w.CONNECT}`;await this.openModal(e)}ensureFonts(){const e="lazorkit-font-roboto-flex";if(document.getElementById(e))return;const t=document.createElement("link");t.id=e,t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap",document.head.appendChild(t)}ensureDialogBackdropCSS(){const e="lazorkit-dialog-backdrop-style";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent='\n    /* ===== Backdrop (overlay nhẹ) ===== */\n    dialog#lazorkit-dialog::backdrop {\n      background: rgba(0,0,0,0);\n      animation: lazor-backdrop-in 160ms ease-out forwards;\n    }\n\n    dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n      animation: lazor-backdrop-out 140ms ease-in forwards;\n    }\n\n    @keyframes lazor-backdrop-in {\n      from { background: rgba(0,0,0,0); }\n      to   { background: rgba(0,0,0,0.12); } /* ✅ overlay nhẹ */\n    }\n\n    @keyframes lazor-backdrop-out {\n      from { background: rgba(0,0,0,0.12); }\n      to   { background: rgba(0,0,0,0); }\n    }\n\n    /* ===== Panel animations ===== */\n    @keyframes lazor-drawer-in {\n      from { transform: translateY(16px); opacity: 0.98; }\n      to   { transform: translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-drawer-out {\n      from { transform: translateY(0); opacity: 1; }\n      to   { transform: translateY(16px); opacity: 0.98; }\n    }\n\n    @keyframes lazor-float-in {\n      from { transform: scale(0.985) translateY(4px); opacity: 0; }\n      to   { transform: scale(1) translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-float-out {\n      from { transform: scale(1) translateY(0); opacity: 1; }\n      to   { transform: scale(0.985) translateY(4px); opacity: 0; }\n    }\n\n    #lazorkit-panel {\n      will-change: transform, opacity;\n      transform-origin: center;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-drawer-in 180ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-drawer-out 150ms ease-in forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-float-in 170ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-float-out 140ms ease-in forwards;\n    }\n\n    /* ===== Reduced motion ===== */\n    @media (prefers-reduced-motion: reduce) {\n      dialog#lazorkit-dialog::backdrop {\n        animation: none !important;\n        background: rgba(0,0,0,0.12) !important;\n      }\n      dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n        background: rgba(0,0,0,0) !important;\n      }\n      dialog#lazorkit-dialog #lazorkit-panel {\n        animation: none !important;\n      }\n    }\n  ',document.head.appendChild(t)}createCloseButton(e){const t=document.createElement("button");return t.type="button",t.title="Close Dialog",t.setAttribute("aria-label","Close Dialog"),Object.assign(t.style,{width:"36px",height:"36px",borderRadius:"10px",border:"none",background:"transparent",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"0",color:"rgba(255, 255, 255, 0.6)",outline:"none",webkitTapHighlightColor:"transparent"}),t.addEventListener("mouseenter",()=>{t.style.background="rgba(255,255,255,0.1)",t.style.color="#ffffff"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent",t.style.color="rgba(255, 255, 255, 0.6)"}),t.onclick=e,t.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg"\n      width="20" height="20" viewBox="0 0 24 24"\n      fill="none" stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18" />\n      <line x1="6" y1="6" x2="18" y2="18" />\n    </svg>\n  ',t}async openSignDialog(e){await this.openModal(e),this.iframeRef&&(this.credentialManager.setIframeRef(this.iframeRef),setTimeout(()=>{this.credentialManager.syncCredentials(!0)},500))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}shouldUsePopup(e){const t=this.isMobileDevice();return!(!this.isSafari()||"connect"!==e)||(!(!t||"connect"!==e)||!(!t&&"sign"===e)&&(!t||"sign"!==e))}getPopupDimensions(){if(!window.top)return{width:450,height:600,top:0,left:0};const e=window.top.outerWidth/2+window.top.screenX-225;return{width:450,height:600,top:window.top.outerHeight/2+window.top.screenY-300,left:e}}async openPopup(e){if(this.popupWindow&&!this.popupWindow.closed)try{this.popupWindow.close()}catch(e){}const t=this.getPopupDimensions();if(this.popupWindow=window.open(e,"lazorkit-popup",`width=${t.width},height=${t.height},top=${t.top},left=${t.left},resizable,scrollbars,status`),this.startPopupMonitor(),!this.popupWindow)throw this.logger.error("Popup was blocked by browser"),new Error("Popup was blocked by browser")}startPopupMonitor(){this.popupCloseInterval&&clearInterval(this.popupCloseInterval),this.popupCloseInterval=setInterval(()=>{this.popupWindow?.closed&&(this.popupWindow=null,this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null))},500)}async openModal(e){this.dialogRef||this.createModal(),this.iframeRef&&(this.iframeRef.src=e),this.dialogRef&&!this.dialogRef.open&&(this.dialogRef.setAttribute("data-state","opening"),this.dialogRef.showModal(),window.setTimeout(()=>{this.dialogRef?.open&&this.dialogRef.setAttribute("data-state","idle")},220))}createModal(){this.ensureFonts(),this.ensureDialogBackdropCSS();const e=document.createElement("dialog");e.id="lazorkit-dialog",e.style.colorScheme="dark",e.setAttribute("data-theme","dark");const t=this.isMobileDevice(),a=(e=>({overlay:{position:"fixed",inset:0,padding:0,border:"none",background:"transparent",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",overflow:"visible",zIndex:2147483647,display:"grid",placeItems:e?"end center":"center"},panel:{width:e?"100%":"360px",maxWidth:e?"100%":"90vw",height:e?"55vh":"650px",maxHeight:e?"55vh":"90vh",background:"white",borderRadius:e?"20px 20px 0 0":"20px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden",position:"relative"},closeButton:{zIndex:10},iframeContainer:{position:"relative",width:"100%",height:"100%",border:"none",margin:0,padding:0,overflow:"hidden",borderRadius:"inherit",background:"white"},iframe:{width:"100%",height:"100%",border:0,borderRadius:"inherit",display:"block"}}))(t);Object.assign(e.style,a.overlay),Object.assign(e.style,{"--background-color-th_base":"#191919","--background-color-th_frame":"#191919","--text-color-th_base":"#eeeeee","--border-color-th_frame":"rgba(255,255,255,0.10)"});const r=document.createElement("div"),n=t?"drawer":"floating";e.setAttribute("data-variant",n),e.setAttribute("data-state","idle"),r.id="lazorkit-panel",Object.assign(r.style,a.panel),Object.assign(r.style,{display:"flex",flexDirection:"column"}),Object.assign(r.style,{background:"var(--background-color-th_base, #fcfcfc)",color:"var(--text-color-th_base, #202020)",fontFamily:'"Roboto Flex", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'});const i=document.createElement("div");Object.assign(i.style,{height:"32px",flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 12px",boxSizing:"border-box",borderBottom:"1px solid rgba(0,0,0,0.08)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, var(--background-color-th_base, #fcfcfc))",color:"var(--text-color-th_base, #202020)",borderBottom:"1px solid var(--border-color-th_frame, rgba(0,0,0,0.08))"});const s=document.createElement("div");Object.assign(s.style,a.iframeContainer),Object.assign(s.style,{flex:"1 1 auto"}),Object.assign(s.style,{background:"var(--background-color-th_base, #fcfcfc)"}),Object.assign(r.style,{background:"var(--background-color-th_base, #191919)",color:"var(--text-color-th_base, #eeeeee)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, #191919)",color:"var(--text-color-th_base, #eeeeee)",borderBottom:"1px solid var(--border-color-th_frame, rgba(255,255,255,0.10))"}),Object.assign(s.style,{background:"var(--background-color-th_base, #191919)"});const o=this.createCloseButton(()=>{this.closeDialog(),this.emit("close")});Object.assign(o.style,{position:"static",top:"",right:""}),o.id="lazorkit-dialog-close",o.ariaLabel="Close",Object.assign(o.style,a.closeButton);const l=document.createElement("iframe");l.id="lazorkit-iframe",Object.assign(l.style,a.iframe),l.allow=`publickey-credentials-get ${this.config.portalUrl}; publickey-credentials-create ${this.config.portalUrl}; clipboard-write; camera; microphone`;const c=l.sandbox;c.add("allow-forms"),c.add("allow-scripts"),c.add("allow-same-origin"),c.add("allow-popups"),c.add("allow-popups-to-escape-sandbox"),c.add("allow-modals"),l.setAttribute("aria-label","Lazor Wallet"),l.tabIndex=0,l.title="Lazor",e.addEventListener("cancel",()=>this.closeDialog()),e.addEventListener("click",t=>{t.target===e&&this.closeDialog()}),i.appendChild(o),r.appendChild(i),s.appendChild(l),r.appendChild(s),e.appendChild(r),document.body.appendChild(e),this.dialogRef=e,this.iframeRef=l}setupMessageListener(){window.addEventListener("message",e=>{if(!e.origin.includes(new URL(this.config.portalUrl).hostname))return;const{type:t,data:a,error:r}=e.data;if(r)this.emit("error",new Error(r.message||"Portal error"));else switch(t){case"connect-result":case"WALLET_CONNECTED":const e={publicKey:a.publickey||a.publicKey||"",credentialId:a.credentialId,isCreated:"create"===a.connectionType||!!a.publickey,connectionType:a.connectionType||(a.publickey?"create":"get"),timestamp:a.timestamp||Date.now(),accountName:a.accountName};this.emit("connect-result",e),this.closeDialog();break;case"sign-result":case"SIGNATURE_CREATED":const t={signature:a.normalized,clientDataJsonBase64:a.clientDataJSONReturn,authenticatorDataBase64:a.authenticatorDataReturn,signedPayload:a.msg};this.emit("sign-result",t),this.closeDialog();break;case"error":this.emit("error",new Error(a?.message||"Unknown portal error"));break;case"close":this.closeDialog()}})}closeDialog(){if(this.isClosing)return;this.isClosing=!0;const e=this.dialogRef,t=this.iframeRef;try{e&&e.setAttribute("data-state","closing"),window.setTimeout(()=>{try{if(t&&(t.parentNode&&t.parentNode.removeChild(t),this.iframeRef=null),e){try{e.open&&e.close()}catch{}e.parentNode&&e.parentNode.removeChild(e),this.dialogRef=null}if(this.popupWindow){try{this.popupWindow.close()}catch{}this.popupWindow=null}this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null),this.logger.debug("Closed dialog (animated)")}catch(e){this.logger.error("Error during animated close:",e)}finally{this.isClosing=!1}},170)}catch(e){this.logger.error("Error closing dialog:",e),this.isClosing=!1}}getIframeRef(){return this.iframeRef}getDialogRef(){return this.dialogRef}getPopupWindow(){return this.popupWindow}getCurrentAction(){return this._currentAction}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.closeDialog(),this.credentialManager.destroy(),this.removeAllListeners(),this.logger.debug("Destroyed dialog manager"))}}const Ue=e=>new Te({portalUrl:e.portalUrl,rpcUrl:e.rpcUrl,paymasterUrl:e.paymasterConfig.paymasterUrl}),Re=e=>Array.from(new Uint8Array(s.sha256.arrayBuffer(Buffer.from(e,"base64")))),Me=(e,t,a)=>{const r=e instanceof Error?e:new Error(String(e));throw t({error:r}),a?.(r),r},He=e=>e?Array.from(Buffer.from(e,"base64")):[],Qe=async(e,t,a)=>{const{isConnecting:r,config:n}=e();if(r)throw new Error("Already connecting");t({isConnecting:!0,error:null});try{const r=await I.getWallet();if((()=>{if("undefined"==typeof window)return;const e=localStorage.getItem("lazorkit-wallet");if(e)try{const t=JSON.parse(e);t.state&&void 0!==t.version&&localStorage.removeItem("lazorkit-wallet")}catch(e){}})(),r)return t({wallet:r}),a?.onSuccess?.(r),r;const i=Ue(n);try{const r=await i.openConnect(),s=new P(n.paymasterConfig),o=new Be(e().connection),l=Re(r.credentialId),c=await o.getSmartWalletByCredentialHash(l);let d,u;if(!r.publicKey&&c?(u=Buffer.from(c.passkeyPublicKey).toString("base64"),localStorage.setItem("PUBLIC_KEY",u)):u=r.publicKey,c)d=c.smartWallet.toBase58();else{const e=await s.getPayer(),t=await o.createSmartWalletTxn({passkeyPublicKey:He(u),payer:e,credentialIdBase64:r.credentialId});await s.signAndSend(t.transaction),d=t.smartWallet.toBase58()}const A={credentialId:r.credentialId,passkeyPubkey:He(u),expo:"web",platform:navigator.platform,smartWallet:d,walletDevice:"",accountName:r.accountName};return await I.saveWallet(A),t({wallet:A}),a?.onSuccess?.(A),A}finally{i.destroy()}}catch(e){return Me(e,t,a?.onFail)}finally{t({isConnecting:!1})}},Ke=r.create()(y((e,t)=>({wallet:null,config:{portalUrl:f.PORTAL_URL,paymasterConfig:{paymasterUrl:f.PAYMASTER_URL},rpcUrl:f.RPC_ENDPOINT},connection:new a.Connection(f.RPC_ENDPOINT,b),isLoading:!1,isConnecting:!1,isSigning:!1,error:null,setConfig:t=>{try{const r=new a.Connection(t.rpcUrl||f.RPC_ENDPOINT,b);e({config:t,connection:r})}catch(e){throw console.error("Failed to update wallet configuration:",e,{config:t}),new Error(`Failed to update configuration: ${e}`)}},setWallet:t=>{try{e({wallet:t})}catch(e){throw console.error("Failed to set wallet:",e,{wallet:t}),e}},setLoading:t=>e({isLoading:t}),setConnecting:t=>e({isConnecting:t}),setSigning:t=>e({isSigning:t}),setConnection:t=>{try{e({connection:t})}catch(e){throw console.error("Failed to set connection:",e,{endpoint:t?.rpcEndpoint}),e}},setError:t=>{e({error:t}),t&&console.error("Error state set:",t)},clearError:()=>{e({error:null})},connect:a=>Qe(t,e,a),disconnect:()=>(async(e,t)=>{try{await I.clearWallet(),e({wallet:null,error:null,isConnecting:!1,isSigning:!1,isLoading:!1}),t?.onSuccess?.()}catch(a){return Me(a,e,t?.onFail)}})(e),signAndSendTransaction:a=>(async(e,t,a)=>{const{isSigning:r,connection:n,wallet:i,config:s}=e();if(r)throw new Error("Already signing");if(!i)throw new Error("No wallet connected");if(!n)throw new Error("No connection available");t({isSigning:!0,error:null});try{const e=new P(s.paymasterConfig),t=new Be(n),r=await e.getPayer(),o=await x(n),l=await t.buildAuthorizationMessage({action:{type:exports.SmartWalletAction.CreateChunk,args:{cpiInstructions:a.instructions}},payer:r,smartWallet:new p.web3.PublicKey(i.smartWallet),passkeyPublicKey:i.passkeyPubkey,timestamp:new p.BN(o),credentialHash:Re(i.credentialId)}),c=Buffer.from(l).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),d=await n.getLatestBlockhash(),u=new p.web3.TransactionMessage({payerKey:r,recentBlockhash:d.blockhash,instructions:a.instructions}).compileToV0Message(),A=new p.web3.VersionedTransaction(u),g=Buffer.from(A.serialize()).toString("base64"),m=Ue(s),h=i.credentialId,y=a.transactionOptions?.clusterSimulation;try{const s=await m.openSign(c,g,h,y),l={msg:c,normalized:s.signature,clientDataJSONReturn:s.clientDataJsonBase64,authenticatorDataReturn:s.authenticatorDataBase64},d=Re(i.credentialId),u=await t.createChunkTxn({payer:r,smartWallet:new p.web3.PublicKey(i.smartWallet),passkeySignature:{passkeyPublicKey:i.passkeyPubkey,signature64:l.normalized,clientDataJsonRaw64:l.clientDataJSONReturn,authenticatorDataRaw64:l.authenticatorDataReturn},cpiInstructions:a.instructions,timestamp:o,credentialHash:d}),A=await e.signAndSend(u);await n.confirmTransaction(A),await T(n,t,new p.web3.PublicKey(i.smartWallet));const f=a.transactionOptions?.addressLookupTableAccounts||[],w=await t.executeChunkTxn({payer:r,smartWallet:new p.web3.PublicKey(i.smartWallet),cpiInstructions:a.instructions},{addressLookupTables:f,computeUnitLimit:a.transactionOptions?.computeUnitLimit});let b;return b=f.length>0?await e.signAndSendVersionedTransaction(w):await e.signAndSend(w),a.onSuccess?.(b),b}finally{m.destroy()}}catch(e){return Me(e,t,a.onFail)}finally{t({isSigning:!1})}})(t,e,a),signMessage:a=>(async(e,t,a)=>{const{isSigning:r,wallet:n,config:i}=e();if(r)throw new Error("Already signing");if(!n)throw new Error("No wallet connected");t({isSigning:!0,error:null});try{const e=Ue(i);try{const t=await e.openSignMessage(a,n.credentialId);return{signature:t.signature,signedPayload:t.signedPayload}}finally{e.destroy()}}catch(e){throw t({error:e}),e}finally{t({isSigning:!1})}})(t,e,a)}),{name:"lazorkit-wallet-store",storage:m(()=>k),partialize:e=>({wallet:e.wallet,config:e.config})}));function Ne(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}async function Oe(e){let t=e;if(64===t.length){const e=new Uint8Array(65);e[0]=4,e.set(t,1),t=e}return crypto.subtle.importKey("raw",t,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])}async function ze({signedPayload:e,signature:t,publicKey:a}){const r=Ne(e),n=Ne(t),i=Ne(a),s=await Oe(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},s,n,r)}const Le="CREDENTIAL_ID",Ve="PUBLIC_KEY",Fe="SMART_WALLET_ADDRESS";const je="Lazorkit Wallet",_e={rpcUrl:"https://api.devnet.solana.com",portalUrl:"https://portal.lazor.sh",paymasterConfig:{paymasterUrl:"https://kora.devnet.lazorkit.com"}};class Ge extends c.BaseWalletAdapter{constructor(e){super(),this.name=je,this.url="https://lazorkit.com",this.icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAABXCAAAAAA8UASIAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB+kMEAUXDRWPYLQAAAB3dEVYdFJhdyBwcm9maWxlIHR5cGUgOGJpbQAKOGJpbQogICAgICA0MAozODQyNDk0ZDA0MDQwMDAwMDAwMDAwMDAzODQyNDk0ZDA0MjUwMDAwMDAwMDAwMTBkNDFkOGNkOThmMDBiMjA0ZTk4MDA5OTgKZWNmODQyN2UKplPDjgAAAAFvck5UAc+id5oAAAg8SURBVGje7ZlNkFVHFcf/53T3ve/NmzcDBASBVCVAEhBC+AoYRciHAwSDliRllS5MlS50kY1WWeXGrSuLilVaxU5LF1bhB4pgCAmJkErkc6pgwghJDMQKhO9hhnkz797bfY6L92YYPmbefeM4btKLe2/fvn1+fU6f7j7dl+YTCAQQABAIVH9Ry4x4uutCNKKwLoCUuFZ4WxExJiEp1E4GB4pJ0QegSdFnsvoHmBy7KXRy9JlIP9Axymiy/O1Tzqec/ytneBQEE4hFUF9KbiutrSq1vHLgAA405gAaXZ8okAbEw4IVUFANpaogIiICwRuNKI3Ga7eMSGJKg9barQTUm1y7iIqIiLCxIUUhNOCMui7YYDBIzg+t57ct7fXlnQjwLok1aLDj5KQRYIy3AQCUbl1JSWsZIiJwHFITJU7HyYkgEtuQ2VsRBQ1FF7X+qsUhtrfFVceeRcfkZNLedz20Uz9GckBaD3i4fldO+rTY1j9eu5m4t+3HpXNJex2j9f4ZiqmknrVyfU5x+6UZaXOc4bESIlM5uHnRP9+8YtpDsCCpB2eBrQqp8WSVOVSmrF/wR3x3+U+gqrX23CvRqHGiOu3xj6ycd/1wFxXgvDGqRJBYUzZKviXT4sBg21NLut7qeGDauR3MPFqcCBqdQwpjJE3aVyyPzxy54MoizFAFgUmJKTjfN3XtmmOHl6w9cfibvwrMXBtl9+SYaaNwOAiRcAGnDl+Ys3Fpdj6FgVdDauGtTUA3XcdX+3/bulV2/P3Fsx8UmRR1n2xGH7EswkzieKDStmzF1FPHPzFFyoywUSVzs7Bm9b/3T996ec+llnnPvlwWACDm0KzdglpWJQNvo8EBN/Pxxb3HTg+4yGVa8APm82sv/nXalmTf+1NM/w/3/ovrQX3T/QOHTA0rB2KAkSUti1dPfa/zLJVsH69+8souu7Vl77uFcjawdtH26UGYoPXQsyl9RA2TKoMgzMoUqjJr5aPJka5sacfNHeGF6fuOx+XgY3np132mNryIWJrV5879D4GpmrnFK+7z4U/XXpj31tvWxamlK99O/vCZrC7hbruxNscBK6yKqejs9MZzyw69oZEzwYhMe3Fbi1BmMGb/5N8vkIowo4XOd6zv+tlAm0ZZML546XtvJKUsNg0q5+YQiDVA497v07br5ZJ4scLmxhPh0NSMk4Ifs3YTcXwAE8gOLiz/wk8hR84IMrYbdrV4YuMb1M7NIVWIEpIvH2gNIB+CkIuubzh7zhmBldHtgOb2CwRV0vSx4jvFOONgLFE2OGfpqzF55nRU+2utbm6OgogtpRv3lGTQeudJxFY3Hbnc5oUDy9i18+8bSYyKVtYMniqkThUMaLpgzutTErJhRIg3Sivz242Dso+/tDeGMULCmeXK1j/HeWvnxYgJzOmKgTOxiFgWcVJ56lq3m2gOp1Fgu253SQxSViJF/MzOQt76+fuHfHxt7eVzsWfDXlhN75bOnrhRHNo0x0eatqzb3RJcFuJAYm489Mgr5byYJvQJLX0b3r9gwUGVGMZ/ZX/WMNxtnsMYnLJqz1RI6qIEsD1fsO+UKMomilOLb1Vgbm5694pVw6LEUPfMzkhVJswPWAUSEAVMf/hgqSppIYETurrp/IdlCDWKq/PrwySwlLirG05dipyhpJgSJ3OX7ZoywCY0mghyc6DEBDLZ3M+90h5EnEhULdzccuwS29zeloujjEzj3ufeSWE8qc0Q9yy977WZA2zgTQ5GLo4weXXat2D2/rKohUfkEb72atA4ZTSap/NzCAAxpOOQD5RSBtKof13f8bbgC5kvNFpHc3Ocl5grfP9nXy9FaaRRnFFSXv+XsohNLWUTZreAKJHWnudfUyUV6yXYmxu7P46JhdVMnF9LnIZC7zIcbbNVR4EkSh9YtHta1YMhkns+adw/XuKqbD7g2ZOBN6Drz+/LfIGgSowJ8wPRKCTLwpG2VKOMLfoKP7h4sEzeqAKSF9M4HrU+RIMdfytYyhKTVmZ+Z9rR0qqTFEdgo4FdTodryKHg+lYnp8tVG9nLs74x62j3Svfw0x91fgwbG4S8AUZDThpT6Pid9U77+VsP/qN7Db/e1Tp7+dez905edq3G53S4xvsFe+XZhT+fIb2t61d3nlsf7T9ZiiittM5fMr/n+OmKK4zYFIxrP1f/xSPQH/3m2qB9csUHZ1bNOHg8skbBhMG0tGTV1LPd3ewKHJQRLIdgx7XPAhGZvs2zts14Yv0HpxYuePtwKLAlVYaylYqfuXRh6+kTF1C0SggUYg08Tk5mXtq+5JlznYseOnHAlwwyQwKCGmUrWcDcxQtD18keUzAg9VRMx8mpbPriR+6tB1acfLPamsU8EDEpiNSIGgaQiLv/8Qcvdp2uxJbEVe04OekvP9xZXv3RvqszMrjEOE8EECmYFMwAKBsoPvrYjPOdn0SF1I23f2zrlZ+u+v2ltmKlAG/rExoBYiiAoawgh2pl+srZp17ubwnj9TdN2uf6kqXA3rI3arQmw6qCSQVMEDU29FPpDJNgnPtgU/RdhjSw1WBIDBRMACnIqLBVgWEAYoWKGDUuGZNDgAqkdcR55a3dfv0cdiirBKjSaAtSjulJFapauwOKW1nUs/XnsVKe+HhICCnp0AWoHx0qQEoNz2FzTrf1BitGHJUPt0EbUnLpQ7c90u2vbh3O/Lf6DJ3y3iE8h+zmOKq4U+gdtpsYzrBEvftVfh7n+G4M+9NYfTOy7H/5P2ukH+bjaNMFdybO4TfDf8vuIbaZuDfnt3q3L+f3Oabmvm8qjRA71D/UqEZt5rn9YKrxBDpc/B9wB8PpHagItQAAECRlWElmTU0AKgAAAAgABgESAAMAAAABAAEAAAEaAAUAAAABAAAAVgEbAAUAAAABAAAAXgEoAAMAAAABAAIAAAITAAMAAAABAAEAAIdpAAQAAAABAAAAZgAAAMAAAABIAAAAAQAAAEgAAAABAAeQAAAHAAAABDAyMjGRAQAHAAAABAECAwCgAAAHAAAABDAxMDCgAQADAAAAAQABAACgAgAEAAAAAQAAAvygAwAEAAAAAQAAAoikBgADAAAAAQAAAAAAAAAAAAYBAwADAAAAAQAGAAABGgAFAAAAAQAAAQ4BGwAFAAAAAQAAARYBKAADAAAAAQACAAACAQAEAAAAAQAAAR4CAgAEAAAAAQAADwQAAAAAAAAASAAAAAEAAABIAAAAAf/Y/9sAhAABAQEBAQECAQECAwICAgMEAwMDAwQFBAQEBAQFBgUFBQUFBQYGBgYGBgYGBwcHBwcHCAgICAgJCQkJCQkJCQkJAQEBAQICAgQCAgQJBgUGCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQn/3QAEAAr/wAARCACIAKADASIAAhEBAxEB/8QBogAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoLEAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+foBAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKCxEAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+SCIcVpx8DHpWZD0rTjoAsp6VpwHisuOtO36UAaydK0IutZ6dK0IutAGlEBxV+ICqMXar8NAGjDjgCtGHPes6LtWhDQBpRVp2wBYVlw1q2vUUAaqDmtJPu4rNTrWknSgCxGf0rSh/hrMjrTg6LQBrJ0rTjA4FZidK1I+1AGhD0q3HkNxVSHpVuP71AH//0P5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXar8NUIu1X4aANGLPGa0Iaz4u1aMNAGhDWra9RWXFWpbdRQBqp1rSTpWanWtJOlAE8dacHRazI604Oi0AaydK1I+1ZadK1I+1AGhD0q3H96qkPSrUf3qAP/9H+SCHpWnHWZD0rTjoAsR1p2/SsyOtO36UAaydK+vf2Xv2ePhx+0DPqeleLfijoPw+1K02GytdcjnUX4IO4QzovkK6kABJHRmz8ua+Qk6VfjAb5WGRQB+gnxB/Y/wDht8IryGx+JnxJbRGuc/Z3uvDWsLDcAfxQTCIxTL7xswriYvg5+zP/ANFotP8AwQat/wDGq84+GP7SXxl+FelP4X8OaubrQJ8CfRNTij1DS5gOz2V0skBx2IUMvVSDzXqf/CVfsmfFS1Y+LdCvvhprjYxd+H92o6M7eslhdS/arcevk3Eq9lRBxQBJF8HP2ascfGa0/wDBDq3/AMarQj+Dv7NfQfGW0/8ABDqv/wAbrG1f9kn4lf2NN4u+FVzp/wARNDt082a78NSm5mt09bqwdY723A7s8HlA8CQ184rG8MjQSja6cFSMEexHagD62j+D37NvX/hctp/4IdV/+N1fi+EH7N6kbfjHaf8Agh1X/wCNV85+BfAnjT4keI4PB/w+0m61rVLniK1sommlb32oDgDuTgAdcCvu34UfsjeGrfWZrXx7ct4u1bTo/Ou9F8OXMK2OngdTrOvy/wCg2ca/x+SZmH3QQ/AAMb4e/stfC/4p67/wjnw7+JY1i8SPzZEtvD2rMIoxwZJX8vbFGO7uVUetdbrf7A/ju98ayeFvghr+meP9MsbKW61LxBZFrTR7KS3R5Z7dr26CQSywxpucQPIFzt6giuy8dftFfCjwB4bk+H2kRWHiaKKQNH4e0BJ9P8IwuowJLudmTUtblXpmd0jP94p8lc/8R/jR8RtF+BME/jTUt3iX4h2nlWtjbolta6L4YRyBDbWkKpDbHUZU6RoP9Gj5z55wAfAqgAkAg47jp+FaUHRazI604Oi0AaydK1I+1ZadK1I+1AGhD0q3Hw1VIelW4/vcUAf/0v5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXar8NUIu1X4aAOn8O69rvhfWLbxD4YvbjTNQtGDwXVpK8E0TDo0ckZVkPupFfZ3gz48+Nfjx4osfBPxZ8FWXxT1O+/0e2lEZsdaLYzkX1j5TylQNxa5EowCWOK+G4s8Zr7O8AOnwP/AGeNU+Ke/wAvxL8QBc+H9EHSS20pAF1S9X0NxkWMZH8BuO+2gD6f8W/Fv4XfCDw3ceAdSlsJ7acDzfBXge4eLTWI6LrniEM93f8AP3ra3laPPWWMrtr4x+IXx++IvxQ0u28I6hNDpXhmxffZ6DpUS2mmwHs3kp/rZMf8tZi8n+1jivAYQoACjAA4ArUtgWYIgyx4AA5J9AKAPoz9nn4caB488Zz6r49ZoPCPhe1bV9elQhWNnCwVbaInjz7uUpbw+jPuI2o2Od+KXxK1z4v+P9S+IniFI4Z9QkGy3hG2G2giURW9tCvaOCJUjQei5POa9k+NYX4J/DzTv2YLJFXWWki1nxfKPvDUDGfsumZH8NhE580dDcyOMfugT8sx/doAnjrTg6LWZHWnB0WgDWTpWpH2rLTpWpH2oA0IelW4/vcVUh6Vaj+9QB//0/5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXar8NUIu1X4aAPXfgv8MNX+MnxM0j4b6PKls2oy/vrqX/VWlrEpkubqX0jt4UeV/ZcDnFd1+0J8T9K+KPxIe58IRNa+F9DtotH8PWr4zDplnlYSwHHmzEtPMR1lkftiu50OOD4H/szXHiidceKPimkljp3Z7Tw/azBbu5Hp9uuI/s0frHDP2K18oxHPtQBoxV9efs16Pp3gnT9V/ae8WQh7LwcyRaLDIBtvfEEyk2cQB4ZLUD7XOOgSNFODIlfM/gnwj4j8f8Ai3TPA3hG1a91XWLmKztIEHzSTTMERR+J+gHPSvof9ofxdoUeo6V8C/h1epfeFPASSWdvdRDCahqEpDahqA9VmmGyEnnyI4unQAHhmo6rqeu6pca3rdw93e3kjT3E8py8ksh3O7H1YnJp6dKzU61pJ0oAnjrTg6LWZHWnB0WgDWTpWpH2rLTpWpH2oA0IelW48buaqQ9KtR/eoA//1P5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXavaPgT8K5vjN8TdO8CtcjT7B/MutTvn/1dlp1ohnvLlz2WGBHb3ICjJIFeLR9Bivs9n/4UV+zFHYLG0Pir4tJ5srnhoPDNrN+7Re4+33kJZv70dunYnIB5t8d/ihb/Fv4nXviXRomtdDtlj07RLNuPsulWSCCzhwOAwiVS+Orlj3ryuGs2NlA3HAAr6++D37JHj74gJpfiPxk3/CLeG9TmWO3u7xHN3f8jdHpdhGr3N7KRwvlx+Upx5kiLzQB0nw18z4B/BG9+OErCLxN4yS50PwwpH7yCy/1eqanGf4Dj/QoW7s823/VnHypa9RX0J+1hf8Ajq6+L9xZ+NPDN74NtNLhj0rRtGvYXhaz06zGy3hG8Dc2MvKw+9KzseSa+e7XqKANVOtaSdKzU61pJ0oAnjrTg6LWZHWnB0WgDWTpWpH2rLTpWpH2oA0IelW4/vcVUh6Vbj+9xQB//9X+SCHpWnHWZD0rTjoAsR1p2/SsyOtO36UAaydK0IutZ6dK0IutAHvn7PXwx0v4sfE200HxRdNp3h2wil1PXb5ettplmvm3LL28xlHlQg9ZXQV79rfw6+K37VvjLUPj1qNta+D/AAZd3CWVjfam5t7C1s7ZVgtbCwjw092beFUjEVrHI2R82GbJd+xx+0H8M/hPp+rfDfx1o+nxReMr2yj1HxHqVrLqkenadZkzeWmlxPCLovOI3KySGMtHHuRlUqfs74lftC/Bi/1me6+Dfxk/sm6dBAPEepaLf3XiDyAMCG2mjjjttLgA+7Dp8MOwfKHxkUAYFn8O/wBnT9kdVv8AxoRFrSRCSO61qzjvdalJ6f2d4dZjb6cD1W41h/OCkMlvGwAPzb8TP22/iJ4qvbhPhn9o8Lw3Efkz6i1095r93EBgJc6s4WUR44Fvarb2y/wxDknjJfhL+ztfXMl7ffGmGaeVi7ySaFqbM7HklieST61Zh+DX7NnX/hclt/4INS/woAxvBP7UPxq8IadF4dm1Ya/ocQ2jSNfij1awC/3VgvFkWMf9c9uO1ehW3if9k34nyBfF+g3/AMNtTk/5fdAZtS0nd6vp10/2qFf7xhupQP4IQMCsaP4N/s2jj/hclr/4IdS/wq/D8Hf2cFwV+Mdr/wCCHUv8KANBv2UPHviCGbU/ghqGnfEaxh5xoMpa/wBoHU6ZMI73jvshfHevnu6sb3TLqTT9She2uIWKSRSqUdGHBVlYAgj0Ir6MsvhR+z5ZXMd5Z/GWCGWMgo6aHqaspHQggZH4V9U6d8UvhzqunJoPxh+Kei/ETT0QRp/wkPhzU5r2JRwBDqUZjvVwOFVpXjXslAH5jx1pwdFr7R+N3gH9haLwE/ir4EeO9T/4SSIru0C50+eW0mDMATb3siQvEEUltsqyE4wGFfF8P8NAGqnStSPtWWnStSPtQBoQ9Ktx/eqpD0q1H96gD//W/kgh6Vpx1mQ9K046ALEdadv0rMjrTt+lAGsnStCLrWenStCLrQBpxdqvw1Qi7VfhoA0YhjFaMNZ0WOMVow0AaMWe9alr1FZcWe9alr1FAGqnWtJOlZqda0k6UATx1pwdFrMjrTg6LQBrJ0rUj7Vlp0rUj7UAaEPSrcf3qqQ9Ktx/eoA//9f+SCLgVpx9M1lR9BWrF/qxQBZQVpwDis1Pu1qQfcoA006VoRdaz06VoRdaANKIjgVfiIFZ0XWr8dAGpFzjFaMII4NZ0H3R9K0060AX4hjitO2IDCs1OtaEH3hQBsJ1rST7tZcfatSP7goAsRitKH+Gs+PoK0Yuq0AaqdK04yOKzE6VoJ0oA1IelW4wd3FVIOhq7D94fhQB/9kAAO26j/EAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjUtMTItMTZUMDU6MjM6MTMrMDA6MDDRx6XwAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDI1LTEyLTE2VDA1OjIzOjEzKzAwOjAwoJodTAAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyNS0xMi0xNlQwNToyMzoxMyswMDowMPePPJMAAAARdEVYdGV4aWY6Q29sb3JTcGFjZQAxD5sCSQAAACB0RVh0ZXhpZjpDb21wb25lbnRzQ29uZmlndXJhdGlvbgAuLi5q8qFkAAAAE3RFWHRleGlmOkV4aWZPZmZzZXQAMTAyc0IppwAAABV0RVh0ZXhpZjpFeGlmVmVyc2lvbgAwMjIx5Fw1LQAAABl0RVh0ZXhpZjpGbGFzaFBpeFZlcnNpb24AMDEwMBLUKKwAAAAYdEVYdGV4aWY6UGl4ZWxYRGltZW5zaW9uADc2NBOIX0AAAAAYdEVYdGV4aWY6UGl4ZWxZRGltZW5zaW9uADY0OLTF+qgAAAAXdEVYdGV4aWY6U2NlbmVDYXB0dXJlVHlwZQAwIrQxYwAAABx0RVh0ZXhpZjp0aHVtYm5haWw6Q29tcHJlc3Npb24ANvllcFcAAAAodEVYdGV4aWY6dGh1bWJuYWlsOkpQRUdJbnRlcmNoYW5nZUZvcm1hdAAyODaLUk57AAAAL3RFWHRleGlmOnRodW1ibmFpbDpKUEVHSW50ZXJjaGFuZ2VGb3JtYXRMZW5ndGgAMzg0NI983bUAAAAfdEVYdGV4aWY6dGh1bWJuYWlsOlJlc29sdXRpb25Vbml0ADIlQF7TAAAAH3RFWHRleGlmOnRodW1ibmFpbDpYUmVzb2x1dGlvbgA3Mi8x2ocYLAAAAB90RVh0ZXhpZjp0aHVtYm5haWw6WVJlc29sdXRpb24ANzIvMXTvib0AAAAXdEVYdGV4aWY6WUNiQ3JQb3NpdGlvbmluZwAxrA+AYwAAAABJRU5ErkJggg==",this.supportedTransactionVersions=new Set(["legacy",0]),this._publicKey=null,this._readyState="undefined"==typeof window||"undefined"==typeof document?c.WalletReadyState.Unsupported:c.WalletReadyState.Installed,this._connecting=!1,this._wallet=null,this._config=_e,e&&(this._config={...this._config,...e})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==c.WalletReadyState.Installed)throw new c.WalletWindowClosedError;this._connecting=!0,this.emit("readyStateChange",this._readyState);const e=await I.getWallet();if(e)return void this._updateWalletState(e);const t=this._createDialogManager();try{const e=await t.openConnect(),a=await this._ensureWalletOnChain(e);await I.saveWallet(a),this._updateWalletState(a)}finally{t.destroy()}}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}_updateWalletState(e){this._wallet=e,this._publicKey=new a.PublicKey(e.smartWallet),this.emit("connect",this._publicKey)}_createDialogManager(){return new Te({portalUrl:this._config.portalUrl,rpcUrl:this._config.rpcUrl,paymasterUrl:this._config.paymasterConfig.paymasterUrl})}async _ensureWalletOnChain(e){const t=new a.Connection(this._config.rpcUrl),r=new d.KoraClient({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),n=new Be(t),s=Re(e.credentialId),o=await n.getSmartWalletByCredentialHash(s);let l,c;if(!e.publicKey&&o?(c=i.Buffer.from(o.passkeyPublicKey).toString("base64"),localStorage.setItem("PUBLIC_KEY",c)):c=e.publicKey,o)l=o.smartWallet.toBase58();else{const t=await r.getPayerSigner(),a=await n.createSmartWalletTxn({passkeyPublicKey:He(e.publicKey),payer:new p.web3.PublicKey(t.signer_address),credentialIdBase64:e.credentialId});await r.signAndSendTransaction({transaction:i.Buffer.from(a.transaction.serialize({requireAllSignatures:!1})).toString("base64"),signer_key:t.signer_address}),l=a.smartWallet.toBase58()}return{credentialId:e.credentialId,passkeyPubkey:He(c),expo:"web",platform:navigator.platform,smartWallet:l,walletDevice:""}}async disconnect(){await I.clearWallet(),this._wallet=null,this._publicKey=null,this.emit("disconnect")}async sendTransaction(e){try{if(!this._wallet||!this._publicKey)throw new c.WalletDisconnectedError;const t=this._prepareInstructions(e);if(0===t.length)throw new c.WalletSignTransactionError("No instructions to sign");const r=this._initializeClients();let n=[];if("version"in e){const t=e.message.addressTableLookups;n=await Promise.all(t.map(async e=>{const t=await r.connection.getAccountInfo(e.accountKey);if(!t)throw new Error("Lookup table not found");return new a.AddressLookupTableAccount({key:e.accountKey,state:a.AddressLookupTableAccount.deserialize(t.data)})}))}const i=await r.paymaster.getPayerSigner(),s=await x(r.connection),o=Re(this._wallet.credentialId),l=await this._buildAuthorizationMessage(r.smartWallet,t,i.signer_address,s,o),d=await r.connection.getLatestBlockhash(),u=await this._signWithDialog(l,t,d.blockhash,i.signer_address);return await this._executeSmartWalletTransaction(r,t,u,i.signer_address,s,o,n)}catch(e){throw this.emit("error",e),e}}async signTransaction(e){throw new c.WalletSignTransactionError("Lazorkit Wallet does not support signTransaction. Please use sendTransaction or signAndSendTransaction.")}async signAllTransactions(e){throw new c.WalletSignTransactionError("Lazorkit Wallet does not support signAllTransactions. Please use sendTransaction or signAndSendTransaction.")}async signMessage(e){const t=this._createDialogManager();try{if(!this._wallet||!this._publicKey)throw new c.WalletDisconnectedError;const a=i.Buffer.from(e).toString("base64"),r=await t.openSign(a,"",this._wallet.credentialId,this._config.clusterSimulation),n=JSON.stringify({signature:r.signature,signedPayload:r.signedPayload});return new Uint8Array(i.Buffer.from(n))}catch(e){throw this.emit("error",e),e}finally{t.destroy()}}_initializeClients(){const e=new a.Connection(this._config.rpcUrl);return{connection:e,paymaster:new d.KoraClient({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),smartWallet:new Be(e)}}_prepareInstructions(e){return"version"in e?e.message.compiledInstructions.map(t=>new a.TransactionInstruction({keys:t.accountKeyIndexes.map(t=>({pubkey:e.message.staticAccountKeys[t],isSigner:e.message.isAccountSigner(t),isWritable:e.message.isAccountWritable(t)})),programId:new a.PublicKey(e.message.staticAccountKeys[t.programIdIndex]),data:i.Buffer.from(t.data)})):[...e.instructions]}async _buildAuthorizationMessage(e,t,a,r,n){return await e.buildAuthorizationMessage({action:{type:exports.SmartWalletAction.CreateChunk,args:{cpiInstructions:t}},payer:new p.web3.PublicKey(a),smartWallet:this._publicKey,passkeyPublicKey:this._wallet.passkeyPubkey,timestamp:new p.BN(r),credentialHash:n})}async _signWithDialog(e,t,a,r){const n=i.Buffer.from(e).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),s=this._createDialogManager();try{const e=new p.web3.TransactionMessage({payerKey:new p.web3.PublicKey(r),recentBlockhash:a,instructions:t}).compileToV0Message(),o=new p.web3.VersionedTransaction(e),l=i.Buffer.from(o.serialize()).toString("base64");return await s.openSign(n,l,this._wallet.credentialId,this._config.clusterSimulation)}finally{s.destroy()}}async _executeSmartWalletTransaction(e,t,a,r,n,i,s){const o=await e.smartWallet.createChunkTxn({payer:new p.web3.PublicKey(r),smartWallet:this._publicKey,passkeySignature:{passkeyPublicKey:this._wallet.passkeyPubkey,signature64:a.signature,clientDataJsonRaw64:a.clientDataJsonBase64,authenticatorDataRaw64:a.authenticatorDataBase64},cpiInstructions:t,timestamp:n,credentialHash:i}),l=await this._sendToPaymaster(e.paymaster,o,r);await e.connection.confirmTransaction(l,"confirmed"),await T(e.connection,e.smartWallet,this._publicKey);const c=await e.smartWallet.executeChunkTxn({payer:new p.web3.PublicKey(r),smartWallet:this._publicKey,cpiInstructions:t},{addressLookupTables:s});return await this._sendToPaymaster(e.paymaster,c,r)}async _sendToPaymaster(e,t,a){let r;r="version"in t?i.Buffer.from(t.serialize()):i.Buffer.from(t.serialize({requireAllSignatures:!1,verifySignatures:!1}));return(await e.signAndSendTransaction({transaction:r.toString("base64"),signer_key:a})).signature}}class Je{constructor(e){this.version="1.0.0",this.name=je,this.icon="data:image/png;base64,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",this._account=null,this._listeners={},this._adapter=new Ge(e),this._adapter.on("connect",e=>{this._account={address:e.toBase58(),publicKey:e.toBytes(),chains:["solana:mainnet","solana:devnet","solana:testnet"],features:["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"]},this._emit("change",{accounts:[this._account]})}),this._adapter.on("disconnect",()=>{this._account=null,this._emit("change",{accounts:[]})})}get accounts(){return this._account?[this._account]:[]}get chains(){return["solana:mainnet","solana:devnet","solana:testnet"]}get features(){return{"standard:connect":{version:"1.0.0",connect:async()=>(await this._adapter.connect(),{accounts:this.accounts})},"standard:disconnect":{version:"1.0.0",disconnect:async()=>{await this._adapter.disconnect()}},"standard:events":{version:"1.0.0",on:(e,t)=>(this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),()=>{this._listeners[e]=this._listeners[e]?.filter(e=>e!==t)||[]})},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:async(...e)=>{const t=[];for(const r of e){const e=a.VersionedTransaction.deserialize(r.transaction),n=await this._adapter.sendTransaction(e);t.push({signature:o.decode(n)})}return t}},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:async(...e)=>{throw new Error("signTransaction not supported")}},"solana:signMessage":{version:"1.0.0",signMessage:async(...e)=>{const t=[];for(const a of e){const e=await this._adapter.signMessage(a.message);t.push({message:a.message,signature:e,signedMessage:a.message})}return t}}}}_emit(e,...t){this._listeners[e]?.forEach(e=>e(...t))}}Object.defineProperty(exports,"Connection",{enumerable:!0,get:function(){return a.Connection}}),Object.defineProperty(exports,"Keypair",{enumerable:!0,get:function(){return a.Keypair}}),Object.defineProperty(exports,"PublicKey",{enumerable:!0,get:function(){return a.PublicKey}}),Object.defineProperty(exports,"Transaction",{enumerable:!0,get:function(){return a.Transaction}}),Object.defineProperty(exports,"TransactionInstruction",{enumerable:!0,get:function(){return a.TransactionInstruction}}),exports.API_ENDPOINTS=w,exports.CHUNK_SEED=se,exports.CREDENTIAL_HASH_SIZE=32,exports.DEFAULTS=f,exports.DEFAULT_COMMITMENT=b,exports.DEFAULT_CONFIG=_e,exports.DefaultPolicyClient=ae,exports.DialogManager=Te,exports.EMPTY_PDA_RENT_EXEMPT_BALANCE=Q,exports.LazorkitClient=Be,exports.LazorkitProvider=a=>{const{children:r,rpcUrl:n=f.RPC_ENDPOINT,portalUrl:i=f.PORTAL_URL,paymasterConfig:s={paymasterUrl:f.PAYMASTER_URL}}=a,{setConfig:o}=Ke();return t.useEffect(()=>{o({portalUrl:i,paymasterConfig:s,rpcUrl:n})},[n,i,s,o]),e.jsx(e.Fragment,{children:r})},exports.LazorkitWalletAdapter=Ge,exports.LazorkitWalletName=je,exports.Logger=v,exports.PASSKEY_PUBLIC_KEY_SIZE=33,exports.Paymaster=P,exports.SIGNATURE_SIZE=64,exports.SMART_WALLET_CONFIG_SEED=ne,exports.SMART_WALLET_SEED=re,exports.STORAGE_KEYS=S,exports.StorageManager=I,exports.StorageUtil=class{static saveCredentials(e){try{e.credentialId&&localStorage.setItem(Le,e.credentialId),localStorage.setItem(Ve,e.publickey),localStorage.setItem(Fe,e.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",e.timestamp.toString())}catch(e){console.error("Failed to save credentials to local storage:",e)}}static getCredentials(){try{const e=localStorage.getItem(Le),t=localStorage.getItem(Ve),a=localStorage.getItem(Fe),r=localStorage.getItem("CREDENTIALS_TIMESTAMP");return t&&a?{credentialId:e||void 0,publickey:t,smartWalletAddress:a,timestamp:r?parseInt(r):Date.now()}:null}catch(e){return console.error("Failed to get credentials from local storage:",e),null}}static updateSmartWalletAddress(e){try{localStorage.setItem(Fe,e)}catch(e){console.error("Failed to update smart wallet address in local storage:",e)}}static clearCredentials(){try{localStorage.removeItem(Le),localStorage.removeItem(Ve),localStorage.removeItem(Fe),localStorage.removeItem("CREDENTIALS_TIMESTAMP"),console.log("Credentials cleared from local storage")}catch(e){console.error("Failed to clear credentials from local storage:",e)}}static getItem(e){return localStorage.getItem(e)}static setItem(e,t){localStorage.setItem(e,t)}},exports.ValidationError=K,exports.WALLET_DEVICE_SEED=ie,exports.asCredentialHash=R,exports.asPasskeyPublicKey=U,exports.asSignature=function(e){return e},exports.assertByteArrayLength=z,exports.assertDefined=N,exports.assertNonEmptyArray=G,exports.assertNonEmptyByteArray=function(e,t){if(N(e,t),0===(Array.isArray(e)?e:Array.from(e)).length)throw new K(`${t} cannot be empty`,t)},exports.assertNonEmptyString=_,exports.assertPositiveBN=j,exports.assertPositiveInteger=X,exports.assertPositiveNumber=function(e,t){if(N(e,t),"number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))throw new K(`${t} must be a finite number (got ${Number.isNaN(e)?"NaN":Number.isFinite(e)?typeof e:e===1/0?"Infinity":"-Infinity"})`,t);if(e<0)throw new K(`${t} must be non-negative, got ${e}`,t)},exports.assertValidBase64=Y,exports.assertValidCredentialHash=V,exports.assertValidPasskeyPublicKey=L,exports.assertValidPasskeySignature=te,exports.assertValidPublicKey=O,exports.assertValidPublicKeyArray=q,exports.assertValidSignature=F,exports.assertValidTransactionInstruction=J,exports.assertValidTransactionInstructionArray=$,exports.base64ToBytes=Ne,exports.buildCreateChunkMessage=be,exports.buildExecuteMessage=function(e,t,a,r,n,s){const o=ye(r,e),l=((e,t,a)=>{const r=W(e,a),n=he(e.programId,r,t);return{cpiDataHash:me(e.data),cpiAccountsHash:n}})(n,e,s??[]),c=new Uint8Array(64);c.set(o.policyDataHash,0),c.set(o.policyAccountsHash,32);const d=me(c),u=new Uint8Array(64);u.set(l.cpiDataHash,0),u.set(l.cpiAccountsHash,32);const A=me(u),p=i.Buffer.alloc(8);p.writeBigUInt64LE(BigInt(t.toString()),0);const g=i.Buffer.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=i.Buffer.concat([p,g,i.Buffer.from(d),i.Buffer.from(A)]),h=me(m);return we("SimpleMessage",{dataHash:Array.from(h)})},exports.buildPasskeyVerificationInstruction=Ie,exports.buildTransaction=Ee,exports.byteArrayEquals=function(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0},exports.calculateVerifyInstructionIndex=We,exports.combineInstructionsWithAuth=De,exports.combineInstructionsWithAuthAndCU=function(e,t,a){return Ce([e,...t],a)},exports.computeMultipleCpiHashes=fe,exports.convertPasskeySignatureToInstructionArgs=ve,exports.createComputeUnitLimitInstruction=Pe,exports.credentialHashFromBase64=B,exports.deriveChunkPda=ue,exports.deriveSmartWalletConfigPda=le,exports.deriveSmartWalletPda=oe,exports.deriveWalletDevicePda=de,exports.detectPlatform=function(){if("undefined"!=typeof window&&window.ReactNativeWebView)return"mobile";const e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":"web"},exports.ensureChunkExist=T,exports.getBlockchainTimestamp=x,exports.getRandomBytes=E,exports.importP256PublicKey=Oe,exports.instructionToAccountMetas=W,exports.isAndroid=function(){return/Android/i.test(navigator.userAgent)},exports.isIOS=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},exports.isSafari=function(){const e=navigator.userAgent.toLowerCase();return/^((?!chrome|android).)*safari/i.test(e)},exports.normalizePublicKey=function(e,t="publicKey"){return O(e,t),"string"==typeof e?new p.web3.PublicKey(e):e},exports.prependComputeUnitLimit=Ce,exports.registerLazorkitWallet=function(e){u.registerWallet(new Je(e))},exports.toNumberArray=Z,exports.toNumberArraySafe=ee,exports.useWallet=()=>{const{wallet:e,isLoading:r,isConnecting:n,isSigning:i,error:s,connect:o,disconnect:l,signAndSendTransaction:c,signMessage:d}=Ke(),u=t.useCallback(async e=>{try{return await o(e)}catch(e){throw console.error("Failed to connect wallet:",e),e}},[o]),A=t.useCallback(async()=>{try{await l()}catch(e){throw console.error("Failed to disconnect wallet:",e),e}},[l]),p=t.useCallback(async e=>{try{return await c({instructions:e.instructions,transactionOptions:e.transactionOptions})}catch(e){throw console.error("Failed to sign and send transaction:",e),e}},[c]),g=t.useCallback(async e=>{try{return await d(e)}catch(e){throw console.error("Failed to sign message:",e),e}},[d]),m=t.useCallback(async({signedPayload:e,signature:t,publicKey:a})=>{const r=Buffer.from(e).toString("base64"),n=Buffer.from(t).toString("base64"),i=Buffer.from(a).toString("base64");return await ze({signedPayload:r,signature:n,publicKey:i})},[]);return{smartWalletPubkey:e?.smartWallet?new a.PublicKey(e.smartWallet):null,isConnected:!!e,isLoading:r||n||i,isConnecting:n,isSigning:i,error:s,wallet:e,connect:u,disconnect:A,signAndSendTransaction:p,signMessage:g,verifyMessage:m}},exports.useWalletStore=Ke,exports.validateCredentialHash=function(e,t="credentialHash"){return V(e,t),Array.isArray(e)?e:Array.from(e)},exports.validatePasskeyPublicKey=function(e,t="passkeyPublicKey"){return L(e,t),Array.isArray(e)?e:Array.from(e)},exports.validateSignature=function(e,t="signature"){return F(e,t),Array.isArray(e)?e:Array.from(e)},exports.verifySignatureBrowser=ze;
+"use strict";var e=require("react/jsx-runtime"),t=require("react"),a=require("@solana/web3.js"),r=require("zustand"),n=require("@coral-xyz/anchor"),i=require("buffer"),s=require("js-sha256"),o=require("bs58"),l=require("eventemitter3"),c=require("@solana/wallet-adapter-base"),d=require("@solana/kora"),u=require("@wallet-standard/wallet");function A(e){var t=Object.create(null);return e&&Object.keys(e).forEach(function(a){if("default"!==a){var r=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,r.get?r:{enumerable:!0,get:function(){return e[a]}})}}),t.default=e,Object.freeze(t)}var p=A(n);function g(e,t){let a;try{a=e()}catch(e){return}return{getItem:e=>{var t;const r=e=>null===e?null:JSON.parse(e,void 0),n=null!=(t=a.getItem(e))?t:null;return n instanceof Promise?n.then(r):r(n)},setItem:(e,t)=>a.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>a.removeItem(e)}}const m=e=>t=>{try{const a=e(t);return a instanceof Promise?a:{then:e=>m(e)(a),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>m(t)(e)}}},h=(e,t)=>(a,r,n)=>{let i={storage:g(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},s=!1;const o=new Set,l=new Set;let c=i.storage;if(!c)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),a(...e)},r,n);const d=()=>{const e=i.partialize({...r()});return c.setItem(i.name,{state:e,version:i.version})},u=n.setState;n.setState=(e,t)=>(u(e,t),d());const A=e((...e)=>(a(...e),d()),r,n);let p;n.getInitialState=()=>A;const h=()=>{var e,t;if(!c)return;s=!1,o.forEach(e=>{var t;return e(null!=(t=r())?t:A)});const n=(null==(t=i.onRehydrateStorage)?void 0:t.call(i,null!=(e=r())?e:A))||void 0;return m(c.getItem.bind(c))(i.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const t=i.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;const[n,s]=e;if(p=i.merge(s,null!=(t=r())?t:A),a(p,!0),n)return d()}).then(()=>{null==n||n(p,void 0),p=r(),s=!0,l.forEach(e=>e(p))}).catch(e=>{null==n||n(void 0,e)})};return n.persist={setOptions:e=>{i={...i,...e},e.storage&&(c=e.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>h(),hasHydrated:()=>s,onHydrate:e=>(o.add(e),()=>{o.delete(e)}),onFinishHydration:e=>(l.add(e),()=>{l.delete(e)})},i.skipHydration||h(),p||A},y={PORTAL_URL:"https://portal.lazor.sh",PAYMASTER_URL:"https://lazorkit-paymaster.onrender.com",RPC_ENDPOINT:"https://api.devnet.solana.com"},f={CONNECT:"connect",SIGN:"sign"},w="confirmed",b={WALLET:"lazorkit-wallet",CREDENTIALS:"lazorkit-credentials",PUBLIC_KEY:"PUBLIC_KEY",CREDENTIAL_ID:"CREDENTIAL_ID",SMART_WALLET_ADDRESS:"SMART_WALLET_ADDRESS"},S={getItem:async e=>{try{if("undefined"==typeof window)return null;return localStorage.getItem(e)}catch(t){return console.error("Error reading from localStorage:",t,{key:e}),null}},setItem:async(e,t)=>{try{if("undefined"==typeof window)return;localStorage.setItem(e,t)}catch(a){console.error("Error writing to localStorage:",a,{key:e,valueLength:t.length})}},removeItem:async e=>{try{if("undefined"==typeof window)return;localStorage.removeItem(e)}catch(t){console.error("Error removing from localStorage:",t,{key:e})}}};class k{static async saveWallet(e){try{await S.setItem(b.WALLET,JSON.stringify(e)),await S.setItem(b.CREDENTIAL_ID,e.credentialId),await S.setItem(b.SMART_WALLET_ADDRESS,e.smartWallet),await S.setItem(b.PUBLIC_KEY,i.Buffer.from(e.passkeyPubkey).toString("base64"))}catch(e){throw console.error("Failed to save wallet to storage:",e),e}}static async getWallet(){try{const e=await S.getItem(b.WALLET);return e?JSON.parse(e):null}catch(e){return console.error("Failed to get wallet from storage:",e),null}}static async saveConfig(e){try{await S.setItem("lazorkit-config",JSON.stringify(e))}catch(e){throw console.error("Failed to save config to storage:",e),e}}static async getConfig(){try{const e=await S.getItem("lazorkit-config");return e?JSON.parse(e):null}catch(e){return console.error("Failed to get config from storage:",e),null}}static async clearWallet(){try{await S.removeItem(b.WALLET),await S.removeItem(b.CREDENTIAL_ID),await S.removeItem(b.SMART_WALLET_ADDRESS),await S.removeItem(b.PUBLIC_KEY),await S.removeItem("CREDENTIALS_TIMESTAMP")}catch(e){throw console.error("Failed to clear wallet from storage:",e),e}}static async getItem(e){return await S.getItem(e)}static async setItem(e,t){await S.setItem(e,t)}static async removeItem(e){await S.removeItem(e)}}class I{constructor(e){this.context=e,this.enabled="production"!==process.env.NODE_ENV}debug(e,t){this.enabled&&console.debug(`[${this.context}] ${e}`,t)}info(e,t){console.info(`[${this.context}] ${e}`,t)}warn(e,t){console.warn(`[${this.context}] ${e}`,t)}error(e,t){console.error(`[${this.context}] ${e}`,t)}}class P{constructor(e){this.logger=new I("Paymaster"),this.endpoint=e.paymasterUrl,this.apiKey=e.apiKey}getHeaders(){const e={"Content-Type":"application/json"};return this.apiKey&&(e["x-api-key"]=this.apiKey),e}async getPayer(){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getPayerSigner",params:[]})});if(!e.ok)throw new Error(`Failed to get payer: ${e.statusText}`);const t=await e.json();return new a.PublicKey(t.result.signer_address)}catch(e){throw this.logger.error("Failed to get payer",e),e}}async getBlockhash(){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"getBlockhash",id:1,params:[]})});if(!e.ok)throw new Error(`Failed to get blockhash: ${e.statusText}`);return(await e.json()).result.blockhash}catch(e){throw this.logger.error("Failed to get blockhash",e),e}}async attemptSign(e,t=1){try{const t=e.serialize({verifySignatures:!1,requireAllSignatures:!1}),r=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signTransaction",id:1,params:[t.toString("base64")]})});if(!r.ok)throw new Error(`Failed to sign transaction: ${r.statusText}`);const n=await r.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return a.Transaction.from(i.Buffer.from(n.result.signed_transaction,"base64"))}catch(e){throw this.logger.error(`Sign attempt ${t} failed:`,e),e}}async sign(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSign(e,r)}catch(e){if(r===t)throw this.logger.error("All sign retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying sign in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign transaction after all retries")}async attemptSignAndSend(e,t=1){try{const t=e.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[t.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign and send transaction: ${a.statusText}`);const r=await a.json();if(r.error)throw new Error(r.error.message||"Unknown paymaster error");return r.result.signature}catch(e){throw this.logger.error(`Attempt ${t} failed:`,e),e}}async signAndSend(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSignAndSend(e,r)}catch(e){if(r===t)throw this.logger.error("All retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign and send transaction after all retries")}async attemptSignAndSendVersionedTransaction(e,t=1){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[i.Buffer.from(e.serialize()).toString("base64")]})});if(!t.ok)throw new Error(`Failed to sign and send transaction: ${t.statusText}`);const a=await t.json();if(a.error)throw new Error(a.error.message||"Unknown paymaster error");return a.result.signature}catch(e){throw this.logger.error(`Attempt ${t} failed:`,e),e}}async signAndSendVersionedTransaction(e,t=3,a=1e3){for(let r=1;r<=t;r++)try{return await this.attemptSignAndSendVersionedTransaction(e,r)}catch(e){if(r===t)throw this.logger.error("All retry attempts failed",e),e;const n=a*Math.pow(2,r-1);this.logger.info(`Retrying in ${n}ms (attempt ${r}/${t})`),await new Promise(e=>setTimeout(e,n))}throw new Error("Failed to sign and send transaction after all retries")}}var v,C={address:"Gsuz7YcA5sbMGVRXT3xSYhJBessW4xFC4xYsihNCqMFh",metadata:{name:"lazorkit",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},docs:["LazorKit: Smart Wallet with WebAuthn Passkey Authentication"],instructions:[{name:"close_chunk",discriminator:[150,183,213,198,0,74,14,170],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0}],args:[]},{name:"create_chunk",discriminator:[83,226,15,219,9,19,186,90],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"wallet_state.last_nonce",account:"WalletState"}]}},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateChunkArgs"}}}]},{name:"create_smart_wallet",discriminator:[129,39,235,18,132,68,203,19],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"arg",path:"args.wallet_id"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"policy_program"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateSmartWalletArgs"}}}]},{name:"delete_smart_wallet",discriminator:[126,239,172,118,134,32,52,102],accounts:[{name:"payer",writable:!0,signer:!0,address:"BE8duRBDmh4cF4Ecz4TBCNgNAMCaonrpQiEiQ1xfQmab"},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[]},{name:"execute",discriminator:[130,221,242,154,13,193,189,29],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"cpi_program"},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"ExecuteArgs"}}}]},{name:"execute_chunk",discriminator:[106,83,113,47,89,243,39,220],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"instruction_data_list",type:{vec:"bytes"}},{name:"split_index",type:"bytes"}]}],accounts:[{name:"Chunk",discriminator:[134,67,80,65,135,143,156,196]},{name:"WalletDevice",discriminator:[35,85,31,31,179,48,136,123]},{name:"WalletState",discriminator:[126,186,0,158,92,223,167,68]}],errors:[{code:6e3,name:"PasskeyMismatch",msg:"Passkey public key mismatch with stored authenticator"},{code:6001,name:"InvalidPolicyDataSize",msg:"Invalid policy data size"},{code:6002,name:"Secp256r1InvalidLength",msg:"Secp256r1 instruction has invalid data length"},{code:6003,name:"Secp256r1HeaderMismatch",msg:"Secp256r1 instruction header validation failed"},{code:6004,name:"Secp256r1DataMismatch",msg:"Secp256r1 signature data validation failed"},{code:6005,name:"InvalidSignature",msg:"Invalid signature provided for passkey verification"},{code:6006,name:"ClientDataInvalidUtf8",msg:"Client data JSON is not valid UTF-8"},{code:6007,name:"ClientDataJsonParseError",msg:"Client data JSON parsing failed"},{code:6008,name:"ChallengeMissing",msg:"Challenge field missing from client data JSON"},{code:6009,name:"ChallengeBase64DecodeError",msg:"Challenge base64 decoding failed"},{code:6010,name:"ChallengeDeserializationError",msg:"Challenge message deserialization failed"},{code:6011,name:"HashMismatch",msg:"Message hash mismatch: expected different value"},{code:6012,name:"InvalidInstructionDiscriminator",msg:"Invalid instruction discriminator"},{code:6013,name:"InsufficientCpiAccounts",msg:"Insufficient remaining accounts for CPI instruction"},{code:6014,name:"AccountSliceOutOfBounds",msg:"Account slice index out of bounds"},{code:6015,name:"InvalidAccountOwner",msg:"Account owner verification failed"},{code:6016,name:"ProgramNotExecutable",msg:"Program not executable"},{code:6017,name:"CredentialIdEmpty",msg:"Credential ID cannot be empty"},{code:6018,name:"PolicyDataTooLarge",msg:"Policy data exceeds maximum allowed size"},{code:6019,name:"TransactionTooOld",msg:"Transaction is too old"},{code:6020,name:"InvalidInstructionData",msg:"Invalid instruction data"},{code:6021,name:"InvalidInstruction",msg:"Invalid instruction"},{code:6022,name:"InsufficientBalanceForFee",msg:"Insufficient balance for fee"},{code:6023,name:"InvalidSequenceNumber",msg:"Invalid sequence number"},{code:6024,name:"InvalidPasskeyFormat",msg:"Invalid passkey format"},{code:6025,name:"ReentrancyDetected",msg:"Reentrancy detected"},{code:6026,name:"UnauthorizedAdmin",msg:"Unauthorized admin"}],types:[{name:"Chunk",docs:["Transaction chunk for deferred execution","","Created after full passkey and policy verification. Contains all bindings","necessary to execute the transaction later without re-verification.","Used for large transactions that need to be split into manageable chunks."],type:{kind:"struct",fields:[{name:"owner_wallet_address",docs:["Smart wallet address that authorized this chunk session"],type:"pubkey"},{name:"cpi_hash",docs:["Combined SHA256 hash of all cpi transaction instruction data"],type:{array:["u8",32]}},{name:"authorized_nonce",docs:["The nonce that was authorized at chunk creation (bound into data hash)"],type:"u64"},{name:"authorized_timestamp",docs:["Timestamp from the original message hash for expiration validation"],type:"i64"},{name:"rent_refund_address",docs:["Address to receive rent refund when closing the chunk session"],type:"pubkey"}]}},{name:"CreateChunkArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"policy_data",type:"bytes"},{name:"timestamp",type:"i64"},{name:"cpi_hash",type:{array:["u8",32]}}]}},{name:"CreateSmartWalletArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"init_policy_data",type:"bytes"},{name:"wallet_id",type:"u64"},{name:"amount",type:"u64"},{name:"policy_data_size",type:"u16"}]}},{name:"ExecuteArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"split_index",type:"u16"},{name:"policy_data",type:"bytes"},{name:"cpi_data",type:"bytes"},{name:"timestamp",type:"i64"}]}},{name:"WalletDevice",docs:["Wallet device account linking a passkey to a smart wallet"],type:{kind:"struct",fields:[{name:"passkey_pubkey",docs:["Secp256r1 compressed public key (33 bytes)"],type:{array:["u8",33]}},{name:"credential_hash",docs:["SHA256 hash of the credential ID"],type:{array:["u8",32]}},{name:"smart_wallet",docs:["Associated smart wallet address"],type:"pubkey"},{name:"bump",docs:["PDA bump seed"],type:"u8"}]}},{name:"WalletState",docs:["Wallet state account storing wallet configuration and execution state"],type:{kind:"struct",fields:[{name:"bump",docs:["PDA bump seed for smart wallet"],type:"u8"},{name:"wallet_id",docs:["Unique wallet identifier"],type:"u64"},{name:"last_nonce",docs:["Last used nonce for anti-replay protection"],type:"u64"},{name:"policy_program",docs:["Policy program that validates transactions"],type:"pubkey"},{name:"policy_data",docs:["Serialized policy data returned from policy initialization"],type:"bytes"}]}}]};function W(e,t){return e.keys.map(e=>({pubkey:e.pubkey,isWritable:e.isWritable,isSigner:!!t&&t.some(t=>t.toString()===e.pubkey.toString())}))}function D(e){if("function"==typeof globalThis.crypto?.getRandomValues){const t=new Uint8Array(e);return globalThis.crypto.getRandomValues(t),t}try{const{randomBytes:t}=require("crypto");return t(e)}catch{throw new Error("No CSPRNG available")}}function E(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}function B(e){const t=i.Buffer.from(e,"base64");return Array.from(new Uint8Array(s.sha256.arrayBuffer(t)))}async function x(e){const t=await e.getSlot(),a=await e.getBlockTime(t);return new p.BN(a||Math.floor(Date.now()/1e3))}function T(e){return e}function U(e){return e}exports.SmartWalletAction=void 0,(v=exports.SmartWalletAction||(exports.SmartWalletAction={})).Execute="execute",v.CreateChunk="create_chunk",v.ExecuteChunk="execute_chunk";var R={address:"BiE9vSdz9MidUiyjVYsu3PG4C1fbPZ8CVPADA9jRfXw7",metadata:{name:"default_policy",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},instructions:[{name:"check_policy",discriminator:[28,88,170,179,239,136,25,35],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet"}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"policy_data",type:"bytes"}]},{name:"init_policy",discriminator:[45,234,110,100,209,146,191,86],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}],returns:{defined:{name:"PolicyStruct"}}}],errors:[{code:6e3,name:"InvalidPasskey",msg:"Invalid passkey format"},{code:6001,name:"Unauthorized",msg:"Unauthorized to access smart wallet"}],types:[{name:"DeviceSlot",type:{kind:"struct",fields:[{name:"passkey_pubkey",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}]}},{name:"PolicyStruct",type:{kind:"struct",fields:[{name:"bump",type:"u8"},{name:"smart_wallet",type:"pubkey"},{name:"device_slots",type:{vec:{defined:{name:"DeviceSlot"}}}}]}}]};const M=i.Buffer.from("policy");const H=890880;class Q extends Error{constructor(e,t){super(e),this.field=t,this.name="ValidationError"}}function N(e,t){if(null==e||void 0===e){throw new Q(`${t} is required but was ${null===e?"null":"undefined"}`,t)}}function K(e,t){N(e,t);try{if("string"==typeof e){if(0===e.trim().length)throw new Q(`${t} cannot be an empty string`,t);new p.web3.PublicKey(e)}else{if(!(e instanceof p.web3.PublicKey||e&&"object"==typeof e&&"toBase58"in e&&"function"==typeof e.toBase58&&"toBytes"in e&&"function"==typeof e.toBytes))throw new Q(`${t} must be a PublicKey instance or valid base58 string`,t)}}catch(e){if(e instanceof Q)throw e;throw new Q(`${t} is not a valid PublicKey: ${e instanceof Error?e.message:"Invalid format"}`,t)}}function O(e,t,a){let r;if(N(e,a),Array.isArray(e))r=e;else if(e instanceof Uint8Array)r=Array.from(e);else{if(!e||"object"!=typeof e||"number"!=typeof e.length)throw new Q(`${a} must be an array or Uint8Array`,a);r=Array.from(e)}if(r.length!==t)throw new Q(`${a} must be exactly ${t} bytes, got ${r.length}`,a);for(let e=0;e<r.length;e++){const t=r[e];if("number"!=typeof t||!Number.isFinite(t)||!Number.isInteger(t)||t<0||t>255)throw new Q(`${a}[${e}] must be a valid byte (0-255), got ${"number"==typeof t?t:typeof t}`,a)}}function z(e,t="passkeyPublicKey"){O(e,33,t)}function L(e,t="credentialHash"){O(e,32,t)}function V(e,t="signature"){O(e,64,t)}function F(e,t){N(e,t);if(!(e instanceof p.BN||e&&"object"==typeof e&&"lt"in e&&"function"==typeof e.lt&&"toString"in e&&"function"==typeof e.toString))throw new Q(`${t} must be a BN instance`,t);if(e.lt(new p.BN(0)))throw new Q(`${t} must be non-negative, got ${e.toString()}`,t)}function _(e,t){if(N(e,t),"string"!=typeof e)throw new Q(`${t} must be a string (got ${typeof e})`,t);if(0===String(e).trim().length)throw new Q(`${t} cannot be empty`,t)}function j(e,t){if(N(e,t),!Array.isArray(e))throw new Q(`${t} must be an array (got ${typeof e}${e&&"object"==typeof e?` with constructor ${e.constructor?.name||"unknown"}`:""})`,t);if(0===e.length)throw new Q(`${t} cannot be empty`,t)}function G(e,t){N(e,t);if(!(e instanceof p.web3.TransactionInstruction||e&&"object"==typeof e&&"programId"in e&&"keys"in e&&Array.isArray(e.keys)&&"data"in e))throw new Q(`${t} must be a TransactionInstruction instance`,t);if(K(e.programId,`${t}.programId`),!e.keys||!Array.isArray(e.keys)||0===e.keys.length)throw new Q(`${t} must have at least one account key`,t)}function J(e){return Array.isArray(e)?e:Array.from(e)}function Z(e,t){_(e,t);if(!/^[A-Za-z0-9+/]*={0,2}$/.test(e))throw new Q(`${t} is not a valid base64 string (invalid characters)`,t);try{"undefined"!=typeof Buffer&&Buffer.from?Buffer.from(e,"base64"):"undefined"!=typeof atob&&atob(e)}catch(e){throw new Q(`${t} is not a valid base64 string: ${e instanceof Error?e.message:"Invalid format"}`,t)}}function Y(e,t){if(N(e,t),"number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))throw new Q(`${t} must be a finite number (got ${Number.isNaN(e)?"NaN":Number.isFinite(e)?typeof e:e===1/0?"Infinity":"-Infinity"})`,t);if(!Number.isInteger(e))throw new Q(`${t} must be an integer, got ${e}`,t);if(e<=0)throw new Q(`${t} must be a positive integer, got ${e}`,t)}function X(e,t){j(e,t),e.forEach((e,a)=>{K(e,`${t}[${a}]`)})}function q(e,t){j(e,t),e.forEach((e,a)=>{G(e,`${t}[${a}]`)})}function $(e){return Array.isArray(e)?[...e]:Array.from(e)}class ee{constructor(e){N(e,"connection"),this.connection=e,this.program=new p.Program(R,{connection:e}),this.programId=this.program.programId}policyPda(e){return K(e,"smartWallet"),function(e,t){return p.web3.PublicKey.findProgramAddressSync([M,t.toBuffer()],e)[0]}(this.programId,e)}getPolicyDataSize(){return 102}validateInitPolicyParams(e){N(e,"params"),F(e.walletId,"params.walletId"),z(e.passkeyPublicKey,"params.passkeyPublicKey"),L(e.credentialHash,"params.credentialHash"),K(e.policySigner,"params.policySigner"),K(e.smartWallet,"params.smartWallet"),K(e.walletState,"params.walletState")}async buildInitPolicyIx(e){return this.validateInitPolicyParams(e),await this.program.methods.initPolicy(e.walletId,$(e.passkeyPublicKey),$(e.credentialHash)).accountsPartial({smartWallet:e.smartWallet,walletState:e.walletState,policySigner:e.policySigner}).instruction()}validateCheckPolicyParams(e){if(N(e,"params"),F(e.walletId,"params.walletId"),z(e.passkeyPublicKey,"params.passkeyPublicKey"),K(e.policySigner,"params.policySigner"),K(e.smartWallet,"params.smartWallet"),L(e.credentialHash,"params.credentialHash"),N(e.policyData,"params.policyData"),!Buffer.isBuffer(e.policyData))throw new Q("params.policyData must be a Buffer instance","params.policyData")}async buildCheckPolicyIx(e){return this.validateCheckPolicyParams(e),await this.program.methods.checkPolicy(e.walletId,$(e.passkeyPublicKey),$(e.credentialHash),e.policyData).accountsPartial({smartWallet:e.smartWallet,policySigner:e.policySigner}).instruction()}}function te(e,t){const a=i.Buffer.concat([e.toBuffer(),i.Buffer.from(t)]),r=s.sha256.arrayBuffer(a);return i.Buffer.from(r).subarray(0,32)}const ae=32,re=new p.web3.PublicKey("Secp256r1SigVerify1111111111111111111111111"),ne=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),ie=new Uint8Array([127,255,255,255,128,0,0,0,127,255,255,255,255,255,255,255,222,115,125,86,211,139,207,66,121,220,229,97,126,49,146,168]);function se(e){if(e instanceof Uint8Array)return e;if(Array.isArray(e))return new Uint8Array(e);{const t=new ArrayBuffer(2*Object.values(e).length),a=new DataView(t);return Object.values(e).forEach((e,t)=>{a.setUint16(2*t,e,!0)}),new Uint8Array(t)}}function oe(e,t,a){try{const r=a.slice(0,ae),n=a.slice(ae,64),s=i.Buffer.alloc(ae,0),o=i.Buffer.alloc(ae,0);if(r.copy(s,ae-r.length),n.copy(o,ae-n.length),function(e,t){if(e.length!==t.length)return e.length>t.length;for(let a=0;a<e.length;a++)if(e[a]!==t[a])return e[a]>t[a];return!1}(o,ie)){const e=function(e,t){const a=new Uint8Array(e.length);let r=0;for(let n=e.length-1;n>=0;n--){let i=e[n]-t[n]-r;i<0?(i+=256,r=1):r=0,a[n]=i}return a}(ne,o);a=i.Buffer.concat([s,i.Buffer.from(e)])}else a=i.Buffer.concat([s,o]);if(33!==t.length||64!==a.length)throw new Error("Invalid key or signature length");const l=113+e.length,c=new Uint8Array(l),d=1,u=16,A=u+33,g=A+64;c.set(se([d,0]),0);const m={signature_offset:A,signature_instruction_index:65535,public_key_offset:u,public_key_instruction_index:65535,message_data_offset:g,message_data_size:e.length,message_instruction_index:65535};return c.set(se(m),2),c.set(t,u),c.set(a,A),c.set(e,g),new p.web3.TransactionInstruction({keys:[],programId:re,data:i.Buffer.from(c)})}catch(e){throw new Error(`Failed to create secp256r1 instruction: ${e}`)}}const le=i.Buffer.from("smart_wallet"),ce=i.Buffer.from("wallet_state"),de=i.Buffer.from("wallet_device"),ue=i.Buffer.from("chunk");function Ae(e,t){return p.web3.PublicKey.findProgramAddressSync([le,t.toArrayLike(i.Buffer,"le",8)],e)[0]}function pe(e,t){return p.web3.PublicKey.findProgramAddressSync([ce,t.toBuffer()],e)[0]}function ge(e,t,a){return p.web3.PublicKey.findProgramAddressSync([de,te(t,a)],e)}function me(e,t,a){return p.web3.PublicKey.findProgramAddressSync([ue,t.toBuffer(),a.toArrayLike(i.Buffer,"le",8)],e)[0]}class he{constructor(e){this.programId=e}smartWallet(e){return F(e,"walletId"),Ae(this.programId,e)}walletState(e){return K(e,"smartWallet"),pe(this.programId,e)}walletDevice(e,t){return K(e,"smartWallet"),L(t,"credentialHash"),ge(this.programId,e,t)[0]}chunk(e,t){return K(e,"smartWallet"),me(this.programId,e,t)}}class ye{constructor(e,t){this.policyClient=e,this.walletPdas=t}async resolveForExecute({provided:e,smartWallet:t,credentialHash:a,passkeyPublicKey:r,walletStateData:n}){if(null!==e)return e;const i=this.walletPdas.walletDevice(t,a);return this.policyClient.buildCheckPolicyIx({walletId:n.walletId,passkeyPublicKey:r,policySigner:i,smartWallet:t,credentialHash:a,policyData:n.policyData})}async resolveForCreate({provided:e,smartWalletId:t,smartWallet:a,walletState:r,passkeyPublicKey:n,credentialHash:i}){if(null!=e)return e;const s=this.walletPdas.walletDevice(a,i);return this.policyClient.buildInitPolicyIx({walletId:t,passkeyPublicKey:n,credentialHash:i,policySigner:s,smartWallet:a,walletState:r})}}let fe=null;const we=e=>new Uint8Array(s.sha256.arrayBuffer(e)),be=(e,t,a)=>{const r=s.sha256.create();r.update(e.toBytes());for(const e of t)r.update(e.pubkey.toBytes()),r.update(Uint8Array.from([e.isSigner?1:0])),r.update(Uint8Array.from([e.pubkey.toString()===a.toString()||e.isWritable?1:0]));return new Uint8Array(r.arrayBuffer())},Se=(e,t)=>{const a=W(e),r=be(e.programId,a,t);return{policyDataHash:we(e.data),policyAccountsHash:r}},ke=(e,t,a)=>{const r=i.Buffer.alloc(4);r.writeUInt32LE(e.length,0);const n=i.Buffer.concat([r,...e.map(e=>{const t=i.Buffer.from(e.data),a=i.Buffer.alloc(4);return a.writeUInt32LE(t.length,0),i.Buffer.concat([a,t])})]),o=we(n),l=((e,t)=>{const a=new Map;for(const t of e){const e=t.pubkey.toString(),r=a.get(e);r?(r.isSigner=r.isSigner||t.isSigner,r.isWritable=r.isWritable||t.isWritable):a.set(e,{isSigner:t.isSigner,isWritable:t.isWritable})}const r=e.map(e=>{const t=e.pubkey.toString(),r=a.get(t);return{pubkey:e.pubkey,isSigner:r.isSigner,isWritable:r.isWritable}}),n=s.sha256.create();for(const e of r)n.update(e.pubkey.toBytes()),n.update(Uint8Array.from([e.isSigner?1:0])),n.update(Uint8Array.from([e.pubkey.toString()===t.toString()||e.isWritable?1:0]));return new Uint8Array(n.arrayBuffer())})(e.flatMap(e=>[{pubkey:e.programId,isSigner:!1,isWritable:!1},...W(e,a)]),t);return{cpiDataHash:o,cpiAccountsHash:l}},Ie=(e,t)=>{try{const a=(fe||(fe=new p.BorshCoder({version:"0.1.0",name:"lazorkit_msgs",instructions:[],accounts:[],types:[{name:"SimpleMessage",type:{kind:"struct",fields:[{name:"dataHash",type:{array:["u8",32]}}]}}]})),fe).types.encode(e,t);return i.Buffer.from(a)}catch(t){throw new Error(`Failed to encode ${e}: ${t instanceof Error?t.message:"Unknown error"}`)}};function Pe(e,t,a,r,n,s){const o=Se(r,e),l=((e,t,a)=>{const r=W(e,a),n=be(e.programId,r,t);return{cpiDataHash:we(e.data),cpiAccountsHash:n}})(n,e,s??[]),c=new Uint8Array(64);c.set(o.policyDataHash,0),c.set(o.policyAccountsHash,32);const d=we(c),u=new Uint8Array(64);u.set(l.cpiDataHash,0),u.set(l.cpiAccountsHash,32);const A=we(u),p=i.Buffer.alloc(8);p.writeBigUInt64LE(BigInt(t.toString()),0);const g=i.Buffer.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=i.Buffer.concat([p,g,i.Buffer.from(d),i.Buffer.from(A)]),h=we(m);return Ie("SimpleMessage",{dataHash:Array.from(h)})}function ve(e,t,a,r,n,s){const o=Se(r,e),l=ke(n,e,s),c=new Uint8Array(64);c.set(o.policyDataHash,0),c.set(o.policyAccountsHash,32);const d=we(c),u=new Uint8Array(64);u.set(l.cpiDataHash,0),u.set(l.cpiAccountsHash,32);const A=we(u),p=i.Buffer.alloc(8);p.writeBigUInt64LE(BigInt(t.toString()),0);const g=i.Buffer.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=i.Buffer.concat([p,g,i.Buffer.from(d),i.Buffer.from(A)]),h=we(m);return Ie("SimpleMessage",{dataHash:Array.from(h)})}function Ce(e){z(e.passkeyPublicKey,"passkeySignature.passkeyPublicKey"),Z(e.signature64,"passkeySignature.signature64"),Z(e.clientDataJsonRaw64,"passkeySignature.clientDataJsonRaw64"),Z(e.authenticatorDataRaw64,"passkeySignature.authenticatorDataRaw64");const t=Buffer.from(e.authenticatorDataRaw64,"base64"),a=Buffer.from(e.clientDataJsonRaw64,"base64"),r=Buffer.from(e.signature64,"base64");V(J(r),"passkeySignature.signature64 (decoded)");const n=Buffer.concat([t,Buffer.from(s.sha256.arrayBuffer(a))]);return oe(Buffer.from(s.sha256.arrayBuffer(n)),e.passkeyPublicKey,r)}function We(e){const t=Buffer.from(e.signature64,"base64");return V(J(t),"passkeySignature.signature64 (decoded)"),{passkeyPublicKey:e.passkeyPublicKey,signature:J(t),clientDataJsonRaw:Buffer.from(e.clientDataJsonRaw64,"base64"),authenticatorDataRaw:Buffer.from(e.authenticatorDataRaw64,"base64")}}function De(e){return p.web3.ComputeBudgetProgram.setComputeUnitLimit({units:e})}function Ee(e,t){return void 0===t?e:[De(t),...e]}function Be(e,t){return[e,...t]}function xe(e){return void 0!==e?1:0}async function Te(e,t,a,r={}){const{addressLookupTables:n,recentBlockhash:i,computeUnitLimit:s}=r,o=Ee(a,s),l=n||[],c=i||(await e.getLatestBlockhash()).blockhash;if(l.length>0){console.log("lookupTables in buildTransaction",l);const e=new p.web3.TransactionMessage({payerKey:t,recentBlockhash:c,instructions:o}).compileToV0Message(l);return{transaction:new p.web3.VersionedTransaction(e),isVersioned:!0,recentBlockhash:c}}{const e=(new p.web3.Transaction).add(...o);return e.feePayer=t,e.recentBlockhash=c,{transaction:e,isVersioned:!1,recentBlockhash:c}}}"undefined"!=typeof globalThis&&(globalThis.Buffer=i.Buffer),i.Buffer.prototype.subarray=function(e,t){const a=Uint8Array.prototype.subarray.apply(this,[e,t]);return Object.setPrototypeOf(a,i.Buffer.prototype),a};class Ue{constructor(e){this.connection=e,this.program=new p.Program(C,{connection:e}),this.programId=this.program.programId,this.defaultPolicyProgram=new ee(e),this.walletPdas=new he(this.programId),this.policyResolver=new ye(this.defaultPolicyProgram,this.walletPdas)}getSmartWalletPubkey(e){return this.walletPdas.smartWallet(e)}getWalletStatePubkey(e){return this.walletPdas.walletState(e)}getWalletDevicePubkey(e,t){return this.walletPdas.walletDevice(e,t)}getChunkPubkey(e,t){return this.walletPdas.chunk(e,t)}generateWalletId(){return new p.BN(D(8),"le")}async fetchWalletStateContext(e){const t=this.getWalletStatePubkey(e);return{walletState:t,data:await this.program.account.walletState.fetch(t)}}async fetchChunkContext(e,t){const a=this.getChunkPubkey(e,t);return{chunk:a,data:await this.program.account.chunk.fetch(a)}}validateCreateSmartWalletParams(e){N(e,"params"),K(e.payer,"params.payer"),z(e.passkeyPublicKey,"params.passkeyPublicKey"),Z(e.credentialIdBase64,"params.credentialIdBase64"),void 0!==e.amount&&F(e.amount,"params.amount"),void 0!==e.smartWalletId&&F(e.smartWalletId,"params.smartWalletId"),void 0!==e.policyDataSize&&Y(e.policyDataSize,"params.policyDataSize"),null!==e.policyInstruction&&void 0!==e.policyInstruction&&G(e.policyInstruction,"params.policyInstruction")}validateExecuteParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),L(e.credentialHash,"params.credentialHash"),G(e.cpiInstruction,"params.cpiInstruction"),F(e.timestamp,"params.timestamp"),null!==e.policyInstruction&&G(e.policyInstruction,"params.policyInstruction")}validateCreateChunkParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),L(e.credentialHash,"params.credentialHash"),q(e.cpiInstructions,"params.cpiInstructions"),F(e.timestamp,"params.timestamp"),null!==e.policyInstruction&&G(e.policyInstruction,"params.policyInstruction"),void 0!==e.cpiSigners&&X(e.cpiSigners,"params.cpiSigners")}validateExecuteChunkParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),q(e.cpiInstructions,"params.cpiInstructions"),void 0!==e.cpiSigners&&X(e.cpiSigners,"params.cpiSigners")}validateCloseChunkParams(e){N(e,"params"),K(e.payer,"params.payer"),K(e.smartWallet,"params.smartWallet"),F(e.nonce,"params.nonce")}async getWalletStateData(e){const{data:t}=await this.fetchWalletStateContext(e);return t}async getChunkData(e){return await this.program.account.chunk.fetch(e)}async getSmartWalletByPasskey(e){z(e,"passkeyPublicKey");const t=C.accounts?.find(e=>"WalletState"===e.name)?.discriminator;if(!t)throw new Q("WalletState discriminator not found in IDL","passkeyPublicKey");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:o.encode(t)}}]});for(const t of a)try{const a=this.program.coder.accounts.decode("WalletState",t.account.data);for(const r of a.devices)if(E(r.passkeyPubkey,e)){return{smartWallet:this.getSmartWalletPubkey(a.walletId),walletState:t.pubkey,deviceSlot:{passkeyPubkey:r.passkeyPubkey,credentialHash:r.credentialHash}}}}catch(e){continue}return{smartWallet:null,walletState:null,deviceSlot:null}}async getSmartWalletByCredentialHash(e){L(e,"credentialHash");const t=C.accounts?.find(e=>"WalletDevice"===e.name)?.discriminator;if(!t)throw new Q("WalletDevice discriminator not found in IDL","credentialHash");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:o.encode(t)}},{memcmp:{offset:41,bytes:o.encode(e)}}]});if(0===a.length)return null;for(const e of a){const t=await this.program.account.walletDevice.fetch(e.pubkey);return{smartWallet:t.smartWallet,walletState:this.getWalletStatePubkey(t.smartWallet),walletDevice:e.pubkey,passkeyPubkey:t.passkeyPubkey}}return null}async buildCreateSmartWalletIns(e,t,a,r){return K(e,"payer"),K(t,"smartWallet"),G(a,"policyInstruction"),N(r,"args"),z(r.passkeyPublicKey,"args.passkeyPublicKey"),L(r.credentialHash,"args.credentialHash"),F(r.walletId,"args.walletId"),F(r.amount,"args.amount"),await this.program.methods.createSmartWallet(r).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),walletDevice:this.getWalletDevicePubkey(t,r.credentialHash),policyProgram:a.programId,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(a)]).instruction()}async buildExecuteIns(e,t,a,r,n,i,s){return K(e,"payer"),K(t,"smartWallet"),K(a,"walletDevice"),N(r,"args"),G(n,"policyInstruction"),G(i,"cpiInstruction"),void 0!==s&&X(s,"cpiSigners"),await this.program.methods.execute(r).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),walletDevice:a,policyProgram:n.programId,cpiProgram:i.programId,ixSysvar:p.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(n),...W(i,s)]).instruction()}async buildCreateChunkIns(e,t,a,r,n){K(e,"payer"),K(t,"smartWallet"),K(a,"walletDevice"),N(r,"args"),G(n,"policyInstruction");const{walletState:i,data:s}=await this.fetchWalletStateContext(t),o=this.getChunkPubkey(t,s.lastNonce);return await this.program.methods.createChunk(r).accountsPartial({payer:e,smartWallet:t,walletState:i,walletDevice:a,policyProgram:n.programId,chunk:o,ixSysvar:p.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts([...W(n)]).instruction()}async buildExecuteChunkIns(e,t,a,r){K(e,"payer"),K(t,"smartWallet"),q(a,"cpiInstructions"),void 0!==r&&X(r,"cpiSigners");const{data:n}=await this.fetchWalletStateContext(t),s=n.lastNonce.sub(new p.BN(1)),{chunk:o,data:l}=await this.fetchChunkContext(t,s),c=a.map(e=>i.Buffer.from(e.data)),d=function(e){const t=[];let a=0;for(let r=0;r<e.length-1;r++)a+=e[r].keys.length+1,t.push(a);return t}(a),u=function(e,t){return e.flatMap(e=>[{pubkey:e.programId,isSigner:!1,isWritable:!1},...W(e,t)])}(a,r);return await this.program.methods.executeChunk(c,i.Buffer.from(d)).accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),chunk:o,sessionRefund:l.rentRefundAddress,systemProgram:p.web3.SystemProgram.programId}).remainingAccounts(u).instruction()}async buildCloseChunkIns(e,t,a){K(e,"payer"),K(t,"smartWallet"),F(a,"nonce");const{chunk:r,data:n}=await this.fetchChunkContext(t,a);return await this.program.methods.closeChunk().accountsPartial({payer:e,smartWallet:t,walletState:this.getWalletStatePubkey(t),chunk:r,sessionRefund:n.rentRefundAddress}).instruction()}async createSmartWalletTxn(e,t={}){this.validateCreateSmartWalletParams(e);const a=e.smartWalletId??this.generateWalletId(),r=this.getSmartWalletPubkey(a),n=this.getWalletStatePubkey(r),i=e.amount??new p.BN(H),s=e.policyDataSize??this.defaultPolicyProgram.getPolicyDataSize(),o=B(e.credentialIdBase64),l=await this.policyResolver.resolveForCreate({provided:e.policyInstruction,smartWalletId:a,smartWallet:r,walletState:n,passkeyPublicKey:e.passkeyPublicKey,credentialHash:o}),c={passkeyPublicKey:e.passkeyPublicKey,credentialHash:o,initPolicyData:l.data,walletId:a,amount:i,policyDataSize:s},d=await this.buildCreateSmartWalletIns(e.payer,r,l,c);return{transaction:(await Te(this.connection,e.payer,[d],t)).transaction,smartWalletId:a,smartWallet:r}}async executeTxn(e,t={}){this.validateExecuteParams(e);const a=Ce(e.passkeySignature),r=await this.getWalletStateData(e.smartWallet),n=this.getWalletDevicePubkey(e.smartWallet,e.credentialHash),i=await this.policyResolver.resolveForExecute({provided:e.policyInstruction,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:e.passkeySignature.passkeyPublicKey,walletStateData:r}),s=We(e.passkeySignature),o=Be(a,[await this.buildExecuteIns(e.payer,e.smartWallet,n,{...s,verifyInstructionIndex:xe(t.computeUnitLimit),splitIndex:i.keys.length,policyData:i.data,cpiData:e.cpiInstruction.data,timestamp:e.timestamp},i,e.cpiInstruction,[...e.cpiSigners??[],e.payer])]);return(await Te(this.connection,e.payer,o,t)).transaction}async createChunkTxn(e,t={}){this.validateCreateChunkParams(e);const a=Ce(e.passkeySignature),r=await this.getWalletStateData(e.smartWallet),n=this.getWalletDevicePubkey(e.smartWallet,e.credentialHash),i=await this.policyResolver.resolveForExecute({provided:e.policyInstruction,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:e.passkeySignature.passkeyPublicKey,walletStateData:r}),o=We(e.passkeySignature),l=function(e,t,a){const r=ke(e,t,a),n=new Uint8Array(64);return n.set(r.cpiDataHash,0),n.set(r.cpiAccountsHash,32),Array.from(new Uint8Array(s.sha256.arrayBuffer(n)))}(e.cpiInstructions,e.smartWallet,[...e.cpiSigners??[],e.payer]),c=Be(a,[await this.buildCreateChunkIns(e.payer,e.smartWallet,n,{...o,policyData:i.data,verifyInstructionIndex:xe(t.computeUnitLimit),timestamp:e.timestamp,cpiHash:Array.from(l)},i)]);return(await Te(this.connection,e.payer,c,t)).transaction}async executeChunkTxn(e,t={}){this.validateExecuteChunkParams(e);const a=await this.buildExecuteChunkIns(e.payer,e.smartWallet,e.cpiInstructions,e.cpiSigners);return(await Te(this.connection,e.payer,[a],t)).transaction}async closeChunkTxn(e,t={}){this.validateCloseChunkParams(e);const a=await this.buildCloseChunkIns(e.payer,e.smartWallet,e.nonce);return(await Te(this.connection,e.payer,[a],t)).transaction}async buildAuthorizationMessage(e){let t;const{action:a,smartWallet:r,passkeyPublicKey:n,credentialHash:i,timestamp:s}=e;switch(a.type){case exports.SmartWalletAction.Execute:{const{policyInstruction:i,cpiInstruction:o,cpiSigners:l}=a.args,c=await this.getWalletStateData(e.smartWallet),d=await this.policyResolver.resolveForExecute({provided:i,smartWallet:e.smartWallet,credentialHash:e.credentialHash,passkeyPublicKey:n,walletStateData:c});t=Pe(r,(await this.getWalletStateData(r)).lastNonce,s,d,o,[...l??[],e.payer]);break}case exports.SmartWalletAction.CreateChunk:{const{policyInstruction:o,cpiInstructions:l,cpiSigners:c}=a.args,d=await this.getWalletStateData(r);if(o)t=ve(r,d.lastNonce,s,o,l,[...c??[],e.payer]);else{const a=this.getWalletDevicePubkey(r,i),o=await this.defaultPolicyProgram.buildCheckPolicyIx({walletId:d.walletId,passkeyPublicKey:n,policySigner:a,smartWallet:r,credentialHash:i,policyData:d.policyData});t=ve(r,d.lastNonce,s,o,l,[...c??[],e.payer])}break}default:throw new Q(`Unsupported SmartWalletAction: ${a.type}`,"action.type")}return t}}"function"!=typeof globalThis.structuredClone&&(globalThis.structuredClone=e=>JSON.parse(JSON.stringify(e)));class Re extends l.EventEmitter{constructor(){super(),this.iframeRef=null,this.retryDelays=[200,400,800,1500,3e3]}setIframeRef(e){this.iframeRef=e}notifyCredentialsUpdated(e){this.emit("credentials-updated",e);const t=new CustomEvent("lazorkit:credentials-updated",{detail:e,bubbles:!0,cancelable:!0});window.dispatchEvent(t)}syncCredentials(e=!1){this.iframeRef&&this.iframeRef.contentWindow?this.performCredentialSync(e):setTimeout(()=>this.syncCredentials(e),500)}performCredentialSync(e){if(!this.iframeRef?.contentWindow)throw new Error("Cannot sync credentials: iframe reference not available");const t=localStorage.getItem("CREDENTIAL_ID")||"",a=localStorage.getItem("PUBLIC_KEY")||"",r=localStorage.getItem("SMART_WALLET_ADDRESS")||"";if(!(e||t&&a))return;const n={type:"SYNC_CREDENTIALS",data:{credentialId:t,publickey:a,smartWalletAddress:r,timestamp:Date.now()}};try{this.iframeRef.contentWindow.postMessage(n,"*"),this.retryDelays.forEach(e=>{setTimeout(()=>{try{this.iframeRef?.contentWindow&&this.iframeRef.contentWindow.postMessage(n,"*")}catch(e){}},e)})}catch(e){}}storeCredential(e){e.credentialId&&localStorage.setItem("CREDENTIAL_ID",e.credentialId),e.publickey&&localStorage.setItem("PUBLIC_KEY",e.publickey),e.smartWalletAddress&&localStorage.setItem("SMART_WALLET_ADDRESS",e.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",(new Date).toISOString())}destroy(){this.removeAllListeners(),this.iframeRef=null}}class Me extends l.EventEmitter{constructor(e){super(),this.dialogRef=null,this.iframeRef=null,this.popupWindow=null,this.popupCloseInterval=null,this.isClosing=!1,this.isDestroyed=!1,this.logger=new I("DialogManager"),this._currentAction=null,this.config=e,this.credentialManager=new Re,this.logger.debug("Created dialog manager"),this.setupMessageListener()}async openConnect(){return new Promise((e,t)=>{const a=()=>{this.off("connect-result",r),this.off("error",n)},r=t=>{a(),e(t)},n=e=>{a(),t(e)};this.on("connect-result",r),this.on("error",n);const i=setTimeout(()=>{a(),t(new Error("Connection timed out after 60 seconds"))},6e4),s=e,o=t;e=e=>{clearTimeout(i),s(e)},t=e=>{clearTimeout(i),o(e)},this._currentAction=f.CONNECT;if(this.shouldUsePopup("connect")){const e=`${this.config.portalUrl}?action=${f.CONNECT}`;this.openPopup(e).catch(t)}else this.openConnectDialog().catch(t)})}async openSign(e,t,a,r){return new Promise((n,i)=>{const s=()=>{this.off("sign-result",o),this.off("error",l)},o=e=>{s(),n(e)},l=e=>{s(),i(e)};this.on("sign-result",o),this.on("error",l);const c=setTimeout(()=>{s(),i(new Error("Signing timed out after 60 seconds"))},6e4),d=n,u=i;n=e=>{clearTimeout(c),d(e)},i=e=>{clearTimeout(c),u(e)},this._currentAction=f.SIGN;const A=this.shouldUsePopup("sign"),p=encodeURIComponent(e);let g=`${this.config.portalUrl}?action=${f.SIGN}&message=${p}&transaction=${encodeURIComponent(t)}&credentialId=${encodeURIComponent(a)}`;r&&(g+=`&clusterSimulation=${r}`),A?this.openPopup(g).catch(i):this.openSignDialog(g).catch(i)})}async openSignMessage(e,t){return new Promise((a,r)=>{const n=()=>{this.off("sign-result",i),this.off("error",s)},i=e=>{n(),a(e)},s=e=>{n(),r(e)};this.on("sign-result",i),this.on("error",s);const o=setTimeout(()=>{n(),r(new Error("Signing timed out after 60 seconds"))},6e4),l=a,c=r;a=e=>{clearTimeout(o),l(e)},r=e=>{clearTimeout(o),c(e)},this._currentAction=f.SIGN;const d=encodeURIComponent(e),u=`${this.config.portalUrl}?action=${f.SIGN}&message=${d}&credentialId=${encodeURIComponent(t)}`;this.shouldUsePopup("sign")?this.openPopup(u).catch(r):this.openSignDialog(u).catch(r)})}async openConnectDialog(){const e=`${this.config.portalUrl}?action=${f.CONNECT}`;await this.openModal(e)}ensureFonts(){const e="lazorkit-font-roboto-flex";if(document.getElementById(e))return;const t=document.createElement("link");t.id=e,t.rel="stylesheet",t.href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap",document.head.appendChild(t)}ensureDialogBackdropCSS(){const e="lazorkit-dialog-backdrop-style";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent='\n    /* ===== Backdrop (overlay nhẹ) ===== */\n    dialog#lazorkit-dialog::backdrop {\n      background: rgba(0,0,0,0);\n      animation: lazor-backdrop-in 160ms ease-out forwards;\n    }\n\n    dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n      animation: lazor-backdrop-out 140ms ease-in forwards;\n    }\n\n    @keyframes lazor-backdrop-in {\n      from { background: rgba(0,0,0,0); }\n      to   { background: rgba(0,0,0,0.12); } /* ✅ overlay nhẹ */\n    }\n\n    @keyframes lazor-backdrop-out {\n      from { background: rgba(0,0,0,0.12); }\n      to   { background: rgba(0,0,0,0); }\n    }\n\n    /* ===== Panel animations ===== */\n    @keyframes lazor-drawer-in {\n      from { transform: translateY(16px); opacity: 0.98; }\n      to   { transform: translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-drawer-out {\n      from { transform: translateY(0); opacity: 1; }\n      to   { transform: translateY(16px); opacity: 0.98; }\n    }\n\n    @keyframes lazor-float-in {\n      from { transform: scale(0.985) translateY(4px); opacity: 0; }\n      to   { transform: scale(1) translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-float-out {\n      from { transform: scale(1) translateY(0); opacity: 1; }\n      to   { transform: scale(0.985) translateY(4px); opacity: 0; }\n    }\n\n    #lazorkit-panel {\n      will-change: transform, opacity;\n      transform-origin: center;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-drawer-in 180ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-drawer-out 150ms ease-in forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-float-in 170ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-float-out 140ms ease-in forwards;\n    }\n\n    /* ===== Reduced motion ===== */\n    @media (prefers-reduced-motion: reduce) {\n      dialog#lazorkit-dialog::backdrop {\n        animation: none !important;\n        background: rgba(0,0,0,0.12) !important;\n      }\n      dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n        background: rgba(0,0,0,0) !important;\n      }\n      dialog#lazorkit-dialog #lazorkit-panel {\n        animation: none !important;\n      }\n    }\n  ',document.head.appendChild(t)}createCloseButton(e){const t=document.createElement("button");return t.type="button",t.title="Close Dialog",t.setAttribute("aria-label","Close Dialog"),Object.assign(t.style,{width:"36px",height:"36px",borderRadius:"10px",border:"none",background:"transparent",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"0",color:"rgba(255, 255, 255, 0.6)",outline:"none",webkitTapHighlightColor:"transparent"}),t.addEventListener("mouseenter",()=>{t.style.background="rgba(255,255,255,0.1)",t.style.color="#ffffff"}),t.addEventListener("mouseleave",()=>{t.style.background="transparent",t.style.color="rgba(255, 255, 255, 0.6)"}),t.onclick=e,t.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg"\n      width="20" height="20" viewBox="0 0 24 24"\n      fill="none" stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18" />\n      <line x1="6" y1="6" x2="18" y2="18" />\n    </svg>\n  ',t}async openSignDialog(e){await this.openModal(e),this.iframeRef&&(this.credentialManager.setIframeRef(this.iframeRef),setTimeout(()=>{this.credentialManager.syncCredentials(!0)},500))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}shouldUsePopup(e){const t=this.isMobileDevice();return!(!this.isSafari()||"connect"!==e)||(!(!t||"connect"!==e)||!(!t&&"sign"===e)&&(!t||"sign"!==e))}getPopupDimensions(){if(!window.top)return{width:450,height:600,top:0,left:0};const e=window.top.outerWidth/2+window.top.screenX-225;return{width:450,height:600,top:window.top.outerHeight/2+window.top.screenY-300,left:e}}async openPopup(e){if(this.popupWindow&&!this.popupWindow.closed)try{this.popupWindow.close()}catch(e){}const t=this.getPopupDimensions();if(this.popupWindow=window.open(e,"lazorkit-popup",`width=${t.width},height=${t.height},top=${t.top},left=${t.left},resizable,scrollbars,status`),this.startPopupMonitor(),!this.popupWindow)throw this.logger.error("Popup was blocked by browser"),new Error("Popup was blocked by browser")}startPopupMonitor(){this.popupCloseInterval&&clearInterval(this.popupCloseInterval),this.popupCloseInterval=setInterval(()=>{this.popupWindow?.closed&&(this.popupWindow=null,this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null))},500)}async openModal(e){this.dialogRef||this.createModal(),this.iframeRef&&(this.iframeRef.src=e),this.dialogRef&&!this.dialogRef.open&&(this.dialogRef.setAttribute("data-state","opening"),this.dialogRef.showModal(),window.setTimeout(()=>{this.dialogRef?.open&&this.dialogRef.setAttribute("data-state","idle")},220))}createModal(){this.ensureFonts(),this.ensureDialogBackdropCSS();const e=document.createElement("dialog");e.id="lazorkit-dialog",e.style.colorScheme="dark",e.setAttribute("data-theme","dark");const t=this.isMobileDevice(),a=(e=>({overlay:{position:"fixed",inset:0,padding:0,border:"none",background:"transparent",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",overflow:"visible",zIndex:2147483647,display:"grid",placeItems:e?"end center":"center"},panel:{width:e?"100%":"360px",maxWidth:e?"100%":"90vw",height:e?"55vh":"650px",maxHeight:e?"55vh":"90vh",background:"white",borderRadius:e?"20px 20px 0 0":"20px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden",position:"relative"},closeButton:{zIndex:10},iframeContainer:{position:"relative",width:"100%",height:"100%",border:"none",margin:0,padding:0,overflow:"hidden",borderRadius:"inherit",background:"white"},iframe:{width:"100%",height:"100%",border:0,borderRadius:"inherit",display:"block"}}))(t);Object.assign(e.style,a.overlay),Object.assign(e.style,{"--background-color-th_base":"#191919","--background-color-th_frame":"#191919","--text-color-th_base":"#eeeeee","--border-color-th_frame":"rgba(255,255,255,0.10)"});const r=document.createElement("div"),n=t?"drawer":"floating";e.setAttribute("data-variant",n),e.setAttribute("data-state","idle"),r.id="lazorkit-panel",Object.assign(r.style,a.panel),Object.assign(r.style,{display:"flex",flexDirection:"column"}),Object.assign(r.style,{background:"var(--background-color-th_base, #fcfcfc)",color:"var(--text-color-th_base, #202020)",fontFamily:'"Roboto Flex", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'});const i=document.createElement("div");Object.assign(i.style,{height:"32px",flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 12px",boxSizing:"border-box",borderBottom:"1px solid rgba(0,0,0,0.08)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, var(--background-color-th_base, #fcfcfc))",color:"var(--text-color-th_base, #202020)",borderBottom:"1px solid var(--border-color-th_frame, rgba(0,0,0,0.08))"});const s=document.createElement("div");Object.assign(s.style,a.iframeContainer),Object.assign(s.style,{flex:"1 1 auto"}),Object.assign(s.style,{background:"var(--background-color-th_base, #fcfcfc)"}),Object.assign(r.style,{background:"var(--background-color-th_base, #191919)",color:"var(--text-color-th_base, #eeeeee)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, #191919)",color:"var(--text-color-th_base, #eeeeee)",borderBottom:"1px solid var(--border-color-th_frame, rgba(255,255,255,0.10))"}),Object.assign(s.style,{background:"var(--background-color-th_base, #191919)"});const o=this.createCloseButton(()=>{this.closeDialog(),this.emit("close")});Object.assign(o.style,{position:"static",top:"",right:""}),o.id="lazorkit-dialog-close",o.ariaLabel="Close",Object.assign(o.style,a.closeButton);const l=document.createElement("iframe");l.id="lazorkit-iframe",Object.assign(l.style,a.iframe),l.allow=`publickey-credentials-get ${this.config.portalUrl}; publickey-credentials-create ${this.config.portalUrl}; clipboard-write; camera; microphone`;const c=l.sandbox;c.add("allow-forms"),c.add("allow-scripts"),c.add("allow-same-origin"),c.add("allow-popups"),c.add("allow-popups-to-escape-sandbox"),c.add("allow-modals"),l.setAttribute("aria-label","Lazor Wallet"),l.tabIndex=0,l.title="Lazor",e.addEventListener("cancel",()=>this.closeDialog()),e.addEventListener("click",t=>{t.target===e&&this.closeDialog()}),i.appendChild(o),r.appendChild(i),s.appendChild(l),r.appendChild(s),e.appendChild(r),document.body.appendChild(e),this.dialogRef=e,this.iframeRef=l}setupMessageListener(){window.addEventListener("message",e=>{if(!e.origin.includes(new URL(this.config.portalUrl).hostname))return;const{type:t,data:a,error:r}=e.data;if(r)this.emit("error",new Error(r.message||"Portal error"));else switch(t){case"connect-result":case"WALLET_CONNECTED":const e={publicKey:a.publickey||a.publicKey||"",credentialId:a.credentialId,isCreated:"create"===a.connectionType||!!a.publickey,connectionType:a.connectionType||(a.publickey?"create":"get"),timestamp:a.timestamp||Date.now(),accountName:a.accountName};this.emit("connect-result",e),this.closeDialog();break;case"sign-result":case"SIGNATURE_CREATED":const t={signature:a.normalized,clientDataJsonBase64:a.clientDataJSONReturn,authenticatorDataBase64:a.authenticatorDataReturn,signedPayload:a.msg};this.emit("sign-result",t),this.closeDialog();break;case"error":this.emit("error",new Error(a?.message||"Unknown portal error"));break;case"close":this.closeDialog()}})}closeDialog(){if(this.isClosing)return;this.isClosing=!0;const e=this.dialogRef,t=this.iframeRef;try{e&&e.setAttribute("data-state","closing"),window.setTimeout(()=>{try{if(t&&(t.parentNode&&t.parentNode.removeChild(t),this.iframeRef=null),e){try{e.open&&e.close()}catch{}e.parentNode&&e.parentNode.removeChild(e),this.dialogRef=null}if(this.popupWindow){try{this.popupWindow.close()}catch{}this.popupWindow=null}this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null),this.logger.debug("Closed dialog (animated)")}catch(e){this.logger.error("Error during animated close:",e)}finally{this.isClosing=!1}},170)}catch(e){this.logger.error("Error closing dialog:",e),this.isClosing=!1}}getIframeRef(){return this.iframeRef}getDialogRef(){return this.dialogRef}getPopupWindow(){return this.popupWindow}getCurrentAction(){return this._currentAction}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.closeDialog(),this.credentialManager.destroy(),this.removeAllListeners(),this.logger.debug("Destroyed dialog manager"))}}const He=e=>new Me({portalUrl:e.portalUrl,rpcUrl:e.rpcUrl,paymasterUrl:e.paymasterConfig.paymasterUrl}),Qe=e=>Array.from(new Uint8Array(s.sha256.arrayBuffer(Buffer.from(e,"base64")))),Ne=(e,t,a)=>{const r=e instanceof Error?e:new Error(String(e));throw t({error:r}),a?.(r),r},Ke=e=>e?Array.from(Buffer.from(e,"base64")):[],Oe=async(e,t,a)=>{const{isConnecting:r,config:n}=e();if(r)throw new Error("Already connecting");t({isConnecting:!0,error:null});try{const r=await k.getWallet();if((()=>{if("undefined"==typeof window)return;const e=localStorage.getItem("lazorkit-wallet");if(e)try{const t=JSON.parse(e);t.state&&void 0!==t.version&&localStorage.removeItem("lazorkit-wallet")}catch(e){}})(),r)return t({wallet:r}),a?.onSuccess?.(r),r;const i=He(n);try{const r=await i.openConnect(),s=new P(n.paymasterConfig),o=new Ue(e().connection),l=Qe(r.credentialId),c=await o.getSmartWalletByCredentialHash(l);let d,u;if(!r.publicKey&&c?(u=Buffer.from(c.passkeyPubkey).toString("base64"),localStorage.setItem("PUBLIC_KEY",u)):u=r.publicKey,c)d=c.smartWallet.toBase58();else{const e=await s.getPayer(),t=await o.createSmartWalletTxn({passkeyPublicKey:Ke(u),payer:e,credentialIdBase64:r.credentialId});await s.signAndSend(t.transaction),d=t.smartWallet.toBase58()}const A={credentialId:r.credentialId,passkeyPubkey:Ke(u),expo:"web",platform:navigator.platform,smartWallet:d,walletDevice:"",accountName:r.accountName};return await k.saveWallet(A),t({wallet:A}),a?.onSuccess?.(A),A}finally{i.destroy()}}catch(e){return Ne(e,t,a?.onFail)}finally{t({isConnecting:!1})}},ze=r.create()(h((e,t)=>({wallet:null,config:{portalUrl:y.PORTAL_URL,paymasterConfig:{paymasterUrl:y.PAYMASTER_URL},rpcUrl:y.RPC_ENDPOINT},connection:new a.Connection(y.RPC_ENDPOINT,w),isLoading:!1,isConnecting:!1,isSigning:!1,error:null,setConfig:t=>{try{const r=new a.Connection(t.rpcUrl||y.RPC_ENDPOINT,w);e({config:t,connection:r})}catch(e){throw console.error("Failed to update wallet configuration:",e,{config:t}),new Error(`Failed to update configuration: ${e}`)}},setWallet:t=>{try{e({wallet:t})}catch(e){throw console.error("Failed to set wallet:",e,{wallet:t}),e}},setLoading:t=>e({isLoading:t}),setConnecting:t=>e({isConnecting:t}),setSigning:t=>e({isSigning:t}),setConnection:t=>{try{e({connection:t})}catch(e){throw console.error("Failed to set connection:",e,{endpoint:t?.rpcEndpoint}),e}},setError:t=>{e({error:t}),t&&console.error("Error state set:",t)},clearError:()=>{e({error:null})},connect:a=>Oe(t,e,a),disconnect:()=>(async(e,t)=>{try{await k.clearWallet(),e({wallet:null,error:null,isConnecting:!1,isSigning:!1,isLoading:!1}),t?.onSuccess?.()}catch(a){return Ne(a,e,t?.onFail)}})(e),signAndSendTransaction:a=>(async(e,t,a)=>{const{isSigning:r,connection:n,wallet:i,config:s}=e();if(r)throw new Error("Already signing");if(!i)throw new Error("No wallet connected");if(!n)throw new Error("No connection available");t({isSigning:!0,error:null});try{const e=new P(s.paymasterConfig),t=new Ue(n),r=await e.getPayer(),o=await x(n),l=await t.buildAuthorizationMessage({action:{type:exports.SmartWalletAction.CreateChunk,args:{policyInstruction:null,cpiInstructions:a.instructions}},payer:r,smartWallet:new p.web3.PublicKey(i.smartWallet),passkeyPublicKey:i.passkeyPubkey,timestamp:new p.BN(o),credentialHash:Qe(i.credentialId)}),c=Buffer.from(l).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),d=await n.getLatestBlockhash(),u=new p.web3.TransactionMessage({payerKey:r,recentBlockhash:d.blockhash,instructions:a.instructions}).compileToV0Message(),A=new p.web3.VersionedTransaction(u),g=Buffer.from(A.serialize()).toString("base64"),m=He(s),h=i.credentialId,y=a.transactionOptions?.clusterSimulation;try{const s=await m.openSign(c,g,h,y),l={msg:c,normalized:s.signature,clientDataJSONReturn:s.clientDataJsonBase64,authenticatorDataReturn:s.authenticatorDataBase64},d=Qe(i.credentialId),u=await t.createChunkTxn({payer:r,smartWallet:new p.web3.PublicKey(i.smartWallet),passkeySignature:{passkeyPublicKey:i.passkeyPubkey,signature64:l.normalized,clientDataJsonRaw64:l.clientDataJSONReturn,authenticatorDataRaw64:l.authenticatorDataReturn},policyInstruction:null,cpiInstructions:a.instructions,timestamp:o,credentialHash:d}),A=await e.signAndSend(u);await n.confirmTransaction(A);const f=a.transactionOptions?.addressLookupTableAccounts||[],w=await t.executeChunkTxn({payer:r,smartWallet:new p.web3.PublicKey(i.smartWallet),cpiInstructions:a.instructions},{addressLookupTables:f,computeUnitLimit:a.transactionOptions?.computeUnitLimit});let b;return b=f.length>0?await e.signAndSendVersionedTransaction(w):await e.signAndSend(w),a.onSuccess?.(b),b}finally{m.destroy()}}catch(e){return Ne(e,t,a.onFail)}finally{t({isSigning:!1})}})(t,e,a),signMessage:a=>(async(e,t,a)=>{const{isSigning:r,wallet:n,config:i}=e();if(r)throw new Error("Already signing");if(!n)throw new Error("No wallet connected");t({isSigning:!0,error:null});try{const e=He(i);try{const t=await e.openSignMessage(a,n.credentialId);return{signature:t.signature,signedPayload:t.signedPayload}}finally{e.destroy()}}catch(e){throw t({error:e}),e}finally{t({isSigning:!1})}})(t,e,a)}),{name:"lazorkit-wallet-store",storage:g(()=>S),partialize:e=>({wallet:e.wallet,config:e.config})}));function Le(e){return Uint8Array.from(atob(e),e=>e.charCodeAt(0))}async function Ve(e){let t=e;if(64===t.length){const e=new Uint8Array(65);e[0]=4,e.set(t,1),t=e}return crypto.subtle.importKey("raw",t,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])}async function Fe({signedPayload:e,signature:t,publicKey:a}){const r=Le(e),n=Le(t),i=Le(a),s=await Ve(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},s,n,r)}const _e="CREDENTIAL_ID",je="PUBLIC_KEY",Ge="SMART_WALLET_ADDRESS";const Je="Lazorkit Wallet",Ze={rpcUrl:"https://api.devnet.solana.com",portalUrl:"https://portal.lazor.sh",paymasterConfig:{paymasterUrl:"https://kora.devnet.lazorkit.com"}};class Ye extends c.BaseWalletAdapter{constructor(e){super(),this.name=Je,this.url="https://lazorkit.com",this.icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGcAAABXCAAAAAA8UASIAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB+kMEAUXDRWPYLQAAAB3dEVYdFJhdyBwcm9maWxlIHR5cGUgOGJpbQAKOGJpbQogICAgICA0MAozODQyNDk0ZDA0MDQwMDAwMDAwMDAwMDAzODQyNDk0ZDA0MjUwMDAwMDAwMDAwMTBkNDFkOGNkOThmMDBiMjA0ZTk4MDA5OTgKZWNmODQyN2UKplPDjgAAAAFvck5UAc+id5oAAAg8SURBVGje7ZlNkFVHFcf/53T3ve/NmzcDBASBVCVAEhBC+AoYRciHAwSDliRllS5MlS50kY1WWeXGrSuLilVaxU5LF1bhB4pgCAmJkErkc6pgwghJDMQKhO9hhnkz797bfY6L92YYPmbefeM4btKLe2/fvn1+fU6f7j7dl+YTCAQQABAIVH9Ry4x4uutCNKKwLoCUuFZ4WxExJiEp1E4GB4pJ0QegSdFnsvoHmBy7KXRy9JlIP9Axymiy/O1Tzqec/ytneBQEE4hFUF9KbiutrSq1vHLgAA405gAaXZ8okAbEw4IVUFANpaogIiICwRuNKI3Ga7eMSGJKg9barQTUm1y7iIqIiLCxIUUhNOCMui7YYDBIzg+t57ct7fXlnQjwLok1aLDj5KQRYIy3AQCUbl1JSWsZIiJwHFITJU7HyYkgEtuQ2VsRBQ1FF7X+qsUhtrfFVceeRcfkZNLedz20Uz9GckBaD3i4fldO+rTY1j9eu5m4t+3HpXNJex2j9f4ZiqmknrVyfU5x+6UZaXOc4bESIlM5uHnRP9+8YtpDsCCpB2eBrQqp8WSVOVSmrF/wR3x3+U+gqrX23CvRqHGiOu3xj6ycd/1wFxXgvDGqRJBYUzZKviXT4sBg21NLut7qeGDauR3MPFqcCBqdQwpjJE3aVyyPzxy54MoizFAFgUmJKTjfN3XtmmOHl6w9cfibvwrMXBtl9+SYaaNwOAiRcAGnDl+Ys3Fpdj6FgVdDauGtTUA3XcdX+3/bulV2/P3Fsx8UmRR1n2xGH7EswkzieKDStmzF1FPHPzFFyoywUSVzs7Bm9b/3T996ec+llnnPvlwWACDm0KzdglpWJQNvo8EBN/Pxxb3HTg+4yGVa8APm82sv/nXalmTf+1NM/w/3/ovrQX3T/QOHTA0rB2KAkSUti1dPfa/zLJVsH69+8souu7Vl77uFcjawdtH26UGYoPXQsyl9RA2TKoMgzMoUqjJr5aPJka5sacfNHeGF6fuOx+XgY3np132mNryIWJrV5879D4GpmrnFK+7z4U/XXpj31tvWxamlK99O/vCZrC7hbruxNscBK6yKqejs9MZzyw69oZEzwYhMe3Fbi1BmMGb/5N8vkIowo4XOd6zv+tlAm0ZZML546XtvJKUsNg0q5+YQiDVA497v07br5ZJ4scLmxhPh0NSMk4Ifs3YTcXwAE8gOLiz/wk8hR84IMrYbdrV4YuMb1M7NIVWIEpIvH2gNIB+CkIuubzh7zhmBldHtgOb2CwRV0vSx4jvFOONgLFE2OGfpqzF55nRU+2utbm6OgogtpRv3lGTQeudJxFY3Hbnc5oUDy9i18+8bSYyKVtYMniqkThUMaLpgzutTErJhRIg3Sivz242Dso+/tDeGMULCmeXK1j/HeWvnxYgJzOmKgTOxiFgWcVJ56lq3m2gOp1Fgu253SQxSViJF/MzOQt76+fuHfHxt7eVzsWfDXlhN75bOnrhRHNo0x0eatqzb3RJcFuJAYm489Mgr5byYJvQJLX0b3r9gwUGVGMZ/ZX/WMNxtnsMYnLJqz1RI6qIEsD1fsO+UKMomilOLb1Vgbm5694pVw6LEUPfMzkhVJswPWAUSEAVMf/hgqSppIYETurrp/IdlCDWKq/PrwySwlLirG05dipyhpJgSJ3OX7ZoywCY0mghyc6DEBDLZ3M+90h5EnEhULdzccuwS29zeloujjEzj3ufeSWE8qc0Q9yy977WZA2zgTQ5GLo4weXXat2D2/rKohUfkEb72atA4ZTSap/NzCAAxpOOQD5RSBtKof13f8bbgC5kvNFpHc3Ocl5grfP9nXy9FaaRRnFFSXv+XsohNLWUTZreAKJHWnudfUyUV6yXYmxu7P46JhdVMnF9LnIZC7zIcbbNVR4EkSh9YtHta1YMhkns+adw/XuKqbD7g2ZOBN6Drz+/LfIGgSowJ8wPRKCTLwpG2VKOMLfoKP7h4sEzeqAKSF9M4HrU+RIMdfytYyhKTVmZ+Z9rR0qqTFEdgo4FdTodryKHg+lYnp8tVG9nLs74x62j3Svfw0x91fgwbG4S8AUZDThpT6Pid9U77+VsP/qN7Db/e1Tp7+dez905edq3G53S4xvsFe+XZhT+fIb2t61d3nlsf7T9ZiiittM5fMr/n+OmKK4zYFIxrP1f/xSPQH/3m2qB9csUHZ1bNOHg8skbBhMG0tGTV1LPd3ewKHJQRLIdgx7XPAhGZvs2zts14Yv0HpxYuePtwKLAlVYaylYqfuXRh6+kTF1C0SggUYg08Tk5mXtq+5JlznYseOnHAlwwyQwKCGmUrWcDcxQtD18keUzAg9VRMx8mpbPriR+6tB1acfLPamsU8EDEpiNSIGgaQiLv/8Qcvdp2uxJbEVe04OekvP9xZXv3RvqszMrjEOE8EECmYFMwAKBsoPvrYjPOdn0SF1I23f2zrlZ+u+v2ltmKlAG/rExoBYiiAoawgh2pl+srZp17ubwnj9TdN2uf6kqXA3rI3arQmw6qCSQVMEDU29FPpDJNgnPtgU/RdhjSw1WBIDBRMACnIqLBVgWEAYoWKGDUuGZNDgAqkdcR55a3dfv0cdiirBKjSaAtSjulJFapauwOKW1nUs/XnsVKe+HhICCnp0AWoHx0qQEoNz2FzTrf1BitGHJUPt0EbUnLpQ7c90u2vbh3O/Lf6DJ3y3iE8h+zmOKq4U+gdtpsYzrBEvftVfh7n+G4M+9NYfTOy7H/5P2ukH+bjaNMFdybO4TfDf8vuIbaZuDfnt3q3L+f3Oabmvm8qjRA71D/UqEZt5rn9YKrxBDpc/B9wB8PpHagItQAAECRlWElmTU0AKgAAAAgABgESAAMAAAABAAEAAAEaAAUAAAABAAAAVgEbAAUAAAABAAAAXgEoAAMAAAABAAIAAAITAAMAAAABAAEAAIdpAAQAAAABAAAAZgAAAMAAAABIAAAAAQAAAEgAAAABAAeQAAAHAAAABDAyMjGRAQAHAAAABAECAwCgAAAHAAAABDAxMDCgAQADAAAAAQABAACgAgAEAAAAAQAAAvygAwAEAAAAAQAAAoikBgADAAAAAQAAAAAAAAAAAAYBAwADAAAAAQAGAAABGgAFAAAAAQAAAQ4BGwAFAAAAAQAAARYBKAADAAAAAQACAAACAQAEAAAAAQAAAR4CAgAEAAAAAQAADwQAAAAAAAAASAAAAAEAAABIAAAAAf/Y/9sAhAABAQEBAQECAQECAwICAgMEAwMDAwQFBAQEBAQFBgUFBQUFBQYGBgYGBgYGBwcHBwcHCAgICAgJCQkJCQkJCQkJAQEBAQICAgQCAgQJBgUGCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQn/3QAEAAr/wAARCACIAKADASIAAhEBAxEB/8QBogAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoLEAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+foBAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKCxEAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+SCIcVpx8DHpWZD0rTjoAsp6VpwHisuOtO36UAaydK0IutZ6dK0IutAGlEBxV+ICqMXar8NAGjDjgCtGHPes6LtWhDQBpRVp2wBYVlw1q2vUUAaqDmtJPu4rNTrWknSgCxGf0rSh/hrMjrTg6LQBrJ0rTjA4FZidK1I+1AGhD0q3HkNxVSHpVuP71AH//0P5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXar8NUIu1X4aANGLPGa0Iaz4u1aMNAGhDWra9RWXFWpbdRQBqp1rSTpWanWtJOlAE8dacHRazI604Oi0AaydK1I+1ZadK1I+1AGhD0q3H96qkPSrUf3qAP/9H+SCHpWnHWZD0rTjoAsR1p2/SsyOtO36UAaydK+vf2Xv2ePhx+0DPqeleLfijoPw+1K02GytdcjnUX4IO4QzovkK6kABJHRmz8ua+Qk6VfjAb5WGRQB+gnxB/Y/wDht8IryGx+JnxJbRGuc/Z3uvDWsLDcAfxQTCIxTL7xswriYvg5+zP/ANFotP8AwQat/wDGq84+GP7SXxl+FelP4X8OaubrQJ8CfRNTij1DS5gOz2V0skBx2IUMvVSDzXqf/CVfsmfFS1Y+LdCvvhprjYxd+H92o6M7eslhdS/arcevk3Eq9lRBxQBJF8HP2ascfGa0/wDBDq3/AMarQj+Dv7NfQfGW0/8ABDqv/wAbrG1f9kn4lf2NN4u+FVzp/wARNDt082a78NSm5mt09bqwdY723A7s8HlA8CQ184rG8MjQSja6cFSMEexHagD62j+D37NvX/hctp/4IdV/+N1fi+EH7N6kbfjHaf8Agh1X/wCNV85+BfAnjT4keI4PB/w+0m61rVLniK1sommlb32oDgDuTgAdcCvu34UfsjeGrfWZrXx7ct4u1bTo/Ou9F8OXMK2OngdTrOvy/wCg2ca/x+SZmH3QQ/AAMb4e/stfC/4p67/wjnw7+JY1i8SPzZEtvD2rMIoxwZJX8vbFGO7uVUetdbrf7A/ju98ayeFvghr+meP9MsbKW61LxBZFrTR7KS3R5Z7dr26CQSywxpucQPIFzt6giuy8dftFfCjwB4bk+H2kRWHiaKKQNH4e0BJ9P8IwuowJLudmTUtblXpmd0jP94p8lc/8R/jR8RtF+BME/jTUt3iX4h2nlWtjbolta6L4YRyBDbWkKpDbHUZU6RoP9Gj5z55wAfAqgAkAg47jp+FaUHRazI604Oi0AaydK1I+1ZadK1I+1AGhD0q3Hw1VIelW4/vcUAf/0v5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXar8NUIu1X4aAOn8O69rvhfWLbxD4YvbjTNQtGDwXVpK8E0TDo0ckZVkPupFfZ3gz48+Nfjx4osfBPxZ8FWXxT1O+/0e2lEZsdaLYzkX1j5TylQNxa5EowCWOK+G4s8Zr7O8AOnwP/AGeNU+Ke/wAvxL8QBc+H9EHSS20pAF1S9X0NxkWMZH8BuO+2gD6f8W/Fv4XfCDw3ceAdSlsJ7acDzfBXge4eLTWI6LrniEM93f8AP3ra3laPPWWMrtr4x+IXx++IvxQ0u28I6hNDpXhmxffZ6DpUS2mmwHs3kp/rZMf8tZi8n+1jivAYQoACjAA4ArUtgWYIgyx4AA5J9AKAPoz9nn4caB488Zz6r49ZoPCPhe1bV9elQhWNnCwVbaInjz7uUpbw+jPuI2o2Od+KXxK1z4v+P9S+IniFI4Z9QkGy3hG2G2giURW9tCvaOCJUjQei5POa9k+NYX4J/DzTv2YLJFXWWki1nxfKPvDUDGfsumZH8NhE580dDcyOMfugT8sx/doAnjrTg6LWZHWnB0WgDWTpWpH2rLTpWpH2oA0IelW4/vcVUh6Vaj+9QB//0/5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXar8NUIu1X4aAPXfgv8MNX+MnxM0j4b6PKls2oy/vrqX/VWlrEpkubqX0jt4UeV/ZcDnFd1+0J8T9K+KPxIe58IRNa+F9DtotH8PWr4zDplnlYSwHHmzEtPMR1lkftiu50OOD4H/szXHiidceKPimkljp3Z7Tw/azBbu5Hp9uuI/s0frHDP2K18oxHPtQBoxV9efs16Pp3gnT9V/ae8WQh7LwcyRaLDIBtvfEEyk2cQB4ZLUD7XOOgSNFODIlfM/gnwj4j8f8Ai3TPA3hG1a91XWLmKztIEHzSTTMERR+J+gHPSvof9ofxdoUeo6V8C/h1epfeFPASSWdvdRDCahqEpDahqA9VmmGyEnnyI4unQAHhmo6rqeu6pca3rdw93e3kjT3E8py8ksh3O7H1YnJp6dKzU61pJ0oAnjrTg6LWZHWnB0WgDWTpWpH2rLTpWpH2oA0IelW48buaqQ9KtR/eoA//1P5IIelacdZkPStOOgCxHWnb9KzI607fpQBrJ0rQi61np0rQi60AacXavaPgT8K5vjN8TdO8CtcjT7B/MutTvn/1dlp1ohnvLlz2WGBHb3ICjJIFeLR9Bivs9n/4UV+zFHYLG0Pir4tJ5srnhoPDNrN+7Re4+33kJZv70dunYnIB5t8d/ihb/Fv4nXviXRomtdDtlj07RLNuPsulWSCCzhwOAwiVS+Orlj3ryuGs2NlA3HAAr6++D37JHj74gJpfiPxk3/CLeG9TmWO3u7xHN3f8jdHpdhGr3N7KRwvlx+Upx5kiLzQB0nw18z4B/BG9+OErCLxN4yS50PwwpH7yCy/1eqanGf4Dj/QoW7s823/VnHypa9RX0J+1hf8Ajq6+L9xZ+NPDN74NtNLhj0rRtGvYXhaz06zGy3hG8Dc2MvKw+9KzseSa+e7XqKANVOtaSdKzU61pJ0oAnjrTg6LWZHWnB0WgDWTpWpH2rLTpWpH2oA0IelW4/vcVUh6Vbj+9xQB//9X+SCHpWnHWZD0rTjoAsR1p2/SsyOtO36UAaydK0IutZ6dK0IutAHvn7PXwx0v4sfE200HxRdNp3h2wil1PXb5ettplmvm3LL28xlHlQg9ZXQV79rfw6+K37VvjLUPj1qNta+D/AAZd3CWVjfam5t7C1s7ZVgtbCwjw092beFUjEVrHI2R82GbJd+xx+0H8M/hPp+rfDfx1o+nxReMr2yj1HxHqVrLqkenadZkzeWmlxPCLovOI3KySGMtHHuRlUqfs74lftC/Bi/1me6+Dfxk/sm6dBAPEepaLf3XiDyAMCG2mjjjttLgA+7Dp8MOwfKHxkUAYFn8O/wBnT9kdVv8AxoRFrSRCSO61qzjvdalJ6f2d4dZjb6cD1W41h/OCkMlvGwAPzb8TP22/iJ4qvbhPhn9o8Lw3Efkz6i1095r93EBgJc6s4WUR44Fvarb2y/wxDknjJfhL+ztfXMl7ffGmGaeVi7ySaFqbM7HklieST61Zh+DX7NnX/hclt/4INS/woAxvBP7UPxq8IadF4dm1Ya/ocQ2jSNfij1awC/3VgvFkWMf9c9uO1ehW3if9k34nyBfF+g3/AMNtTk/5fdAZtS0nd6vp10/2qFf7xhupQP4IQMCsaP4N/s2jj/hclr/4IdS/wq/D8Hf2cFwV+Mdr/wCCHUv8KANBv2UPHviCGbU/ghqGnfEaxh5xoMpa/wBoHU6ZMI73jvshfHevnu6sb3TLqTT9She2uIWKSRSqUdGHBVlYAgj0Ir6MsvhR+z5ZXMd5Z/GWCGWMgo6aHqaspHQggZH4V9U6d8UvhzqunJoPxh+Kei/ETT0QRp/wkPhzU5r2JRwBDqUZjvVwOFVpXjXslAH5jx1pwdFr7R+N3gH9haLwE/ir4EeO9T/4SSIru0C50+eW0mDMATb3siQvEEUltsqyE4wGFfF8P8NAGqnStSPtWWnStSPtQBoQ9Ktx/eqpD0q1H96gD//W/kgh6Vpx1mQ9K046ALEdadv0rMjrTt+lAGsnStCLrWenStCLrQBpxdqvw1Qi7VfhoA0YhjFaMNZ0WOMVow0AaMWe9alr1FZcWe9alr1FAGqnWtJOlZqda0k6UATx1pwdFrMjrTg6LQBrJ0rUj7Vlp0rUj7UAaEPSrcf3qqQ9Ktx/eoA//9f+SCLgVpx9M1lR9BWrF/qxQBZQVpwDis1Pu1qQfcoA006VoRdaz06VoRdaANKIjgVfiIFZ0XWr8dAGpFzjFaMII4NZ0H3R9K0060AX4hjitO2IDCs1OtaEH3hQBsJ1rST7tZcfatSP7goAsRitKH+Gs+PoK0Yuq0AaqdK04yOKzE6VoJ0oA1IelW4wd3FVIOhq7D94fhQB/9kAAO26j/EAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjUtMTItMTZUMDU6MjM6MTMrMDA6MDDRx6XwAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDI1LTEyLTE2VDA1OjIzOjEzKzAwOjAwoJodTAAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyNS0xMi0xNlQwNToyMzoxMyswMDowMPePPJMAAAARdEVYdGV4aWY6Q29sb3JTcGFjZQAxD5sCSQAAACB0RVh0ZXhpZjpDb21wb25lbnRzQ29uZmlndXJhdGlvbgAuLi5q8qFkAAAAE3RFWHRleGlmOkV4aWZPZmZzZXQAMTAyc0IppwAAABV0RVh0ZXhpZjpFeGlmVmVyc2lvbgAwMjIx5Fw1LQAAABl0RVh0ZXhpZjpGbGFzaFBpeFZlcnNpb24AMDEwMBLUKKwAAAAYdEVYdGV4aWY6UGl4ZWxYRGltZW5zaW9uADc2NBOIX0AAAAAYdEVYdGV4aWY6UGl4ZWxZRGltZW5zaW9uADY0OLTF+qgAAAAXdEVYdGV4aWY6U2NlbmVDYXB0dXJlVHlwZQAwIrQxYwAAABx0RVh0ZXhpZjp0aHVtYm5haWw6Q29tcHJlc3Npb24ANvllcFcAAAAodEVYdGV4aWY6dGh1bWJuYWlsOkpQRUdJbnRlcmNoYW5nZUZvcm1hdAAyODaLUk57AAAAL3RFWHRleGlmOnRodW1ibmFpbDpKUEVHSW50ZXJjaGFuZ2VGb3JtYXRMZW5ndGgAMzg0NI983bUAAAAfdEVYdGV4aWY6dGh1bWJuYWlsOlJlc29sdXRpb25Vbml0ADIlQF7TAAAAH3RFWHRleGlmOnRodW1ibmFpbDpYUmVzb2x1dGlvbgA3Mi8x2ocYLAAAAB90RVh0ZXhpZjp0aHVtYm5haWw6WVJlc29sdXRpb24ANzIvMXTvib0AAAAXdEVYdGV4aWY6WUNiQ3JQb3NpdGlvbmluZwAxrA+AYwAAAABJRU5ErkJggg==",this.supportedTransactionVersions=new Set(["legacy",0]),this._publicKey=null,this._readyState="undefined"==typeof window||"undefined"==typeof document?c.WalletReadyState.Unsupported:c.WalletReadyState.Installed,this._connecting=!1,this._wallet=null,this._config=Ze,e&&(this._config={...this._config,...e})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==c.WalletReadyState.Installed)throw new c.WalletWindowClosedError;this._connecting=!0,this.emit("readyStateChange",this._readyState);const e=await k.getWallet();if(e)return void this._updateWalletState(e);const t=this._createDialogManager();try{const e=await t.openConnect(),a=await this._ensureWalletOnChain(e);await k.saveWallet(a),this._updateWalletState(a)}finally{t.destroy()}}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}_updateWalletState(e){this._wallet=e,this._publicKey=new a.PublicKey(e.smartWallet),this.emit("connect",this._publicKey)}_createDialogManager(){return new Me({portalUrl:this._config.portalUrl,rpcUrl:this._config.rpcUrl,paymasterUrl:this._config.paymasterConfig.paymasterUrl})}async _ensureWalletOnChain(e){const t=new a.Connection(this._config.rpcUrl),r=new d.KoraClient({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),n=new Ue(t),s=Qe(e.credentialId),o=await n.getSmartWalletByCredentialHash(s);let l,c;if(!e.publicKey&&o?(c=i.Buffer.from(o.passkeyPubkey).toString("base64"),localStorage.setItem("PUBLIC_KEY",c)):c=e.publicKey,o)l=o.smartWallet.toBase58();else{const t=await r.getPayerSigner(),a=await n.createSmartWalletTxn({passkeyPublicKey:Ke(e.publicKey),payer:new p.web3.PublicKey(t.signer_address),credentialIdBase64:e.credentialId});await r.signAndSendTransaction({transaction:i.Buffer.from(a.transaction.serialize({requireAllSignatures:!1})).toString("base64"),signer_key:t.signer_address}),l=a.smartWallet.toBase58()}return{credentialId:e.credentialId,passkeyPubkey:Ke(c),expo:"web",platform:navigator.platform,smartWallet:l,walletDevice:""}}async disconnect(){await k.clearWallet(),this._wallet=null,this._publicKey=null,this.emit("disconnect")}async sendTransaction(e){try{if(!this._wallet||!this._publicKey)throw new c.WalletDisconnectedError;const t=this._prepareInstructions(e);if(0===t.length)throw new c.WalletSignTransactionError("No instructions to sign");const r=this._initializeClients();let n=[];if("version"in e){const t=e.message.addressTableLookups;n=await Promise.all(t.map(async e=>{const t=await r.connection.getAccountInfo(e.accountKey);if(!t)throw new Error("Lookup table not found");return new a.AddressLookupTableAccount({key:e.accountKey,state:a.AddressLookupTableAccount.deserialize(t.data)})}))}const i=await r.paymaster.getPayerSigner(),s=await x(r.connection),o=Qe(this._wallet.credentialId),l=await this._buildAuthorizationMessage(r.smartWallet,t,i.signer_address,s,o),d=await r.connection.getLatestBlockhash(),u=await this._signWithDialog(l,t,d.blockhash,i.signer_address);return await this._executeSmartWalletTransaction(r,t,u,i.signer_address,s,o,n)}catch(e){throw this.emit("error",e),e}}async signTransaction(e){throw new c.WalletSignTransactionError("Lazorkit Wallet does not support signTransaction. Please use sendTransaction or signAndSendTransaction.")}async signAllTransactions(e){throw new c.WalletSignTransactionError("Lazorkit Wallet does not support signAllTransactions. Please use sendTransaction or signAndSendTransaction.")}async signMessage(e){const t=this._createDialogManager();try{if(!this._wallet||!this._publicKey)throw new c.WalletDisconnectedError;const a=i.Buffer.from(e).toString("base64"),r=await t.openSign(a,"",this._wallet.credentialId,this._config.clusterSimulation),n=JSON.stringify({signature:r.signature,signedPayload:r.signedPayload});return new Uint8Array(i.Buffer.from(n))}catch(e){throw this.emit("error",e),e}finally{t.destroy()}}_initializeClients(){const e=new a.Connection(this._config.rpcUrl);return{connection:e,paymaster:new d.KoraClient({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),smartWallet:new Ue(e)}}_prepareInstructions(e){return"version"in e?e.message.compiledInstructions.map(t=>new a.TransactionInstruction({keys:t.accountKeyIndexes.map(t=>({pubkey:e.message.staticAccountKeys[t],isSigner:e.message.isAccountSigner(t),isWritable:e.message.isAccountWritable(t)})),programId:new a.PublicKey(e.message.staticAccountKeys[t.programIdIndex]),data:i.Buffer.from(t.data)})):[...e.instructions]}async _buildAuthorizationMessage(e,t,a,r,n){return await e.buildAuthorizationMessage({action:{type:exports.SmartWalletAction.CreateChunk,args:{policyInstruction:null,cpiInstructions:t}},payer:new p.web3.PublicKey(a),smartWallet:this._publicKey,passkeyPublicKey:this._wallet.passkeyPubkey,timestamp:new p.BN(r),credentialHash:n})}async _signWithDialog(e,t,a,r){const n=i.Buffer.from(e).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),s=this._createDialogManager();try{const e=new p.web3.TransactionMessage({payerKey:new p.web3.PublicKey(r),recentBlockhash:a,instructions:t}).compileToV0Message(),o=new p.web3.VersionedTransaction(e),l=i.Buffer.from(o.serialize()).toString("base64");return await s.openSign(n,l,this._wallet.credentialId,this._config.clusterSimulation)}finally{s.destroy()}}async _executeSmartWalletTransaction(e,t,a,r,n,i,s){const o=await e.smartWallet.createChunkTxn({payer:new p.web3.PublicKey(r),smartWallet:this._publicKey,passkeySignature:{passkeyPublicKey:this._wallet.passkeyPubkey,signature64:a.signature,clientDataJsonRaw64:a.clientDataJsonBase64,authenticatorDataRaw64:a.authenticatorDataBase64},policyInstruction:null,cpiInstructions:t,timestamp:n,credentialHash:i}),l=await this._sendToPaymaster(e.paymaster,o,r);await e.connection.confirmTransaction(l,"confirmed");const c=await e.smartWallet.executeChunkTxn({payer:new p.web3.PublicKey(r),smartWallet:this._publicKey,cpiInstructions:t},{addressLookupTables:s});return await this._sendToPaymaster(e.paymaster,c,r)}async _sendToPaymaster(e,t,a){let r;r="version"in t?i.Buffer.from(t.serialize()):i.Buffer.from(t.serialize({requireAllSignatures:!1,verifySignatures:!1}));return(await e.signAndSendTransaction({transaction:r.toString("base64"),signer_key:a})).signature}}class Xe{constructor(e){this.version="1.0.0",this.name=Je,this.icon="data:image/png;base64,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",this._account=null,this._listeners={},this._adapter=new Ye(e),this._adapter.on("connect",e=>{this._account={address:e.toBase58(),publicKey:e.toBytes(),chains:["solana:mainnet","solana:devnet","solana:testnet"],features:["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"]},this._emit("change",{accounts:[this._account]})}),this._adapter.on("disconnect",()=>{this._account=null,this._emit("change",{accounts:[]})})}get accounts(){return this._account?[this._account]:[]}get chains(){return["solana:mainnet","solana:devnet","solana:testnet"]}get features(){return{"standard:connect":{version:"1.0.0",connect:async()=>(await this._adapter.connect(),{accounts:this.accounts})},"standard:disconnect":{version:"1.0.0",disconnect:async()=>{await this._adapter.disconnect()}},"standard:events":{version:"1.0.0",on:(e,t)=>(this._listeners[e]=this._listeners[e]||[],this._listeners[e].push(t),()=>{this._listeners[e]=this._listeners[e]?.filter(e=>e!==t)||[]})},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:async(...e)=>{const t=[];for(const r of e){const e=a.VersionedTransaction.deserialize(r.transaction),n=await this._adapter.sendTransaction(e);t.push({signature:o.decode(n)})}return t}},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:async(...e)=>{throw new Error("signTransaction not supported")}},"solana:signMessage":{version:"1.0.0",signMessage:async(...e)=>{const t=[];for(const a of e){const e=await this._adapter.signMessage(a.message);t.push({message:a.message,signature:e,signedMessage:a.message})}return t}}}}_emit(e,...t){this._listeners[e]?.forEach(e=>e(...t))}}Object.defineProperty(exports,"Connection",{enumerable:!0,get:function(){return a.Connection}}),Object.defineProperty(exports,"Keypair",{enumerable:!0,get:function(){return a.Keypair}}),Object.defineProperty(exports,"PublicKey",{enumerable:!0,get:function(){return a.PublicKey}}),Object.defineProperty(exports,"Transaction",{enumerable:!0,get:function(){return a.Transaction}}),Object.defineProperty(exports,"TransactionInstruction",{enumerable:!0,get:function(){return a.TransactionInstruction}}),exports.API_ENDPOINTS=f,exports.CHUNK_SEED=ue,exports.CREDENTIAL_HASH_SIZE=32,exports.DEFAULTS=y,exports.DEFAULT_COMMITMENT=w,exports.DEFAULT_CONFIG=Ze,exports.DefaultPolicyClient=ee,exports.DialogManager=Me,exports.EMPTY_PDA_RENT_EXEMPT_BALANCE=H,exports.LazorkitClient=Ue,exports.LazorkitProvider=a=>{const{children:r,rpcUrl:n=y.RPC_ENDPOINT,portalUrl:i=y.PORTAL_URL,paymasterConfig:s={paymasterUrl:y.PAYMASTER_URL}}=a,{setConfig:o}=ze();return t.useEffect(()=>{o({portalUrl:i,paymasterConfig:s,rpcUrl:n})},[n,i,s,o]),e.jsx(e.Fragment,{children:r})},exports.LazorkitWalletAdapter=Ye,exports.LazorkitWalletName=Je,exports.Logger=I,exports.PASSKEY_PUBLIC_KEY_SIZE=33,exports.Paymaster=P,exports.SIGNATURE_SIZE=64,exports.SMART_WALLET_CONFIG_SEED=ce,exports.SMART_WALLET_SEED=le,exports.STORAGE_KEYS=b,exports.StorageManager=k,exports.StorageUtil=class{static saveCredentials(e){try{e.credentialId&&localStorage.setItem(_e,e.credentialId),localStorage.setItem(je,e.publickey),localStorage.setItem(Ge,e.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",e.timestamp.toString())}catch(e){console.error("Failed to save credentials to local storage:",e)}}static getCredentials(){try{const e=localStorage.getItem(_e),t=localStorage.getItem(je),a=localStorage.getItem(Ge),r=localStorage.getItem("CREDENTIALS_TIMESTAMP");return t&&a?{credentialId:e||void 0,publickey:t,smartWalletAddress:a,timestamp:r?parseInt(r):Date.now()}:null}catch(e){return console.error("Failed to get credentials from local storage:",e),null}}static updateSmartWalletAddress(e){try{localStorage.setItem(Ge,e)}catch(e){console.error("Failed to update smart wallet address in local storage:",e)}}static clearCredentials(){try{localStorage.removeItem(_e),localStorage.removeItem(je),localStorage.removeItem(Ge),localStorage.removeItem("CREDENTIALS_TIMESTAMP"),console.log("Credentials cleared from local storage")}catch(e){console.error("Failed to clear credentials from local storage:",e)}}static getItem(e){return localStorage.getItem(e)}static setItem(e,t){localStorage.setItem(e,t)}},exports.ValidationError=Q,exports.WALLET_DEVICE_SEED=de,exports.asCredentialHash=U,exports.asPasskeyPublicKey=T,exports.asSignature=function(e){return e},exports.assertByteArrayLength=O,exports.assertDefined=N,exports.assertNonEmptyArray=j,exports.assertNonEmptyByteArray=function(e,t){if(N(e,t),0===(Array.isArray(e)?e:Array.from(e)).length)throw new Q(`${t} cannot be empty`,t)},exports.assertNonEmptyString=_,exports.assertPositiveBN=F,exports.assertPositiveInteger=Y,exports.assertPositiveNumber=function(e,t){if(N(e,t),"number"!=typeof e||!Number.isFinite(e)||Number.isNaN(e))throw new Q(`${t} must be a finite number (got ${Number.isNaN(e)?"NaN":Number.isFinite(e)?typeof e:e===1/0?"Infinity":"-Infinity"})`,t);if(e<0)throw new Q(`${t} must be non-negative, got ${e}`,t)},exports.assertValidBase64=Z,exports.assertValidCredentialHash=L,exports.assertValidPasskeyPublicKey=z,exports.assertValidPublicKey=K,exports.assertValidPublicKeyArray=X,exports.assertValidSignature=V,exports.assertValidTransactionInstruction=G,exports.assertValidTransactionInstructionArray=q,exports.base64ToBytes=Le,exports.buildCreateChunkMessage=ve,exports.buildExecuteMessage=Pe,exports.buildPasskeyVerificationInstruction=Ce,exports.buildTransaction=Te,exports.byteArrayEquals=E,exports.calculateVerifyInstructionIndex=xe,exports.combineInstructionsWithAuth=Be,exports.combineInstructionsWithAuthAndCU=function(e,t,a){return Ee([e,...t],a)},exports.computeMultipleCpiHashes=ke,exports.convertPasskeySignatureToInstructionArgs=We,exports.createComputeUnitLimitInstruction=De,exports.credentialHashFromBase64=B,exports.deriveChunkPda=me,exports.deriveSmartWalletConfigPda=pe,exports.deriveSmartWalletPda=Ae,exports.deriveWalletDevicePda=ge,exports.detectPlatform=function(){if("undefined"!=typeof window&&window.ReactNativeWebView)return"mobile";const e=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e)?"mobile":"web"},exports.getBlockchainTimestamp=x,exports.getRandomBytes=D,exports.importP256PublicKey=Ve,exports.instructionToAccountMetas=W,exports.isAndroid=function(){return/Android/i.test(navigator.userAgent)},exports.isIOS=function(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)},exports.isSafari=function(){const e=navigator.userAgent.toLowerCase();return/^((?!chrome|android).)*safari/i.test(e)},exports.normalizePublicKey=function(e,t="publicKey"){return K(e,t),"string"==typeof e?new p.web3.PublicKey(e):e},exports.prependComputeUnitLimit=Ee,exports.registerLazorkitWallet=function(e){u.registerWallet(new Xe(e))},exports.toNumberArray=J,exports.toNumberArraySafe=$,exports.useWallet=()=>{const{wallet:e,isLoading:r,isConnecting:n,isSigning:i,error:s,connect:o,disconnect:l,signAndSendTransaction:c,signMessage:d}=ze(),u=t.useCallback(async e=>{try{return await o(e)}catch(e){throw console.error("Failed to connect wallet:",e),e}},[o]),A=t.useCallback(async()=>{try{await l()}catch(e){throw console.error("Failed to disconnect wallet:",e),e}},[l]),p=t.useCallback(async e=>{try{return await c({instructions:e.instructions,transactionOptions:e.transactionOptions})}catch(e){throw console.error("Failed to sign and send transaction:",e),e}},[c]),g=t.useCallback(async e=>{try{return await d(e)}catch(e){throw console.error("Failed to sign message:",e),e}},[d]),m=t.useCallback(async({signedPayload:e,signature:t,publicKey:a})=>{const r=Buffer.from(e).toString("base64"),n=Buffer.from(t).toString("base64"),i=Buffer.from(a).toString("base64");return await Fe({signedPayload:r,signature:n,publicKey:i})},[]);return{smartWalletPubkey:e?.smartWallet?new a.PublicKey(e.smartWallet):null,isConnected:!!e,isLoading:r||n||i,isConnecting:n,isSigning:i,error:s,wallet:e,connect:u,disconnect:A,signAndSendTransaction:p,signMessage:g,verifyMessage:m}},exports.useWalletStore=ze,exports.validateCredentialHash=function(e,t="credentialHash"){return L(e,t),Array.isArray(e)?e:Array.from(e)},exports.validatePasskeyPublicKey=function(e,t="passkeyPublicKey"){return z(e,t),Array.isArray(e)?e:Array.from(e)},exports.validateSignature=function(e,t="signature"){return V(e,t),Array.isArray(e)?e:Array.from(e)},exports.verifySignatureBrowser=Fe;
 //# sourceMappingURL=index.js.map
diff --git a/node_modules/@lazorkit/wallet/dist/index.mjs b/node_modules/@lazorkit/wallet/dist/index.mjs
index 7e20456..9e4f986 100644
--- a/node_modules/@lazorkit/wallet/dist/index.mjs
+++ b/node_modules/@lazorkit/wallet/dist/index.mjs
@@ -1,2 +1,2 @@
-import{jsx as t,Fragment as e}from"react/jsx-runtime";import{useEffect as a,useCallback as n}from"react";import{PublicKey as r,Transaction as i,Connection as s,AddressLookupTableAccount as o,TransactionInstruction as l,VersionedTransaction as c}from"@solana/web3.js";export{Connection,Keypair,PublicKey,Transaction,TransactionInstruction}from"@solana/web3.js";import{create as d}from"zustand";import*as A from"@coral-xyz/anchor";import{Buffer as u}from"buffer";import{sha256 as p}from"js-sha256";import*as g from"bs58";import m from"bs58";import{EventEmitter as h}from"eventemitter3";import{BaseWalletAdapter as y,WalletReadyState as f,WalletWindowClosedError as w,WalletDisconnectedError as b,WalletSignTransactionError as S}from"@solana/wallet-adapter-base";import{KoraClient as k}from"@solana/kora";import{registerWallet as I}from"@wallet-standard/wallet";function v(t,e){let a;try{a=t()}catch(t){return}return{getItem:t=>{var e;const n=t=>null===t?null:JSON.parse(t,void 0),r=null!=(e=a.getItem(t))?e:null;return r instanceof Promise?r.then(n):n(r)},setItem:(t,e)=>a.setItem(t,JSON.stringify(e,void 0)),removeItem:t=>a.removeItem(t)}}const D=t=>e=>{try{const a=t(e);return a instanceof Promise?a:{then:t=>D(t)(a),catch(t){return this}}}catch(t){return{then(t){return this},catch:e=>D(e)(t)}}},C=(t,e)=>(a,n,r)=>{let i={storage:v(()=>localStorage),partialize:t=>t,version:0,merge:(t,e)=>({...e,...t}),...e},s=!1;const o=new Set,l=new Set;let c=i.storage;if(!c)return t((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),a(...t)},n,r);const d=()=>{const t=i.partialize({...n()});return c.setItem(i.name,{state:t,version:i.version})},A=r.setState;r.setState=(t,e)=>(A(t,e),d());const u=t((...t)=>(a(...t),d()),n,r);let p;r.getInitialState=()=>u;const g=()=>{var t,e;if(!c)return;s=!1,o.forEach(t=>{var e;return t(null!=(e=n())?e:u)});const r=(null==(e=i.onRehydrateStorage)?void 0:e.call(i,null!=(t=n())?t:u))||void 0;return D(c.getItem.bind(c))(i.name).then(t=>{if(t){if("number"!=typeof t.version||t.version===i.version)return[!1,t.state];if(i.migrate){const e=i.migrate(t.state,t.version);return e instanceof Promise?e.then(t=>[!0,t]):[!0,e]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(t=>{var e;const[r,s]=t;if(p=i.merge(s,null!=(e=n())?e:u),a(p,!0),r)return d()}).then(()=>{null==r||r(p,void 0),p=n(),s=!0,l.forEach(t=>t(p))}).catch(t=>{null==r||r(void 0,t)})};return r.persist={setOptions:t=>{i={...i,...t},t.storage&&(c=t.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>g(),hasHydrated:()=>s,onHydrate:t=>(o.add(t),()=>{o.delete(t)}),onFinishHydration:t=>(l.add(t),()=>{l.delete(t)})},i.skipHydration||g(),p||u},P={PORTAL_URL:"https://portal.lazor.sh",PAYMASTER_URL:"https://lazorkit-paymaster.onrender.com",RPC_ENDPOINT:"https://api.devnet.solana.com"},W={CONNECT:"connect",SIGN:"sign"},E="confirmed",B={WALLET:"lazorkit-wallet",CREDENTIALS:"lazorkit-credentials",PUBLIC_KEY:"PUBLIC_KEY",CREDENTIAL_ID:"CREDENTIAL_ID",SMART_WALLET_ADDRESS:"SMART_WALLET_ADDRESS"},x={getItem:async t=>{try{if("undefined"==typeof window)return null;return localStorage.getItem(t)}catch(e){return console.error("Error reading from localStorage:",e,{key:t}),null}},setItem:async(t,e)=>{try{if("undefined"==typeof window)return;localStorage.setItem(t,e)}catch(a){console.error("Error writing to localStorage:",a,{key:t,valueLength:e.length})}},removeItem:async t=>{try{if("undefined"==typeof window)return;localStorage.removeItem(t)}catch(e){console.error("Error removing from localStorage:",e,{key:t})}}};class U{static async saveWallet(t){try{await x.setItem(B.WALLET,JSON.stringify(t)),await x.setItem(B.CREDENTIAL_ID,t.credentialId),await x.setItem(B.SMART_WALLET_ADDRESS,t.smartWallet),await x.setItem(B.PUBLIC_KEY,u.from(t.passkeyPubkey).toString("base64"))}catch(t){throw console.error("Failed to save wallet to storage:",t),t}}static async getWallet(){try{const t=await x.getItem(B.WALLET);return t?JSON.parse(t):null}catch(t){return console.error("Failed to get wallet from storage:",t),null}}static async saveConfig(t){try{await x.setItem("lazorkit-config",JSON.stringify(t))}catch(t){throw console.error("Failed to save config to storage:",t),t}}static async getConfig(){try{const t=await x.getItem("lazorkit-config");return t?JSON.parse(t):null}catch(t){return console.error("Failed to get config from storage:",t),null}}static async clearWallet(){try{await x.removeItem(B.WALLET),await x.removeItem(B.CREDENTIAL_ID),await x.removeItem(B.SMART_WALLET_ADDRESS),await x.removeItem(B.PUBLIC_KEY),await x.removeItem("CREDENTIALS_TIMESTAMP")}catch(t){throw console.error("Failed to clear wallet from storage:",t),t}}static async getItem(t){return await x.getItem(t)}static async setItem(t,e){await x.setItem(t,e)}static async removeItem(t){await x.removeItem(t)}}class R{constructor(t){this.context=t,this.enabled="production"!==process.env.NODE_ENV}debug(t,e){this.enabled&&console.debug(`[${this.context}] ${t}`,e)}info(t,e){console.info(`[${this.context}] ${t}`,e)}warn(t,e){console.warn(`[${this.context}] ${t}`,e)}error(t,e){console.error(`[${this.context}] ${t}`,e)}}class T{constructor(t){this.logger=new R("Paymaster"),this.endpoint=t.paymasterUrl,this.apiKey=t.apiKey}getHeaders(){const t={"Content-Type":"application/json"};return this.apiKey&&(t["x-api-key"]=this.apiKey),t}async getPayer(){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getPayerSigner",params:[]})});if(!t.ok)throw new Error(`Failed to get payer: ${t.statusText}`);const e=await t.json();return new r(e.result.signer_address)}catch(t){throw this.logger.error("Failed to get payer",t),t}}async getBlockhash(){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"getBlockhash",id:1,params:[]})});if(!t.ok)throw new Error(`Failed to get blockhash: ${t.statusText}`);return(await t.json()).result.blockhash}catch(t){throw this.logger.error("Failed to get blockhash",t),t}}async attemptSign(t,e=1){try{const e=t.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signTransaction",id:1,params:[e.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign transaction: ${a.statusText}`);const n=await a.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return i.from(u.from(n.result.signed_transaction,"base64"))}catch(t){throw this.logger.error(`Sign attempt ${e} failed:`,t),t}}async sign(t,e=3,a=1e3){for(let n=1;n<=e;n++)try{return await this.attemptSign(t,n)}catch(t){if(n===e)throw this.logger.error("All sign retry attempts failed",t),t;const r=a*Math.pow(2,n-1);this.logger.info(`Retrying sign in ${r}ms (attempt ${n}/${e})`),await new Promise(t=>setTimeout(t,r))}throw new Error("Failed to sign transaction after all retries")}async attemptSignAndSend(t,e=1){try{const e=t.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[e.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign and send transaction: ${a.statusText}`);const n=await a.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return n.result.signature}catch(t){throw this.logger.error(`Attempt ${e} failed:`,t),t}}async signAndSend(t,e=3,a=1e3){for(let n=1;n<=e;n++)try{return await this.attemptSignAndSend(t,n)}catch(t){if(n===e)throw this.logger.error("All retry attempts failed",t),t;const r=a*Math.pow(2,n-1);this.logger.info(`Retrying in ${r}ms (attempt ${n}/${e})`),await new Promise(t=>setTimeout(t,r))}throw new Error("Failed to sign and send transaction after all retries")}async attemptSignAndSendVersionedTransaction(t,e=1){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[u.from(t.serialize()).toString("base64")]})});if(!e.ok)throw new Error(`Failed to sign and send transaction: ${e.statusText}`);const a=await e.json();if(a.error)throw new Error(a.error.message||"Unknown paymaster error");return a.result.signature}catch(t){throw this.logger.error(`Attempt ${e} failed:`,t),t}}async signAndSendVersionedTransaction(t,e=3,a=1e3){for(let n=1;n<=e;n++)try{return await this.attemptSignAndSendVersionedTransaction(t,n)}catch(t){if(n===e)throw this.logger.error("All retry attempts failed",t),t;const r=a*Math.pow(2,n-1);this.logger.info(`Retrying in ${r}ms (attempt ${n}/${e})`),await new Promise(t=>setTimeout(t,r))}throw new Error("Failed to sign and send transaction after all retries")}}var M,H={address:"Gsuz7YcA5sbMGVRXT3xSYhJBessW4xFC4xYsihNCqMFh",metadata:{name:"lazorkit",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},docs:["LazorKit: Smart Wallet with WebAuthn Passkey Authentication"],instructions:[{name:"create_chunk",discriminator:[83,226,15,219,9,19,186,90],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"wallet_state.last_nonce",account:"WalletState"}]}},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateChunkArgs"}}}]},{name:"create_smart_wallet",discriminator:[129,39,235,18,132,68,203,19],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"arg",path:"args.wallet_id"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"policy_program"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateSmartWalletArgs"}}}]},{name:"execute",discriminator:[130,221,242,154,13,193,189,29],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"cpi_program"},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"ExecuteArgs"}}}]},{name:"execute_chunk",discriminator:[106,83,113,47,89,243,39,220],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"instruction_data_list",type:{vec:"bytes"}},{name:"split_index",type:"bytes"}]}],accounts:[{name:"Chunk",discriminator:[134,67,80,65,135,143,156,196]},{name:"WalletDevice",discriminator:[35,85,31,31,179,48,136,123]},{name:"WalletState",discriminator:[126,186,0,158,92,223,167,68]}],errors:[{code:6e3,name:"PasskeyMismatch",msg:"Passkey public key mismatch with stored authenticator"},{code:6001,name:"InvalidPolicyDataSize",msg:"Invalid policy data size"},{code:6002,name:"Secp256r1InvalidLength",msg:"Secp256r1 instruction has invalid data length"},{code:6003,name:"Secp256r1HeaderMismatch",msg:"Secp256r1 instruction header validation failed"},{code:6004,name:"Secp256r1DataMismatch",msg:"Secp256r1 signature data validation failed"},{code:6005,name:"InvalidSignature",msg:"Invalid signature provided for passkey verification"},{code:6006,name:"ClientDataInvalidUtf8",msg:"Client data JSON is not valid UTF-8"},{code:6007,name:"ClientDataJsonParseError",msg:"Client data JSON parsing failed"},{code:6008,name:"ChallengeMissing",msg:"Challenge field missing from client data JSON"},{code:6009,name:"ChallengeBase64DecodeError",msg:"Challenge base64 decoding failed"},{code:6010,name:"ChallengeDeserializationError",msg:"Challenge message deserialization failed"},{code:6011,name:"HashMismatch",msg:"Message hash mismatch: expected different value"},{code:6012,name:"InvalidInstructionDiscriminator",msg:"Invalid instruction discriminator"},{code:6013,name:"InsufficientCpiAccounts",msg:"Insufficient remaining accounts for CPI instruction"},{code:6014,name:"AccountSliceOutOfBounds",msg:"Account slice index out of bounds"},{code:6015,name:"InvalidAccountOwner",msg:"Account owner verification failed"},{code:6016,name:"ProgramNotExecutable",msg:"Program not executable"},{code:6017,name:"CredentialIdEmpty",msg:"Credential ID cannot be empty"},{code:6018,name:"PolicyDataTooLarge",msg:"Policy data exceeds maximum allowed size"},{code:6019,name:"TransactionTooOld",msg:"Transaction is too old"},{code:6020,name:"InvalidInstructionData",msg:"Invalid instruction data"},{code:6021,name:"InvalidInstruction",msg:"Invalid instruction"},{code:6022,name:"InsufficientBalanceForFee",msg:"Insufficient balance for fee"},{code:6023,name:"InvalidSequenceNumber",msg:"Invalid sequence number"},{code:6024,name:"InvalidPasskeyFormat",msg:"Invalid passkey format"},{code:6025,name:"ReentrancyDetected",msg:"Reentrancy detected"},{code:6026,name:"UnauthorizedAdmin",msg:"Unauthorized admin"}],types:[{name:"Chunk",docs:["Transaction chunk for deferred execution","","Created after full passkey and policy verification. Contains all bindings","necessary to execute the transaction later without re-verification.","Used for large transactions that need to be split into manageable chunks."],type:{kind:"struct",fields:[{name:"owner_wallet_address",docs:["Smart wallet address that authorized this chunk session"],type:"pubkey"},{name:"cpi_hash",docs:["Combined SHA256 hash of all cpi transaction instruction data"],type:{array:["u8",32]}},{name:"authorized_nonce",docs:["The nonce that was authorized at chunk creation (bound into data hash)"],type:"u64"},{name:"authorized_timestamp",docs:["Timestamp from the original message hash for expiration validation"],type:"i64"},{name:"rent_refund_address",docs:["Address to receive rent refund when closing the chunk session"],type:"pubkey"}]}},{name:"CreateChunkArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"policy_data",type:"bytes"},{name:"timestamp",type:"i64"},{name:"cpi_hash",type:{array:["u8",32]}}]}},{name:"CreateSmartWalletArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"init_policy_data",type:"bytes"},{name:"wallet_id",type:"u64"},{name:"amount",type:"u64"},{name:"policy_data_size",type:"u16"}]}},{name:"ExecuteArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"split_index",type:"u16"},{name:"policy_data",type:"bytes"},{name:"cpi_data",type:"bytes"},{name:"timestamp",type:"i64"}]}},{name:"WalletDevice",docs:["Wallet device account linking a passkey to a smart wallet"],type:{kind:"struct",fields:[{name:"passkey_pubkey",docs:["Secp256r1 compressed public key (33 bytes)"],type:{array:["u8",33]}},{name:"credential_hash",docs:["SHA256 hash of the credential ID"],type:{array:["u8",32]}},{name:"smart_wallet",docs:["Associated smart wallet address"],type:"pubkey"},{name:"bump",docs:["PDA bump seed"],type:"u8"}]}},{name:"WalletState",docs:["Wallet state account storing wallet configuration and execution state"],type:{kind:"struct",fields:[{name:"bump",docs:["PDA bump seed for smart wallet"],type:"u8"},{name:"wallet_id",docs:["Unique wallet identifier"],type:"u64"},{name:"last_nonce",docs:["Last used nonce for anti-replay protection"],type:"u64"},{name:"policy_program",docs:["Policy program that validates transactions"],type:"pubkey"},{name:"policy_data",docs:["Serialized policy data returned from policy initialization"],type:"bytes"}]}}]};function Q(t,e){return t.keys.map(t=>({pubkey:t.pubkey,isWritable:t.isWritable,isSigner:!!e&&e.some(e=>e.toString()===t.pubkey.toString())}))}function K(t){if("function"==typeof globalThis.crypto?.getRandomValues){const e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),e}try{const{randomBytes:e}=require("crypto");return e(t)}catch{throw new Error("No CSPRNG available")}}function N(t,e){if(t.length!==e.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==e[a])return!1;return!0}function O(t){const e=u.from(t,"base64");return Array.from(new Uint8Array(p.arrayBuffer(e)))}async function z(t){const e=await t.getSlot(),a=await t.getBlockTime(e);if(null===a)throw new Error("Failed to get blockchain timestamp");return new A.BN(a)}async function V(t,e,a){let n=0;for(;n<3;){try{const n=await e.getWalletStateData(a),r=e.getChunkPubkey(a,n.lastNonce);if(await t.getAccountInfo(r))return}catch(t){console.warn(`Attempt ${n+1} failed to find chunk:`,t)}n++,n<3&&await new Promise(t=>setTimeout(t,3e3))}throw new Error("Chunk not found")}function F(t){return t}function L(t){return t}function j(t){return t}!function(t){t.CreateChunk="create_chunk",t.ExecuteChunk="execute_chunk"}(M||(M={}));var J={address:"BiE9vSdz9MidUiyjVYsu3PG4C1fbPZ8CVPADA9jRfXw7",metadata:{name:"default_policy",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},instructions:[{name:"check_policy",discriminator:[28,88,170,179,239,136,25,35],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet"}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"policy_data",type:"bytes"}]},{name:"init_policy",discriminator:[45,234,110,100,209,146,191,86],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}],returns:{defined:{name:"PolicyStruct"}}}],errors:[{code:6e3,name:"InvalidPasskey",msg:"Invalid passkey format"},{code:6001,name:"Unauthorized",msg:"Unauthorized to access smart wallet"}],types:[{name:"DeviceSlot",type:{kind:"struct",fields:[{name:"passkey_pubkey",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}]}},{name:"PolicyStruct",type:{kind:"struct",fields:[{name:"bump",type:"u8"},{name:"smart_wallet",type:"pubkey"},{name:"device_slots",type:{vec:{defined:{name:"DeviceSlot"}}}}]}}]};const G=u.from("policy");const _=890880,Z=33,Y=32,X=64;class q extends Error{constructor(t,e){super(t),this.field=e,this.name="ValidationError"}}function $(t,e){if(null==t||void 0===t){throw new q(`${e} is required but was ${null===t?"null":"undefined"}`,e)}}function tt(t,e){$(t,e);try{if("string"==typeof t){if(0===t.trim().length)throw new q(`${e} cannot be an empty string`,e);new A.web3.PublicKey(t)}else{if(!(t instanceof A.web3.PublicKey||t&&"object"==typeof t&&"toBase58"in t&&"function"==typeof t.toBase58&&"toBytes"in t&&"function"==typeof t.toBytes))throw new q(`${e} must be a PublicKey instance or valid base58 string`,e)}}catch(t){if(t instanceof q)throw t;throw new q(`${e} is not a valid PublicKey: ${t instanceof Error?t.message:"Invalid format"}`,e)}}function et(t,e,a){let n;if($(t,a),Array.isArray(t))n=t;else if(t instanceof Uint8Array)n=Array.from(t);else{if(!t||"object"!=typeof t||"number"!=typeof t.length)throw new q(`${a} must be an array or Uint8Array`,a);n=Array.from(t)}if(n.length!==e)throw new q(`${a} must be exactly ${e} bytes, got ${n.length}`,a);for(let t=0;t<n.length;t++){const e=n[t];if("number"!=typeof e||!Number.isFinite(e)||!Number.isInteger(e)||e<0||e>255)throw new q(`${a}[${t}] must be a valid byte (0-255), got ${"number"==typeof e?e:typeof e}`,a)}}function at(t,e){$(t,e);if(0===(Array.isArray(t)?t:Array.from(t)).length)throw new q(`${e} cannot be empty`,e)}function nt(t,e="passkeyPublicKey"){et(t,33,e)}function rt(t,e="passkeyPublicKey"){return nt(t,e),Array.isArray(t)?t:Array.from(t)}function it(t,e="credentialHash"){et(t,32,e)}function st(t,e="credentialHash"){return it(t,e),Array.isArray(t)?t:Array.from(t)}function ot(t,e="signature"){et(t,64,e)}function lt(t,e="signature"){return ot(t,e),Array.isArray(t)?t:Array.from(t)}function ct(t,e){$(t,e);if(!(t instanceof A.BN||t&&"object"==typeof t&&"lt"in t&&"function"==typeof t.lt&&"toString"in t&&"function"==typeof t.toString))throw new q(`${e} must be a BN instance`,e);if(t.lt(new A.BN(0)))throw new q(`${e} must be non-negative, got ${t.toString()}`,e)}function dt(t,e){if($(t,e),"number"!=typeof t||!Number.isFinite(t)||Number.isNaN(t))throw new q(`${e} must be a finite number (got ${Number.isNaN(t)?"NaN":Number.isFinite(t)?typeof t:t===1/0?"Infinity":"-Infinity"})`,e);if(t<0)throw new q(`${e} must be non-negative, got ${t}`,e)}function At(t,e){if($(t,e),"string"!=typeof t)throw new q(`${e} must be a string (got ${typeof t})`,e);if(0===String(t).trim().length)throw new q(`${e} cannot be empty`,e)}function ut(t,e){if($(t,e),!Array.isArray(t))throw new q(`${e} must be an array (got ${typeof t}${t&&"object"==typeof t?` with constructor ${t.constructor?.name||"unknown"}`:""})`,e);if(0===t.length)throw new q(`${e} cannot be empty`,e)}function pt(t,e){$(t,e);if(!(t instanceof A.web3.TransactionInstruction||t&&"object"==typeof t&&"programId"in t&&"keys"in t&&Array.isArray(t.keys)&&"data"in t))throw new q(`${e} must be a TransactionInstruction instance`,e);if(tt(t.programId,`${e}.programId`),!t.keys||!Array.isArray(t.keys)||0===t.keys.length)throw new q(`${e} must have at least one account key`,e)}function gt(t){return Array.isArray(t)?t:Array.from(t)}function mt(t,e="publicKey"){return tt(t,e),"string"==typeof t?new A.web3.PublicKey(t):t}function ht(t,e){At(t,e);if(!/^[A-Za-z0-9+/]*={0,2}$/.test(t))throw new q(`${e} is not a valid base64 string (invalid characters)`,e);try{"undefined"!=typeof Buffer&&Buffer.from?Buffer.from(t,"base64"):"undefined"!=typeof atob&&atob(t)}catch(t){throw new q(`${e} is not a valid base64 string: ${t instanceof Error?t.message:"Invalid format"}`,e)}}function yt(t,e){if($(t,e),"number"!=typeof t||!Number.isFinite(t)||Number.isNaN(t))throw new q(`${e} must be a finite number (got ${Number.isNaN(t)?"NaN":Number.isFinite(t)?typeof t:t===1/0?"Infinity":"-Infinity"})`,e);if(!Number.isInteger(t))throw new q(`${e} must be an integer, got ${t}`,e);if(t<=0)throw new q(`${e} must be a positive integer, got ${t}`,e)}function ft(t,e){if($(t,e),!Array.isArray(t))throw new q(`${e} must be an array (got ${typeof t})`,e);t.forEach((t,a)=>{tt(t,`${e}[${a}]`)})}function wt(t,e){ut(t,e),t.forEach((t,a)=>{pt(t,`${e}[${a}]`)})}function bt(t){return Array.isArray(t)?[...t]:Array.from(t)}function St(t,e="passkeySignature"){if($(t,e),"object"!=typeof t||null===t)throw new q(`${e} must be an object`,e);nt(t.passkeyPublicKey,`${e}.passkeyPublicKey`),ht(t.signature64,`${e}.signature64`),ht(t.clientDataJsonRaw64,`${e}.clientDataJsonRaw64`),ht(t.authenticatorDataRaw64,`${e}.authenticatorDataRaw64`)}class kt{constructor(t){$(t,"connection"),this.connection=t,this.program=new A.Program(J,{connection:t}),this.programId=this.program.programId}policyPda(t){return tt(t,"smartWallet"),function(t,e){return A.web3.PublicKey.findProgramAddressSync([G,e.toBuffer()],t)[0]}(this.programId,t)}getPolicyDataSize(){return 102}validateInitPolicyParams(t){$(t,"params"),ct(t.walletId,"params.walletId"),nt(t.passkeyPublicKey,"params.passkeyPublicKey"),it(t.credentialHash,"params.credentialHash"),tt(t.policySigner,"params.policySigner"),tt(t.smartWallet,"params.smartWallet"),tt(t.walletState,"params.walletState")}async buildInitPolicyIx(t){return this.validateInitPolicyParams(t),await this.program.methods.initPolicy(t.walletId,bt(t.passkeyPublicKey),bt(t.credentialHash)).accountsPartial({smartWallet:t.smartWallet,walletState:t.walletState,policySigner:t.policySigner}).instruction()}validateCheckPolicyParams(t){if($(t,"params"),ct(t.walletId,"params.walletId"),nt(t.passkeyPublicKey,"params.passkeyPublicKey"),tt(t.policySigner,"params.policySigner"),tt(t.smartWallet,"params.smartWallet"),it(t.credentialHash,"params.credentialHash"),$(t.policyData,"params.policyData"),!Buffer.isBuffer(t.policyData))throw new q("params.policyData must be a Buffer instance","params.policyData")}async buildCheckPolicyIx(t){return this.validateCheckPolicyParams(t),await this.program.methods.checkPolicy(t.walletId,bt(t.passkeyPublicKey),bt(t.credentialHash),t.policyData).accountsPartial({smartWallet:t.smartWallet,policySigner:t.policySigner}).instruction()}}const It=u.from("smart_wallet"),vt=u.from("wallet_state"),Dt=u.from("wallet_device"),Ct=u.from("chunk");function Pt(t,e){return A.web3.PublicKey.findProgramAddressSync([It,e.toArrayLike(u,"le",8)],t)[0]}function Wt(t,e){return A.web3.PublicKey.findProgramAddressSync([vt,e.toBuffer()],t)[0]}function Et(t,e){const a=u.concat([t.toBuffer(),u.from(e)]),n=p.arrayBuffer(a);return u.from(n).subarray(0,32)}function Bt(t,e,a){return A.web3.PublicKey.findProgramAddressSync([Dt,Et(e,a)],t)}function xt(t,e,a){return A.web3.PublicKey.findProgramAddressSync([Ct,e.toBuffer(),a.toArrayLike(u,"le",8)],t)[0]}class Ut{constructor(t){this.programId=t}smartWallet(t){return ct(t,"walletId"),Pt(this.programId,t)}walletState(t){return tt(t,"smartWallet"),Wt(this.programId,t)}walletDevice(t,e){return tt(t,"smartWallet"),it(e,"credentialHash"),Bt(this.programId,t,e)[0]}chunk(t,e){return tt(t,"smartWallet"),xt(this.programId,t,e)}}class Rt{constructor(t,e){this.policyClient=t,this.walletPdas=e}async resolveForExecute({provided:t,smartWallet:e,credentialHash:a,passkeyPublicKey:n,walletStateData:r}){if(void 0!==t)return t;const i=this.walletPdas.walletDevice(e,a);return this.policyClient.buildCheckPolicyIx({walletId:r.walletId,passkeyPublicKey:n,policySigner:i,smartWallet:e,credentialHash:a,policyData:r.policyData})}async resolveForCreate({provided:t,smartWalletId:e,smartWallet:a,walletState:n,passkeyPublicKey:r,credentialHash:i}){if(void 0!==t)return t;const s=this.walletPdas.walletDevice(a,i);return this.policyClient.buildInitPolicyIx({walletId:e,passkeyPublicKey:r,credentialHash:i,policySigner:s,smartWallet:a,walletState:n})}}let Tt=null;const Mt=t=>new Uint8Array(p.arrayBuffer(t)),Ht=(t,e,a)=>{const n=p.create();n.update(t.toBytes());for(const t of e)n.update(t.pubkey.toBytes()),n.update(Uint8Array.from([t.isSigner?1:0])),n.update(Uint8Array.from([t.pubkey.toString()===a.toString()||t.isWritable?1:0]));return new Uint8Array(n.arrayBuffer())},Qt=(t,e)=>{const a=Q(t),n=Ht(t.programId,a,e);return{policyDataHash:Mt(t.data),policyAccountsHash:n}},Kt=(t,e,a)=>{const n=u.alloc(4);n.writeUInt32LE(t.length,0);const r=u.concat([n,...t.map(t=>{const e=u.from(t.data),a=u.alloc(4);return a.writeUInt32LE(e.length,0),u.concat([a,e])})]),i=Mt(r),s=((t,e)=>{const a=new Map;for(const e of t){const t=e.pubkey.toString(),n=a.get(t);n?(n.isSigner=n.isSigner||e.isSigner,n.isWritable=n.isWritable||e.isWritable):a.set(t,{isSigner:e.isSigner,isWritable:e.isWritable})}const n=t.map(t=>{const e=t.pubkey.toString(),n=a.get(e);return{pubkey:t.pubkey,isSigner:n.isSigner,isWritable:n.isWritable}}),r=p.create();for(const t of n)r.update(t.pubkey.toBytes()),r.update(Uint8Array.from([t.isSigner?1:0])),r.update(Uint8Array.from([t.pubkey.toString()===e.toString()||t.isWritable?1:0]));return new Uint8Array(r.arrayBuffer())})(t.flatMap(t=>[{pubkey:t.programId,isSigner:!1,isWritable:!1},...Q(t,a)]),e);return{cpiDataHash:i,cpiAccountsHash:s}},Nt=(t,e)=>{try{const a=(Tt||(Tt=new A.BorshCoder({version:"0.1.0",name:"lazorkit_msgs",instructions:[],accounts:[],types:[{name:"SimpleMessage",type:{kind:"struct",fields:[{name:"dataHash",type:{array:["u8",32]}}]}}]})),Tt).types.encode(t,e);return u.from(a)}catch(e){throw new Error(`Failed to encode ${t}: ${e instanceof Error?e.message:"Unknown error"}`)}};function Ot(t,e,a,n,r,i){const s=Qt(n,t),o=((t,e,a)=>{const n=Q(t,a),r=Ht(t.programId,n,e);return{cpiDataHash:Mt(t.data),cpiAccountsHash:r}})(r,t,i??[]),l=new Uint8Array(64);l.set(s.policyDataHash,0),l.set(s.policyAccountsHash,32);const c=Mt(l),d=new Uint8Array(64);d.set(o.cpiDataHash,0),d.set(o.cpiAccountsHash,32);const A=Mt(d),p=u.alloc(8);p.writeBigUInt64LE(BigInt(e.toString()),0);const g=u.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=u.concat([p,g,u.from(c),u.from(A)]),h=Mt(m);return Nt("SimpleMessage",{dataHash:Array.from(h)})}function zt(t,e,a,n,r,i){const s=Qt(n,t),o=Kt(r,t,i),l=new Uint8Array(64);l.set(s.policyDataHash,0),l.set(s.policyAccountsHash,32);const c=Mt(l),d=new Uint8Array(64);d.set(o.cpiDataHash,0),d.set(o.cpiAccountsHash,32);const A=Mt(d),p=u.alloc(8);p.writeBigUInt64LE(BigInt(e.toString()),0);const g=u.alloc(8);g.writeBigInt64LE(BigInt(a.toString()),0);const m=u.concat([p,g,u.from(c),u.from(A)]),h=Mt(m);return Nt("SimpleMessage",{dataHash:Array.from(h)})}const Vt=new A.web3.PublicKey("Secp256r1SigVerify1111111111111111111111111");function Ft(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);{const e=new ArrayBuffer(2*Object.values(t).length),a=new DataView(e);return Object.values(t).forEach((t,e)=>{a.setUint16(2*e,t,!0)}),new Uint8Array(e)}}function Lt(t){nt(t.passkeyPublicKey,"passkeySignature.passkeyPublicKey"),ht(t.signature64,"passkeySignature.signature64"),ht(t.clientDataJsonRaw64,"passkeySignature.clientDataJsonRaw64"),ht(t.authenticatorDataRaw64,"passkeySignature.authenticatorDataRaw64");const e=Buffer.from(t.authenticatorDataRaw64,"base64"),a=Buffer.from(t.clientDataJsonRaw64,"base64"),n=Buffer.from(t.signature64,"base64");ot(gt(n),"passkeySignature.signature64 (decoded)");return function(t,e,a){if(33!==e.length||64!==a.length)throw new Error("Invalid key or signature length");const n=113+t.length,r=new Uint8Array(n);r.set(Ft([1,0]),0);const i={signature_offset:49,signature_instruction_index:65535,public_key_offset:16,public_key_instruction_index:65535,message_data_offset:113,message_data_size:t.length,message_instruction_index:65535};return r.set(Ft(i),2),r.set(e,16),r.set(a,49),r.set(t,113),new A.web3.TransactionInstruction({keys:[],programId:Vt,data:u.from(r)})}(Buffer.concat([e,Buffer.from(p.arrayBuffer(a))]),t.passkeyPublicKey,n)}function jt(t){const e=Buffer.from(t.signature64,"base64");return ot(gt(e),"passkeySignature.signature64 (decoded)"),{passkeyPublicKey:t.passkeyPublicKey,signature:gt(e),clientDataJsonRaw:Buffer.from(t.clientDataJsonRaw64,"base64"),authenticatorDataRaw:Buffer.from(t.authenticatorDataRaw64,"base64")}}function Jt(t){return A.web3.ComputeBudgetProgram.setComputeUnitLimit({units:t})}function Gt(t,e){return void 0===e?t:[Jt(e),...t]}function _t(t,e){return[t,...e]}function Zt(t,e,a){return Gt([t,...e],a)}function Yt(t){return void 0!==t?1:0}async function Xt(t,e,a,n={}){const{addressLookupTables:r,recentBlockhash:i,computeUnitLimit:s}=n,o=Gt(a,s),l=void 0!==r&&r.length>0,c=i||(await t.getLatestBlockhash()).blockhash;if(l){const t=new A.web3.TransactionMessage({payerKey:e,recentBlockhash:c,instructions:o}).compileToV0Message([...r]);return{transaction:new A.web3.VersionedTransaction(t),isVersioned:!0,recentBlockhash:c}}{const t=(new A.web3.Transaction).add(...o);return t.feePayer=e,t.recentBlockhash=c,{transaction:t,isVersioned:!1,recentBlockhash:c}}}global.Buffer=u,u.prototype.subarray=function(t,e){const a=Uint8Array.prototype.subarray.apply(this,[t,e]);return Object.setPrototypeOf(a,u.prototype),a};class qt{constructor(t){this.connection=t,this.program=new A.Program(H,{connection:t}),this.programId=this.program.programId,this.defaultPolicyProgram=new kt(t),this.walletPdas=new Ut(this.programId),this.policyResolver=new Rt(this.defaultPolicyProgram,this.walletPdas)}getSmartWalletPubkey(t){return this.walletPdas.smartWallet(t)}getWalletStatePubkey(t){return this.walletPdas.walletState(t)}getWalletDevicePubkey(t,e){return this.walletPdas.walletDevice(t,e)}getChunkPubkey(t,e){return this.walletPdas.chunk(t,e)}generateWalletId(){return new A.BN(K(8),"le")}async fetchWalletStateContext(t){const e=this.getWalletStatePubkey(t);return{walletState:e,data:await this.program.account.walletState.fetch(e)}}async fetchChunkContext(t,e){const a=this.getChunkPubkey(t,e);return{chunk:a,data:await this.program.account.chunk.fetch(a)}}validateCreateSmartWalletParams(t){$(t,"params"),tt(t.payer,"params.payer"),nt(t.passkeyPublicKey,"params.passkeyPublicKey"),ht(t.credentialIdBase64,"params.credentialIdBase64"),void 0!==t.amount&&ct(t.amount,"params.amount"),void 0!==t.smartWalletId&&ct(t.smartWalletId,"params.smartWalletId"),void 0!==t.policyDataSize&&yt(t.policyDataSize,"params.policyDataSize"),void 0!==t.policyInstruction&&pt(t.policyInstruction,"params.policyInstruction")}validateExecuteParams(t){$(t,"params"),tt(t.payer,"params.payer"),tt(t.smartWallet,"params.smartWallet"),St(t.passkeySignature,"params.passkeySignature"),it(t.credentialHash,"params.credentialHash"),pt(t.cpiInstruction,"params.cpiInstruction"),ct(t.timestamp,"params.timestamp"),void 0!==t.policyInstruction&&pt(t.policyInstruction,"params.policyInstruction"),void 0!==t.cpiSigners&&ft(t.cpiSigners,"params.cpiSigners")}validateCreateChunkParams(t){$(t,"params"),tt(t.payer,"params.payer"),tt(t.smartWallet,"params.smartWallet"),St(t.passkeySignature,"params.passkeySignature"),it(t.credentialHash,"params.credentialHash"),wt(t.cpiInstructions,"params.cpiInstructions"),ct(t.timestamp,"params.timestamp"),void 0!==t.policyInstruction&&pt(t.policyInstruction,"params.policyInstruction"),void 0!==t.cpiSigners&&ft(t.cpiSigners,"params.cpiSigners")}validateExecuteChunkParams(t){$(t,"params"),tt(t.payer,"params.payer"),tt(t.smartWallet,"params.smartWallet"),wt(t.cpiInstructions,"params.cpiInstructions"),void 0!==t.cpiSigners&&ft(t.cpiSigners,"params.cpiSigners")}async getWalletStateData(t){const{data:e}=await this.fetchWalletStateContext(t);return e}async getChunkData(t){return await this.program.account.chunk.fetch(t)}async getSmartWalletByCredentialHash(t){it(t,"credentialHash");const e=H.accounts?.find(t=>"WalletDevice"===t.name)?.discriminator;if(!e)throw new q("WalletDevice discriminator not found in IDL","credentialHash");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:g.default.encode(e)}},{memcmp:{offset:41,bytes:g.default.encode(t)}}]});if(0===a.length)return null;for(const t of a){const e=await this.program.account.walletDevice.fetch(t.pubkey);return{smartWallet:e.smartWallet,walletState:this.getWalletStatePubkey(e.smartWallet),walletDevice:t.pubkey,passkeyPublicKey:e.passkeyPubkey}}return null}async buildCreateSmartWalletIns(t,e,a,n){return tt(t,"payer"),tt(e,"smartWallet"),pt(a,"policyInstruction"),$(n,"args"),nt(n.passkeyPublicKey,"args.passkeyPublicKey"),it(n.credentialHash,"args.credentialHash"),ct(n.walletId,"args.walletId"),ct(n.amount,"args.amount"),await this.program.methods.createSmartWallet(n).accountsPartial({payer:t,smartWallet:e,walletState:this.getWalletStatePubkey(e),walletDevice:this.getWalletDevicePubkey(e,n.credentialHash),policyProgram:a.programId,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts([...Q(a)]).instruction()}async buildExecuteIns(t,e,a,n,r,i,s){return tt(t,"payer"),tt(e,"smartWallet"),tt(a,"walletDevice"),$(n,"args"),pt(r,"policyInstruction"),pt(i,"cpiInstruction"),void 0!==s&&ft(s,"cpiSigners"),await this.program.methods.execute(n).accountsPartial({payer:t,smartWallet:e,walletState:this.getWalletStatePubkey(e),walletDevice:a,policyProgram:r.programId,cpiProgram:i.programId,ixSysvar:A.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts([...Q(r),...Q(i,s)]).instruction()}async buildCreateChunkIns(t,e,a,n,r){tt(t,"payer"),tt(e,"smartWallet"),tt(a,"walletDevice"),$(n,"args"),pt(r,"policyInstruction");const{walletState:i,data:s}=await this.fetchWalletStateContext(e),o=this.getChunkPubkey(e,s.lastNonce);return await this.program.methods.createChunk(n).accountsPartial({payer:t,smartWallet:e,walletState:i,walletDevice:a,policyProgram:r.programId,chunk:o,ixSysvar:A.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts([...Q(r)]).instruction()}async buildExecuteChunkIns(t,e,a,n){tt(t,"payer"),tt(e,"smartWallet"),wt(a,"cpiInstructions"),void 0!==n&&ft(n,"cpiSigners");const{data:r,walletState:i}=await this.fetchWalletStateContext(e),{chunk:s,data:o}=await this.fetchChunkContext(e,r.lastNonce),l=a.map(t=>u.from(t.data)),c=function(t){const e=[];let a=0;for(let n=0;n<t.length-1;n++)a+=t[n].keys.length+1,e.push(a);return e}(a),d=function(t,e){return t.flatMap(t=>[{pubkey:t.programId,isSigner:!1,isWritable:!1},...Q(t,e)])}(a,n);return await this.program.methods.executeChunk(l,u.from(c)).accountsStrict({payer:t,smartWallet:e,walletState:i,chunk:s,sessionRefund:o.rentRefundAddress,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts(d).instruction()}async createSmartWalletTxn(t,e={}){this.validateCreateSmartWalletParams(t);const a=t.smartWalletId??this.generateWalletId(),n=this.getSmartWalletPubkey(a),r=this.getWalletStatePubkey(n),i=t.amount??new A.BN(_),s=t.policyDataSize??this.defaultPolicyProgram.getPolicyDataSize(),o=O(t.credentialIdBase64),l=await this.policyResolver.resolveForCreate({provided:t.policyInstruction,smartWalletId:a,smartWallet:n,walletState:r,passkeyPublicKey:t.passkeyPublicKey,credentialHash:o}),c={passkeyPublicKey:t.passkeyPublicKey,credentialHash:o,initPolicyData:l.data,walletId:a,amount:i,policyDataSize:s},d=await this.buildCreateSmartWalletIns(t.payer,n,l,c);return{transaction:(await Xt(this.connection,t.payer,[d],e)).transaction,smartWalletId:a,smartWallet:n}}async executeTxn(t,e={}){this.validateExecuteParams(t);const a=Lt(t.passkeySignature),n=await this.getWalletStateData(t.smartWallet),r=this.getWalletDevicePubkey(t.smartWallet,t.credentialHash),i=await this.policyResolver.resolveForExecute({provided:t.policyInstruction,smartWallet:t.smartWallet,credentialHash:t.credentialHash,passkeyPublicKey:t.passkeySignature.passkeyPublicKey,walletStateData:n}),s=jt(t.passkeySignature),o=_t(a,[await this.buildExecuteIns(t.payer,t.smartWallet,r,{...s,verifyInstructionIndex:Yt(e.computeUnitLimit),splitIndex:i.keys.length,policyData:i.data,cpiData:t.cpiInstruction.data,timestamp:t.timestamp},i,t.cpiInstruction,[...t.cpiSigners??[],t.payer])]);return(await Xt(this.connection,t.payer,o,e)).transaction}async createChunkTxn(t,e={}){this.validateCreateChunkParams(t);const a=Lt(t.passkeySignature),n=await this.getWalletStateData(t.smartWallet),r=this.getWalletDevicePubkey(t.smartWallet,t.credentialHash),i=await this.policyResolver.resolveForExecute({provided:t.policyInstruction,smartWallet:t.smartWallet,credentialHash:t.credentialHash,passkeyPublicKey:t.passkeySignature.passkeyPublicKey,walletStateData:n}),s=jt(t.passkeySignature),o=function(t,e,a){const n=Kt(t,e,a),r=new Uint8Array(64);return r.set(n.cpiDataHash,0),r.set(n.cpiAccountsHash,32),Array.from(new Uint8Array(p.arrayBuffer(r)))}(t.cpiInstructions,t.smartWallet,[...t.cpiSigners??[],t.payer]),l=_t(a,[await this.buildCreateChunkIns(t.payer,t.smartWallet,r,{...s,policyData:i.data,verifyInstructionIndex:Yt(e.computeUnitLimit),timestamp:t.timestamp,cpiHash:Array.from(o)},i)]);return(await Xt(this.connection,t.payer,l,e)).transaction}async executeChunkTxn(t,e={}){this.validateExecuteChunkParams(t);const a=await this.buildExecuteChunkIns(t.payer,t.smartWallet,t.cpiInstructions,t.cpiSigners);return(await Xt(this.connection,t.payer,[a],e)).transaction}async buildAuthorizationMessage(t){let e;const{action:a,smartWallet:n,passkeyPublicKey:r,timestamp:i}=t;switch(a.type){case M.CreateChunk:{const{policyInstruction:s,cpiInstructions:o,cpiSigners:l}=a.args,c=await this.getWalletStateData(t.smartWallet),d=await this.policyResolver.resolveForExecute({provided:s,smartWallet:t.smartWallet,credentialHash:t.credentialHash,passkeyPublicKey:r,walletStateData:c});e=zt(n,(await this.getWalletStateData(n)).lastNonce,i,d,o,[...l??[],t.payer]);break}default:throw new q(`Unsupported SmartWalletAction: ${a.type}`,"action.type")}return e}}"function"!=typeof globalThis.structuredClone&&(globalThis.structuredClone=t=>JSON.parse(JSON.stringify(t)));class $t extends h{constructor(){super(),this.iframeRef=null,this.retryDelays=[200,400,800,1500,3e3]}setIframeRef(t){this.iframeRef=t}notifyCredentialsUpdated(t){this.emit("credentials-updated",t);const e=new CustomEvent("lazorkit:credentials-updated",{detail:t,bubbles:!0,cancelable:!0});window.dispatchEvent(e)}syncCredentials(t=!1){this.iframeRef&&this.iframeRef.contentWindow?this.performCredentialSync(t):setTimeout(()=>this.syncCredentials(t),500)}performCredentialSync(t){if(!this.iframeRef?.contentWindow)throw new Error("Cannot sync credentials: iframe reference not available");const e=localStorage.getItem("CREDENTIAL_ID")||"",a=localStorage.getItem("PUBLIC_KEY")||"",n=localStorage.getItem("SMART_WALLET_ADDRESS")||"";if(!(t||e&&a))return;const r={type:"SYNC_CREDENTIALS",data:{credentialId:e,publickey:a,smartWalletAddress:n,timestamp:Date.now()}};try{this.iframeRef.contentWindow.postMessage(r,"*"),this.retryDelays.forEach(t=>{setTimeout(()=>{try{this.iframeRef?.contentWindow&&this.iframeRef.contentWindow.postMessage(r,"*")}catch(t){}},t)})}catch(t){}}storeCredential(t){t.credentialId&&localStorage.setItem("CREDENTIAL_ID",t.credentialId),t.publickey&&localStorage.setItem("PUBLIC_KEY",t.publickey),t.smartWalletAddress&&localStorage.setItem("SMART_WALLET_ADDRESS",t.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",(new Date).toISOString())}destroy(){this.removeAllListeners(),this.iframeRef=null}}class te extends h{constructor(t){super(),this.dialogRef=null,this.iframeRef=null,this.popupWindow=null,this.popupCloseInterval=null,this.isClosing=!1,this.isDestroyed=!1,this.logger=new R("DialogManager"),this._currentAction=null,this.config=t,this.credentialManager=new $t,this.logger.debug("Created dialog manager"),this.setupMessageListener()}async openConnect(){return new Promise((t,e)=>{const a=()=>{this.off("connect-result",n),this.off("error",r)},n=e=>{a(),t(e)},r=t=>{a(),e(t)};this.on("connect-result",n),this.on("error",r);const i=setTimeout(()=>{a(),e(new Error("Connection timed out after 60 seconds"))},6e4),s=t,o=e;t=t=>{clearTimeout(i),s(t)},e=t=>{clearTimeout(i),o(t)},this._currentAction=W.CONNECT;if(this.shouldUsePopup("connect")){const t=`${this.config.portalUrl}?action=${W.CONNECT}`;this.openPopup(t).catch(e)}else this.openConnectDialog().catch(e)})}async openSign(t,e,a,n){return new Promise((r,i)=>{const s=()=>{this.off("sign-result",o),this.off("error",l)},o=t=>{s(),r(t)},l=t=>{s(),i(t)};this.on("sign-result",o),this.on("error",l);const c=setTimeout(()=>{s(),i(new Error("Signing timed out after 60 seconds"))},6e4),d=r,A=i;r=t=>{clearTimeout(c),d(t)},i=t=>{clearTimeout(c),A(t)},this._currentAction=W.SIGN;const u=this.shouldUsePopup("sign"),p=encodeURIComponent(t);let g=`${this.config.portalUrl}?action=${W.SIGN}&message=${p}&transaction=${encodeURIComponent(e)}&credentialId=${encodeURIComponent(a)}`;n&&(g+=`&clusterSimulation=${n}`),u?this.openPopup(g).catch(i):this.openSignDialog(g).catch(i)})}async openSignMessage(t,e){return new Promise((a,n)=>{const r=()=>{this.off("sign-result",i),this.off("error",s)},i=t=>{r(),a(t)},s=t=>{r(),n(t)};this.on("sign-result",i),this.on("error",s);const o=setTimeout(()=>{r(),n(new Error("Signing timed out after 60 seconds"))},6e4),l=a,c=n;a=t=>{clearTimeout(o),l(t)},n=t=>{clearTimeout(o),c(t)},this._currentAction=W.SIGN;const d=encodeURIComponent(t),A=`${this.config.portalUrl}?action=${W.SIGN}&message=${d}&credentialId=${encodeURIComponent(e)}`;this.shouldUsePopup("sign")?this.openPopup(A).catch(n):this.openSignDialog(A).catch(n)})}async openConnectDialog(){const t=`${this.config.portalUrl}?action=${W.CONNECT}`;await this.openModal(t)}ensureFonts(){const t="lazorkit-font-roboto-flex";if(document.getElementById(t))return;const e=document.createElement("link");e.id=t,e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap",document.head.appendChild(e)}ensureDialogBackdropCSS(){const t="lazorkit-dialog-backdrop-style";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.textContent='\n    /* ===== Backdrop (overlay nhẹ) ===== */\n    dialog#lazorkit-dialog::backdrop {\n      background: rgba(0,0,0,0);\n      animation: lazor-backdrop-in 160ms ease-out forwards;\n    }\n\n    dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n      animation: lazor-backdrop-out 140ms ease-in forwards;\n    }\n\n    @keyframes lazor-backdrop-in {\n      from { background: rgba(0,0,0,0); }\n      to   { background: rgba(0,0,0,0.12); } /* ✅ overlay nhẹ */\n    }\n\n    @keyframes lazor-backdrop-out {\n      from { background: rgba(0,0,0,0.12); }\n      to   { background: rgba(0,0,0,0); }\n    }\n\n    /* ===== Panel animations ===== */\n    @keyframes lazor-drawer-in {\n      from { transform: translateY(16px); opacity: 0.98; }\n      to   { transform: translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-drawer-out {\n      from { transform: translateY(0); opacity: 1; }\n      to   { transform: translateY(16px); opacity: 0.98; }\n    }\n\n    @keyframes lazor-float-in {\n      from { transform: scale(0.985) translateY(4px); opacity: 0; }\n      to   { transform: scale(1) translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-float-out {\n      from { transform: scale(1) translateY(0); opacity: 1; }\n      to   { transform: scale(0.985) translateY(4px); opacity: 0; }\n    }\n\n    #lazorkit-panel {\n      will-change: transform, opacity;\n      transform-origin: center;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-drawer-in 180ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-drawer-out 150ms ease-in forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-float-in 170ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-float-out 140ms ease-in forwards;\n    }\n\n    /* ===== Reduced motion ===== */\n    @media (prefers-reduced-motion: reduce) {\n      dialog#lazorkit-dialog::backdrop {\n        animation: none !important;\n        background: rgba(0,0,0,0.12) !important;\n      }\n      dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n        background: rgba(0,0,0,0) !important;\n      }\n      dialog#lazorkit-dialog #lazorkit-panel {\n        animation: none !important;\n      }\n    }\n  ',document.head.appendChild(e)}createCloseButton(t){const e=document.createElement("button");return e.type="button",e.title="Close Dialog",e.setAttribute("aria-label","Close Dialog"),Object.assign(e.style,{width:"36px",height:"36px",borderRadius:"10px",border:"none",background:"transparent",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"0",color:"rgba(255, 255, 255, 0.6)",outline:"none",webkitTapHighlightColor:"transparent"}),e.addEventListener("mouseenter",()=>{e.style.background="rgba(255,255,255,0.1)",e.style.color="#ffffff"}),e.addEventListener("mouseleave",()=>{e.style.background="transparent",e.style.color="rgba(255, 255, 255, 0.6)"}),e.onclick=t,e.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg"\n      width="20" height="20" viewBox="0 0 24 24"\n      fill="none" stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18" />\n      <line x1="6" y1="6" x2="18" y2="18" />\n    </svg>\n  ',e}async openSignDialog(t){await this.openModal(t),this.iframeRef&&(this.credentialManager.setIframeRef(this.iframeRef),setTimeout(()=>{this.credentialManager.syncCredentials(!0)},500))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}shouldUsePopup(t){const e=this.isMobileDevice();return!(!this.isSafari()||"connect"!==t)||(!(!e||"connect"!==t)||!(!e&&"sign"===t)&&(!e||"sign"!==t))}getPopupDimensions(){if(!window.top)return{width:450,height:600,top:0,left:0};const t=window.top.outerWidth/2+window.top.screenX-225;return{width:450,height:600,top:window.top.outerHeight/2+window.top.screenY-300,left:t}}async openPopup(t){if(this.popupWindow&&!this.popupWindow.closed)try{this.popupWindow.close()}catch(t){}const e=this.getPopupDimensions();if(this.popupWindow=window.open(t,"lazorkit-popup",`width=${e.width},height=${e.height},top=${e.top},left=${e.left},resizable,scrollbars,status`),this.startPopupMonitor(),!this.popupWindow)throw this.logger.error("Popup was blocked by browser"),new Error("Popup was blocked by browser")}startPopupMonitor(){this.popupCloseInterval&&clearInterval(this.popupCloseInterval),this.popupCloseInterval=setInterval(()=>{this.popupWindow?.closed&&(this.popupWindow=null,this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null))},500)}async openModal(t){this.dialogRef||this.createModal(),this.iframeRef&&(this.iframeRef.src=t),this.dialogRef&&!this.dialogRef.open&&(this.dialogRef.setAttribute("data-state","opening"),this.dialogRef.showModal(),window.setTimeout(()=>{this.dialogRef?.open&&this.dialogRef.setAttribute("data-state","idle")},220))}createModal(){this.ensureFonts(),this.ensureDialogBackdropCSS();const t=document.createElement("dialog");t.id="lazorkit-dialog",t.style.colorScheme="dark",t.setAttribute("data-theme","dark");const e=this.isMobileDevice(),a=(t=>({overlay:{position:"fixed",inset:0,padding:0,border:"none",background:"transparent",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",overflow:"visible",zIndex:2147483647,display:"grid",placeItems:t?"end center":"center"},panel:{width:t?"100%":"360px",maxWidth:t?"100%":"90vw",height:t?"55vh":"650px",maxHeight:t?"55vh":"90vh",background:"white",borderRadius:t?"20px 20px 0 0":"20px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden",position:"relative"},closeButton:{zIndex:10},iframeContainer:{position:"relative",width:"100%",height:"100%",border:"none",margin:0,padding:0,overflow:"hidden",borderRadius:"inherit",background:"white"},iframe:{width:"100%",height:"100%",border:0,borderRadius:"inherit",display:"block"}}))(e);Object.assign(t.style,a.overlay),Object.assign(t.style,{"--background-color-th_base":"#191919","--background-color-th_frame":"#191919","--text-color-th_base":"#eeeeee","--border-color-th_frame":"rgba(255,255,255,0.10)"});const n=document.createElement("div"),r=e?"drawer":"floating";t.setAttribute("data-variant",r),t.setAttribute("data-state","idle"),n.id="lazorkit-panel",Object.assign(n.style,a.panel),Object.assign(n.style,{display:"flex",flexDirection:"column"}),Object.assign(n.style,{background:"var(--background-color-th_base, #fcfcfc)",color:"var(--text-color-th_base, #202020)",fontFamily:'"Roboto Flex", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'});const i=document.createElement("div");Object.assign(i.style,{height:"32px",flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 12px",boxSizing:"border-box",borderBottom:"1px solid rgba(0,0,0,0.08)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, var(--background-color-th_base, #fcfcfc))",color:"var(--text-color-th_base, #202020)",borderBottom:"1px solid var(--border-color-th_frame, rgba(0,0,0,0.08))"});const s=document.createElement("div");Object.assign(s.style,a.iframeContainer),Object.assign(s.style,{flex:"1 1 auto"}),Object.assign(s.style,{background:"var(--background-color-th_base, #fcfcfc)"}),Object.assign(n.style,{background:"var(--background-color-th_base, #191919)",color:"var(--text-color-th_base, #eeeeee)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, #191919)",color:"var(--text-color-th_base, #eeeeee)",borderBottom:"1px solid var(--border-color-th_frame, rgba(255,255,255,0.10))"}),Object.assign(s.style,{background:"var(--background-color-th_base, #191919)"});const o=this.createCloseButton(()=>{this.closeDialog(),this.emit("close")});Object.assign(o.style,{position:"static",top:"",right:""}),o.id="lazorkit-dialog-close",o.ariaLabel="Close",Object.assign(o.style,a.closeButton);const l=document.createElement("iframe");l.id="lazorkit-iframe",Object.assign(l.style,a.iframe),l.allow=`publickey-credentials-get ${this.config.portalUrl}; publickey-credentials-create ${this.config.portalUrl}; clipboard-write; camera; microphone`;const c=l.sandbox;c.add("allow-forms"),c.add("allow-scripts"),c.add("allow-same-origin"),c.add("allow-popups"),c.add("allow-popups-to-escape-sandbox"),c.add("allow-modals"),l.setAttribute("aria-label","Lazor Wallet"),l.tabIndex=0,l.title="Lazor",t.addEventListener("cancel",()=>this.closeDialog()),t.addEventListener("click",e=>{e.target===t&&this.closeDialog()}),i.appendChild(o),n.appendChild(i),s.appendChild(l),n.appendChild(s),t.appendChild(n),document.body.appendChild(t),this.dialogRef=t,this.iframeRef=l}setupMessageListener(){window.addEventListener("message",t=>{if(!t.origin.includes(new URL(this.config.portalUrl).hostname))return;const{type:e,data:a,error:n}=t.data;if(n)this.emit("error",new Error(n.message||"Portal error"));else switch(e){case"connect-result":case"WALLET_CONNECTED":const t={publicKey:a.publickey||a.publicKey||"",credentialId:a.credentialId,isCreated:"create"===a.connectionType||!!a.publickey,connectionType:a.connectionType||(a.publickey?"create":"get"),timestamp:a.timestamp||Date.now(),accountName:a.accountName};this.emit("connect-result",t),this.closeDialog();break;case"sign-result":case"SIGNATURE_CREATED":const e={signature:a.normalized,clientDataJsonBase64:a.clientDataJSONReturn,authenticatorDataBase64:a.authenticatorDataReturn,signedPayload:a.msg};this.emit("sign-result",e),this.closeDialog();break;case"error":this.emit("error",new Error(a?.message||"Unknown portal error"));break;case"close":this.closeDialog()}})}closeDialog(){if(this.isClosing)return;this.isClosing=!0;const t=this.dialogRef,e=this.iframeRef;try{t&&t.setAttribute("data-state","closing"),window.setTimeout(()=>{try{if(e&&(e.parentNode&&e.parentNode.removeChild(e),this.iframeRef=null),t){try{t.open&&t.close()}catch{}t.parentNode&&t.parentNode.removeChild(t),this.dialogRef=null}if(this.popupWindow){try{this.popupWindow.close()}catch{}this.popupWindow=null}this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null),this.logger.debug("Closed dialog (animated)")}catch(t){this.logger.error("Error during animated close:",t)}finally{this.isClosing=!1}},170)}catch(t){this.logger.error("Error closing dialog:",t),this.isClosing=!1}}getIframeRef(){return this.iframeRef}getDialogRef(){return this.dialogRef}getPopupWindow(){return this.popupWindow}getCurrentAction(){return this._currentAction}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.closeDialog(),this.credentialManager.destroy(),this.removeAllListeners(),this.logger.debug("Destroyed dialog manager"))}}const ee=t=>new te({portalUrl:t.portalUrl,rpcUrl:t.rpcUrl,paymasterUrl:t.paymasterConfig.paymasterUrl}),ae=t=>Array.from(new Uint8Array(p.arrayBuffer(Buffer.from(t,"base64")))),ne=(t,e,a)=>{const n=t instanceof Error?t:new Error(String(t));throw e({error:n}),a?.(n),n},re=t=>t?Array.from(Buffer.from(t,"base64")):[],ie=async(t,e,a)=>{const{isConnecting:n,config:r}=t();if(n)throw new Error("Already connecting");e({isConnecting:!0,error:null});try{const n=await U.getWallet();if((()=>{if("undefined"==typeof window)return;const t=localStorage.getItem("lazorkit-wallet");if(t)try{const e=JSON.parse(t);e.state&&void 0!==e.version&&localStorage.removeItem("lazorkit-wallet")}catch(t){}})(),n)return e({wallet:n}),a?.onSuccess?.(n),n;const i=ee(r);try{const n=await i.openConnect(),s=new T(r.paymasterConfig),o=new qt(t().connection),l=ae(n.credentialId),c=await o.getSmartWalletByCredentialHash(l);let d,A;if(!n.publicKey&&c?(A=Buffer.from(c.passkeyPublicKey).toString("base64"),localStorage.setItem("PUBLIC_KEY",A)):A=n.publicKey,c)d=c.smartWallet.toBase58();else{const t=await s.getPayer(),e=await o.createSmartWalletTxn({passkeyPublicKey:re(A),payer:t,credentialIdBase64:n.credentialId});await s.signAndSend(e.transaction),d=e.smartWallet.toBase58()}const u={credentialId:n.credentialId,passkeyPubkey:re(A),expo:"web",platform:navigator.platform,smartWallet:d,walletDevice:"",accountName:n.accountName};return await U.saveWallet(u),e({wallet:u}),a?.onSuccess?.(u),u}finally{i.destroy()}}catch(t){return ne(t,e,a?.onFail)}finally{e({isConnecting:!1})}},se=d()(C((t,e)=>({wallet:null,config:{portalUrl:P.PORTAL_URL,paymasterConfig:{paymasterUrl:P.PAYMASTER_URL},rpcUrl:P.RPC_ENDPOINT},connection:new s(P.RPC_ENDPOINT,E),isLoading:!1,isConnecting:!1,isSigning:!1,error:null,setConfig:e=>{try{const a=new s(e.rpcUrl||P.RPC_ENDPOINT,E);t({config:e,connection:a})}catch(t){throw console.error("Failed to update wallet configuration:",t,{config:e}),new Error(`Failed to update configuration: ${t}`)}},setWallet:e=>{try{t({wallet:e})}catch(t){throw console.error("Failed to set wallet:",t,{wallet:e}),t}},setLoading:e=>t({isLoading:e}),setConnecting:e=>t({isConnecting:e}),setSigning:e=>t({isSigning:e}),setConnection:e=>{try{t({connection:e})}catch(t){throw console.error("Failed to set connection:",t,{endpoint:e?.rpcEndpoint}),t}},setError:e=>{t({error:e}),e&&console.error("Error state set:",e)},clearError:()=>{t({error:null})},connect:a=>ie(e,t,a),disconnect:()=>(async(t,e)=>{try{await U.clearWallet(),t({wallet:null,error:null,isConnecting:!1,isSigning:!1,isLoading:!1}),e?.onSuccess?.()}catch(a){return ne(a,t,e?.onFail)}})(t),signAndSendTransaction:a=>(async(t,e,a)=>{const{isSigning:n,connection:r,wallet:i,config:s}=t();if(n)throw new Error("Already signing");if(!i)throw new Error("No wallet connected");if(!r)throw new Error("No connection available");e({isSigning:!0,error:null});try{const t=new T(s.paymasterConfig),e=new qt(r),n=await t.getPayer(),o=await z(r),l=await e.buildAuthorizationMessage({action:{type:M.CreateChunk,args:{cpiInstructions:a.instructions}},payer:n,smartWallet:new A.web3.PublicKey(i.smartWallet),passkeyPublicKey:i.passkeyPubkey,timestamp:new A.BN(o),credentialHash:ae(i.credentialId)}),c=Buffer.from(l).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),d=await r.getLatestBlockhash(),u=new A.web3.TransactionMessage({payerKey:n,recentBlockhash:d.blockhash,instructions:a.instructions}).compileToV0Message(),p=new A.web3.VersionedTransaction(u),g=Buffer.from(p.serialize()).toString("base64"),m=ee(s),h=i.credentialId,y=a.transactionOptions?.clusterSimulation;try{const s=await m.openSign(c,g,h,y),l={msg:c,normalized:s.signature,clientDataJSONReturn:s.clientDataJsonBase64,authenticatorDataReturn:s.authenticatorDataBase64},d=ae(i.credentialId),u=await e.createChunkTxn({payer:n,smartWallet:new A.web3.PublicKey(i.smartWallet),passkeySignature:{passkeyPublicKey:i.passkeyPubkey,signature64:l.normalized,clientDataJsonRaw64:l.clientDataJSONReturn,authenticatorDataRaw64:l.authenticatorDataReturn},cpiInstructions:a.instructions,timestamp:o,credentialHash:d}),p=await t.signAndSend(u);await r.confirmTransaction(p),await V(r,e,new A.web3.PublicKey(i.smartWallet));const f=a.transactionOptions?.addressLookupTableAccounts||[],w=await e.executeChunkTxn({payer:n,smartWallet:new A.web3.PublicKey(i.smartWallet),cpiInstructions:a.instructions},{addressLookupTables:f,computeUnitLimit:a.transactionOptions?.computeUnitLimit});let b;return b=f.length>0?await t.signAndSendVersionedTransaction(w):await t.signAndSend(w),a.onSuccess?.(b),b}finally{m.destroy()}}catch(t){return ne(t,e,a.onFail)}finally{e({isSigning:!1})}})(e,t,a),signMessage:a=>(async(t,e,a)=>{const{isSigning:n,wallet:r,config:i}=t();if(n)throw new Error("Already signing");if(!r)throw new Error("No wallet connected");e({isSigning:!0,error:null});try{const t=ee(i);try{const e=await t.openSignMessage(a,r.credentialId);return{signature:e.signature,signedPayload:e.signedPayload}}finally{t.destroy()}}catch(t){throw e({error:t}),t}finally{e({isSigning:!1})}})(e,t,a)}),{name:"lazorkit-wallet-store",storage:v(()=>x),partialize:t=>({wallet:t.wallet,config:t.config})})),oe=n=>{const{children:r,rpcUrl:i=P.RPC_ENDPOINT,portalUrl:s=P.PORTAL_URL,paymasterConfig:o={paymasterUrl:P.PAYMASTER_URL}}=n,{setConfig:l}=se();return a(()=>{l({portalUrl:s,paymasterConfig:o,rpcUrl:i})},[i,s,o,l]),t(e,{children:r})};function le(t){return Uint8Array.from(atob(t),t=>t.charCodeAt(0))}async function ce(t){let e=t;if(64===e.length){const t=new Uint8Array(65);t[0]=4,t.set(e,1),e=t}return crypto.subtle.importKey("raw",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])}async function de({signedPayload:t,signature:e,publicKey:a}){const n=le(t),r=le(e),i=le(a),s=await ce(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},s,r,n)}const Ae=()=>{const{wallet:t,isLoading:e,isConnecting:a,isSigning:i,error:s,connect:o,disconnect:l,signAndSendTransaction:c,signMessage:d}=se(),A=n(async t=>{try{return await o(t)}catch(t){throw console.error("Failed to connect wallet:",t),t}},[o]),u=n(async()=>{try{await l()}catch(t){throw console.error("Failed to disconnect wallet:",t),t}},[l]),p=n(async t=>{try{return await c({instructions:t.instructions,transactionOptions:t.transactionOptions})}catch(t){throw console.error("Failed to sign and send transaction:",t),t}},[c]),g=n(async t=>{try{return await d(t)}catch(t){throw console.error("Failed to sign message:",t),t}},[d]),m=n(async({signedPayload:t,signature:e,publicKey:a})=>{const n=Buffer.from(t).toString("base64"),r=Buffer.from(e).toString("base64"),i=Buffer.from(a).toString("base64");return await de({signedPayload:n,signature:r,publicKey:i})},[]);return{smartWalletPubkey:t?.smartWallet?new r(t.smartWallet):null,isConnected:!!t,isLoading:e||a||i,isConnecting:a,isSigning:i,error:s,wallet:t,connect:A,disconnect:u,signAndSendTransaction:p,signMessage:g,verifyMessage:m}};function ue(){if("undefined"!=typeof window&&window.ReactNativeWebView)return"mobile";const t=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t)?"mobile":"web"}function pe(){const t=navigator.userAgent.toLowerCase();return/^((?!chrome|android).)*safari/i.test(t)}function ge(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function me(){return/Android/i.test(navigator.userAgent)}const he="CREDENTIAL_ID",ye="PUBLIC_KEY",fe="SMART_WALLET_ADDRESS";class we{static saveCredentials(t){try{t.credentialId&&localStorage.setItem(he,t.credentialId),localStorage.setItem(ye,t.publickey),localStorage.setItem(fe,t.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",t.timestamp.toString())}catch(t){console.error("Failed to save credentials to local storage:",t)}}static getCredentials(){try{const t=localStorage.getItem(he),e=localStorage.getItem(ye),a=localStorage.getItem(fe),n=localStorage.getItem("CREDENTIALS_TIMESTAMP");return e&&a?{credentialId:t||void 0,publickey:e,smartWalletAddress:a,timestamp:n?parseInt(n):Date.now()}:null}catch(t){return console.error("Failed to get credentials from local storage:",t),null}}static updateSmartWalletAddress(t){try{localStorage.setItem(fe,t)}catch(t){console.error("Failed to update smart wallet address in local storage:",t)}}static clearCredentials(){try{localStorage.removeItem(he),localStorage.removeItem(ye),localStorage.removeItem(fe),localStorage.removeItem("CREDENTIALS_TIMESTAMP"),console.log("Credentials cleared from local storage")}catch(t){console.error("Failed to clear credentials from local storage:",t)}}static getItem(t){return localStorage.getItem(t)}static setItem(t,e){localStorage.setItem(t,e)}}const be="Lazorkit Wallet",Se={rpcUrl:"https://api.devnet.solana.com",portalUrl:"https://portal.lazor.sh",paymasterConfig:{paymasterUrl:"https://kora.devnet.lazorkit.com"}};class ke extends y{constructor(t){super(),this.name=be,this.url="https://lazorkit.com",this.icon="data:image/png;base64,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",this.supportedTransactionVersions=new Set(["legacy",0]),this._publicKey=null,this._readyState="undefined"==typeof window||"undefined"==typeof document?f.Unsupported:f.Installed,this._connecting=!1,this._wallet=null,this._config=Se,t&&(this._config={...this._config,...t})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==f.Installed)throw new w;this._connecting=!0,this.emit("readyStateChange",this._readyState);const t=await U.getWallet();if(t)return void this._updateWalletState(t);const e=this._createDialogManager();try{const t=await e.openConnect(),a=await this._ensureWalletOnChain(t);await U.saveWallet(a),this._updateWalletState(a)}finally{e.destroy()}}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}_updateWalletState(t){this._wallet=t,this._publicKey=new r(t.smartWallet),this.emit("connect",this._publicKey)}_createDialogManager(){return new te({portalUrl:this._config.portalUrl,rpcUrl:this._config.rpcUrl,paymasterUrl:this._config.paymasterConfig.paymasterUrl})}async _ensureWalletOnChain(t){const e=new s(this._config.rpcUrl),a=new k({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),n=new qt(e),r=ae(t.credentialId),i=await n.getSmartWalletByCredentialHash(r);let o,l;if(!t.publicKey&&i?(l=u.from(i.passkeyPublicKey).toString("base64"),localStorage.setItem("PUBLIC_KEY",l)):l=t.publicKey,i)o=i.smartWallet.toBase58();else{const e=await a.getPayerSigner(),r=await n.createSmartWalletTxn({passkeyPublicKey:re(t.publicKey),payer:new A.web3.PublicKey(e.signer_address),credentialIdBase64:t.credentialId});await a.signAndSendTransaction({transaction:u.from(r.transaction.serialize({requireAllSignatures:!1})).toString("base64"),signer_key:e.signer_address}),o=r.smartWallet.toBase58()}return{credentialId:t.credentialId,passkeyPubkey:re(l),expo:"web",platform:navigator.platform,smartWallet:o,walletDevice:""}}async disconnect(){await U.clearWallet(),this._wallet=null,this._publicKey=null,this.emit("disconnect")}async sendTransaction(t){try{if(!this._wallet||!this._publicKey)throw new b;const e=this._prepareInstructions(t);if(0===e.length)throw new S("No instructions to sign");const a=this._initializeClients();let n=[];if("version"in t){const e=t.message.addressTableLookups;n=await Promise.all(e.map(async t=>{const e=await a.connection.getAccountInfo(t.accountKey);if(!e)throw new Error("Lookup table not found");return new o({key:t.accountKey,state:o.deserialize(e.data)})}))}const r=await a.paymaster.getPayerSigner(),i=await z(a.connection),s=ae(this._wallet.credentialId),l=await this._buildAuthorizationMessage(a.smartWallet,e,r.signer_address,i,s),c=await a.connection.getLatestBlockhash(),d=await this._signWithDialog(l,e,c.blockhash,r.signer_address);return await this._executeSmartWalletTransaction(a,e,d,r.signer_address,i,s,n)}catch(t){throw this.emit("error",t),t}}async signTransaction(t){throw new S("Lazorkit Wallet does not support signTransaction. Please use sendTransaction or signAndSendTransaction.")}async signAllTransactions(t){throw new S("Lazorkit Wallet does not support signAllTransactions. Please use sendTransaction or signAndSendTransaction.")}async signMessage(t){const e=this._createDialogManager();try{if(!this._wallet||!this._publicKey)throw new b;const a=u.from(t).toString("base64"),n=await e.openSign(a,"",this._wallet.credentialId,this._config.clusterSimulation),r=JSON.stringify({signature:n.signature,signedPayload:n.signedPayload});return new Uint8Array(u.from(r))}catch(t){throw this.emit("error",t),t}finally{e.destroy()}}_initializeClients(){const t=new s(this._config.rpcUrl);return{connection:t,paymaster:new k({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),smartWallet:new qt(t)}}_prepareInstructions(t){return"version"in t?t.message.compiledInstructions.map(e=>new l({keys:e.accountKeyIndexes.map(e=>({pubkey:t.message.staticAccountKeys[e],isSigner:t.message.isAccountSigner(e),isWritable:t.message.isAccountWritable(e)})),programId:new r(t.message.staticAccountKeys[e.programIdIndex]),data:u.from(e.data)})):[...t.instructions]}async _buildAuthorizationMessage(t,e,a,n,r){return await t.buildAuthorizationMessage({action:{type:M.CreateChunk,args:{cpiInstructions:e}},payer:new A.web3.PublicKey(a),smartWallet:this._publicKey,passkeyPublicKey:this._wallet.passkeyPubkey,timestamp:new A.BN(n),credentialHash:r})}async _signWithDialog(t,e,a,n){const r=u.from(t).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),i=this._createDialogManager();try{const t=new A.web3.TransactionMessage({payerKey:new A.web3.PublicKey(n),recentBlockhash:a,instructions:e}).compileToV0Message(),s=new A.web3.VersionedTransaction(t),o=u.from(s.serialize()).toString("base64");return await i.openSign(r,o,this._wallet.credentialId,this._config.clusterSimulation)}finally{i.destroy()}}async _executeSmartWalletTransaction(t,e,a,n,r,i,s){const o=await t.smartWallet.createChunkTxn({payer:new A.web3.PublicKey(n),smartWallet:this._publicKey,passkeySignature:{passkeyPublicKey:this._wallet.passkeyPubkey,signature64:a.signature,clientDataJsonRaw64:a.clientDataJsonBase64,authenticatorDataRaw64:a.authenticatorDataBase64},cpiInstructions:e,timestamp:r,credentialHash:i}),l=await this._sendToPaymaster(t.paymaster,o,n);await t.connection.confirmTransaction(l,"confirmed"),await V(t.connection,t.smartWallet,this._publicKey);const c=await t.smartWallet.executeChunkTxn({payer:new A.web3.PublicKey(n),smartWallet:this._publicKey,cpiInstructions:e},{addressLookupTables:s});return await this._sendToPaymaster(t.paymaster,c,n)}async _sendToPaymaster(t,e,a){let n;n="version"in e?u.from(e.serialize()):u.from(e.serialize({requireAllSignatures:!1,verifySignatures:!1}));return(await t.signAndSendTransaction({transaction:n.toString("base64"),signer_key:a})).signature}}function Ie(t){I(new ve(t))}class ve{constructor(t){this.version="1.0.0",this.name=be,this.icon="data:image/png;base64,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",this._account=null,this._listeners={},this._adapter=new ke(t),this._adapter.on("connect",t=>{this._account={address:t.toBase58(),publicKey:t.toBytes(),chains:["solana:mainnet","solana:devnet","solana:testnet"],features:["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"]},this._emit("change",{accounts:[this._account]})}),this._adapter.on("disconnect",()=>{this._account=null,this._emit("change",{accounts:[]})})}get accounts(){return this._account?[this._account]:[]}get chains(){return["solana:mainnet","solana:devnet","solana:testnet"]}get features(){return{"standard:connect":{version:"1.0.0",connect:async()=>(await this._adapter.connect(),{accounts:this.accounts})},"standard:disconnect":{version:"1.0.0",disconnect:async()=>{await this._adapter.disconnect()}},"standard:events":{version:"1.0.0",on:(t,e)=>(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),()=>{this._listeners[t]=this._listeners[t]?.filter(t=>t!==e)||[]})},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:async(...t)=>{const e=[];for(const a of t){const t=c.deserialize(a.transaction),n=await this._adapter.sendTransaction(t);e.push({signature:m.decode(n)})}return e}},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:async(...t)=>{throw new Error("signTransaction not supported")}},"solana:signMessage":{version:"1.0.0",signMessage:async(...t)=>{const e=[];for(const a of t){const t=await this._adapter.signMessage(a.message);e.push({message:a.message,signature:t,signedMessage:a.message})}return e}}}}_emit(t,...e){this._listeners[t]?.forEach(t=>t(...e))}}export{W as API_ENDPOINTS,Ct as CHUNK_SEED,Y as CREDENTIAL_HASH_SIZE,P as DEFAULTS,E as DEFAULT_COMMITMENT,Se as DEFAULT_CONFIG,kt as DefaultPolicyClient,te as DialogManager,_ as EMPTY_PDA_RENT_EXEMPT_BALANCE,qt as LazorkitClient,oe as LazorkitProvider,ke as LazorkitWalletAdapter,be as LazorkitWalletName,R as Logger,Z as PASSKEY_PUBLIC_KEY_SIZE,T as Paymaster,X as SIGNATURE_SIZE,vt as SMART_WALLET_CONFIG_SEED,It as SMART_WALLET_SEED,B as STORAGE_KEYS,M as SmartWalletAction,U as StorageManager,we as StorageUtil,q as ValidationError,Dt as WALLET_DEVICE_SEED,L as asCredentialHash,F as asPasskeyPublicKey,j as asSignature,et as assertByteArrayLength,$ as assertDefined,ut as assertNonEmptyArray,at as assertNonEmptyByteArray,At as assertNonEmptyString,ct as assertPositiveBN,yt as assertPositiveInteger,dt as assertPositiveNumber,ht as assertValidBase64,it as assertValidCredentialHash,nt as assertValidPasskeyPublicKey,St as assertValidPasskeySignature,tt as assertValidPublicKey,ft as assertValidPublicKeyArray,ot as assertValidSignature,pt as assertValidTransactionInstruction,wt as assertValidTransactionInstructionArray,le as base64ToBytes,zt as buildCreateChunkMessage,Ot as buildExecuteMessage,Lt as buildPasskeyVerificationInstruction,Xt as buildTransaction,N as byteArrayEquals,Yt as calculateVerifyInstructionIndex,_t as combineInstructionsWithAuth,Zt as combineInstructionsWithAuthAndCU,Kt as computeMultipleCpiHashes,jt as convertPasskeySignatureToInstructionArgs,Jt as createComputeUnitLimitInstruction,O as credentialHashFromBase64,xt as deriveChunkPda,Wt as deriveSmartWalletConfigPda,Pt as deriveSmartWalletPda,Bt as deriveWalletDevicePda,ue as detectPlatform,V as ensureChunkExist,z as getBlockchainTimestamp,K as getRandomBytes,ce as importP256PublicKey,Q as instructionToAccountMetas,me as isAndroid,ge as isIOS,pe as isSafari,mt as normalizePublicKey,Gt as prependComputeUnitLimit,Ie as registerLazorkitWallet,gt as toNumberArray,bt as toNumberArraySafe,Ae as useWallet,se as useWalletStore,st as validateCredentialHash,rt as validatePasskeyPublicKey,lt as validateSignature,de as verifySignatureBrowser};
+import{jsx as t,Fragment as e}from"react/jsx-runtime";import{useEffect as a,useCallback as n}from"react";import{PublicKey as r,Transaction as i,Connection as s,AddressLookupTableAccount as o,TransactionInstruction as l,VersionedTransaction as c}from"@solana/web3.js";export{Connection,Keypair,PublicKey,Transaction,TransactionInstruction}from"@solana/web3.js";import{create as d}from"zustand";import*as A from"@coral-xyz/anchor";import{Buffer as u}from"buffer";import{sha256 as p}from"js-sha256";import m from"bs58";import{EventEmitter as g}from"eventemitter3";import{BaseWalletAdapter as h,WalletReadyState as y,WalletWindowClosedError as f,WalletDisconnectedError as w,WalletSignTransactionError as b}from"@solana/wallet-adapter-base";import{KoraClient as k}from"@solana/kora";import{registerWallet as S}from"@wallet-standard/wallet";function I(t,e){let a;try{a=t()}catch(t){return}return{getItem:t=>{var e;const n=t=>null===t?null:JSON.parse(t,void 0),r=null!=(e=a.getItem(t))?e:null;return r instanceof Promise?r.then(n):n(r)},setItem:(t,e)=>a.setItem(t,JSON.stringify(e,void 0)),removeItem:t=>a.removeItem(t)}}const v=t=>e=>{try{const a=t(e);return a instanceof Promise?a:{then:t=>v(t)(a),catch(t){return this}}}catch(t){return{then(t){return this},catch:e=>v(e)(t)}}},C=(t,e)=>(a,n,r)=>{let i={storage:I(()=>localStorage),partialize:t=>t,version:0,merge:(t,e)=>({...e,...t}),...e},s=!1;const o=new Set,l=new Set;let c=i.storage;if(!c)return t((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),a(...t)},n,r);const d=()=>{const t=i.partialize({...n()});return c.setItem(i.name,{state:t,version:i.version})},A=r.setState;r.setState=(t,e)=>(A(t,e),d());const u=t((...t)=>(a(...t),d()),n,r);let p;r.getInitialState=()=>u;const m=()=>{var t,e;if(!c)return;s=!1,o.forEach(t=>{var e;return t(null!=(e=n())?e:u)});const r=(null==(e=i.onRehydrateStorage)?void 0:e.call(i,null!=(t=n())?t:u))||void 0;return v(c.getItem.bind(c))(i.name).then(t=>{if(t){if("number"!=typeof t.version||t.version===i.version)return[!1,t.state];if(i.migrate){const e=i.migrate(t.state,t.version);return e instanceof Promise?e.then(t=>[!0,t]):[!0,e]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(t=>{var e;const[r,s]=t;if(p=i.merge(s,null!=(e=n())?e:u),a(p,!0),r)return d()}).then(()=>{null==r||r(p,void 0),p=n(),s=!0,l.forEach(t=>t(p))}).catch(t=>{null==r||r(void 0,t)})};return r.persist={setOptions:t=>{i={...i,...t},t.storage&&(c=t.storage)},clearStorage:()=>{null==c||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>m(),hasHydrated:()=>s,onHydrate:t=>(o.add(t),()=>{o.delete(t)}),onFinishHydration:t=>(l.add(t),()=>{l.delete(t)})},i.skipHydration||m(),p||u},P={PORTAL_URL:"https://portal.lazor.sh",PAYMASTER_URL:"https://lazorkit-paymaster.onrender.com",RPC_ENDPOINT:"https://api.devnet.solana.com"},D={CONNECT:"connect",SIGN:"sign"},W="confirmed",E={WALLET:"lazorkit-wallet",CREDENTIALS:"lazorkit-credentials",PUBLIC_KEY:"PUBLIC_KEY",CREDENTIAL_ID:"CREDENTIAL_ID",SMART_WALLET_ADDRESS:"SMART_WALLET_ADDRESS"},B={getItem:async t=>{try{if("undefined"==typeof window)return null;return localStorage.getItem(t)}catch(e){return console.error("Error reading from localStorage:",e,{key:t}),null}},setItem:async(t,e)=>{try{if("undefined"==typeof window)return;localStorage.setItem(t,e)}catch(a){console.error("Error writing to localStorage:",a,{key:t,valueLength:e.length})}},removeItem:async t=>{try{if("undefined"==typeof window)return;localStorage.removeItem(t)}catch(e){console.error("Error removing from localStorage:",e,{key:t})}}};class x{static async saveWallet(t){try{await B.setItem(E.WALLET,JSON.stringify(t)),await B.setItem(E.CREDENTIAL_ID,t.credentialId),await B.setItem(E.SMART_WALLET_ADDRESS,t.smartWallet),await B.setItem(E.PUBLIC_KEY,u.from(t.passkeyPubkey).toString("base64"))}catch(t){throw console.error("Failed to save wallet to storage:",t),t}}static async getWallet(){try{const t=await B.getItem(E.WALLET);return t?JSON.parse(t):null}catch(t){return console.error("Failed to get wallet from storage:",t),null}}static async saveConfig(t){try{await B.setItem("lazorkit-config",JSON.stringify(t))}catch(t){throw console.error("Failed to save config to storage:",t),t}}static async getConfig(){try{const t=await B.getItem("lazorkit-config");return t?JSON.parse(t):null}catch(t){return console.error("Failed to get config from storage:",t),null}}static async clearWallet(){try{await B.removeItem(E.WALLET),await B.removeItem(E.CREDENTIAL_ID),await B.removeItem(E.SMART_WALLET_ADDRESS),await B.removeItem(E.PUBLIC_KEY),await B.removeItem("CREDENTIALS_TIMESTAMP")}catch(t){throw console.error("Failed to clear wallet from storage:",t),t}}static async getItem(t){return await B.getItem(t)}static async setItem(t,e){await B.setItem(t,e)}static async removeItem(t){await B.removeItem(t)}}class U{constructor(t){this.context=t,this.enabled="production"!==process.env.NODE_ENV}debug(t,e){this.enabled&&console.debug(`[${this.context}] ${t}`,e)}info(t,e){console.info(`[${this.context}] ${t}`,e)}warn(t,e){console.warn(`[${this.context}] ${t}`,e)}error(t,e){console.error(`[${this.context}] ${t}`,e)}}class R{constructor(t){this.logger=new U("Paymaster"),this.endpoint=t.paymasterUrl,this.apiKey=t.apiKey}getHeaders(){const t={"Content-Type":"application/json"};return this.apiKey&&(t["x-api-key"]=this.apiKey),t}async getPayer(){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",id:1,method:"getPayerSigner",params:[]})});if(!t.ok)throw new Error(`Failed to get payer: ${t.statusText}`);const e=await t.json();return new r(e.result.signer_address)}catch(t){throw this.logger.error("Failed to get payer",t),t}}async getBlockhash(){try{const t=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"getBlockhash",id:1,params:[]})});if(!t.ok)throw new Error(`Failed to get blockhash: ${t.statusText}`);return(await t.json()).result.blockhash}catch(t){throw this.logger.error("Failed to get blockhash",t),t}}async attemptSign(t,e=1){try{const e=t.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signTransaction",id:1,params:[e.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign transaction: ${a.statusText}`);const n=await a.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return i.from(u.from(n.result.signed_transaction,"base64"))}catch(t){throw this.logger.error(`Sign attempt ${e} failed:`,t),t}}async sign(t,e=3,a=1e3){for(let n=1;n<=e;n++)try{return await this.attemptSign(t,n)}catch(t){if(n===e)throw this.logger.error("All sign retry attempts failed",t),t;const r=a*Math.pow(2,n-1);this.logger.info(`Retrying sign in ${r}ms (attempt ${n}/${e})`),await new Promise(t=>setTimeout(t,r))}throw new Error("Failed to sign transaction after all retries")}async attemptSignAndSend(t,e=1){try{const e=t.serialize({verifySignatures:!1,requireAllSignatures:!1}),a=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[e.toString("base64")]})});if(!a.ok)throw new Error(`Failed to sign and send transaction: ${a.statusText}`);const n=await a.json();if(n.error)throw new Error(n.error.message||"Unknown paymaster error");return n.result.signature}catch(t){throw this.logger.error(`Attempt ${e} failed:`,t),t}}async signAndSend(t,e=3,a=1e3){for(let n=1;n<=e;n++)try{return await this.attemptSignAndSend(t,n)}catch(t){if(n===e)throw this.logger.error("All retry attempts failed",t),t;const r=a*Math.pow(2,n-1);this.logger.info(`Retrying in ${r}ms (attempt ${n}/${e})`),await new Promise(t=>setTimeout(t,r))}throw new Error("Failed to sign and send transaction after all retries")}async attemptSignAndSendVersionedTransaction(t,e=1){try{const e=await fetch(`${this.endpoint}`,{method:"POST",headers:this.getHeaders(),body:JSON.stringify({jsonrpc:"2.0",method:"signAndSendTransaction",id:1,params:[u.from(t.serialize()).toString("base64")]})});if(!e.ok)throw new Error(`Failed to sign and send transaction: ${e.statusText}`);const a=await e.json();if(a.error)throw new Error(a.error.message||"Unknown paymaster error");return a.result.signature}catch(t){throw this.logger.error(`Attempt ${e} failed:`,t),t}}async signAndSendVersionedTransaction(t,e=3,a=1e3){for(let n=1;n<=e;n++)try{return await this.attemptSignAndSendVersionedTransaction(t,n)}catch(t){if(n===e)throw this.logger.error("All retry attempts failed",t),t;const r=a*Math.pow(2,n-1);this.logger.info(`Retrying in ${r}ms (attempt ${n}/${e})`),await new Promise(t=>setTimeout(t,r))}throw new Error("Failed to sign and send transaction after all retries")}}var T,M={address:"Gsuz7YcA5sbMGVRXT3xSYhJBessW4xFC4xYsihNCqMFh",metadata:{name:"lazorkit",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},docs:["LazorKit: Smart Wallet with WebAuthn Passkey Authentication"],instructions:[{name:"close_chunk",discriminator:[150,183,213,198,0,74,14,170],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0}],args:[]},{name:"create_chunk",discriminator:[83,226,15,219,9,19,186,90],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"wallet_state.last_nonce",account:"WalletState"}]}},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateChunkArgs"}}}]},{name:"create_smart_wallet",discriminator:[129,39,235,18,132,68,203,19],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"arg",path:"args.wallet_id"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"policy_program"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"CreateSmartWalletArgs"}}}]},{name:"delete_smart_wallet",discriminator:[126,239,172,118,134,32,52,102],accounts:[{name:"payer",writable:!0,signer:!0,address:"BE8duRBDmh4cF4Ecz4TBCNgNAMCaonrpQiEiQ1xfQmab"},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[]},{name:"execute",discriminator:[130,221,242,154,13,193,189,29],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",writable:!0,pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"wallet_device"},{name:"policy_program"},{name:"cpi_program"},{name:"ix_sysvar",address:"Sysvar1nstructions1111111111111111111111111"},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"args",type:{defined:{name:"ExecuteArgs"}}}]},{name:"execute_chunk",discriminator:[106,83,113,47,89,243,39,220],accounts:[{name:"payer",writable:!0,signer:!0},{name:"smart_wallet",writable:!0,pda:{seeds:[{kind:"const",value:[115,109,97,114,116,95,119,97,108,108,101,116]},{kind:"account",path:"wallet_state.wallet_id",account:"WalletState"}]}},{name:"wallet_state",pda:{seeds:[{kind:"const",value:[119,97,108,108,101,116,95,115,116,97,116,101]},{kind:"account",path:"smart_wallet"}]}},{name:"chunk",writable:!0,pda:{seeds:[{kind:"const",value:[99,104,117,110,107]},{kind:"account",path:"smart_wallet"},{kind:"account",path:"chunk.authorized_nonce",account:"Chunk"}]}},{name:"session_refund",writable:!0},{name:"system_program",address:"11111111111111111111111111111111"}],args:[{name:"instruction_data_list",type:{vec:"bytes"}},{name:"split_index",type:"bytes"}]}],accounts:[{name:"Chunk",discriminator:[134,67,80,65,135,143,156,196]},{name:"WalletDevice",discriminator:[35,85,31,31,179,48,136,123]},{name:"WalletState",discriminator:[126,186,0,158,92,223,167,68]}],errors:[{code:6e3,name:"PasskeyMismatch",msg:"Passkey public key mismatch with stored authenticator"},{code:6001,name:"InvalidPolicyDataSize",msg:"Invalid policy data size"},{code:6002,name:"Secp256r1InvalidLength",msg:"Secp256r1 instruction has invalid data length"},{code:6003,name:"Secp256r1HeaderMismatch",msg:"Secp256r1 instruction header validation failed"},{code:6004,name:"Secp256r1DataMismatch",msg:"Secp256r1 signature data validation failed"},{code:6005,name:"InvalidSignature",msg:"Invalid signature provided for passkey verification"},{code:6006,name:"ClientDataInvalidUtf8",msg:"Client data JSON is not valid UTF-8"},{code:6007,name:"ClientDataJsonParseError",msg:"Client data JSON parsing failed"},{code:6008,name:"ChallengeMissing",msg:"Challenge field missing from client data JSON"},{code:6009,name:"ChallengeBase64DecodeError",msg:"Challenge base64 decoding failed"},{code:6010,name:"ChallengeDeserializationError",msg:"Challenge message deserialization failed"},{code:6011,name:"HashMismatch",msg:"Message hash mismatch: expected different value"},{code:6012,name:"InvalidInstructionDiscriminator",msg:"Invalid instruction discriminator"},{code:6013,name:"InsufficientCpiAccounts",msg:"Insufficient remaining accounts for CPI instruction"},{code:6014,name:"AccountSliceOutOfBounds",msg:"Account slice index out of bounds"},{code:6015,name:"InvalidAccountOwner",msg:"Account owner verification failed"},{code:6016,name:"ProgramNotExecutable",msg:"Program not executable"},{code:6017,name:"CredentialIdEmpty",msg:"Credential ID cannot be empty"},{code:6018,name:"PolicyDataTooLarge",msg:"Policy data exceeds maximum allowed size"},{code:6019,name:"TransactionTooOld",msg:"Transaction is too old"},{code:6020,name:"InvalidInstructionData",msg:"Invalid instruction data"},{code:6021,name:"InvalidInstruction",msg:"Invalid instruction"},{code:6022,name:"InsufficientBalanceForFee",msg:"Insufficient balance for fee"},{code:6023,name:"InvalidSequenceNumber",msg:"Invalid sequence number"},{code:6024,name:"InvalidPasskeyFormat",msg:"Invalid passkey format"},{code:6025,name:"ReentrancyDetected",msg:"Reentrancy detected"},{code:6026,name:"UnauthorizedAdmin",msg:"Unauthorized admin"}],types:[{name:"Chunk",docs:["Transaction chunk for deferred execution","","Created after full passkey and policy verification. Contains all bindings","necessary to execute the transaction later without re-verification.","Used for large transactions that need to be split into manageable chunks."],type:{kind:"struct",fields:[{name:"owner_wallet_address",docs:["Smart wallet address that authorized this chunk session"],type:"pubkey"},{name:"cpi_hash",docs:["Combined SHA256 hash of all cpi transaction instruction data"],type:{array:["u8",32]}},{name:"authorized_nonce",docs:["The nonce that was authorized at chunk creation (bound into data hash)"],type:"u64"},{name:"authorized_timestamp",docs:["Timestamp from the original message hash for expiration validation"],type:"i64"},{name:"rent_refund_address",docs:["Address to receive rent refund when closing the chunk session"],type:"pubkey"}]}},{name:"CreateChunkArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"policy_data",type:"bytes"},{name:"timestamp",type:"i64"},{name:"cpi_hash",type:{array:["u8",32]}}]}},{name:"CreateSmartWalletArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"init_policy_data",type:"bytes"},{name:"wallet_id",type:"u64"},{name:"amount",type:"u64"},{name:"policy_data_size",type:"u16"}]}},{name:"ExecuteArgs",type:{kind:"struct",fields:[{name:"passkey_public_key",type:{array:["u8",33]}},{name:"signature",type:{array:["u8",64]}},{name:"client_data_json_raw",type:"bytes"},{name:"authenticator_data_raw",type:"bytes"},{name:"verify_instruction_index",type:"u8"},{name:"split_index",type:"u16"},{name:"policy_data",type:"bytes"},{name:"cpi_data",type:"bytes"},{name:"timestamp",type:"i64"}]}},{name:"WalletDevice",docs:["Wallet device account linking a passkey to a smart wallet"],type:{kind:"struct",fields:[{name:"passkey_pubkey",docs:["Secp256r1 compressed public key (33 bytes)"],type:{array:["u8",33]}},{name:"credential_hash",docs:["SHA256 hash of the credential ID"],type:{array:["u8",32]}},{name:"smart_wallet",docs:["Associated smart wallet address"],type:"pubkey"},{name:"bump",docs:["PDA bump seed"],type:"u8"}]}},{name:"WalletState",docs:["Wallet state account storing wallet configuration and execution state"],type:{kind:"struct",fields:[{name:"bump",docs:["PDA bump seed for smart wallet"],type:"u8"},{name:"wallet_id",docs:["Unique wallet identifier"],type:"u64"},{name:"last_nonce",docs:["Last used nonce for anti-replay protection"],type:"u64"},{name:"policy_program",docs:["Policy program that validates transactions"],type:"pubkey"},{name:"policy_data",docs:["Serialized policy data returned from policy initialization"],type:"bytes"}]}}]};function H(t,e){return t.keys.map(t=>({pubkey:t.pubkey,isWritable:t.isWritable,isSigner:!!e&&e.some(e=>e.toString()===t.pubkey.toString())}))}function Q(t){if("function"==typeof globalThis.crypto?.getRandomValues){const e=new Uint8Array(t);return globalThis.crypto.getRandomValues(e),e}try{const{randomBytes:e}=require("crypto");return e(t)}catch{throw new Error("No CSPRNG available")}}function N(t,e){if(t.length!==e.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==e[a])return!1;return!0}function K(t){const e=u.from(t,"base64");return Array.from(new Uint8Array(p.arrayBuffer(e)))}async function O(t){const e=await t.getSlot(),a=await t.getBlockTime(e);return new A.BN(a||Math.floor(Date.now()/1e3))}function z(t){return t}function F(t){return t}function V(t){return t}!function(t){t.Execute="execute",t.CreateChunk="create_chunk",t.ExecuteChunk="execute_chunk"}(T||(T={}));var L={address:"BiE9vSdz9MidUiyjVYsu3PG4C1fbPZ8CVPADA9jRfXw7",metadata:{name:"default_policy",version:"0.1.0",spec:"0.1.0",description:"Created with Anchor"},instructions:[{name:"check_policy",discriminator:[28,88,170,179,239,136,25,35],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet"}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}},{name:"policy_data",type:"bytes"}]},{name:"init_policy",discriminator:[45,234,110,100,209,146,191,86],accounts:[{name:"policy_signer",signer:!0},{name:"smart_wallet",writable:!0},{name:"wallet_state",writable:!0}],args:[{name:"wallet_id",type:"u64"},{name:"passkey_public_key",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}],returns:{defined:{name:"PolicyStruct"}}}],errors:[{code:6e3,name:"InvalidPasskey",msg:"Invalid passkey format"},{code:6001,name:"Unauthorized",msg:"Unauthorized to access smart wallet"}],types:[{name:"DeviceSlot",type:{kind:"struct",fields:[{name:"passkey_pubkey",type:{array:["u8",33]}},{name:"credential_hash",type:{array:["u8",32]}}]}},{name:"PolicyStruct",type:{kind:"struct",fields:[{name:"bump",type:"u8"},{name:"smart_wallet",type:"pubkey"},{name:"device_slots",type:{vec:{defined:{name:"DeviceSlot"}}}}]}}]};const j=u.from("policy");const _=890880,G=33,J=32,Z=64;class Y extends Error{constructor(t,e){super(t),this.field=e,this.name="ValidationError"}}function X(t,e){if(null==t||void 0===t){throw new Y(`${e} is required but was ${null===t?"null":"undefined"}`,e)}}function q(t,e){X(t,e);try{if("string"==typeof t){if(0===t.trim().length)throw new Y(`${e} cannot be an empty string`,e);new A.web3.PublicKey(t)}else{if(!(t instanceof A.web3.PublicKey||t&&"object"==typeof t&&"toBase58"in t&&"function"==typeof t.toBase58&&"toBytes"in t&&"function"==typeof t.toBytes))throw new Y(`${e} must be a PublicKey instance or valid base58 string`,e)}}catch(t){if(t instanceof Y)throw t;throw new Y(`${e} is not a valid PublicKey: ${t instanceof Error?t.message:"Invalid format"}`,e)}}function $(t,e,a){let n;if(X(t,a),Array.isArray(t))n=t;else if(t instanceof Uint8Array)n=Array.from(t);else{if(!t||"object"!=typeof t||"number"!=typeof t.length)throw new Y(`${a} must be an array or Uint8Array`,a);n=Array.from(t)}if(n.length!==e)throw new Y(`${a} must be exactly ${e} bytes, got ${n.length}`,a);for(let t=0;t<n.length;t++){const e=n[t];if("number"!=typeof e||!Number.isFinite(e)||!Number.isInteger(e)||e<0||e>255)throw new Y(`${a}[${t}] must be a valid byte (0-255), got ${"number"==typeof e?e:typeof e}`,a)}}function tt(t,e){X(t,e);if(0===(Array.isArray(t)?t:Array.from(t)).length)throw new Y(`${e} cannot be empty`,e)}function et(t,e="passkeyPublicKey"){$(t,33,e)}function at(t,e="passkeyPublicKey"){return et(t,e),Array.isArray(t)?t:Array.from(t)}function nt(t,e="credentialHash"){$(t,32,e)}function rt(t,e="credentialHash"){return nt(t,e),Array.isArray(t)?t:Array.from(t)}function it(t,e="signature"){$(t,64,e)}function st(t,e="signature"){return it(t,e),Array.isArray(t)?t:Array.from(t)}function ot(t,e){X(t,e);if(!(t instanceof A.BN||t&&"object"==typeof t&&"lt"in t&&"function"==typeof t.lt&&"toString"in t&&"function"==typeof t.toString))throw new Y(`${e} must be a BN instance`,e);if(t.lt(new A.BN(0)))throw new Y(`${e} must be non-negative, got ${t.toString()}`,e)}function lt(t,e){if(X(t,e),"number"!=typeof t||!Number.isFinite(t)||Number.isNaN(t))throw new Y(`${e} must be a finite number (got ${Number.isNaN(t)?"NaN":Number.isFinite(t)?typeof t:t===1/0?"Infinity":"-Infinity"})`,e);if(t<0)throw new Y(`${e} must be non-negative, got ${t}`,e)}function ct(t,e){if(X(t,e),"string"!=typeof t)throw new Y(`${e} must be a string (got ${typeof t})`,e);if(0===String(t).trim().length)throw new Y(`${e} cannot be empty`,e)}function dt(t,e){if(X(t,e),!Array.isArray(t))throw new Y(`${e} must be an array (got ${typeof t}${t&&"object"==typeof t?` with constructor ${t.constructor?.name||"unknown"}`:""})`,e);if(0===t.length)throw new Y(`${e} cannot be empty`,e)}function At(t,e){X(t,e);if(!(t instanceof A.web3.TransactionInstruction||t&&"object"==typeof t&&"programId"in t&&"keys"in t&&Array.isArray(t.keys)&&"data"in t))throw new Y(`${e} must be a TransactionInstruction instance`,e);if(q(t.programId,`${e}.programId`),!t.keys||!Array.isArray(t.keys)||0===t.keys.length)throw new Y(`${e} must have at least one account key`,e)}function ut(t){return Array.isArray(t)?t:Array.from(t)}function pt(t,e="publicKey"){return q(t,e),"string"==typeof t?new A.web3.PublicKey(t):t}function mt(t,e){ct(t,e);if(!/^[A-Za-z0-9+/]*={0,2}$/.test(t))throw new Y(`${e} is not a valid base64 string (invalid characters)`,e);try{"undefined"!=typeof Buffer&&Buffer.from?Buffer.from(t,"base64"):"undefined"!=typeof atob&&atob(t)}catch(t){throw new Y(`${e} is not a valid base64 string: ${t instanceof Error?t.message:"Invalid format"}`,e)}}function gt(t,e){if(X(t,e),"number"!=typeof t||!Number.isFinite(t)||Number.isNaN(t))throw new Y(`${e} must be a finite number (got ${Number.isNaN(t)?"NaN":Number.isFinite(t)?typeof t:t===1/0?"Infinity":"-Infinity"})`,e);if(!Number.isInteger(t))throw new Y(`${e} must be an integer, got ${t}`,e);if(t<=0)throw new Y(`${e} must be a positive integer, got ${t}`,e)}function ht(t,e){dt(t,e),t.forEach((t,a)=>{q(t,`${e}[${a}]`)})}function yt(t,e){dt(t,e),t.forEach((t,a)=>{At(t,`${e}[${a}]`)})}function ft(t){return Array.isArray(t)?[...t]:Array.from(t)}class wt{constructor(t){X(t,"connection"),this.connection=t,this.program=new A.Program(L,{connection:t}),this.programId=this.program.programId}policyPda(t){return q(t,"smartWallet"),function(t,e){return A.web3.PublicKey.findProgramAddressSync([j,e.toBuffer()],t)[0]}(this.programId,t)}getPolicyDataSize(){return 102}validateInitPolicyParams(t){X(t,"params"),ot(t.walletId,"params.walletId"),et(t.passkeyPublicKey,"params.passkeyPublicKey"),nt(t.credentialHash,"params.credentialHash"),q(t.policySigner,"params.policySigner"),q(t.smartWallet,"params.smartWallet"),q(t.walletState,"params.walletState")}async buildInitPolicyIx(t){return this.validateInitPolicyParams(t),await this.program.methods.initPolicy(t.walletId,ft(t.passkeyPublicKey),ft(t.credentialHash)).accountsPartial({smartWallet:t.smartWallet,walletState:t.walletState,policySigner:t.policySigner}).instruction()}validateCheckPolicyParams(t){if(X(t,"params"),ot(t.walletId,"params.walletId"),et(t.passkeyPublicKey,"params.passkeyPublicKey"),q(t.policySigner,"params.policySigner"),q(t.smartWallet,"params.smartWallet"),nt(t.credentialHash,"params.credentialHash"),X(t.policyData,"params.policyData"),!Buffer.isBuffer(t.policyData))throw new Y("params.policyData must be a Buffer instance","params.policyData")}async buildCheckPolicyIx(t){return this.validateCheckPolicyParams(t),await this.program.methods.checkPolicy(t.walletId,ft(t.passkeyPublicKey),ft(t.credentialHash),t.policyData).accountsPartial({smartWallet:t.smartWallet,policySigner:t.policySigner}).instruction()}}function bt(t,e){const a=u.concat([t.toBuffer(),u.from(e)]),n=p.arrayBuffer(a);return u.from(n).subarray(0,32)}const kt=32,St=new A.web3.PublicKey("Secp256r1SigVerify1111111111111111111111111"),It=new Uint8Array([255,255,255,255,0,0,0,0,255,255,255,255,255,255,255,255,188,230,250,173,167,23,158,132,243,185,202,194,252,99,37,81]),vt=new Uint8Array([127,255,255,255,128,0,0,0,127,255,255,255,255,255,255,255,222,115,125,86,211,139,207,66,121,220,229,97,126,49,146,168]);function Ct(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);{const e=new ArrayBuffer(2*Object.values(t).length),a=new DataView(e);return Object.values(t).forEach((t,e)=>{a.setUint16(2*e,t,!0)}),new Uint8Array(e)}}function Pt(t,e,a){try{const n=a.slice(0,kt),r=a.slice(kt,64),i=u.alloc(kt,0),s=u.alloc(kt,0);if(n.copy(i,kt-n.length),r.copy(s,kt-r.length),function(t,e){if(t.length!==e.length)return t.length>e.length;for(let a=0;a<t.length;a++)if(t[a]!==e[a])return t[a]>e[a];return!1}(s,vt)){const t=function(t,e){const a=new Uint8Array(t.length);let n=0;for(let r=t.length-1;r>=0;r--){let i=t[r]-e[r]-n;i<0?(i+=256,n=1):n=0,a[r]=i}return a}(It,s);a=u.concat([i,u.from(t)])}else a=u.concat([i,s]);if(33!==e.length||64!==a.length)throw new Error("Invalid key or signature length");const o=113+t.length,l=new Uint8Array(o),c=1,d=16,p=d+33,m=p+64;l.set(Ct([c,0]),0);const g={signature_offset:p,signature_instruction_index:65535,public_key_offset:d,public_key_instruction_index:65535,message_data_offset:m,message_data_size:t.length,message_instruction_index:65535};return l.set(Ct(g),2),l.set(e,d),l.set(a,p),l.set(t,m),new A.web3.TransactionInstruction({keys:[],programId:St,data:u.from(l)})}catch(t){throw new Error(`Failed to create secp256r1 instruction: ${t}`)}}const Dt=u.from("smart_wallet"),Wt=u.from("wallet_state"),Et=u.from("wallet_device"),Bt=u.from("chunk");function xt(t,e){return A.web3.PublicKey.findProgramAddressSync([Dt,e.toArrayLike(u,"le",8)],t)[0]}function Ut(t,e){return A.web3.PublicKey.findProgramAddressSync([Wt,e.toBuffer()],t)[0]}function Rt(t,e,a){return A.web3.PublicKey.findProgramAddressSync([Et,bt(e,a)],t)}function Tt(t,e,a){return A.web3.PublicKey.findProgramAddressSync([Bt,e.toBuffer(),a.toArrayLike(u,"le",8)],t)[0]}class Mt{constructor(t){this.programId=t}smartWallet(t){return ot(t,"walletId"),xt(this.programId,t)}walletState(t){return q(t,"smartWallet"),Ut(this.programId,t)}walletDevice(t,e){return q(t,"smartWallet"),nt(e,"credentialHash"),Rt(this.programId,t,e)[0]}chunk(t,e){return q(t,"smartWallet"),Tt(this.programId,t,e)}}class Ht{constructor(t,e){this.policyClient=t,this.walletPdas=e}async resolveForExecute({provided:t,smartWallet:e,credentialHash:a,passkeyPublicKey:n,walletStateData:r}){if(null!==t)return t;const i=this.walletPdas.walletDevice(e,a);return this.policyClient.buildCheckPolicyIx({walletId:r.walletId,passkeyPublicKey:n,policySigner:i,smartWallet:e,credentialHash:a,policyData:r.policyData})}async resolveForCreate({provided:t,smartWalletId:e,smartWallet:a,walletState:n,passkeyPublicKey:r,credentialHash:i}){if(null!=t)return t;const s=this.walletPdas.walletDevice(a,i);return this.policyClient.buildInitPolicyIx({walletId:e,passkeyPublicKey:r,credentialHash:i,policySigner:s,smartWallet:a,walletState:n})}}let Qt=null;const Nt=t=>new Uint8Array(p.arrayBuffer(t)),Kt=(t,e,a)=>{const n=p.create();n.update(t.toBytes());for(const t of e)n.update(t.pubkey.toBytes()),n.update(Uint8Array.from([t.isSigner?1:0])),n.update(Uint8Array.from([t.pubkey.toString()===a.toString()||t.isWritable?1:0]));return new Uint8Array(n.arrayBuffer())},Ot=(t,e)=>{const a=H(t),n=Kt(t.programId,a,e);return{policyDataHash:Nt(t.data),policyAccountsHash:n}},zt=(t,e,a)=>{const n=u.alloc(4);n.writeUInt32LE(t.length,0);const r=u.concat([n,...t.map(t=>{const e=u.from(t.data),a=u.alloc(4);return a.writeUInt32LE(e.length,0),u.concat([a,e])})]),i=Nt(r),s=((t,e)=>{const a=new Map;for(const e of t){const t=e.pubkey.toString(),n=a.get(t);n?(n.isSigner=n.isSigner||e.isSigner,n.isWritable=n.isWritable||e.isWritable):a.set(t,{isSigner:e.isSigner,isWritable:e.isWritable})}const n=t.map(t=>{const e=t.pubkey.toString(),n=a.get(e);return{pubkey:t.pubkey,isSigner:n.isSigner,isWritable:n.isWritable}}),r=p.create();for(const t of n)r.update(t.pubkey.toBytes()),r.update(Uint8Array.from([t.isSigner?1:0])),r.update(Uint8Array.from([t.pubkey.toString()===e.toString()||t.isWritable?1:0]));return new Uint8Array(r.arrayBuffer())})(t.flatMap(t=>[{pubkey:t.programId,isSigner:!1,isWritable:!1},...H(t,a)]),e);return{cpiDataHash:i,cpiAccountsHash:s}},Ft=(t,e)=>{try{const a=(Qt||(Qt=new A.BorshCoder({version:"0.1.0",name:"lazorkit_msgs",instructions:[],accounts:[],types:[{name:"SimpleMessage",type:{kind:"struct",fields:[{name:"dataHash",type:{array:["u8",32]}}]}}]})),Qt).types.encode(t,e);return u.from(a)}catch(e){throw new Error(`Failed to encode ${t}: ${e instanceof Error?e.message:"Unknown error"}`)}};function Vt(t,e,a,n,r,i){const s=Ot(n,t),o=((t,e,a)=>{const n=H(t,a),r=Kt(t.programId,n,e);return{cpiDataHash:Nt(t.data),cpiAccountsHash:r}})(r,t,i??[]),l=new Uint8Array(64);l.set(s.policyDataHash,0),l.set(s.policyAccountsHash,32);const c=Nt(l),d=new Uint8Array(64);d.set(o.cpiDataHash,0),d.set(o.cpiAccountsHash,32);const A=Nt(d),p=u.alloc(8);p.writeBigUInt64LE(BigInt(e.toString()),0);const m=u.alloc(8);m.writeBigInt64LE(BigInt(a.toString()),0);const g=u.concat([p,m,u.from(c),u.from(A)]),h=Nt(g);return Ft("SimpleMessage",{dataHash:Array.from(h)})}function Lt(t,e,a,n,r,i){const s=Ot(n,t),o=zt(r,t,i),l=new Uint8Array(64);l.set(s.policyDataHash,0),l.set(s.policyAccountsHash,32);const c=Nt(l),d=new Uint8Array(64);d.set(o.cpiDataHash,0),d.set(o.cpiAccountsHash,32);const A=Nt(d),p=u.alloc(8);p.writeBigUInt64LE(BigInt(e.toString()),0);const m=u.alloc(8);m.writeBigInt64LE(BigInt(a.toString()),0);const g=u.concat([p,m,u.from(c),u.from(A)]),h=Nt(g);return Ft("SimpleMessage",{dataHash:Array.from(h)})}function jt(t){et(t.passkeyPublicKey,"passkeySignature.passkeyPublicKey"),mt(t.signature64,"passkeySignature.signature64"),mt(t.clientDataJsonRaw64,"passkeySignature.clientDataJsonRaw64"),mt(t.authenticatorDataRaw64,"passkeySignature.authenticatorDataRaw64");const e=Buffer.from(t.authenticatorDataRaw64,"base64"),a=Buffer.from(t.clientDataJsonRaw64,"base64"),n=Buffer.from(t.signature64,"base64");it(ut(n),"passkeySignature.signature64 (decoded)");const r=Buffer.concat([e,Buffer.from(p.arrayBuffer(a))]);return Pt(Buffer.from(p.arrayBuffer(r)),t.passkeyPublicKey,n)}function _t(t){const e=Buffer.from(t.signature64,"base64");return it(ut(e),"passkeySignature.signature64 (decoded)"),{passkeyPublicKey:t.passkeyPublicKey,signature:ut(e),clientDataJsonRaw:Buffer.from(t.clientDataJsonRaw64,"base64"),authenticatorDataRaw:Buffer.from(t.authenticatorDataRaw64,"base64")}}function Gt(t){return A.web3.ComputeBudgetProgram.setComputeUnitLimit({units:t})}function Jt(t,e){return void 0===e?t:[Gt(e),...t]}function Zt(t,e){return[t,...e]}function Yt(t,e,a){return Jt([t,...e],a)}function Xt(t){return void 0!==t?1:0}async function qt(t,e,a,n={}){const{addressLookupTables:r,recentBlockhash:i,computeUnitLimit:s}=n,o=Jt(a,s),l=r||[],c=i||(await t.getLatestBlockhash()).blockhash;if(l.length>0){console.log("lookupTables in buildTransaction",l);const t=new A.web3.TransactionMessage({payerKey:e,recentBlockhash:c,instructions:o}).compileToV0Message(l);return{transaction:new A.web3.VersionedTransaction(t),isVersioned:!0,recentBlockhash:c}}{const t=(new A.web3.Transaction).add(...o);return t.feePayer=e,t.recentBlockhash=c,{transaction:t,isVersioned:!1,recentBlockhash:c}}}"undefined"!=typeof globalThis&&(globalThis.Buffer=u),u.prototype.subarray=function(t,e){const a=Uint8Array.prototype.subarray.apply(this,[t,e]);return Object.setPrototypeOf(a,u.prototype),a};class $t{constructor(t){this.connection=t,this.program=new A.Program(M,{connection:t}),this.programId=this.program.programId,this.defaultPolicyProgram=new wt(t),this.walletPdas=new Mt(this.programId),this.policyResolver=new Ht(this.defaultPolicyProgram,this.walletPdas)}getSmartWalletPubkey(t){return this.walletPdas.smartWallet(t)}getWalletStatePubkey(t){return this.walletPdas.walletState(t)}getWalletDevicePubkey(t,e){return this.walletPdas.walletDevice(t,e)}getChunkPubkey(t,e){return this.walletPdas.chunk(t,e)}generateWalletId(){return new A.BN(Q(8),"le")}async fetchWalletStateContext(t){const e=this.getWalletStatePubkey(t);return{walletState:e,data:await this.program.account.walletState.fetch(e)}}async fetchChunkContext(t,e){const a=this.getChunkPubkey(t,e);return{chunk:a,data:await this.program.account.chunk.fetch(a)}}validateCreateSmartWalletParams(t){X(t,"params"),q(t.payer,"params.payer"),et(t.passkeyPublicKey,"params.passkeyPublicKey"),mt(t.credentialIdBase64,"params.credentialIdBase64"),void 0!==t.amount&&ot(t.amount,"params.amount"),void 0!==t.smartWalletId&&ot(t.smartWalletId,"params.smartWalletId"),void 0!==t.policyDataSize&&gt(t.policyDataSize,"params.policyDataSize"),null!==t.policyInstruction&&void 0!==t.policyInstruction&&At(t.policyInstruction,"params.policyInstruction")}validateExecuteParams(t){X(t,"params"),q(t.payer,"params.payer"),q(t.smartWallet,"params.smartWallet"),nt(t.credentialHash,"params.credentialHash"),At(t.cpiInstruction,"params.cpiInstruction"),ot(t.timestamp,"params.timestamp"),null!==t.policyInstruction&&At(t.policyInstruction,"params.policyInstruction")}validateCreateChunkParams(t){X(t,"params"),q(t.payer,"params.payer"),q(t.smartWallet,"params.smartWallet"),nt(t.credentialHash,"params.credentialHash"),yt(t.cpiInstructions,"params.cpiInstructions"),ot(t.timestamp,"params.timestamp"),null!==t.policyInstruction&&At(t.policyInstruction,"params.policyInstruction"),void 0!==t.cpiSigners&&ht(t.cpiSigners,"params.cpiSigners")}validateExecuteChunkParams(t){X(t,"params"),q(t.payer,"params.payer"),q(t.smartWallet,"params.smartWallet"),yt(t.cpiInstructions,"params.cpiInstructions"),void 0!==t.cpiSigners&&ht(t.cpiSigners,"params.cpiSigners")}validateCloseChunkParams(t){X(t,"params"),q(t.payer,"params.payer"),q(t.smartWallet,"params.smartWallet"),ot(t.nonce,"params.nonce")}async getWalletStateData(t){const{data:e}=await this.fetchWalletStateContext(t);return e}async getChunkData(t){return await this.program.account.chunk.fetch(t)}async getSmartWalletByPasskey(t){et(t,"passkeyPublicKey");const e=M.accounts?.find(t=>"WalletState"===t.name)?.discriminator;if(!e)throw new Y("WalletState discriminator not found in IDL","passkeyPublicKey");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:m.encode(e)}}]});for(const e of a)try{const a=this.program.coder.accounts.decode("WalletState",e.account.data);for(const n of a.devices)if(N(n.passkeyPubkey,t)){return{smartWallet:this.getSmartWalletPubkey(a.walletId),walletState:e.pubkey,deviceSlot:{passkeyPubkey:n.passkeyPubkey,credentialHash:n.credentialHash}}}}catch(t){continue}return{smartWallet:null,walletState:null,deviceSlot:null}}async getSmartWalletByCredentialHash(t){nt(t,"credentialHash");const e=M.accounts?.find(t=>"WalletDevice"===t.name)?.discriminator;if(!e)throw new Y("WalletDevice discriminator not found in IDL","credentialHash");const a=await this.connection.getProgramAccounts(this.programId,{filters:[{memcmp:{offset:0,bytes:m.encode(e)}},{memcmp:{offset:41,bytes:m.encode(t)}}]});if(0===a.length)return null;for(const t of a){const e=await this.program.account.walletDevice.fetch(t.pubkey);return{smartWallet:e.smartWallet,walletState:this.getWalletStatePubkey(e.smartWallet),walletDevice:t.pubkey,passkeyPubkey:e.passkeyPubkey}}return null}async buildCreateSmartWalletIns(t,e,a,n){return q(t,"payer"),q(e,"smartWallet"),At(a,"policyInstruction"),X(n,"args"),et(n.passkeyPublicKey,"args.passkeyPublicKey"),nt(n.credentialHash,"args.credentialHash"),ot(n.walletId,"args.walletId"),ot(n.amount,"args.amount"),await this.program.methods.createSmartWallet(n).accountsPartial({payer:t,smartWallet:e,walletState:this.getWalletStatePubkey(e),walletDevice:this.getWalletDevicePubkey(e,n.credentialHash),policyProgram:a.programId,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts([...H(a)]).instruction()}async buildExecuteIns(t,e,a,n,r,i,s){return q(t,"payer"),q(e,"smartWallet"),q(a,"walletDevice"),X(n,"args"),At(r,"policyInstruction"),At(i,"cpiInstruction"),void 0!==s&&ht(s,"cpiSigners"),await this.program.methods.execute(n).accountsPartial({payer:t,smartWallet:e,walletState:this.getWalletStatePubkey(e),walletDevice:a,policyProgram:r.programId,cpiProgram:i.programId,ixSysvar:A.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts([...H(r),...H(i,s)]).instruction()}async buildCreateChunkIns(t,e,a,n,r){q(t,"payer"),q(e,"smartWallet"),q(a,"walletDevice"),X(n,"args"),At(r,"policyInstruction");const{walletState:i,data:s}=await this.fetchWalletStateContext(e),o=this.getChunkPubkey(e,s.lastNonce);return await this.program.methods.createChunk(n).accountsPartial({payer:t,smartWallet:e,walletState:i,walletDevice:a,policyProgram:r.programId,chunk:o,ixSysvar:A.web3.SYSVAR_INSTRUCTIONS_PUBKEY,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts([...H(r)]).instruction()}async buildExecuteChunkIns(t,e,a,n){q(t,"payer"),q(e,"smartWallet"),yt(a,"cpiInstructions"),void 0!==n&&ht(n,"cpiSigners");const{data:r}=await this.fetchWalletStateContext(e),i=r.lastNonce.sub(new A.BN(1)),{chunk:s,data:o}=await this.fetchChunkContext(e,i),l=a.map(t=>u.from(t.data)),c=function(t){const e=[];let a=0;for(let n=0;n<t.length-1;n++)a+=t[n].keys.length+1,e.push(a);return e}(a),d=function(t,e){return t.flatMap(t=>[{pubkey:t.programId,isSigner:!1,isWritable:!1},...H(t,e)])}(a,n);return await this.program.methods.executeChunk(l,u.from(c)).accountsPartial({payer:t,smartWallet:e,walletState:this.getWalletStatePubkey(e),chunk:s,sessionRefund:o.rentRefundAddress,systemProgram:A.web3.SystemProgram.programId}).remainingAccounts(d).instruction()}async buildCloseChunkIns(t,e,a){q(t,"payer"),q(e,"smartWallet"),ot(a,"nonce");const{chunk:n,data:r}=await this.fetchChunkContext(e,a);return await this.program.methods.closeChunk().accountsPartial({payer:t,smartWallet:e,walletState:this.getWalletStatePubkey(e),chunk:n,sessionRefund:r.rentRefundAddress}).instruction()}async createSmartWalletTxn(t,e={}){this.validateCreateSmartWalletParams(t);const a=t.smartWalletId??this.generateWalletId(),n=this.getSmartWalletPubkey(a),r=this.getWalletStatePubkey(n),i=t.amount??new A.BN(_),s=t.policyDataSize??this.defaultPolicyProgram.getPolicyDataSize(),o=K(t.credentialIdBase64),l=await this.policyResolver.resolveForCreate({provided:t.policyInstruction,smartWalletId:a,smartWallet:n,walletState:r,passkeyPublicKey:t.passkeyPublicKey,credentialHash:o}),c={passkeyPublicKey:t.passkeyPublicKey,credentialHash:o,initPolicyData:l.data,walletId:a,amount:i,policyDataSize:s},d=await this.buildCreateSmartWalletIns(t.payer,n,l,c);return{transaction:(await qt(this.connection,t.payer,[d],e)).transaction,smartWalletId:a,smartWallet:n}}async executeTxn(t,e={}){this.validateExecuteParams(t);const a=jt(t.passkeySignature),n=await this.getWalletStateData(t.smartWallet),r=this.getWalletDevicePubkey(t.smartWallet,t.credentialHash),i=await this.policyResolver.resolveForExecute({provided:t.policyInstruction,smartWallet:t.smartWallet,credentialHash:t.credentialHash,passkeyPublicKey:t.passkeySignature.passkeyPublicKey,walletStateData:n}),s=_t(t.passkeySignature),o=Zt(a,[await this.buildExecuteIns(t.payer,t.smartWallet,r,{...s,verifyInstructionIndex:Xt(e.computeUnitLimit),splitIndex:i.keys.length,policyData:i.data,cpiData:t.cpiInstruction.data,timestamp:t.timestamp},i,t.cpiInstruction,[...t.cpiSigners??[],t.payer])]);return(await qt(this.connection,t.payer,o,e)).transaction}async createChunkTxn(t,e={}){this.validateCreateChunkParams(t);const a=jt(t.passkeySignature),n=await this.getWalletStateData(t.smartWallet),r=this.getWalletDevicePubkey(t.smartWallet,t.credentialHash),i=await this.policyResolver.resolveForExecute({provided:t.policyInstruction,smartWallet:t.smartWallet,credentialHash:t.credentialHash,passkeyPublicKey:t.passkeySignature.passkeyPublicKey,walletStateData:n}),s=_t(t.passkeySignature),o=function(t,e,a){const n=zt(t,e,a),r=new Uint8Array(64);return r.set(n.cpiDataHash,0),r.set(n.cpiAccountsHash,32),Array.from(new Uint8Array(p.arrayBuffer(r)))}(t.cpiInstructions,t.smartWallet,[...t.cpiSigners??[],t.payer]),l=Zt(a,[await this.buildCreateChunkIns(t.payer,t.smartWallet,r,{...s,policyData:i.data,verifyInstructionIndex:Xt(e.computeUnitLimit),timestamp:t.timestamp,cpiHash:Array.from(o)},i)]);return(await qt(this.connection,t.payer,l,e)).transaction}async executeChunkTxn(t,e={}){this.validateExecuteChunkParams(t);const a=await this.buildExecuteChunkIns(t.payer,t.smartWallet,t.cpiInstructions,t.cpiSigners);return(await qt(this.connection,t.payer,[a],e)).transaction}async closeChunkTxn(t,e={}){this.validateCloseChunkParams(t);const a=await this.buildCloseChunkIns(t.payer,t.smartWallet,t.nonce);return(await qt(this.connection,t.payer,[a],e)).transaction}async buildAuthorizationMessage(t){let e;const{action:a,smartWallet:n,passkeyPublicKey:r,credentialHash:i,timestamp:s}=t;switch(a.type){case T.Execute:{const{policyInstruction:i,cpiInstruction:o,cpiSigners:l}=a.args,c=await this.getWalletStateData(t.smartWallet),d=await this.policyResolver.resolveForExecute({provided:i,smartWallet:t.smartWallet,credentialHash:t.credentialHash,passkeyPublicKey:r,walletStateData:c});e=Vt(n,(await this.getWalletStateData(n)).lastNonce,s,d,o,[...l??[],t.payer]);break}case T.CreateChunk:{const{policyInstruction:o,cpiInstructions:l,cpiSigners:c}=a.args,d=await this.getWalletStateData(n);if(o)e=Lt(n,d.lastNonce,s,o,l,[...c??[],t.payer]);else{const a=this.getWalletDevicePubkey(n,i),o=await this.defaultPolicyProgram.buildCheckPolicyIx({walletId:d.walletId,passkeyPublicKey:r,policySigner:a,smartWallet:n,credentialHash:i,policyData:d.policyData});e=Lt(n,d.lastNonce,s,o,l,[...c??[],t.payer])}break}default:throw new Y(`Unsupported SmartWalletAction: ${a.type}`,"action.type")}return e}}"function"!=typeof globalThis.structuredClone&&(globalThis.structuredClone=t=>JSON.parse(JSON.stringify(t)));class te extends g{constructor(){super(),this.iframeRef=null,this.retryDelays=[200,400,800,1500,3e3]}setIframeRef(t){this.iframeRef=t}notifyCredentialsUpdated(t){this.emit("credentials-updated",t);const e=new CustomEvent("lazorkit:credentials-updated",{detail:t,bubbles:!0,cancelable:!0});window.dispatchEvent(e)}syncCredentials(t=!1){this.iframeRef&&this.iframeRef.contentWindow?this.performCredentialSync(t):setTimeout(()=>this.syncCredentials(t),500)}performCredentialSync(t){if(!this.iframeRef?.contentWindow)throw new Error("Cannot sync credentials: iframe reference not available");const e=localStorage.getItem("CREDENTIAL_ID")||"",a=localStorage.getItem("PUBLIC_KEY")||"",n=localStorage.getItem("SMART_WALLET_ADDRESS")||"";if(!(t||e&&a))return;const r={type:"SYNC_CREDENTIALS",data:{credentialId:e,publickey:a,smartWalletAddress:n,timestamp:Date.now()}};try{this.iframeRef.contentWindow.postMessage(r,"*"),this.retryDelays.forEach(t=>{setTimeout(()=>{try{this.iframeRef?.contentWindow&&this.iframeRef.contentWindow.postMessage(r,"*")}catch(t){}},t)})}catch(t){}}storeCredential(t){t.credentialId&&localStorage.setItem("CREDENTIAL_ID",t.credentialId),t.publickey&&localStorage.setItem("PUBLIC_KEY",t.publickey),t.smartWalletAddress&&localStorage.setItem("SMART_WALLET_ADDRESS",t.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",(new Date).toISOString())}destroy(){this.removeAllListeners(),this.iframeRef=null}}class ee extends g{constructor(t){super(),this.dialogRef=null,this.iframeRef=null,this.popupWindow=null,this.popupCloseInterval=null,this.isClosing=!1,this.isDestroyed=!1,this.logger=new U("DialogManager"),this._currentAction=null,this.config=t,this.credentialManager=new te,this.logger.debug("Created dialog manager"),this.setupMessageListener()}async openConnect(){return new Promise((t,e)=>{const a=()=>{this.off("connect-result",n),this.off("error",r)},n=e=>{a(),t(e)},r=t=>{a(),e(t)};this.on("connect-result",n),this.on("error",r);const i=setTimeout(()=>{a(),e(new Error("Connection timed out after 60 seconds"))},6e4),s=t,o=e;t=t=>{clearTimeout(i),s(t)},e=t=>{clearTimeout(i),o(t)},this._currentAction=D.CONNECT;if(this.shouldUsePopup("connect")){const t=`${this.config.portalUrl}?action=${D.CONNECT}`;this.openPopup(t).catch(e)}else this.openConnectDialog().catch(e)})}async openSign(t,e,a,n){return new Promise((r,i)=>{const s=()=>{this.off("sign-result",o),this.off("error",l)},o=t=>{s(),r(t)},l=t=>{s(),i(t)};this.on("sign-result",o),this.on("error",l);const c=setTimeout(()=>{s(),i(new Error("Signing timed out after 60 seconds"))},6e4),d=r,A=i;r=t=>{clearTimeout(c),d(t)},i=t=>{clearTimeout(c),A(t)},this._currentAction=D.SIGN;const u=this.shouldUsePopup("sign"),p=encodeURIComponent(t);let m=`${this.config.portalUrl}?action=${D.SIGN}&message=${p}&transaction=${encodeURIComponent(e)}&credentialId=${encodeURIComponent(a)}`;n&&(m+=`&clusterSimulation=${n}`),u?this.openPopup(m).catch(i):this.openSignDialog(m).catch(i)})}async openSignMessage(t,e){return new Promise((a,n)=>{const r=()=>{this.off("sign-result",i),this.off("error",s)},i=t=>{r(),a(t)},s=t=>{r(),n(t)};this.on("sign-result",i),this.on("error",s);const o=setTimeout(()=>{r(),n(new Error("Signing timed out after 60 seconds"))},6e4),l=a,c=n;a=t=>{clearTimeout(o),l(t)},n=t=>{clearTimeout(o),c(t)},this._currentAction=D.SIGN;const d=encodeURIComponent(t),A=`${this.config.portalUrl}?action=${D.SIGN}&message=${d}&credentialId=${encodeURIComponent(e)}`;this.shouldUsePopup("sign")?this.openPopup(A).catch(n):this.openSignDialog(A).catch(n)})}async openConnectDialog(){const t=`${this.config.portalUrl}?action=${D.CONNECT}`;await this.openModal(t)}ensureFonts(){const t="lazorkit-font-roboto-flex";if(document.getElementById(t))return;const e=document.createElement("link");e.id=t,e.rel="stylesheet",e.href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,100..1000&display=swap",document.head.appendChild(e)}ensureDialogBackdropCSS(){const t="lazorkit-dialog-backdrop-style";if(document.getElementById(t))return;const e=document.createElement("style");e.id=t,e.textContent='\n    /* ===== Backdrop (overlay nhẹ) ===== */\n    dialog#lazorkit-dialog::backdrop {\n      background: rgba(0,0,0,0);\n      animation: lazor-backdrop-in 160ms ease-out forwards;\n    }\n\n    dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n      animation: lazor-backdrop-out 140ms ease-in forwards;\n    }\n\n    @keyframes lazor-backdrop-in {\n      from { background: rgba(0,0,0,0); }\n      to   { background: rgba(0,0,0,0.12); } /* ✅ overlay nhẹ */\n    }\n\n    @keyframes lazor-backdrop-out {\n      from { background: rgba(0,0,0,0.12); }\n      to   { background: rgba(0,0,0,0); }\n    }\n\n    /* ===== Panel animations ===== */\n    @keyframes lazor-drawer-in {\n      from { transform: translateY(16px); opacity: 0.98; }\n      to   { transform: translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-drawer-out {\n      from { transform: translateY(0); opacity: 1; }\n      to   { transform: translateY(16px); opacity: 0.98; }\n    }\n\n    @keyframes lazor-float-in {\n      from { transform: scale(0.985) translateY(4px); opacity: 0; }\n      to   { transform: scale(1) translateY(0); opacity: 1; }\n    }\n\n    @keyframes lazor-float-out {\n      from { transform: scale(1) translateY(0); opacity: 1; }\n      to   { transform: scale(0.985) translateY(4px); opacity: 0; }\n    }\n\n    #lazorkit-panel {\n      will-change: transform, opacity;\n      transform-origin: center;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-drawer-in 180ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="drawer"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-drawer-out 150ms ease-in forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="opening"] #lazorkit-panel {\n      animation: lazor-float-in 170ms cubic-bezier(.2,.9,.2,1) forwards;\n    }\n\n    dialog#lazorkit-dialog[data-variant="floating"][data-state="closing"] #lazorkit-panel {\n      animation: lazor-float-out 140ms ease-in forwards;\n    }\n\n    /* ===== Reduced motion ===== */\n    @media (prefers-reduced-motion: reduce) {\n      dialog#lazorkit-dialog::backdrop {\n        animation: none !important;\n        background: rgba(0,0,0,0.12) !important;\n      }\n      dialog#lazorkit-dialog[data-state="closing"]::backdrop {\n        background: rgba(0,0,0,0) !important;\n      }\n      dialog#lazorkit-dialog #lazorkit-panel {\n        animation: none !important;\n      }\n    }\n  ',document.head.appendChild(e)}createCloseButton(t){const e=document.createElement("button");return e.type="button",e.title="Close Dialog",e.setAttribute("aria-label","Close Dialog"),Object.assign(e.style,{width:"36px",height:"36px",borderRadius:"10px",border:"none",background:"transparent",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",padding:"0",color:"rgba(255, 255, 255, 0.6)",outline:"none",webkitTapHighlightColor:"transparent"}),e.addEventListener("mouseenter",()=>{e.style.background="rgba(255,255,255,0.1)",e.style.color="#ffffff"}),e.addEventListener("mouseleave",()=>{e.style.background="transparent",e.style.color="rgba(255, 255, 255, 0.6)"}),e.onclick=t,e.innerHTML='\n    <svg xmlns="http://www.w3.org/2000/svg"\n      width="20" height="20" viewBox="0 0 24 24"\n      fill="none" stroke="currentColor" stroke-width="2"\n      stroke-linecap="round" stroke-linejoin="round">\n      <line x1="18" y1="6" x2="6" y2="18" />\n      <line x1="6" y1="6" x2="18" y2="18" />\n    </svg>\n  ',e}async openSignDialog(t){await this.openModal(t),this.iframeRef&&(this.credentialManager.setIframeRef(this.iframeRef),setTimeout(()=>{this.credentialManager.syncCredentials(!0)},500))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}shouldUsePopup(t){const e=this.isMobileDevice();return!(!this.isSafari()||"connect"!==t)||(!(!e||"connect"!==t)||!(!e&&"sign"===t)&&(!e||"sign"!==t))}getPopupDimensions(){if(!window.top)return{width:450,height:600,top:0,left:0};const t=window.top.outerWidth/2+window.top.screenX-225;return{width:450,height:600,top:window.top.outerHeight/2+window.top.screenY-300,left:t}}async openPopup(t){if(this.popupWindow&&!this.popupWindow.closed)try{this.popupWindow.close()}catch(t){}const e=this.getPopupDimensions();if(this.popupWindow=window.open(t,"lazorkit-popup",`width=${e.width},height=${e.height},top=${e.top},left=${e.left},resizable,scrollbars,status`),this.startPopupMonitor(),!this.popupWindow)throw this.logger.error("Popup was blocked by browser"),new Error("Popup was blocked by browser")}startPopupMonitor(){this.popupCloseInterval&&clearInterval(this.popupCloseInterval),this.popupCloseInterval=setInterval(()=>{this.popupWindow?.closed&&(this.popupWindow=null,this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null))},500)}async openModal(t){this.dialogRef||this.createModal(),this.iframeRef&&(this.iframeRef.src=t),this.dialogRef&&!this.dialogRef.open&&(this.dialogRef.setAttribute("data-state","opening"),this.dialogRef.showModal(),window.setTimeout(()=>{this.dialogRef?.open&&this.dialogRef.setAttribute("data-state","idle")},220))}createModal(){this.ensureFonts(),this.ensureDialogBackdropCSS();const t=document.createElement("dialog");t.id="lazorkit-dialog",t.style.colorScheme="dark",t.setAttribute("data-theme","dark");const e=this.isMobileDevice(),a=(t=>({overlay:{position:"fixed",inset:0,padding:0,border:"none",background:"transparent",width:"100%",height:"100%",maxWidth:"none",maxHeight:"none",overflow:"visible",zIndex:2147483647,display:"grid",placeItems:t?"end center":"center"},panel:{width:t?"100%":"360px",maxWidth:t?"100%":"90vw",height:t?"55vh":"650px",maxHeight:t?"55vh":"90vh",background:"white",borderRadius:t?"20px 20px 0 0":"20px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",overflow:"hidden",position:"relative"},closeButton:{zIndex:10},iframeContainer:{position:"relative",width:"100%",height:"100%",border:"none",margin:0,padding:0,overflow:"hidden",borderRadius:"inherit",background:"white"},iframe:{width:"100%",height:"100%",border:0,borderRadius:"inherit",display:"block"}}))(e);Object.assign(t.style,a.overlay),Object.assign(t.style,{"--background-color-th_base":"#191919","--background-color-th_frame":"#191919","--text-color-th_base":"#eeeeee","--border-color-th_frame":"rgba(255,255,255,0.10)"});const n=document.createElement("div"),r=e?"drawer":"floating";t.setAttribute("data-variant",r),t.setAttribute("data-state","idle"),n.id="lazorkit-panel",Object.assign(n.style,a.panel),Object.assign(n.style,{display:"flex",flexDirection:"column"}),Object.assign(n.style,{background:"var(--background-color-th_base, #fcfcfc)",color:"var(--text-color-th_base, #202020)",fontFamily:'"Roboto Flex", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif'});const i=document.createElement("div");Object.assign(i.style,{height:"32px",flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"flex-end",padding:"0 12px",boxSizing:"border-box",borderBottom:"1px solid rgba(0,0,0,0.08)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, var(--background-color-th_base, #fcfcfc))",color:"var(--text-color-th_base, #202020)",borderBottom:"1px solid var(--border-color-th_frame, rgba(0,0,0,0.08))"});const s=document.createElement("div");Object.assign(s.style,a.iframeContainer),Object.assign(s.style,{flex:"1 1 auto"}),Object.assign(s.style,{background:"var(--background-color-th_base, #fcfcfc)"}),Object.assign(n.style,{background:"var(--background-color-th_base, #191919)",color:"var(--text-color-th_base, #eeeeee)"}),Object.assign(i.style,{background:"var(--background-color-th_frame, #191919)",color:"var(--text-color-th_base, #eeeeee)",borderBottom:"1px solid var(--border-color-th_frame, rgba(255,255,255,0.10))"}),Object.assign(s.style,{background:"var(--background-color-th_base, #191919)"});const o=this.createCloseButton(()=>{this.closeDialog(),this.emit("close")});Object.assign(o.style,{position:"static",top:"",right:""}),o.id="lazorkit-dialog-close",o.ariaLabel="Close",Object.assign(o.style,a.closeButton);const l=document.createElement("iframe");l.id="lazorkit-iframe",Object.assign(l.style,a.iframe),l.allow=`publickey-credentials-get ${this.config.portalUrl}; publickey-credentials-create ${this.config.portalUrl}; clipboard-write; camera; microphone`;const c=l.sandbox;c.add("allow-forms"),c.add("allow-scripts"),c.add("allow-same-origin"),c.add("allow-popups"),c.add("allow-popups-to-escape-sandbox"),c.add("allow-modals"),l.setAttribute("aria-label","Lazor Wallet"),l.tabIndex=0,l.title="Lazor",t.addEventListener("cancel",()=>this.closeDialog()),t.addEventListener("click",e=>{e.target===t&&this.closeDialog()}),i.appendChild(o),n.appendChild(i),s.appendChild(l),n.appendChild(s),t.appendChild(n),document.body.appendChild(t),this.dialogRef=t,this.iframeRef=l}setupMessageListener(){window.addEventListener("message",t=>{if(!t.origin.includes(new URL(this.config.portalUrl).hostname))return;const{type:e,data:a,error:n}=t.data;if(n)this.emit("error",new Error(n.message||"Portal error"));else switch(e){case"connect-result":case"WALLET_CONNECTED":const t={publicKey:a.publickey||a.publicKey||"",credentialId:a.credentialId,isCreated:"create"===a.connectionType||!!a.publickey,connectionType:a.connectionType||(a.publickey?"create":"get"),timestamp:a.timestamp||Date.now(),accountName:a.accountName};this.emit("connect-result",t),this.closeDialog();break;case"sign-result":case"SIGNATURE_CREATED":const e={signature:a.normalized,clientDataJsonBase64:a.clientDataJSONReturn,authenticatorDataBase64:a.authenticatorDataReturn,signedPayload:a.msg};this.emit("sign-result",e),this.closeDialog();break;case"error":this.emit("error",new Error(a?.message||"Unknown portal error"));break;case"close":this.closeDialog()}})}closeDialog(){if(this.isClosing)return;this.isClosing=!0;const t=this.dialogRef,e=this.iframeRef;try{t&&t.setAttribute("data-state","closing"),window.setTimeout(()=>{try{if(e&&(e.parentNode&&e.parentNode.removeChild(e),this.iframeRef=null),t){try{t.open&&t.close()}catch{}t.parentNode&&t.parentNode.removeChild(t),this.dialogRef=null}if(this.popupWindow){try{this.popupWindow.close()}catch{}this.popupWindow=null}this.popupCloseInterval&&(clearInterval(this.popupCloseInterval),this.popupCloseInterval=null),this.logger.debug("Closed dialog (animated)")}catch(t){this.logger.error("Error during animated close:",t)}finally{this.isClosing=!1}},170)}catch(t){this.logger.error("Error closing dialog:",t),this.isClosing=!1}}getIframeRef(){return this.iframeRef}getDialogRef(){return this.dialogRef}getPopupWindow(){return this.popupWindow}getCurrentAction(){return this._currentAction}destroy(){this.isDestroyed||(this.isDestroyed=!0,this.closeDialog(),this.credentialManager.destroy(),this.removeAllListeners(),this.logger.debug("Destroyed dialog manager"))}}const ae=t=>new ee({portalUrl:t.portalUrl,rpcUrl:t.rpcUrl,paymasterUrl:t.paymasterConfig.paymasterUrl}),ne=t=>Array.from(new Uint8Array(p.arrayBuffer(Buffer.from(t,"base64")))),re=(t,e,a)=>{const n=t instanceof Error?t:new Error(String(t));throw e({error:n}),a?.(n),n},ie=t=>t?Array.from(Buffer.from(t,"base64")):[],se=async(t,e,a)=>{const{isConnecting:n,config:r}=t();if(n)throw new Error("Already connecting");e({isConnecting:!0,error:null});try{const n=await x.getWallet();if((()=>{if("undefined"==typeof window)return;const t=localStorage.getItem("lazorkit-wallet");if(t)try{const e=JSON.parse(t);e.state&&void 0!==e.version&&localStorage.removeItem("lazorkit-wallet")}catch(t){}})(),n)return e({wallet:n}),a?.onSuccess?.(n),n;const i=ae(r);try{const n=await i.openConnect(),s=new R(r.paymasterConfig),o=new $t(t().connection),l=ne(n.credentialId),c=await o.getSmartWalletByCredentialHash(l);let d,A;if(!n.publicKey&&c?(A=Buffer.from(c.passkeyPubkey).toString("base64"),localStorage.setItem("PUBLIC_KEY",A)):A=n.publicKey,c)d=c.smartWallet.toBase58();else{const t=await s.getPayer(),e=await o.createSmartWalletTxn({passkeyPublicKey:ie(A),payer:t,credentialIdBase64:n.credentialId});await s.signAndSend(e.transaction),d=e.smartWallet.toBase58()}const u={credentialId:n.credentialId,passkeyPubkey:ie(A),expo:"web",platform:navigator.platform,smartWallet:d,walletDevice:"",accountName:n.accountName};return await x.saveWallet(u),e({wallet:u}),a?.onSuccess?.(u),u}finally{i.destroy()}}catch(t){return re(t,e,a?.onFail)}finally{e({isConnecting:!1})}},oe=d()(C((t,e)=>({wallet:null,config:{portalUrl:P.PORTAL_URL,paymasterConfig:{paymasterUrl:P.PAYMASTER_URL},rpcUrl:P.RPC_ENDPOINT},connection:new s(P.RPC_ENDPOINT,W),isLoading:!1,isConnecting:!1,isSigning:!1,error:null,setConfig:e=>{try{const a=new s(e.rpcUrl||P.RPC_ENDPOINT,W);t({config:e,connection:a})}catch(t){throw console.error("Failed to update wallet configuration:",t,{config:e}),new Error(`Failed to update configuration: ${t}`)}},setWallet:e=>{try{t({wallet:e})}catch(t){throw console.error("Failed to set wallet:",t,{wallet:e}),t}},setLoading:e=>t({isLoading:e}),setConnecting:e=>t({isConnecting:e}),setSigning:e=>t({isSigning:e}),setConnection:e=>{try{t({connection:e})}catch(t){throw console.error("Failed to set connection:",t,{endpoint:e?.rpcEndpoint}),t}},setError:e=>{t({error:e}),e&&console.error("Error state set:",e)},clearError:()=>{t({error:null})},connect:a=>se(e,t,a),disconnect:()=>(async(t,e)=>{try{await x.clearWallet(),t({wallet:null,error:null,isConnecting:!1,isSigning:!1,isLoading:!1}),e?.onSuccess?.()}catch(a){return re(a,t,e?.onFail)}})(t),signAndSendTransaction:a=>(async(t,e,a)=>{const{isSigning:n,connection:r,wallet:i,config:s}=t();if(n)throw new Error("Already signing");if(!i)throw new Error("No wallet connected");if(!r)throw new Error("No connection available");e({isSigning:!0,error:null});try{const t=new R(s.paymasterConfig),e=new $t(r),n=await t.getPayer(),o=await O(r),l=await e.buildAuthorizationMessage({action:{type:T.CreateChunk,args:{policyInstruction:null,cpiInstructions:a.instructions}},payer:n,smartWallet:new A.web3.PublicKey(i.smartWallet),passkeyPublicKey:i.passkeyPubkey,timestamp:new A.BN(o),credentialHash:ne(i.credentialId)}),c=Buffer.from(l).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),d=await r.getLatestBlockhash(),u=new A.web3.TransactionMessage({payerKey:n,recentBlockhash:d.blockhash,instructions:a.instructions}).compileToV0Message(),p=new A.web3.VersionedTransaction(u),m=Buffer.from(p.serialize()).toString("base64"),g=ae(s),h=i.credentialId,y=a.transactionOptions?.clusterSimulation;try{const s=await g.openSign(c,m,h,y),l={msg:c,normalized:s.signature,clientDataJSONReturn:s.clientDataJsonBase64,authenticatorDataReturn:s.authenticatorDataBase64},d=ne(i.credentialId),u=await e.createChunkTxn({payer:n,smartWallet:new A.web3.PublicKey(i.smartWallet),passkeySignature:{passkeyPublicKey:i.passkeyPubkey,signature64:l.normalized,clientDataJsonRaw64:l.clientDataJSONReturn,authenticatorDataRaw64:l.authenticatorDataReturn},policyInstruction:null,cpiInstructions:a.instructions,timestamp:o,credentialHash:d}),p=await t.signAndSend(u);await r.confirmTransaction(p);const f=a.transactionOptions?.addressLookupTableAccounts||[],w=await e.executeChunkTxn({payer:n,smartWallet:new A.web3.PublicKey(i.smartWallet),cpiInstructions:a.instructions},{addressLookupTables:f,computeUnitLimit:a.transactionOptions?.computeUnitLimit});let b;return b=f.length>0?await t.signAndSendVersionedTransaction(w):await t.signAndSend(w),a.onSuccess?.(b),b}finally{g.destroy()}}catch(t){return re(t,e,a.onFail)}finally{e({isSigning:!1})}})(e,t,a),signMessage:a=>(async(t,e,a)=>{const{isSigning:n,wallet:r,config:i}=t();if(n)throw new Error("Already signing");if(!r)throw new Error("No wallet connected");e({isSigning:!0,error:null});try{const t=ae(i);try{const e=await t.openSignMessage(a,r.credentialId);return{signature:e.signature,signedPayload:e.signedPayload}}finally{t.destroy()}}catch(t){throw e({error:t}),t}finally{e({isSigning:!1})}})(e,t,a)}),{name:"lazorkit-wallet-store",storage:I(()=>B),partialize:t=>({wallet:t.wallet,config:t.config})})),le=n=>{const{children:r,rpcUrl:i=P.RPC_ENDPOINT,portalUrl:s=P.PORTAL_URL,paymasterConfig:o={paymasterUrl:P.PAYMASTER_URL}}=n,{setConfig:l}=oe();return a(()=>{l({portalUrl:s,paymasterConfig:o,rpcUrl:i})},[i,s,o,l]),t(e,{children:r})};function ce(t){return Uint8Array.from(atob(t),t=>t.charCodeAt(0))}async function de(t){let e=t;if(64===e.length){const t=new Uint8Array(65);t[0]=4,t.set(e,1),e=t}return crypto.subtle.importKey("raw",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])}async function Ae({signedPayload:t,signature:e,publicKey:a}){const n=ce(t),r=ce(e),i=ce(a),s=await de(i);return crypto.subtle.verify({name:"ECDSA",hash:"SHA-256"},s,r,n)}const ue=()=>{const{wallet:t,isLoading:e,isConnecting:a,isSigning:i,error:s,connect:o,disconnect:l,signAndSendTransaction:c,signMessage:d}=oe(),A=n(async t=>{try{return await o(t)}catch(t){throw console.error("Failed to connect wallet:",t),t}},[o]),u=n(async()=>{try{await l()}catch(t){throw console.error("Failed to disconnect wallet:",t),t}},[l]),p=n(async t=>{try{return await c({instructions:t.instructions,transactionOptions:t.transactionOptions})}catch(t){throw console.error("Failed to sign and send transaction:",t),t}},[c]),m=n(async t=>{try{return await d(t)}catch(t){throw console.error("Failed to sign message:",t),t}},[d]),g=n(async({signedPayload:t,signature:e,publicKey:a})=>{const n=Buffer.from(t).toString("base64"),r=Buffer.from(e).toString("base64"),i=Buffer.from(a).toString("base64");return await Ae({signedPayload:n,signature:r,publicKey:i})},[]);return{smartWalletPubkey:t?.smartWallet?new r(t.smartWallet):null,isConnected:!!t,isLoading:e||a||i,isConnecting:a,isSigning:i,error:s,wallet:t,connect:A,disconnect:u,signAndSendTransaction:p,signMessage:m,verifyMessage:g}};function pe(){if("undefined"!=typeof window&&window.ReactNativeWebView)return"mobile";const t=navigator.userAgent.toLowerCase();return/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t)?"mobile":"web"}function me(){const t=navigator.userAgent.toLowerCase();return/^((?!chrome|android).)*safari/i.test(t)}function ge(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)}function he(){return/Android/i.test(navigator.userAgent)}const ye="CREDENTIAL_ID",fe="PUBLIC_KEY",we="SMART_WALLET_ADDRESS";class be{static saveCredentials(t){try{t.credentialId&&localStorage.setItem(ye,t.credentialId),localStorage.setItem(fe,t.publickey),localStorage.setItem(we,t.smartWalletAddress),localStorage.setItem("CREDENTIALS_TIMESTAMP",t.timestamp.toString())}catch(t){console.error("Failed to save credentials to local storage:",t)}}static getCredentials(){try{const t=localStorage.getItem(ye),e=localStorage.getItem(fe),a=localStorage.getItem(we),n=localStorage.getItem("CREDENTIALS_TIMESTAMP");return e&&a?{credentialId:t||void 0,publickey:e,smartWalletAddress:a,timestamp:n?parseInt(n):Date.now()}:null}catch(t){return console.error("Failed to get credentials from local storage:",t),null}}static updateSmartWalletAddress(t){try{localStorage.setItem(we,t)}catch(t){console.error("Failed to update smart wallet address in local storage:",t)}}static clearCredentials(){try{localStorage.removeItem(ye),localStorage.removeItem(fe),localStorage.removeItem(we),localStorage.removeItem("CREDENTIALS_TIMESTAMP"),console.log("Credentials cleared from local storage")}catch(t){console.error("Failed to clear credentials from local storage:",t)}}static getItem(t){return localStorage.getItem(t)}static setItem(t,e){localStorage.setItem(t,e)}}const ke="Lazorkit Wallet",Se={rpcUrl:"https://api.devnet.solana.com",portalUrl:"https://portal.lazor.sh",paymasterConfig:{paymasterUrl:"https://kora.devnet.lazorkit.com"}};class Ie extends h{constructor(t){super(),this.name=ke,this.url="https://lazorkit.com",this.icon="data:image/png;base64,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",this.supportedTransactionVersions=new Set(["legacy",0]),this._publicKey=null,this._readyState="undefined"==typeof window||"undefined"==typeof document?y.Unsupported:y.Installed,this._connecting=!1,this._wallet=null,this._config=Se,t&&(this._config={...this._config,...t})}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==y.Installed)throw new f;this._connecting=!0,this.emit("readyStateChange",this._readyState);const t=await x.getWallet();if(t)return void this._updateWalletState(t);const e=this._createDialogManager();try{const t=await e.openConnect(),a=await this._ensureWalletOnChain(t);await x.saveWallet(a),this._updateWalletState(a)}finally{e.destroy()}}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}_updateWalletState(t){this._wallet=t,this._publicKey=new r(t.smartWallet),this.emit("connect",this._publicKey)}_createDialogManager(){return new ee({portalUrl:this._config.portalUrl,rpcUrl:this._config.rpcUrl,paymasterUrl:this._config.paymasterConfig.paymasterUrl})}async _ensureWalletOnChain(t){const e=new s(this._config.rpcUrl),a=new k({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),n=new $t(e),r=ne(t.credentialId),i=await n.getSmartWalletByCredentialHash(r);let o,l;if(!t.publicKey&&i?(l=u.from(i.passkeyPubkey).toString("base64"),localStorage.setItem("PUBLIC_KEY",l)):l=t.publicKey,i)o=i.smartWallet.toBase58();else{const e=await a.getPayerSigner(),r=await n.createSmartWalletTxn({passkeyPublicKey:ie(t.publicKey),payer:new A.web3.PublicKey(e.signer_address),credentialIdBase64:t.credentialId});await a.signAndSendTransaction({transaction:u.from(r.transaction.serialize({requireAllSignatures:!1})).toString("base64"),signer_key:e.signer_address}),o=r.smartWallet.toBase58()}return{credentialId:t.credentialId,passkeyPubkey:ie(l),expo:"web",platform:navigator.platform,smartWallet:o,walletDevice:""}}async disconnect(){await x.clearWallet(),this._wallet=null,this._publicKey=null,this.emit("disconnect")}async sendTransaction(t){try{if(!this._wallet||!this._publicKey)throw new w;const e=this._prepareInstructions(t);if(0===e.length)throw new b("No instructions to sign");const a=this._initializeClients();let n=[];if("version"in t){const e=t.message.addressTableLookups;n=await Promise.all(e.map(async t=>{const e=await a.connection.getAccountInfo(t.accountKey);if(!e)throw new Error("Lookup table not found");return new o({key:t.accountKey,state:o.deserialize(e.data)})}))}const r=await a.paymaster.getPayerSigner(),i=await O(a.connection),s=ne(this._wallet.credentialId),l=await this._buildAuthorizationMessage(a.smartWallet,e,r.signer_address,i,s),c=await a.connection.getLatestBlockhash(),d=await this._signWithDialog(l,e,c.blockhash,r.signer_address);return await this._executeSmartWalletTransaction(a,e,d,r.signer_address,i,s,n)}catch(t){throw this.emit("error",t),t}}async signTransaction(t){throw new b("Lazorkit Wallet does not support signTransaction. Please use sendTransaction or signAndSendTransaction.")}async signAllTransactions(t){throw new b("Lazorkit Wallet does not support signAllTransactions. Please use sendTransaction or signAndSendTransaction.")}async signMessage(t){const e=this._createDialogManager();try{if(!this._wallet||!this._publicKey)throw new w;const a=u.from(t).toString("base64"),n=await e.openSign(a,"",this._wallet.credentialId,this._config.clusterSimulation),r=JSON.stringify({signature:n.signature,signedPayload:n.signedPayload});return new Uint8Array(u.from(r))}catch(t){throw this.emit("error",t),t}finally{e.destroy()}}_initializeClients(){const t=new s(this._config.rpcUrl);return{connection:t,paymaster:new k({rpcUrl:this._config.paymasterConfig.paymasterUrl,apiKey:this._config.paymasterConfig.apiKey}),smartWallet:new $t(t)}}_prepareInstructions(t){return"version"in t?t.message.compiledInstructions.map(e=>new l({keys:e.accountKeyIndexes.map(e=>({pubkey:t.message.staticAccountKeys[e],isSigner:t.message.isAccountSigner(e),isWritable:t.message.isAccountWritable(e)})),programId:new r(t.message.staticAccountKeys[e.programIdIndex]),data:u.from(e.data)})):[...t.instructions]}async _buildAuthorizationMessage(t,e,a,n,r){return await t.buildAuthorizationMessage({action:{type:T.CreateChunk,args:{policyInstruction:null,cpiInstructions:e}},payer:new A.web3.PublicKey(a),smartWallet:this._publicKey,passkeyPublicKey:this._wallet.passkeyPubkey,timestamp:new A.BN(n),credentialHash:r})}async _signWithDialog(t,e,a,n){const r=u.from(t).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,""),i=this._createDialogManager();try{const t=new A.web3.TransactionMessage({payerKey:new A.web3.PublicKey(n),recentBlockhash:a,instructions:e}).compileToV0Message(),s=new A.web3.VersionedTransaction(t),o=u.from(s.serialize()).toString("base64");return await i.openSign(r,o,this._wallet.credentialId,this._config.clusterSimulation)}finally{i.destroy()}}async _executeSmartWalletTransaction(t,e,a,n,r,i,s){const o=await t.smartWallet.createChunkTxn({payer:new A.web3.PublicKey(n),smartWallet:this._publicKey,passkeySignature:{passkeyPublicKey:this._wallet.passkeyPubkey,signature64:a.signature,clientDataJsonRaw64:a.clientDataJsonBase64,authenticatorDataRaw64:a.authenticatorDataBase64},policyInstruction:null,cpiInstructions:e,timestamp:r,credentialHash:i}),l=await this._sendToPaymaster(t.paymaster,o,n);await t.connection.confirmTransaction(l,"confirmed");const c=await t.smartWallet.executeChunkTxn({payer:new A.web3.PublicKey(n),smartWallet:this._publicKey,cpiInstructions:e},{addressLookupTables:s});return await this._sendToPaymaster(t.paymaster,c,n)}async _sendToPaymaster(t,e,a){let n;n="version"in e?u.from(e.serialize()):u.from(e.serialize({requireAllSignatures:!1,verifySignatures:!1}));return(await t.signAndSendTransaction({transaction:n.toString("base64"),signer_key:a})).signature}}function ve(t){S(new Ce(t))}class Ce{constructor(t){this.version="1.0.0",this.name=ke,this.icon="data:image/png;base64,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",this._account=null,this._listeners={},this._adapter=new Ie(t),this._adapter.on("connect",t=>{this._account={address:t.toBase58(),publicKey:t.toBytes(),chains:["solana:mainnet","solana:devnet","solana:testnet"],features:["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"]},this._emit("change",{accounts:[this._account]})}),this._adapter.on("disconnect",()=>{this._account=null,this._emit("change",{accounts:[]})})}get accounts(){return this._account?[this._account]:[]}get chains(){return["solana:mainnet","solana:devnet","solana:testnet"]}get features(){return{"standard:connect":{version:"1.0.0",connect:async()=>(await this._adapter.connect(),{accounts:this.accounts})},"standard:disconnect":{version:"1.0.0",disconnect:async()=>{await this._adapter.disconnect()}},"standard:events":{version:"1.0.0",on:(t,e)=>(this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),()=>{this._listeners[t]=this._listeners[t]?.filter(t=>t!==e)||[]})},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:async(...t)=>{const e=[];for(const a of t){const t=c.deserialize(a.transaction),n=await this._adapter.sendTransaction(t);e.push({signature:m.decode(n)})}return e}},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:async(...t)=>{throw new Error("signTransaction not supported")}},"solana:signMessage":{version:"1.0.0",signMessage:async(...t)=>{const e=[];for(const a of t){const t=await this._adapter.signMessage(a.message);e.push({message:a.message,signature:t,signedMessage:a.message})}return e}}}}_emit(t,...e){this._listeners[t]?.forEach(t=>t(...e))}}export{D as API_ENDPOINTS,Bt as CHUNK_SEED,J as CREDENTIAL_HASH_SIZE,P as DEFAULTS,W as DEFAULT_COMMITMENT,Se as DEFAULT_CONFIG,wt as DefaultPolicyClient,ee as DialogManager,_ as EMPTY_PDA_RENT_EXEMPT_BALANCE,$t as LazorkitClient,le as LazorkitProvider,Ie as LazorkitWalletAdapter,ke as LazorkitWalletName,U as Logger,G as PASSKEY_PUBLIC_KEY_SIZE,R as Paymaster,Z as SIGNATURE_SIZE,Wt as SMART_WALLET_CONFIG_SEED,Dt as SMART_WALLET_SEED,E as STORAGE_KEYS,T as SmartWalletAction,x as StorageManager,be as StorageUtil,Y as ValidationError,Et as WALLET_DEVICE_SEED,F as asCredentialHash,z as asPasskeyPublicKey,V as asSignature,$ as assertByteArrayLength,X as assertDefined,dt as assertNonEmptyArray,tt as assertNonEmptyByteArray,ct as assertNonEmptyString,ot as assertPositiveBN,gt as assertPositiveInteger,lt as assertPositiveNumber,mt as assertValidBase64,nt as assertValidCredentialHash,et as assertValidPasskeyPublicKey,q as assertValidPublicKey,ht as assertValidPublicKeyArray,it as assertValidSignature,At as assertValidTransactionInstruction,yt as assertValidTransactionInstructionArray,ce as base64ToBytes,Lt as buildCreateChunkMessage,Vt as buildExecuteMessage,jt as buildPasskeyVerificationInstruction,qt as buildTransaction,N as byteArrayEquals,Xt as calculateVerifyInstructionIndex,Zt as combineInstructionsWithAuth,Yt as combineInstructionsWithAuthAndCU,zt as computeMultipleCpiHashes,_t as convertPasskeySignatureToInstructionArgs,Gt as createComputeUnitLimitInstruction,K as credentialHashFromBase64,Tt as deriveChunkPda,Ut as deriveSmartWalletConfigPda,xt as deriveSmartWalletPda,Rt as deriveWalletDevicePda,pe as detectPlatform,O as getBlockchainTimestamp,Q as getRandomBytes,de as importP256PublicKey,H as instructionToAccountMetas,he as isAndroid,ge as isIOS,me as isSafari,pt as normalizePublicKey,Jt as prependComputeUnitLimit,ve as registerLazorkitWallet,ut as toNumberArray,ft as toNumberArraySafe,ue as useWallet,oe as useWalletStore,rt as validateCredentialHash,at as validatePasskeyPublicKey,st as validateSignature,Ae as verifySignatureBrowser};
 //# sourceMappingURL=index.mjs.map
